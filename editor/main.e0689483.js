import{n as e,e as t,u as s,a as r}from"../js/lib/fun-events.5ba1262f.js";import{C as a,p as o,R as i}from"../js/wesib/wesib.c27beefd.js";import{_ as l}from"../js/helpers.920c7f83.js";import{a as c}from"../js/core/auth.9a3c67b8.js";import{a as n}from"../js/core/api.a23e84e5.js";import{S as d,O as p,N as m,b as u,c as f,h}from"../js/wesib/generic.e7a7b809.js";import{h as j,j as b,r as v,k as g,f as y,I as S}from"../js/lib/input-aspects.61d8d5b5.js";import{C as _}from"../js/core.f6946162.js";import{a as k}from"../js/core/loader.ba3f37d3.js";import{c as C}from"../js/core/main.3e01346b.js";import{a as w,A as U}from"../js/core/articles.c4298e56.js";import{F as x}from"../js/core/feed.97566213.js";import{n as F}from"../js/current-article.10cd4166.js";import{U as O,F as A,C as I}from"../js/core/input.dae7d5fd.js";let R=class{};R=l([a(["article-body",_],O({select:"textarea",makeControl:({node:{element:e},aspects:t})=>j(e,{aspects:t}).setup(b,e=>e.by(v()))}),d("body"))],R);let q=class{};q=l([a(["article-description",_],O({makeControl:({node:{element:e},aspects:t})=>j(e,{aspects:t}).setup(b,e=>e.by(v()))}),d("description"))],q);let P=class{};P=l([a(["article-tag-editor",_])],P);let E=class{};E=l([a(["article-title",_],O({makeControl:({node:{element:e},aspects:t})=>j(e,{aspects:t}).setup(b,e=>e.by(v()))}),d("title"))],E);let M=class{constructor(a){this._context=a,this.article=F,this._navigation=a.get(m),this._articleService=a.get(U);const o=a.get(c),i=a.get(u);a.whenOn(a=>{a.whenOff(()=>{this.loadStatus=void 0,this.article=F}),this._navigation.read.tillOff(a).keep.thru_(e=>decodeURIComponent(e.get(f).pathname.substring(1)),a=>e(t({user:o.requiredUser,loaded:a?s(this._articleService.article(a),()=>[]):r({ok:!0}),form:i.get(h)})))(({user:[e],loaded:[t],form:[{control:s}]})=>{var r,a;e.username?t?t.ok?(this.loadStatus=t,this.article=null!==(r=t.body)&&void 0!==r?r:F,s&&(s.it=null!==(a=t.body)&&void 0!==a?a:{title:"",description:"",body:""})):this.loadStatus={ok:!1,errors:t.errors}:this.loadStatus=void 0:this.loadStatus=e.failure?{ok:!1,errors:e.failure.errors}:void 0})})}render(){const{element:e}=this._context,t=e.querySelector("button");return()=>{t.innerText=this.article.slug?"Update Post":"Create Post"}}submit({control:e}){e.aspect(g).markEdited(),e.aspect(y).submit(e=>n(this.article.slug?this._articleService.updateArticle(this.article.slug,e):this._articleService.createArticle(e))).then(e=>this._navigation.with(f,encodeURIComponent(e.slug)).open("article/")).catch(e=>{e instanceof S?console.error("Failed to save article",...e.errors):console.error("Failed to save article",e)})}};l([k()],M.prototype,"loadStatus",void 0),l([o()],M.prototype,"article",void 0),l([i()],M.prototype,"render",null),l([p()],M.prototype,"submit",null),M=l([a(["article-editor",_],{feature:{needs:[R,q,P,E,w,I,x]}},A({emptyModel:{title:"",description:"",body:""}}))],M),C.load(M);//# sourceMappingURL=main.e0689483.js.map
