import{c as t}from"../js/core/main.65d7bafb.js";import{_ as e}from"../js/helpers.e1623395.js";import{r as s,c as r,s as o,b as a,q as i,I as c}from"../js/frontmeans/input-aspects.453491d0.js";import{F as n,s as l,m as d,j as p,i as m,C as j,b as u}from"../js/proc7ts/fun-events.2a5b87d8.js";import{S as f,O as h,N as b,a as g,P as v,c as y}from"../js/wesib/generic.2dcf3479.js";import{C as S,S as C,R as _,B as k}from"../js/wesib/wesib.8c9ee002.js";import{C as w}from"../js/core.10059585.js";import{a as x}from"../js/core/api.e1bac610.js";import{a as F,A as U}from"../js/core/articles.dcb8de86.js";import{b as q}from"../js/core/auth.97776b50.js";import{F as L,a as A}from"../js/core/feed.aabbc2ee.js";import{U as E,F as I,C as M}from"../js/core/input.475c0ace.js";import{M as O,i as P,a as R}from"../js/core/loader.9029aa45.js";import{n as T}from"../js/current-article.5d42c2d4.js";import"../js/core/layout.52c96865.js";import"../js/frontmeans/namespace-aliaser.9467f14d.js";import"../js/frontmeans/dom-events.fbc8d9ac.js";import"../js/proc7ts/primitives.d6f0dd1c.js";import"../js/frontmeans/render-scheduler.6f331202.js";import"../js/proc7ts/push-iterator.8feb4ef8.js";import"../js/proc7ts/call-thru.f4f68410.js";import"../js/proc7ts/delta-set.d5d9e832.js";import"../js/proc7ts/context-values.20584faa.js";import"../js/hatsy/http-header-value.851567fb.js";import"../js/proc7ts/workbench.03f3f31a.js";import"../js/frontmeans/httongue.6b868a5b.js";import"../js/lib/dompurify.f5eadf9f.js";import"../js/lib/marked.2adf5b72.js";let B=class{};B=e([S(["article-body",w],E({select:"textarea",makeControl:({node:{element:t},aspects:e})=>s(t,{aspects:e}).setup(r,(t=>t.by(o())))}),f("body"))],B);let H=class{};H=e([S(["article-description",w],E({makeControl:({node:{element:t},aspects:e})=>s(t,{aspects:e}).setup(r,(t=>t.by(o())))}),f("description"))],H);let N=class{constructor(t){this._context=t,this.tags=[],t.get(A).tags.do(n(t))(((...t)=>this.tags=t)).whenOff((()=>this.tags=[]))}render(){const{document:t}=this._context.get(k),{element:e}=this._context,s=e.querySelector("datalist");return()=>{s.innerHTML="",this.tags.forEach((e=>{s.appendChild(t.createElement("option")).value=e+" "}))}}};e([C()],N.prototype,"tags",void 0),e([_()],N.prototype,"render",null),N=e([S(["article-tag-editor",w],{feature:{needs:[L,O]}},E({select:"conduit-multi-input",makeControl:({node:{element:t}})=>P(t)}),f("tagList"))],N);let z=class{};z=e([S(["article-title",w],E({makeControl:({node:{element:t},aspects:e})=>s(t,{aspects:e}).setup(r,(t=>t.by(o())))}),f("title"))],z);let D=class{constructor(t){this._context=t,this.article=T,this._navigation=t.get(b),this._articleService=t.get(U);const e=t.get(q),s=t.get(g);t.supply.whenOff((()=>{this.loadStatus=void 0,this.article=T})),t.whenConnected((()=>{this._navigation.read.do(l(t),d((t=>decodeURIComponent(t.get(v).pathname.substring(1)))),p((t=>m({user:e.requireUser,loaded:t?j(this._articleService.article(t),(()=>[])):u({ok:!0}),form:s.get(y)}))))((({user:[t],loaded:[e],form:[{control:s}]})=>{var r,o;t.username?e?e.ok?(this.loadStatus=e,this.article=null!==(r=e.body)&&void 0!==r?r:T,s&&(s.it=null!==(o=e.body)&&void 0!==o?o:{title:"",description:"",body:"",tagList:[]})):this.loadStatus={ok:!1,errors:e.errors}:this.loadStatus=void 0:this.loadStatus=t.failure?{ok:!1,errors:t.failure.errors}:void 0}))}))}render(){const{element:t}=this._context,e=t.querySelector("button");return()=>{e.innerText=this.article.slug?"Update Post":"Create Post"}}submit({control:t}){t.aspect(a).markEdited(),t.aspect(i).submit((t=>x(this.article.slug?this._articleService.updateArticle(this.article.slug,t):this._articleService.createArticle(t)))).then((t=>this._navigation.with(v,encodeURIComponent(t.slug)).open("article/"))).catch((t=>{t instanceof c?console.error("Failed to save article",...t.errors):console.error("Failed to save article",t)}))}};e([R()],D.prototype,"loadStatus",void 0),e([C()],D.prototype,"article",void 0),e([_()],D.prototype,"render",null),e([h()],D.prototype,"submit",null),D=e([S(["article-editor",w],{feature:{needs:[B,H,N,z,F,M,L]}},I({emptyModel:{title:"",description:"",body:"",tagList:[]}}))],D),t.load(D);//# sourceMappingURL=main.2022d35e.js.map
