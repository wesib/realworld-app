import{b as t,g as e,d as s,a as r}from"../js/lib/fun-events.f47c7338.js";import{C as o,S as a,R as i,B as l}from"../js/wesib/wesib.4cfe016a.js";import{_ as c}from"../js/helpers.920c7f83.js";import{b as n}from"../js/core/auth.b91b93f3.js";import{a as d}from"../js/core/api.59192f3b.js";import{S as p,O as m,N as u,a as h,P as f,d as b}from"../js/wesib/generic.b8309e8a.js";import{r as g,c as j,s as v,b as y,q as S,I as _}from"../js/lib/input-aspects.e48d1860.js";import{C}from"../js/core.f6946162.js";import{i as k,M as w,a as x}from"../js/core/loader.dfe39bab.js";import{c as O}from"../js/core/main.54398e44.js";import{a as U,A as q}from"../js/core/articles.7d3c6834.js";import{F,a as L}from"../js/core/feed.326d2eb7.js";import{n as A}from"../js/current-article.4d677396.js";import{U as E,F as I,C as M}from"../js/core/input.11c77951.js";let P=class{};P=c([o(["article-body",C],E({select:"textarea",makeControl:({node:{element:t},aspects:e})=>g(t,{aspects:e}).setup(j,t=>t.by(v()))}),p("body"))],P);let R=class{};R=c([o(["article-description",C],E({makeControl:({node:{element:t},aspects:e})=>g(t,{aspects:e}).setup(j,t=>t.by(v()))}),p("description"))],R);let T=class{constructor(t){this._context=t,this.tags=[],t.whenOn(e=>{t.get(L).tags().tillOff(e).to((...t)=>this.tags=t).whenOff(()=>this.tags=[])})}render(){const{document:t}=this._context.get(l),{element:e}=this._context,s=e.querySelector("datalist");return()=>{s.innerHTML="",this.tags.forEach(e=>{s.appendChild(t.createElement("option")).value=e+" "})}}};c([a()],T.prototype,"tags",void 0),c([i()],T.prototype,"render",null),T=c([o(["article-tag-editor",C],{feature:{needs:[F,w]}},E({select:"conduit-multi-input",makeControl:({node:{element:t}})=>k(t)}),p("tagList"))],T);let B=class{};B=c([o(["article-title",C],E({makeControl:({node:{element:t},aspects:e})=>g(t,{aspects:e}).setup(j,t=>t.by(v()))}),p("title"))],B);let H=class{constructor(o){this._context=o,this.article=A,this._navigation=o.get(u),this._articleService=o.get(q);const a=o.get(n),i=o.get(h);o.whenOn(o=>{o.whenOff(()=>{this.loadStatus=void 0,this.article=A}),this._navigation.read().tillOff(o).keepThru_(t=>decodeURIComponent(t.get(f).pathname.substring(1)),o=>t(e({user:a.requireUser(),loaded:o?s(this._articleService.article(o),()=>[]):r({ok:!0}),form:i.get(b)}))).to(({user:[t],loaded:[e],form:[{control:s}]})=>{var r,o;t.username?e?e.ok?(this.loadStatus=e,this.article=null!==(r=e.body)&&void 0!==r?r:A,s&&(s.it=null!==(o=e.body)&&void 0!==o?o:{title:"",description:"",body:"",tagList:[]})):this.loadStatus={ok:!1,errors:e.errors}:this.loadStatus=void 0:this.loadStatus=t.failure?{ok:!1,errors:t.failure.errors}:void 0})})}render(){const{element:t}=this._context,e=t.querySelector("button");return()=>{e.innerText=this.article.slug?"Update Post":"Create Post"}}submit({control:t}){t.aspect(y).markEdited(),t.aspect(S).submit(t=>d(this.article.slug?this._articleService.updateArticle(this.article.slug,t):this._articleService.createArticle(t))).then(t=>this._navigation.with(f,encodeURIComponent(t.slug)).open("article/")).catch(t=>{t instanceof _?console.error("Failed to save article",...t.errors):console.error("Failed to save article",t)})}};c([x()],H.prototype,"loadStatus",void 0),c([a()],H.prototype,"article",void 0),c([i()],H.prototype,"render",null),c([m()],H.prototype,"submit",null),H=c([o(["article-editor",C],{feature:{needs:[P,R,T,B,U,M,F]}},I({emptyModel:{title:"",description:"",body:"",tagList:[]}}))],H),O.load(H);//# sourceMappingURL=main.64575e0e.js.map
