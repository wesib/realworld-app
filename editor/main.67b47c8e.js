import"../js/proc7ts/primitives.3596c309.js";import"../js/proc7ts/push-iterator.b943ed6f.js";import"../js/proc7ts/context-values.91624d4c.js";import"../js/frontmeans/namespace-aliaser.e08188c9.js";import{F as t,s as e,m as s,g as r,f as o,B as a,b as i}from"../js/proc7ts/fun-events.26e814e4.js";import"../js/proc7ts/workbench.47577449.js";import"../js/frontmeans/dom-events.272f64a1.js";import"../js/frontmeans/render-scheduler.78bb570f.js";import{C as c,S as l,R as n,B as p}from"../js/wesib/wesib.a2d60763.js";import{_ as d}from"../js/helpers.e1623395.js";import{b as m}from"../js/core/auth.81df9cb2.js";import{a as u}from"../js/core/api.a7ea7d29.js";import"../js/hatsy/http-header-value.0845e903.js";import{S as j,O as f,N as h,a as b,P as g,c as v}from"../js/wesib/generic.fb9d31ab.js";import"../js/proc7ts/delta-set.d5d9e832.js";import{r as y,c as S,s as _,b as C,q as k,I as w}from"../js/frontmeans/input-aspects.ed13f267.js";import{C as x}from"../js/core.c152f8fe.js";import{M as F,i as U,a as q}from"../js/core/loader.d22f956e.js";import"../js/core/layout.b9fbd9a2.js";import{c as L}from"../js/core/main.9ff13c21.js";import{a as A,A as E}from"../js/core/articles.34a938a1.js";import"../js/lib/dompurify.f5eadf9f.js";import"../js/lib/marked.5b76e7a8.js";import"../js/proc7ts/call-thru.f4f68410.js";import{F as I,a as M}from"../js/core/feed.298d7830.js";import{n as O}from"../js/current-article.c9b2c40d.js";import{U as P,F as R,C as B}from"../js/core/input.e4c44730.js";let T=class{};T=d([c(["article-body",x],P({select:"textarea",makeControl:({node:{element:t},aspects:e})=>y(t,{aspects:e}).setup(S,(t=>t.by(_())))}),j("body"))],T);let H=class{};H=d([c(["article-description",x],P({makeControl:({node:{element:t},aspects:e})=>y(t,{aspects:e}).setup(S,(t=>t.by(_())))}),j("description"))],H);let N=class{constructor(e){this._context=e,this.tags=[],e.get(M).tags.do(t(e))(((...t)=>this.tags=t)).whenOff((()=>this.tags=[]))}render(){const{document:t}=this._context.get(p),{element:e}=this._context,s=e.querySelector("datalist");return()=>{s.innerHTML="",this.tags.forEach((e=>{s.appendChild(t.createElement("option")).value=e+" "}))}}};d([l()],N.prototype,"tags",void 0),d([n()],N.prototype,"render",null),N=d([c(["article-tag-editor",x],{feature:{needs:[I,F]}},P({select:"conduit-multi-input",makeControl:({node:{element:t}})=>U(t)}),j("tagList"))],N);let z=class{};z=d([c(["article-title",x],P({makeControl:({node:{element:t},aspects:e})=>y(t,{aspects:e}).setup(S,(t=>t.by(_())))}),j("title"))],z);let D=class{constructor(t){this._context=t,this.article=O,this._navigation=t.get(h),this._articleService=t.get(E);const c=t.get(m),l=t.get(b);t.supply.whenOff((()=>{this.loadStatus=void 0,this.article=O})),t.whenConnected((()=>{this._navigation.read.do(e(t),s((t=>decodeURIComponent(t.get(g).pathname.substring(1)))),r((t=>o({user:c.requireUser,loaded:t?a(this._articleService.article(t),(()=>[])):i({ok:!0}),form:l.get(v)}))))((({user:[t],loaded:[e],form:[{control:s}]})=>{var r,o;t.username?e?e.ok?(this.loadStatus=e,this.article=null!==(r=e.body)&&void 0!==r?r:O,s&&(s.it=null!==(o=e.body)&&void 0!==o?o:{title:"",description:"",body:"",tagList:[]})):this.loadStatus={ok:!1,errors:e.errors}:this.loadStatus=void 0:this.loadStatus=t.failure?{ok:!1,errors:t.failure.errors}:void 0}))}))}render(){const{element:t}=this._context,e=t.querySelector("button");return()=>{e.innerText=this.article.slug?"Update Post":"Create Post"}}submit({control:t}){t.aspect(C).markEdited(),t.aspect(k).submit((t=>u(this.article.slug?this._articleService.updateArticle(this.article.slug,t):this._articleService.createArticle(t)))).then((t=>this._navigation.with(g,encodeURIComponent(t.slug)).open("article/"))).catch((t=>{t instanceof w?console.error("Failed to save article",...t.errors):console.error("Failed to save article",t)}))}};d([q()],D.prototype,"loadStatus",void 0),d([l()],D.prototype,"article",void 0),d([n()],D.prototype,"render",null),d([f()],D.prototype,"submit",null),D=d([c(["article-editor",x],{feature:{needs:[T,H,N,z,A,B,I]}},R({emptyModel:{title:"",description:"",body:"",tagList:[]}}))],D),L.load(D);//# sourceMappingURL=main.67b47c8e.js.map
