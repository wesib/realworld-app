import"../js/proc7ts/primitives.90941b78.js";import"../js/proc7ts/push-iterator.e3c0f3f1.js";import"../js/proc7ts/context-values.de0fa082.js";import"../js/proc7ts/call-thru.104a1934.js";import{i as t,b as e,g as s,d as r,a}from"../js/proc7ts/fun-events.751f4123.js";import"../js/frontmeans/namespace-aliaser.54a2e6c0.js";import"../js/frontmeans/render-scheduler.c6ad5452.js";import{C as o,S as i,R as c,B as l}from"../js/wesib/wesib.fd49a6cd.js";import{_ as n}from"../js/helpers.e1623395.js";import{b as p}from"../js/core/auth.2372f198.js";import{a as d}from"../js/core/api.850f8641.js";import{S as m,O as u,N as f,a as j,P as h,c as b}from"../js/wesib/generic.1df87fc1.js";import"../js/proc7ts/delta-set.9ee1ffba.js";import{r as g,c as v,s as y,b as S,q as _,I as C}from"../js/frontmeans/input-aspects.8b5674f5.js";import{C as k}from"../js/core.bba16f1a.js";import{M as x,i as w,a as O}from"../js/core/loader.46a2a88b.js";import"../js/core/layout.2906fa88.js";import{c as U}from"../js/core/main.e6d61b54.js";import{a as q,A as F}from"../js/core/articles.aa6b0084.js";import"../js/lib/dompurify.0d835c13.js";import"../js/lib/marked.55574563.js";import{F as L,a as A}from"../js/core/feed.e63c551e.js";import{n as E}from"../js/current-article.faae2888.js";import{U as I,F as M,C as P}from"../js/core/input.28057277.js";let R=class{};R=n([o(["article-body",k],I({select:"textarea",makeControl:({node:{element:t},aspects:e})=>g(t,{aspects:e}).setup(v,(t=>t.by(y())))}),m("body"))],R);let T=class{};T=n([o(["article-description",k],I({makeControl:({node:{element:t},aspects:e})=>g(t,{aspects:e}).setup(v,(t=>t.by(y())))}),m("description"))],T);let B=class{constructor(t){this._context=t,this.tags=[],t.get(A).tags().tillOff(t).to(((...t)=>this.tags=t)).whenOff((()=>this.tags=[]))}render(){const{document:t}=this._context.get(l),{element:e}=this._context,s=e.querySelector("datalist");return()=>{s.innerHTML="",this.tags.forEach((e=>{s.appendChild(t.createElement("option")).value=e+" "}))}}};n([i()],B.prototype,"tags",void 0),n([c()],B.prototype,"render",null),B=n([o(["article-tag-editor",k],{feature:{needs:[L,x]}},I({select:"conduit-multi-input",makeControl:({node:{element:t}})=>w(t)}),m("tagList"))],B);let H=class{};H=n([o(["article-title",k],I({makeControl:({node:{element:t},aspects:e})=>g(t,{aspects:e}).setup(v,(t=>t.by(y())))}),m("title"))],H);let N=class{constructor(o){this._context=o,this.article=E,this._navigation=o.get(f),this._articleService=o.get(F);const i=o.get(p),c=o.get(j);t(o).whenOff((()=>{this.loadStatus=void 0,this.article=E})),o.whenConnected((()=>{this._navigation.read().tillOff(o).keepThru_((t=>decodeURIComponent(t.get(h).pathname.substring(1))),(t=>e(s({user:i.requireUser(),loaded:t?r(this._articleService.article(t),(()=>[])):a({ok:!0}),form:c.get(b)})))).to((({user:[t],loaded:[e],form:[{control:s}]})=>{var r,a;t.username?e?e.ok?(this.loadStatus=e,this.article=null!==(r=e.body)&&void 0!==r?r:E,s&&(s.it=null!==(a=e.body)&&void 0!==a?a:{title:"",description:"",body:"",tagList:[]})):this.loadStatus={ok:!1,errors:e.errors}:this.loadStatus=void 0:this.loadStatus=t.failure?{ok:!1,errors:t.failure.errors}:void 0}))}))}render(){const{element:t}=this._context,e=t.querySelector("button");return()=>{e.innerText=this.article.slug?"Update Post":"Create Post"}}submit({control:t}){t.aspect(S).markEdited(),t.aspect(_).submit((t=>d(this.article.slug?this._articleService.updateArticle(this.article.slug,t):this._articleService.createArticle(t)))).then((t=>this._navigation.with(h,encodeURIComponent(t.slug)).open("article/"))).catch((t=>{t instanceof C?console.error("Failed to save article",...t.errors):console.error("Failed to save article",t)}))}};n([O()],N.prototype,"loadStatus",void 0),n([i()],N.prototype,"article",void 0),n([c()],N.prototype,"render",null),n([u()],N.prototype,"submit",null),N=n([o(["article-editor",k],{feature:{needs:[R,T,B,H,q,P,L]}},M({emptyModel:{title:"",description:"",body:"",tagList:[]}}))],N),U.load(N);//# sourceMappingURL=main.b24163a0.js.map
