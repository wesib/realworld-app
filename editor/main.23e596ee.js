import{n as e,e as t,u as s,a}from"../js/lib/fun-events.5ba1262f.js";import{C as r}from"../js/wesib/wesib.698f6f57.js";import{_ as o}from"../js/helpers.920c7f83.js";import{a as i}from"../js/core/auth.9c82fb41.js";import{a as c}from"../js/core/api.75ae058d.js";import{S as l,O as n,N as d,b as m,P as p,f}from"../js/wesib/generic.0655e5c8.js";import{r as u,g as j,s as h,f as b,q as g,I as v}from"../js/lib/input-aspects.3610fdda.js";import{C as _}from"../js/core.f6946162.js";import{a as y}from"../js/core/loader.5d4e024f.js";import{c as k}from"../js/core/main.b23f36d7.js";import{a as S,A as C}from"../js/core/articles.530c016b.js";import{U as w,F,C as O}from"../js/core/input.9ae948cd.js";import{n as A}from"../js/current-article.10cd4166.js";import{F as I}from"../js/core/feed.2bac4641.js";let U=class{};U=o([r(["article-body",_],w({select:"textarea",makeControl:({node:{element:e},aspects:t})=>u(e,{aspects:t}).setup(j,e=>e.by(h()))}),l("body"))],U);let R=class{};R=o([r(["article-description",_],w({makeControl:({node:{element:e},aspects:t})=>u(e,{aspects:t}).setup(j,e=>e.by(h()))}),l("description"))],R);let q=class{};q=o([r(["article-tag-editor",_])],q);let x=class{};x=o([r(["article-title",_],w({makeControl:({node:{element:e},aspects:t})=>u(e,{aspects:t}).setup(j,e=>e.by(h()))}),l("title"))],x);let E=class{constructor(r){this._navigation=r.get(d),this._articleService=r.get(C);const o=r.get(i),c=r.get(m);r.whenOn(r=>{r.whenOff(()=>{this.loadStatus=void 0,this._article=void 0}),this._navigation.read.tillOff(r).keep.thru_(e=>decodeURIComponent(e.get(p).pathname.substring(1)),r=>e(t({user:o.user,loaded:r?s(this._articleService.article(r),()=>[{ok:!0}]):a({ok:!0}),form:c.get(f)})))(({user:[e],loaded:[t],form:[{control:s}]})=>{var a,r;e.username||!e.failure?t.ok?(this.loadStatus=t,this._article=null!==(a=t.body)&&void 0!==a?a:A,s&&(s.it=null!==(r=t.body)&&void 0!==r?r:{title:"",description:"",body:""})):this.loadStatus={ok:!1,errors:t.errors}:this.loadStatus={ok:!1,errors:e.failure.errors}})})}submit({control:e}){e.aspect(b).markEdited(),e.aspect(g).submit(e=>c(this._article&&this._article.slug?this._articleService.updateArticle(this._article.slug,e):this._articleService.createArticle(e))).then(e=>this._navigation.with(p,encodeURIComponent(e.slug)).open("article/")).catch(e=>{e instanceof v?console.error("Failed to save article",...e.errors):console.error("Failed to save article",e)})}};o([y()],E.prototype,"loadStatus",void 0),o([n()],E.prototype,"submit",null),E=o([r(["article-editor",_],{feature:{needs:[U,R,q,x,S,O,I]}},F({emptyModel:{title:"",description:"",body:""}}))],E),k.load(E);//# sourceMappingURL=main.23e596ee.js.map
