{"version":3,"file":"main.a015c15a.js","sources":["../../src/pages/editor/article-body.component.ts","../../src/pages/editor/article-description.component.ts","../../src/pages/editor/article-tag-editor.component.ts","../../src/pages/editor/article-title.component.ts","../../src/pages/editor/article-editor.component.ts","../../src/pages/editor/main.ts"],"sourcesContent":["import { inText, InValidation, requirePresent } from '@frontmeans/input-aspects';\nimport { Field, SharedField } from '@wesib/generic/forms';\nimport { Component, ComponentContext } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\n\n@Component(['article-body', Conduit__NS])\nexport class ArticleBodyComponent {\n\n  @SharedField()\n  body?: Field<string>;\n\n  constructor(context: ComponentContext) {\n    context.whenSettled(({ element }: { element: Element }) => {\n      this.body = Field.by(\n          opts => inText(element.querySelector('textarea')!, opts)\n              .setup(InValidation, validation => validation.by(requirePresent())),\n      );\n    });\n  }\n\n}\n","import { inText, InValidation, requirePresent } from '@frontmeans/input-aspects';\nimport { Field, SharedField } from '@wesib/generic/forms';\nimport { Component, ComponentContext } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\n\n@Component(['article-description', Conduit__NS])\nexport class ArticleDescriptionComponent {\n\n  @SharedField()\n  description?: Field<string>;\n\n  constructor(context: ComponentContext) {\n    context.whenSettled(({ element }: { element: Element }) => {\n      this.description = Field.by(\n          opts => inText(element.querySelector('input')!, opts)\n              .setup(InValidation, validation => validation.by(requirePresent())),\n      );\n    });\n  }\n\n}\n","import { supplyOn } from '@proc7ts/fun-events';\nimport { Field, SharedField } from '@wesib/generic/forms';\nimport {\n  BootstrapContext,\n  BootstrapWindow,\n  Component,\n  ComponentContext,\n  ElementRenderer,\n  Render,\n  StateProperty,\n} from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { FeedService, FeedSupport } from '../../core/feed';\nimport { inMultiInput, MultiInputComponent } from '../../reusable';\n\n@Component(\n    ['article-tag-editor', Conduit__NS],\n    {\n      feature: {\n        needs: [\n          FeedSupport,\n          MultiInputComponent,\n        ],\n      },\n    },\n)\nexport class ArticleTagEditorComponent {\n\n  @StateProperty()\n  private tags: string[] = [];\n\n  @SharedField()\n  tagList?: Field<readonly string[]>;\n\n  constructor(private readonly _context: ComponentContext) {\n    _context.get(FeedService).tags.do(supplyOn(_context))(\n        (...tags) => this.tags = tags,\n    ).whenOff(\n        () => this.tags = [],\n    );\n\n    const bsContext = _context.get(BootstrapContext);\n\n    _context.whenSettled(({ element }: { element: Element }) => {\n      bsContext.whenDefined(MultiInputComponent)(({ elementDef: { tagName } }) => {\n        this.tagList = Field.by(opts => inMultiInput(element.querySelector(tagName!)!, opts));\n      }).needs(_context);\n    });\n  }\n\n  @Render()\n  render(): ElementRenderer {\n\n    const { document } = this._context.get(BootstrapWindow);\n    const { element }: { element: Element } = this._context;\n    const datalist = element.querySelector('datalist')!;\n\n    return () => {\n      datalist.innerHTML = '';\n      this.tags.forEach(tag => {\n\n        const option = datalist.appendChild(document.createElement('option'));\n\n        option.value = tag + ' ';\n      });\n    };\n  }\n\n}\n","import { inText, InValidation, requirePresent } from '@frontmeans/input-aspects';\nimport { Field, SharedField } from '@wesib/generic/forms';\nimport { Component, ComponentContext } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\n\n@Component(['article-title', Conduit__NS])\nexport class ArticleTitleComponent {\n\n  @SharedField()\n  title?: Field<string>;\n\n  constructor(context: ComponentContext) {\n    context.whenSettled(({ element }: { element: Element }) => {\n      this.title = Field.by(\n          opts => inText(element.querySelector('input')!, opts)\n              .setup(InValidation, validation => validation.by(requirePresent())),\n      );\n    });\n  }\n\n}\n","import { inFormElement, inGroup, InStatus, InSubmit, InSubmitError } from '@frontmeans/input-aspects';\nimport { afterAll, afterSent, afterThe, digAfter_, mapAfter_, supplyAfter } from '@proc7ts/fun-events';\nimport { Navigation, PageHashURLParam } from '@wesib/generic';\nimport { Field, Form, FormShare, OnSubmit, SharedField, SharedForm } from '@wesib/generic/forms';\nimport { Component, ComponentContext, ElementRenderer, Render, StateProperty } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { ApiResponse, apiSubmit } from '../../core/api';\nimport { Article, ArticleService, ArticlesSupport, CreateArticleRequest } from '../../core/articles';\nimport { AuthService } from '../../core/auth';\nimport { FeedSupport } from '../../core/feed';\nimport { ConduitFormsSupport, submitButton } from '../../core/forms';\nimport { LoadStatus, RenderLoader } from '../../core/loader';\nimport { noArticle, NoArticle } from '../article/current-article';\nimport { ArticleBodyComponent } from './article-body.component';\nimport { ArticleDescriptionComponent } from './article-description.component';\nimport { ArticleTagEditorComponent } from './article-tag-editor.component';\nimport { ArticleTitleComponent } from './article-title.component';\n\n@Component(\n    ['article-editor', Conduit__NS],\n    {\n      feature: {\n        needs: [\n          ArticleBodyComponent,\n          ArticleDescriptionComponent,\n          ArticleTagEditorComponent,\n          ArticleTitleComponent,\n          ArticlesSupport,\n          ConduitFormsSupport,\n          FeedSupport,\n        ],\n      },\n    },\n)\nexport class ArticleEditorComponent {\n\n  private readonly _articleService: ArticleService;\n  private readonly _navigation: Navigation;\n\n  @RenderLoader()\n  loadStatus?: LoadStatus;\n\n  @StateProperty()\n  article: Article | NoArticle = noArticle;\n\n  @SharedForm()\n  form?: Form<CreateArticleRequest>;\n\n  @SharedField({\n    form: {\n      share: FormShare,\n      local: true,\n    },\n    name: '',\n  })\n  submitButton?: Field<void>;\n\n  constructor(private readonly _context: ComponentContext) {\n    this._navigation = _context.get(Navigation);\n    this._articleService = _context.get(ArticleService);\n\n    const authService = _context.get(AuthService);\n\n    _context.supply.whenOff(() => {\n      this.loadStatus = undefined;\n      this.article = noArticle;\n    });\n    _context.whenSettled(({ element }: { element: Element }) => {\n      this.form = Form.by(\n          opts => inGroup(emptyArticleRequest(), opts),\n          opts => inFormElement(element.querySelector('form')!, opts),\n      );\n      this.submitButton = submitButton(element.querySelector('button')!);\n    });\n    _context.whenConnected(() => {\n      this._navigation.read.do(\n          supplyAfter(_context),\n          mapAfter_(page => decodeURIComponent(\n              page.get(PageHashURLParam).pathname.substring(1),\n          )),\n          digAfter_(slug => afterAll({\n            user: authService.requireUser,\n            loaded: slug\n                ? afterSent<[ApiResponse.Any<Article>?]>(\n                    this._articleService.article(slug),\n                    () => [],\n                )\n                : afterThe<[ApiResponse.Any<Article>]>({ ok: true }),\n          })),\n      )(({\n        user: [user],\n        loaded: [loaded],\n      }) => {\n        if (!user.username) {\n          this.loadStatus = user.failure ? { ok: false, errors: user.failure.errors } : undefined;\n          return;\n        }\n        if (!loaded) {\n          this.loadStatus = undefined;\n          return;\n        }\n        if (!loaded.ok) {\n          this.loadStatus = { ok: false, errors: loaded.errors };\n          return;\n        }\n        this.loadStatus = loaded;\n        this.article = loaded.body ?? noArticle;\n\n        const form = this.form?.control;\n\n        if (form) {\n          form.it = loaded.body ?? emptyArticleRequest();\n        }\n      }).needs(_context);\n    });\n  }\n\n  @Render()\n  render(): ElementRenderer {\n\n    const { element }: { element: Element } = this._context;\n    const button = element.querySelector('button')!;\n\n    return () => {\n      button.innerText = this.article.slug ? 'Update Post' : 'Create Post';\n    };\n  }\n\n  @OnSubmit()\n  submit({ control }: Form.Controls<CreateArticleRequest>): void {\n    control.aspect(InStatus).markEdited();\n    control.aspect(InSubmit)\n        .submit(\n            request => apiSubmit<Article>(\n                this.article.slug\n                    ? this._articleService.updateArticle(this.article.slug, request)\n                    : this._articleService.createArticle(request),\n            ),\n        )\n        .then(article => this._navigation\n            .with(PageHashURLParam, encodeURIComponent(article.slug))\n            .open('article/'))\n        .catch(error => {\n          if (error instanceof InSubmitError) {\n            console.error('Failed to save article', ...error.errors);\n          } else {\n            console.error('Failed to save article', error);\n          }\n        });\n  }\n\n}\n\nfunction emptyArticleRequest(): CreateArticleRequest {\n  return {\n    title: '',\n    description: '',\n    body: '',\n    tagList: [],\n  };\n}\n","import { conduitContext } from '../../core/main';\nimport { ArticleEditorComponent } from './article-editor.component';\n\nconduitContext.load(ArticleEditorComponent);\n"],"names":["ArticleBodyComponent","[object Object]","context","whenSettled","element","this","body","Field","by","opts","inText","querySelector","setup","InValidation","validation","requirePresent","__decorate","SharedField","Component","Conduit__NS","ArticleDescriptionComponent","description","ArticleTagEditorComponent","_context","get","FeedService","tags","do","supplyOn","whenOff","bsContext","BootstrapContext","whenDefined","MultiInputComponent","elementDef","tagName","tagList","inMultiInput","needs","document","BootstrapWindow","datalist","innerHTML","forEach","tag","appendChild","createElement","value","StateProperty","Render","feature","FeedSupport","ArticleTitleComponent","title","ArticleEditorComponent","noArticle","_navigation","Navigation","_articleService","ArticleService","authService","AuthService","supply","loadStatus","undefined","article","form","Form","inGroup","inFormElement","submitButton","whenConnected","read","supplyAfter","mapAfter_","page","decodeURIComponent","PageHashURLParam","pathname","substring","digAfter_","slug","afterAll","user","requireUser","loaded","afterSent","afterThe","ok","username","failure","errors","control","it","button","innerText","aspect","InStatus","markEdited","InSubmit","submit","request","apiSubmit","updateArticle","createArticle","then","with","encodeURIComponent","open","catch","error","InSubmitError","console","RenderLoader","SharedForm","share","FormShare","local","name","OnSubmit","ArticlesSupport","ConduitFormsSupport","conduitContext","load"],"mappings":"ggDAMA,IAAaA,EAAb,MAKEC,YAAYC,GACVA,EAAQC,aAAY,EAAGC,QAAAA,MACrBC,KAAKC,KAAOC,EAAMC,IACdC,GAAQC,EAAON,EAAQO,cAAc,YAAcF,GAC9CG,MAAMC,GAAcC,GAAcA,EAAWN,GAAGO,cAN7DC,GADCC,gCAFUjB,KADZkB,EAAU,CAAC,eAAgBC,KACfnB,GCAb,IAAaoB,EAAb,MAKEnB,YAAYC,GACVA,EAAQC,aAAY,EAAGC,QAAAA,MACrBC,KAAKgB,YAAcd,EAAMC,IACrBC,GAAQC,EAAON,EAAQO,cAAc,SAAWF,GAC3CG,MAAMC,GAAcC,GAAcA,EAAWN,GAAGO,cAN7DC,GADCC,uCAFUG,KADZF,EAAU,CAAC,sBAAuBC,KACtBC,GCoBb,IAAaE,EAAb,MAQErB,YAA6BsB,GAAAlB,cAAAkB,EALrBlB,UAAiB,GAMvBkB,EAASC,IAAIC,GAAaC,KAAKC,GAAGC,EAASL,GAA3CA,EACI,IAAIG,IAASrB,KAAKqB,KAAOA,IAC3BG,SACE,IAAMxB,KAAKqB,KAAO,KAGtB,MAAMI,EAAYP,EAASC,IAAIO,GAE/BR,EAASpB,aAAY,EAAGC,QAAAA,MACtB0B,EAAUE,YAAYC,EAAtBH,EAA2C,EAAGI,YAAcC,QAAAA,OAC1D9B,KAAK+B,QAAU7B,EAAMC,IAAGC,GAAQ4B,EAAajC,EAAQO,cAAcwB,GAAY1B,QAC9E6B,MAAMf,MAKbtB,SAEE,MAAMsC,SAAEA,GAAalC,KAAKkB,SAASC,IAAIgB,IACjCpC,QAAEA,GAAkCC,KAAKkB,SACzCkB,EAAWrC,EAAQO,cAAc,YAEvC,MAAO,KACL8B,EAASC,UAAY,GACrBrC,KAAKqB,KAAKiB,SAAQC,IAEDH,EAASI,YAAYN,EAASO,cAAc,WAEpDC,MAAQH,EAAM,UAlC3B5B,GADCgC,gCAIDhC,GADCC,mCAoBDD,GADCiC,gCAxBU3B,KAXZJ,EACG,CAAC,qBAAsBC,GACvB,CACE+B,QAAS,CACPZ,MAAO,CACLa,EACAlB,OAKGX,GCpBb,IAAa8B,EAAb,MAKEnD,YAAYC,GACVA,EAAQC,aAAY,EAAGC,QAAAA,MACrBC,KAAKgD,MAAQ9C,EAAMC,IACfC,GAAQC,EAAON,EAAQO,cAAc,SAAWF,GAC3CG,MAAMC,GAAcC,GAAcA,EAAWN,GAAGO,cAN7DC,GADCC,iCAFUmC,KADZlC,EAAU,CAAC,gBAAiBC,KAChBiC,GC4Bb,IAAaE,EAAb,MAuBErD,YAA6BsB,GAAAlB,cAAAkB,EAd7BlB,aAA+BkD,EAe7BlD,KAAKmD,YAAcjC,EAASC,IAAIiC,GAChCpD,KAAKqD,gBAAkBnC,EAASC,IAAImC,GAEpC,MAAMC,EAAcrC,EAASC,IAAIqC,GAEjCtC,EAASuC,OAAOjC,SAAQ,KACtBxB,KAAK0D,gBAAaC,EAClB3D,KAAK4D,QAAUV,KAEjBhC,EAASpB,aAAY,EAAGC,QAAAA,MACtBC,KAAK6D,KAAOC,EAAK3D,IACbC,GAAQ2D,EAqFT,CACLf,MAAO,GACPhC,YAAa,GACbf,KAAM,GACN8B,QAAS,IAzFoC3B,KACvCA,GAAQ4D,EAAcjE,EAAQO,cAAc,QAAUF,KAE1DJ,KAAKiE,aAAeA,EAAalE,EAAQO,cAAc,cAEzDY,EAASgD,eAAc,KACrBlE,KAAKmD,YAAYgB,KAAK7C,GAClB8C,EAAYlD,GACZmD,GAAUC,GAAQC,mBACdD,EAAKnD,IAAIqD,GAAkBC,SAASC,UAAU,MAElDC,GAAUC,GAAQC,EAAS,CACzBC,KAAMvB,EAAYwB,YAClBC,OAAQJ,EACFK,EACEjF,KAAKqD,gBAAgBO,QAAQgB,IAC7B,IAAM,KAERM,EAAqC,CAAEC,IAAI,QAZvDnF,EAcE,EACA8E,MAAOA,GACPE,QAASA,iBAET,IAAKF,EAAKM,SAER,YADApF,KAAK0D,WAAaoB,EAAKO,QAAU,CAAEF,IAAI,EAAOG,OAAQR,EAAKO,QAAQC,aAAW3B,GAGhF,IAAKqB,EAEH,YADAhF,KAAK0D,gBAAaC,GAGpB,IAAKqB,EAAOG,GAEV,YADAnF,KAAK0D,WAAa,CAAEyB,IAAI,EAAOG,OAAQN,EAAOM,SAGhDtF,KAAK0D,WAAasB,EAClBhF,KAAK4D,kBAAUoB,EAAO/E,oBAAQiD,EAE9B,MAAMW,YAAO7D,KAAK6D,2BAAM0B,QAEpB1B,IACFA,EAAK2B,aAAKR,EAAO/E,oBA2ClB,CACL+C,MAAO,GACPhC,YAAa,GACbf,KAAM,GACN8B,QAAS,QA7CJE,MAAMf,MAKbtB,SAEE,MAAMG,QAAEA,GAAkCC,KAAKkB,SACzCuE,EAAS1F,EAAQO,cAAc,UAErC,MAAO,KACLmF,EAAOC,UAAY1F,KAAK4D,QAAQgB,KAAO,cAAgB,eAK3DhF,QAAO2F,QAAEA,IACPA,EAAQI,OAAOC,GAAUC,aACzBN,EAAQI,OAAOG,GACVC,QACGC,GAAWC,EACPjG,KAAK4D,QAAQgB,KACP5E,KAAKqD,gBAAgB6C,cAAclG,KAAK4D,QAAQgB,KAAMoB,GACtDhG,KAAKqD,gBAAgB8C,cAAcH,MAGhDI,MAAKxC,GAAW5D,KAAKmD,YACjBkD,KAAK7B,EAAkB8B,mBAAmB1C,EAAQgB,OAClD2B,KAAK,cACTC,OAAMC,IACDA,aAAiBC,EACnBC,QAAQF,MAAM,4BAA6BA,EAAMnB,QAEjDqB,QAAQF,MAAM,yBAA0BA,QA1GlD9F,GADCiG,sCAIDjG,GADCgC,mCAIDhC,GADCkG,gCAUDlG,GAPCC,EAAY,CACXiD,KAAM,CACJiD,MAAOC,EACPC,OAAO,GAETC,KAAM,yCAiERtG,GADCiC,gCAYDjC,GADCuG,gCA9FUjE,KAhBZpC,EACG,CAAC,iBAAkBC,GACnB,CACE+B,QAAS,CACPZ,MAAO,CACLtC,EACAoB,EACAE,EACA8B,EACAoE,EACAC,EACAtE,OAKGG,GC/BboE,EAAeC,KAAKrE"}