import{i as t,b as e,g as s,d as r,a as o}from"../js/proc7ts/fun-events.cf42a1d4.js";import{C as a,S as i,R as c,B as l}from"../js/wesib/wesib.d8a927dd.js";import{_ as n}from"../js/helpers.e1623395.js";import{b as d}from"../js/core/auth.cd430625.js";import{a as p}from"../js/core/api.0f4960fa.js";import{S as u,O as m,N as h,a as f,P as b,c as g}from"../js/wesib/generic.4d2c6788.js";import{r as j,c as v,s as y,b as S,q as _,I as C}from"../js/proc7ts/input-aspects.352068d9.js";import{C as k}from"../js/core.714cbb7b.js";import{a as w}from"../js/core/loader.bec2ccbf.js";import{U as x,M as O,i as U,F as q,C as F}from"../js/core/input.b5d7b961.js";import{c as L}from"../js/core/main.3e023644.js";import{a as A,A as E}from"../js/core/articles.9cfd679b.js";import{F as I,a as M}from"../js/core/feed.688d4480.js";import{n as P}from"../js/current-article.d08eaadd.js";let R=(()=>{let t=class{};return t=n([a(["article-body",k],x({select:"textarea",makeControl:({node:{element:t},aspects:e})=>j(t,{aspects:e}).setup(v,t=>t.by(y()))}),u("body"))],t),t})(),T=(()=>{let t=class{};return t=n([a(["article-description",k],x({makeControl:({node:{element:t},aspects:e})=>j(t,{aspects:e}).setup(v,t=>t.by(y()))}),u("description"))],t),t})(),B=(()=>{let t=class{constructor(t){this._context=t,this.tags=[],t.get(M).tags().tillOff(t).to((...t)=>this.tags=t).whenOff(()=>this.tags=[])}render(){const{document:t}=this._context.get(l),{element:e}=this._context,s=e.querySelector("datalist");return()=>{s.innerHTML="",this.tags.forEach(e=>{s.appendChild(t.createElement("option")).value=e+" "})}}};return n([i()],t.prototype,"tags",void 0),n([c()],t.prototype,"render",null),t=n([a(["article-tag-editor",k],{feature:{needs:[I,O]}},x({select:"conduit-multi-input",makeControl:({node:{element:t}})=>U(t)}),u("tagList"))],t),t})(),H=(()=>{let t=class{};return t=n([a(["article-title",k],x({makeControl:({node:{element:t},aspects:e})=>j(t,{aspects:e}).setup(v,t=>t.by(y()))}),u("title"))],t),t})(),N=(()=>{let l=class{constructor(a){this._context=a,this.article=P,this._navigation=a.get(h),this._articleService=a.get(E);const i=a.get(d),c=a.get(f);t(a).whenOff(()=>{this.loadStatus=void 0,this.article=P}),a.whenConnected(()=>{this._navigation.read().tillOff(a).keepThru_(t=>decodeURIComponent(t.get(b).pathname.substring(1)),t=>e(s({user:i.requireUser(),loaded:t?r(this._articleService.article(t),()=>[]):o({ok:!0}),form:c.get(g)}))).to(({user:[t],loaded:[e],form:[{control:s}]})=>{var r,o;t.username?e?e.ok?(this.loadStatus=e,this.article=null!==(r=e.body)&&void 0!==r?r:P,s&&(s.it=null!==(o=e.body)&&void 0!==o?o:{title:"",description:"",body:"",tagList:[]})):this.loadStatus={ok:!1,errors:e.errors}:this.loadStatus=void 0:this.loadStatus=t.failure?{ok:!1,errors:t.failure.errors}:void 0})})}render(){const{element:t}=this._context,e=t.querySelector("button");return()=>{e.innerText=this.article.slug?"Update Post":"Create Post"}}submit({control:t}){t.aspect(S).markEdited(),t.aspect(_).submit(t=>p(this.article.slug?this._articleService.updateArticle(this.article.slug,t):this._articleService.createArticle(t))).then(t=>this._navigation.with(b,encodeURIComponent(t.slug)).open("article/")).catch(t=>{t instanceof C?console.error("Failed to save article",...t.errors):console.error("Failed to save article",t)})}};return n([w()],l.prototype,"loadStatus",void 0),n([i()],l.prototype,"article",void 0),n([c()],l.prototype,"render",null),n([m()],l.prototype,"submit",null),l=n([a(["article-editor",k],{feature:{needs:[R,T,B,H,A,F,I]}},q({emptyModel:{title:"",description:"",body:"",tagList:[]}}))],l),l})();L.load(N);//# sourceMappingURL=main.a0866f6e.js.map
