{"version":3,"file":"main.23e596ee.js","sources":["../../src/pages/editor/article-body.component.ts","../../src/pages/editor/article-description.component.ts","../../src/pages/editor/article-tag-editor.component.ts","../../src/pages/editor/article-title.component.ts","../../src/pages/editor/article-editor.component.ts","../../src/pages/editor/main.ts"],"sourcesContent":["import { SetInputName } from '@wesib/generic/input';\nimport { Component } from '@wesib/wesib';\nimport { inText, InValidation, requirePresent } from 'input-aspects';\nimport { Conduit__NS } from '../../core';\nimport { UseConduitInput } from '../../core/input';\n\n@Component(\n    ['article-body', Conduit__NS],\n    UseConduitInput({\n      select: 'textarea',\n      makeControl({ node: { element }, aspects }) {\n        return inText(element, { aspects })\n            .setup(InValidation, validation => validation.by(requirePresent()));\n      },\n    }),\n    SetInputName('body'),\n)\nexport class ArticleBodyComponent {\n\n}\n","import { SetInputName } from '@wesib/generic/input';\nimport { Component } from '@wesib/wesib';\nimport { inText, InValidation, requirePresent } from 'input-aspects';\nimport { Conduit__NS } from '../../core';\nimport { UseConduitInput } from '../../core/input';\n\n@Component(\n    ['article-description', Conduit__NS],\n    UseConduitInput({\n      makeControl({ node: { element }, aspects }) {\n        return inText(element, { aspects })\n            .setup(InValidation, validation => validation.by(requirePresent()));\n      },\n    }),\n    SetInputName('description'),\n)\nexport class ArticleDescriptionComponent {\n}\n","import { Component } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\n\n@Component(\n    ['article-tag-editor', Conduit__NS],\n)\nexport class ArticleTagEditorComponent {\n}\n","import { SetInputName } from '@wesib/generic/input';\nimport { Component } from '@wesib/wesib';\nimport { inText, InValidation, requirePresent } from 'input-aspects';\nimport { Conduit__NS } from '../../core';\nimport { UseConduitInput } from '../../core/input';\n\n@Component(\n    ['article-title', Conduit__NS],\n    UseConduitInput({\n      makeControl({ node: { element }, aspects }) {\n        return inText(element, { aspects })\n            .setup(InValidation, validation => validation.by(requirePresent()));\n      },\n    }),\n    SetInputName('title'),\n)\nexport class ArticleTitleComponent {\n\n}\n","import { HierarchyContext, Navigation, PageHashURLParam } from '@wesib/generic';\nimport { InputToForm, OnSubmit } from '@wesib/generic/input';\nimport { Component, ComponentContext } from '@wesib/wesib';\nimport { afterAll, afterSent, afterThe, nextAfterEvent } from 'fun-events';\nimport { InStatus, InSubmit, InSubmitError } from 'input-aspects';\nimport { Conduit__NS } from '../../core';\nimport { ApiResponse, apiSubmit } from '../../core/api';\nimport { Article, ArticleService, ArticlesSupport, CreateArticleRequest } from '../../core/articles';\nimport { AuthService } from '../../core/auth';\nimport { FeedSupport } from '../../core/feed';\nimport { ConduitInputSupport, FillConduitForm } from '../../core/input';\nimport { LoadStatus, RenderLoader } from '../../core/loader';\nimport { noArticle, NoArticle } from '../article/current-article';\nimport { ArticleBodyComponent } from './article-body.component';\nimport { ArticleDescriptionComponent } from './article-description.component';\nimport { ArticleTagEditorComponent } from './article-tag-editor.component';\nimport { ArticleTitleComponent } from './article-title.component';\n\n@Component(\n    ['article-editor', Conduit__NS],\n    {\n      feature: {\n        needs: [\n          ArticleBodyComponent,\n          ArticleDescriptionComponent,\n          ArticleTagEditorComponent,\n          ArticleTitleComponent,\n          ArticlesSupport,\n          ConduitInputSupport,\n          FeedSupport,\n        ],\n      },\n    },\n    FillConduitForm<CreateArticleRequest>({\n      emptyModel: emptyArticleRequest(),\n    }),\n)\nexport class ArticleEditorComponent {\n\n  private readonly _articleService: ArticleService;\n  private readonly _navigation: Navigation;\n\n  @RenderLoader()\n  loadStatus?: LoadStatus;\n\n  private _article?: Article | NoArticle;\n\n  constructor(context: ComponentContext) {\n    this._navigation = context.get(Navigation);\n    this._articleService = context.get(ArticleService);\n\n    const authService = context.get(AuthService);\n    const hierarchy = context.get(HierarchyContext);\n\n    context.whenOn(supply => {\n      supply.whenOff(() => {\n        this.loadStatus = undefined;\n        this._article = undefined;\n      });\n\n      this._navigation.read.tillOff(supply).keep.thru_(\n          page => decodeURIComponent(\n              page.get(PageHashURLParam).pathname.substring(1),\n          ),\n          slug => nextAfterEvent(\n              afterAll({\n                user: authService.user,\n                loaded: slug\n                    ? afterSent<[ApiResponse.Any<Article>]>(\n                        this._articleService.article(slug),\n                        () => [{ ok: true }],\n                    )\n                    : afterThe<[ApiResponse.Any<Article>]>({ ok: true }),\n                form: hierarchy.get(InputToForm),\n              }),\n          ),\n      )(\n          ({\n            user: [user],\n            loaded: [loaded],\n            form: [{ control: form }],\n          }) => {\n            if (!user.username && user.failure) {\n              this.loadStatus = { ok: false, errors: user.failure.errors };\n              return;\n            }\n            if (!loaded.ok) {\n              this.loadStatus = { ok: false, errors: loaded.errors };\n              return;\n            }\n            this.loadStatus = loaded;\n            this._article = loaded.body ?? noArticle;\n            if (form) {\n              form.it = loaded.body ?? emptyArticleRequest();\n            }\n          },\n      );\n    });\n  }\n\n  @OnSubmit()\n  submit({ control }: InputToForm<CreateArticleRequest>): void {\n    control.aspect(InStatus).markEdited();\n    control.aspect(InSubmit)\n        .submit(\n            request => apiSubmit<Article>(\n                this._article && this._article.slug\n                    ? this._articleService.updateArticle(this._article.slug, request)\n                    : this._articleService.createArticle(request),\n            ),\n        )\n        .then(article => this._navigation\n            .with(PageHashURLParam, encodeURIComponent(article.slug))\n            .open('article/'))\n        .catch(error => {\n          if (error instanceof InSubmitError) {\n            console.error('Failed to save article', ...error.errors);\n          } else {\n            console.error('Failed to save article', error);\n          }\n        });\n  }\n\n}\n\nfunction emptyArticleRequest(): CreateArticleRequest {\n  return {\n    title: '',\n    description: '',\n    body: '',\n  };\n}\n","import { conduitContext } from '../../core/main';\nimport { ArticleEditorComponent } from './article-editor.component';\n\nconduitContext.load(ArticleEditorComponent);\n"],"names":["ArticleBodyComponent","Component","Conduit__NS","UseConduitInput","select","makeControl","node","element","aspects","inText","setup","InValidation","validation","by","requirePresent","SetInputName","ArticleDescriptionComponent","ArticleTagEditorComponent","ArticleTitleComponent","ArticleEditorComponent","[object Object]","context","this","_navigation","get","Navigation","_articleService","ArticleService","authService","AuthService","hierarchy","HierarchyContext","whenOn","supply","whenOff","loadStatus","undefined","_article","read","tillOff","keep","thru_","page","decodeURIComponent","PageHashURLParam","pathname","substring","slug","nextAfterEvent","afterAll","user","loaded","afterSent","article","ok","afterThe","form","InputToForm","control","username","failure","body","noArticle","it","title","description","errors","aspect","InStatus","markEdited","InSubmit","submit","request","apiSubmit","updateArticle","createArticle","then","with","encodeURIComponent","open","catch","error","InSubmitError","console","__decorate","RenderLoader","OnSubmit","feature","needs","ArticlesSupport","ConduitInputSupport","FeedSupport","FillConduitForm","emptyModel","conduitContext","load"],"mappings":"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"}