import"../js/proc7ts/primitives.e781e476.js";import"../js/proc7ts/push-iterator.f6f3343e.js";import"../js/proc7ts/context-values.69c73302.js";import"../js/frontmeans/namespace-aliaser.e08188c9.js";import{G as t,s as e,m as s,k as r,j as o,C as a,b as i}from"../js/proc7ts/fun-events.f7c44dc9.js";import{b as c}from"../js/core/auth.e0c9460a.js";import"../js/frontmeans/render-scheduler.78bb570f.js";import{C as l,S as n,R as p,B as d}from"../js/wesib/wesib.acbfb4f5.js";import{_ as m}from"../js/helpers.e1623395.js";import{a as u}from"../js/core/api.f9177210.js";import{S as f,O as j,N as h,a as b,P as g,c as v}from"../js/wesib/generic.5b4ac940.js";import"../js/proc7ts/delta-set.d5d9e832.js";import{r as y,c as S,s as C,b as _,q as k,I as x}from"../js/frontmeans/input-aspects.a58ff15b.js";import{C as w}from"../js/core.c152f8fe.js";import{M as U,i as q,a as F}from"../js/core/loader.57d9ca02.js";import"../js/core/layout.3dca3b65.js";import{c as L}from"../js/core/main.e75f4f7e.js";import{a as A,A as E}from"../js/core/articles.34c878ba.js";import"../js/lib/dompurify.f5eadf9f.js";import"../js/lib/marked.5b76e7a8.js";import"../js/proc7ts/call-thru.f4f68410.js";import{F as I,a as M}from"../js/core/feed.9db6d3c0.js";import{n as O}from"../js/current-article.2a3b7c3c.js";import{U as P,F as R,C as T}from"../js/core/input.6207225b.js";let B=class{};B=m([l(["article-body",w],P({select:"textarea",makeControl:({node:{element:t},aspects:e})=>y(t,{aspects:e}).setup(S,(t=>t.by(C())))}),f("body"))],B);let G=class{};G=m([l(["article-description",w],P({makeControl:({node:{element:t},aspects:e})=>y(t,{aspects:e}).setup(S,(t=>t.by(C())))}),f("description"))],G);let H=class{constructor(e){this._context=e,this.tags=[],e.get(M).tags.do(t(e))(((...t)=>this.tags=t)).whenOff((()=>this.tags=[]))}render(){const{document:t}=this._context.get(d),{element:e}=this._context,s=e.querySelector("datalist");return()=>{s.innerHTML="",this.tags.forEach((e=>{s.appendChild(t.createElement("option")).value=e+" "}))}}};m([n()],H.prototype,"tags",void 0),m([p()],H.prototype,"render",null),H=m([l(["article-tag-editor",w],{feature:{needs:[I,U]}},P({select:"conduit-multi-input",makeControl:({node:{element:t}})=>q(t)}),f("tagList"))],H);let N=class{};N=m([l(["article-title",w],P({makeControl:({node:{element:t},aspects:e})=>y(t,{aspects:e}).setup(S,(t=>t.by(C())))}),f("title"))],N);let z=class{constructor(t){this._context=t,this.article=O,this._navigation=t.get(h),this._articleService=t.get(E);const l=t.get(c),n=t.get(b);t.supply.whenOff((()=>{this.loadStatus=void 0,this.article=O})),t.whenConnected((()=>{this._navigation.read.do(e(t),s((t=>decodeURIComponent(t.get(g).pathname.substring(1)))),r((t=>o({user:l.requireUser,loaded:t?a(this._articleService.article(t),(()=>[])):i({ok:!0}),form:n.get(v)}))))((({user:[t],loaded:[e],form:[{control:s}]})=>{var r,o;t.username?e?e.ok?(this.loadStatus=e,this.article=null!==(r=e.body)&&void 0!==r?r:O,s&&(s.it=null!==(o=e.body)&&void 0!==o?o:{title:"",description:"",body:"",tagList:[]})):this.loadStatus={ok:!1,errors:e.errors}:this.loadStatus=void 0:this.loadStatus=t.failure?{ok:!1,errors:t.failure.errors}:void 0}))}))}render(){const{element:t}=this._context,e=t.querySelector("button");return()=>{e.innerText=this.article.slug?"Update Post":"Create Post"}}submit({control:t}){t.aspect(_).markEdited(),t.aspect(k).submit((t=>u(this.article.slug?this._articleService.updateArticle(this.article.slug,t):this._articleService.createArticle(t)))).then((t=>this._navigation.with(g,encodeURIComponent(t.slug)).open("article/"))).catch((t=>{t instanceof x?console.error("Failed to save article",...t.errors):console.error("Failed to save article",t)}))}};m([F()],z.prototype,"loadStatus",void 0),m([n()],z.prototype,"article",void 0),m([p()],z.prototype,"render",null),m([j()],z.prototype,"submit",null),z=m([l(["article-editor",w],{feature:{needs:[B,G,H,N,A,T,I]}},R({emptyModel:{title:"",description:"",body:"",tagList:[]}}))],z),L.load(z);//# sourceMappingURL=main.63ad21df.js.map
