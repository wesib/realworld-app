{"version":3,"file":"main.5d723456.js","sources":["../../src/pages/profile/user-feed-toggle.component.ts","../../src/pages/profile/user-feed.component.ts","../../src/pages/profile/user-info.component.ts","../../src/pages/profile/profile.component.ts","../../src/pages/profile/main.ts"],"sourcesContent":["import { afterAll } from '@proc7ts/fun-events';\nimport { ActivateNavLink, ComponentNode, HandleNavLinks, Navigation, PageHashURLSupport } from '@wesib/generic';\nimport { Component, ComponentContext } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { FeedRequest } from '../../core/feed';\nimport { PageUserProfileParam } from './page-user-profile-param';\n\nconst favoriteURLPattern = /#\\/.+\\/favorite$/;\n\n@Component(\n    ['user-feed-toggle', Conduit__NS],\n    {\n      feature: {\n        needs: PageHashURLSupport,\n      },\n    },\n    ActivateNavLink({ active: 'active' }),\n    HandleNavLinks(),\n)\nexport class UserFeedToggleComponent {\n\n  constructor(context: ComponentContext) {\n\n    const navigation = context.get(Navigation);\n\n    context.whenConnected(() => {\n      afterAll({\n        page: navigation,\n        links: context.get(ComponentNode).select('a', { all: true, deep: true }),\n      }).tillOff(context).to(\n          ({\n            page: [page],\n            links: [links],\n          }) => {\n            for (const node of links) {\n\n              const element = node.element as HTMLAnchorElement;\n              const profileParam = page.get(PageUserProfileParam);\n              const user = profileParam.author || profileParam.favorited;\n              let request: FeedRequest;\n\n              if (favoriteURLPattern.test(element.href)) {\n                request = { favorited: user };\n              } else {\n                request = { author: user };\n              }\n\n              const targetPage = navigation.with(PageUserProfileParam, request).pretend();\n\n              if (targetPage) {\n\n                const href = targetPage.url.href;\n\n                if (element.href !== href) {\n\n                  const clone = element.cloneNode(true) as HTMLLinkElement;\n\n                  clone.href = href;\n                  element.replaceWith(clone);\n                }\n              }\n            }\n          },\n      );\n    });\n  }\n\n}\n","import { Navigation } from '@wesib/generic';\nimport { Component, ComponentContext } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { FeedRequest } from '../../core/feed';\nimport { RenderFeed } from '../home/render-feed.decorator';\nimport { PageUserProfileParam } from './page-user-profile-param';\n\n@Component(['user-feed', Conduit__NS])\nexport class UserFeedComponent {\n\n  @RenderFeed({ requestParam: PageUserProfileParam })\n  request: FeedRequest = {};\n\n  constructor(context: ComponentContext) {\n\n    const navigation = context.get(Navigation);\n\n    context.whenConnected(() => {\n      navigation.read().tillOff(context).to(page => {\n        this.request = page.get(PageUserProfileParam);\n      });\n    });\n  }\n\n}\n","import { HierarchyContext } from '@wesib/generic';\nimport { BootstrapWindow, Component, ComponentContext, ElementRenderer, Render, StateProperty } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { CurrentUserProfile, noUserProfile } from './current-user-profile';\nimport { FollowAuthorBtnComponent } from './follow-author-btn.component';\n\n@Component(\n    ['user-info', Conduit__NS],\n    {\n      feature: {\n        needs: FollowAuthorBtnComponent,\n      },\n    },\n)\nexport class UserInfoComponent {\n\n  @StateProperty()\n  private profile: CurrentUserProfile = noUserProfile;\n\n  constructor(private readonly _context: ComponentContext) {\n\n    const hierarchy = _context.get(HierarchyContext);\n\n    hierarchy.get(CurrentUserProfile).to(\n        profile => this.profile = profile,\n    );\n  }\n\n  @Render()\n  render(): ElementRenderer {\n\n    const { document } = this._context.get(BootstrapWindow);\n\n    return () => {\n\n      const { profile } = this;\n      document.getElementById('user:image')?.setAttribute('src', profile.username && profile.image || '');\n\n      const username = document.getElementById('user:username');\n\n      if (username) {\n        username.innerText = profile.username || '';\n      }\n\n      const bio = document.getElementById('user:bio');\n\n      if (bio) {\n        bio.innerText = profile.username && profile.bio || '';\n      }\n    };\n  }\n\n}\n","import { trackValue } from '@proc7ts/fun-events';\nimport { HierarchyContext, Navigation } from '@wesib/generic';\nimport { Component, ComponentContext } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { ApiResponse, notAuthenticatedError } from '../../core/api';\nimport { RenderLoader } from '../../core/loader';\nimport { UserProfile, UserService, UserSupport } from '../../core/users';\nimport { CurrentUserProfile, currentUserProfileBy, noUserProfile } from './current-user-profile';\nimport { PageUserProfileParam } from './page-user-profile-param';\nimport { UserFeedToggleComponent } from './user-feed-toggle.component';\nimport { UserFeedComponent } from './user-feed.component';\nimport { UserInfoComponent } from './user-info.component';\n\n@Component(\n    ['profile', Conduit__NS],\n    {\n      feature: {\n        needs: [\n          UserFeedComponent,\n          UserFeedToggleComponent,\n          UserInfoComponent,\n          UserSupport,\n        ],\n      },\n    },\n)\nexport class ProfileComponent {\n\n  private readonly _response = trackValue<ApiResponse<UserProfile>>();\n\n  constructor(context: ComponentContext) {\n\n    const userService = context.get(UserService);\n    const navigation = context.get(Navigation);\n    const hierarchy = context.get(HierarchyContext);\n    const profile = currentUserProfileBy(\n        this._response.read().keepThru_(\n            response => response && response.ok ? response.body : noUserProfile,\n        ),\n    );\n\n    hierarchy.provide({ a: CurrentUserProfile, is: profile });\n    context.whenConnected(() => {\n      navigation.read()\n          .thru_(\n              page => {\n\n                const param = page.get(PageUserProfileParam);\n\n                return param.author || param.favorited;\n              },\n          )\n          .tillOff(context)\n          .consume(username => {\n            if (!username) {\n              this.response = { ok: false, errors: notAuthenticatedError() };\n              return;\n            }\n            if (this.response && this.response.ok && this.response.body.username === username) {\n              return; // User didn't change\n            }\n            return userService.userProfile(username).to(response => this.response = response);\n          });\n    });\n  }\n\n  get response(): ApiResponse<UserProfile> | undefined {\n    return this._response.it;\n  }\n\n  @RenderLoader()\n  set response(value: ApiResponse<UserProfile> | undefined) {\n    this._response.it = value;\n  }\n\n}\n","import { conduitContext } from '../../core/main';\nimport { ProfileComponent } from './profile.component';\n\nconduitContext.load(ProfileComponent);\n"],"names":["favoriteURLPattern","UserFeedToggleComponent","[object Object]","context","navigation","get","Navigation","whenConnected","afterAll","page","links","ComponentNode","select","all","deep","tillOff","to","node","element","profileParam","PageUserProfileParam","user","author","favorited","request","test","href","targetPage","with","pretend","url","clone","cloneNode","replaceWith","Component","Conduit__NS","feature","needs","PageHashURLSupport","ActivateNavLink","active","HandleNavLinks","UserFeedComponent","this","read","__decorate","RenderFeed","requestParam","UserInfoComponent","_context","noUserProfile","HierarchyContext","CurrentUserProfile","profile","document","BootstrapWindow","getElementById","setAttribute","username","image","innerText","bio","StateProperty","Render","FollowAuthorBtnComponent","ProfileComponent","trackValue","userService","UserService","hierarchy","currentUserProfileBy","_response","keepThru_","response","ok","body","provide","a","is","thru_","param","consume","userProfile","errors","notAuthenticatedError","it","value","RenderLoader","UserSupport","conduitContext","load"],"mappings":"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"}