{"version":3,"file":"main.37f2376b.js","sources":["../../src/pages/profile/user-feed-toggle.component.ts","../../src/pages/profile/user-feed.component.ts","../../src/pages/profile/user-info.component.ts","../../src/pages/profile/profile.component.ts","../../src/pages/profile/index.ts"],"sourcesContent":["import {\n  ActivateNavLink,\n  ComponentNode,\n  ComponentTreeSupport,\n  HandleNavLinks,\n  Navigation,\n  PageHashURLSupport,\n} from '@wesib/generic';\nimport { Component, ComponentContext } from '@wesib/wesib';\nimport { afterAll } from 'fun-events';\nimport { Conduit__NS } from '../../core';\nimport { FeedRequest } from '../../core/feed';\nimport { PageUserProfileParam } from './page-user-profile-param';\n\nconst favoriteURLPattern = /#\\/.+\\/favorite$/;\n\n@Component(\n    ['user-feed-toggle', Conduit__NS],\n    {\n      feature: {\n        needs: [\n          ComponentTreeSupport,\n          PageHashURLSupport,\n        ],\n      },\n    },\n    ActivateNavLink({ active: 'active' }),\n    HandleNavLinks(),\n)\nexport class UserFeedToggleComponent {\n\n  constructor(context: ComponentContext) {\n\n    const navigation = context.get(Navigation);\n\n    context.whenOn(supply => {\n      afterAll({\n        page: navigation,\n        links: context.get(ComponentNode).select('a', { all: true, deep: true }),\n      }).tillOff(supply)(\n          ({\n            page: [page],\n            links: [links],\n          }) => {\n            links.forEach(node => {\n\n              const element = node.element as HTMLAnchorElement;\n              const profileParam = page.get(PageUserProfileParam);\n              const user = profileParam.author || profileParam.favorited;\n              let request: FeedRequest;\n\n              if (favoriteURLPattern.test(element.href)) {\n                request = { favorited: user };\n              } else {\n                request = { author: user };\n              }\n\n              const targetPage = navigation.with(PageUserProfileParam, request).pretend();\n\n              if (targetPage) {\n\n                const href = targetPage.url.href;\n\n                if (element.href !== href) {\n\n                  const clone = element.cloneNode(true) as HTMLLinkElement;\n\n                  clone.href = href;\n                  element.replaceWith(clone);\n                }\n              }\n            });\n          },\n      );\n    });\n  }\n\n}\n","import { Navigation } from '@wesib/generic';\nimport { Component, ComponentContext } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { FeedRequest } from '../../core/feed';\nimport { RenderFeed } from '../home/render-feed.decorator';\nimport { PageUserProfileParam } from './page-user-profile-param';\n\n@Component(['user-feed', Conduit__NS])\nexport class UserFeedComponent {\n\n  @RenderFeed({ requestParam: PageUserProfileParam })\n  request: FeedRequest = {};\n\n  constructor(context: ComponentContext) {\n\n    const navigation = context.get(Navigation);\n\n    context.whenOn(supply => {\n      navigation.read.tillOff(supply)(page => {\n        this.request = page.get(PageUserProfileParam);\n      });\n    });\n  }\n\n}\n","import { HierarchyContext } from '@wesib/generic';\nimport { BootstrapWindow, Component, ComponentContext, ElementRenderer, Render, StateProperty } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { FollowAuthorComponent } from './follow-author.component';\nimport { CurrentUserProfile, noUserProfile } from './current-user-profile';\n\n@Component(\n    ['user-info', Conduit__NS],\n    {\n      feature: {\n        needs: FollowAuthorComponent,\n      },\n    },\n)\nexport class UserInfoComponent {\n\n  @StateProperty()\n  private profile: CurrentUserProfile = noUserProfile;\n\n  constructor(private readonly _context: ComponentContext) {\n\n    const hierarchy = _context.get(HierarchyContext);\n\n    hierarchy.get(CurrentUserProfile)(\n        profile => this.profile = profile,\n    );\n  }\n\n  @Render()\n  render(): ElementRenderer {\n\n    const { document } = this._context.get(BootstrapWindow);\n\n    return () => {\n\n      const { profile } = this;\n      document.getElementById('user:image')?.setAttribute('src', profile.username && profile.image || '');\n\n      const username = document.getElementById('user:username');\n\n      if (username) {\n        username.innerText = profile.username || '';\n      }\n\n      const bio = document.getElementById('user:bio');\n\n      if (bio) {\n        bio.innerText = profile.username && profile.bio || '';\n      }\n    };\n  }\n\n}\n","import { HierarchyContext, Navigation } from '@wesib/generic';\nimport { Component, ComponentContext } from '@wesib/wesib';\nimport { trackValue } from 'fun-events';\nimport { Conduit__NS } from '../../core';\nimport { ApiResponse } from '../../core/api';\nimport { RenderLoader } from '../../core/loader';\nimport { UserProfile, UserService, UserSupport } from '../../core/users';\nimport { CurrentUserProfile, currentUserProfileBy, noUserProfile } from './current-user-profile';\nimport { PageUserProfileParam } from './page-user-profile-param';\nimport { UserFeedToggleComponent } from './user-feed-toggle.component';\nimport { UserFeedComponent } from './user-feed.component';\nimport { UserInfoComponent } from './user-info.component';\n\n@Component(\n    ['profile', Conduit__NS],\n    {\n      feature: {\n        needs: [\n          UserFeedComponent,\n          UserFeedToggleComponent,\n          UserInfoComponent,\n          UserSupport,\n        ],\n      },\n    },\n)\nexport class ProfileComponent {\n\n  private readonly _response = trackValue<ApiResponse<UserProfile>>();\n\n  constructor(context: ComponentContext) {\n\n    const userService = context.get(UserService);\n    const navigation = context.get(Navigation);\n    const hierarchy = context.get(HierarchyContext);\n    const profile = currentUserProfileBy(\n        this._response.read.keep.thru_(\n            response => response && response.ok ? response.body : noUserProfile,\n        ),\n    );\n\n    hierarchy.provide({ a: CurrentUserProfile, is: profile });\n    context.whenOn(supply => {\n      navigation.read\n          .thru_(\n              page => {\n\n                const param = page.get(PageUserProfileParam);\n\n                return param.author || param.favorited;\n              },\n          )\n          .tillOff(supply)\n          .consume(username => {\n            if (!username) {\n              this._response.it = undefined;\n              return;\n            }\n            if (this.response && this.response.ok && this.response.body.username === username) {\n              return; // User didn't change\n            }\n            return userService.userProfile(username)(response => this.response = response);\n          });\n    });\n  }\n\n  get response(): ApiResponse<UserProfile> | undefined {\n    return this._response.it;\n  }\n\n  @RenderLoader()\n  set response(value: ApiResponse<UserProfile> | undefined) {\n    this._response.it = value;\n  }\n\n}\n","import { conduitContext } from '../../core/main';\nimport { ProfileComponent } from './profile.component';\n\nconduitContext.load(ProfileComponent);\n"],"names":["favoriteURLPattern","UserFeedToggleComponent","[object Object]","context","navigation","get","Navigation","whenOn","supply","afterAll","page","links","ComponentNode","select","all","deep","tillOff","forEach","node","element","profileParam","PageUserProfileParam","user","author","favorited","request","test","href","targetPage","with","pretend","url","clone","cloneNode","replaceWith","Component","Conduit__NS","feature","needs","ComponentTreeSupport","PageHashURLSupport","ActivateNavLink","active","HandleNavLinks","UserFeedComponent","this","read","__decorate","RenderFeed","requestParam","UserInfoComponent","_context","noUserProfile","HierarchyContext","CurrentUserProfile","hierarchy","profile","document","BootstrapWindow","getElementById","setAttribute","username","image","innerText","bio","StateProperty","Render","FollowAuthorComponent","ProfileComponent","trackValue","userService","UserService","currentUserProfileBy","_response","keep","thru_","response","ok","body","provide","a","is","param","consume","userProfile","it","undefined","value","RenderLoader","UserSupport","conduitContext","load"],"mappings":"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"}