{"version":3,"file":"main.59415c77.js","sources":["../../src/pages/profile/user-info.component.ts","../../src/pages/profile/profile.component.ts","../../src/pages/profile/index.ts"],"sourcesContent":["import { HierarchyContext } from '@wesib/generic';\nimport { BootstrapWindow, Component, ComponentContext, ElementRenderer, Render, StateProperty } from '@wesib/wesib';\nimport { Conduit__NS } from '../../common';\nimport { FollowAuthorComponent } from './follow-author.component';\nimport { CurrentUserProfile, noUserProfile } from './current-user-profile';\n\n@Component(\n    ['user-info', Conduit__NS],\n    {\n      feature: {\n        needs: FollowAuthorComponent,\n      },\n    },\n)\nexport class UserInfoComponent {\n\n  @StateProperty()\n  private profile: CurrentUserProfile = noUserProfile;\n\n  constructor(private readonly _context: ComponentContext) {\n\n    const hierarchy = _context.get(HierarchyContext);\n\n    hierarchy.get(CurrentUserProfile)(\n        profile => this.profile = profile,\n    );\n  }\n\n  @Render()\n  render(): ElementRenderer {\n\n    const { document } = this._context.get(BootstrapWindow);\n\n    return () => {\n\n      const { profile } = this;\n      document.getElementById('user:image')?.setAttribute('src', profile.username && profile.image || '');\n\n      const username = document.getElementById('user:username');\n\n      if (username) {\n        username.innerText = profile.username || '';\n      }\n\n      const bio = document.getElementById('user:bio');\n\n      if (bio) {\n        bio.innerText = profile.username && profile.bio || '';\n      }\n    };\n  }\n\n}\n","import { HierarchyContext, Navigation, PageHashURLParam } from '@wesib/generic';\nimport {\n  BootstrapWindow,\n  Component,\n  ComponentContext,\n  DefaultNamespaceAliaser,\n  ElementRenderer,\n  Render,\n  StateProperty,\n} from '@wesib/wesib';\nimport { trackValue } from 'fun-events';\nimport { css__naming } from 'namespace-aliaser';\nimport { Conduit__NS } from '../../common';\nimport { ApiResponse } from '../../common/api';\nimport { ApiErrorGenerator } from '../../common/input';\nimport { UserService, UserSupport } from '../../common/users';\nimport { CurrentUserProfile, noUserProfile } from './current-user-profile';\nimport { UserInfoComponent } from './user-info.component';\n\n@Component(\n    ['profile', Conduit__NS],\n    {\n      feature: {\n        needs: [\n          UserInfoComponent,\n          UserSupport,\n        ],\n      },\n    },\n)\nexport class ProfileComponent {\n\n  private readonly _response = trackValue<ApiResponse<CurrentUserProfile>>();\n\n  constructor(private readonly _context: ComponentContext) {\n\n    const userService = _context.get(UserService);\n    const navigation = _context.get(Navigation);\n    const hierarchy = _context.get(HierarchyContext);\n\n    hierarchy.provide({\n      a: CurrentUserProfile,\n      is: this._response.read.keep.thru_(\n          response => response && response.ok ? response.body : noUserProfile,\n      ),\n    });\n    _context.whenOn(supply => {\n      navigation.read\n          .thru_(\n              page => page.get(PageHashURLParam).pathname.substring(1),\n          )\n          .tillOff(supply)\n          .consume(username => {\n            if (!username) {\n              this._response.it = undefined;\n              return;\n            }\n            return userService.userProfile(username)(response => this.response = response);\n          });\n    });\n  }\n\n  get response(): ApiResponse<CurrentUserProfile> | undefined {\n    return this._response.it;\n  }\n\n  @StateProperty()\n  set response(value: ApiResponse<CurrentUserProfile> | undefined) {\n    this._response.it = value;\n  }\n\n  @Render()\n  render(): ElementRenderer {\n\n    const visibleClassName = css__naming.name(['visible', Conduit__NS], this._context.get(DefaultNamespaceAliaser));\n    const genErrors = this._context.get(ApiErrorGenerator);\n    const { element, contentRoot }: { element: Element; contentRoot: Node } = this._context;\n    const { document } = this._context.get(BootstrapWindow);\n    let loader: Element | undefined;\n\n    return () => {\n\n      const { response } = this;\n\n      if (!response) {\n        displayLoader();\n      } else if (!response.ok) {\n        displayErrors(response);\n      } else {\n        displayContents(response);\n      }\n    };\n\n    function displayContents(_response: ApiResponse.Ok<CurrentUserProfile>): void {\n      hideLoader();\n      setContentsVisible(true);\n    }\n\n    function displayErrors({ errors }: ApiResponse.Failure): void {\n      hideLoader();\n      setContentsVisible(false);\n      loader = genErrors(errors);\n      if (loader) {\n        contentRoot.appendChild(loader);\n      }\n    }\n\n    function displayLoader(): void {\n      setContentsVisible(false);\n      if (!loader) {\n        loader = contentRoot.appendChild(document.createElement('conduit-loader'));\n      }\n    }\n\n    function hideLoader(): void {\n      if (loader) {\n        loader.remove();\n        loader = undefined;\n      }\n    }\n\n    function setContentsVisible(visible: boolean): void {\n      if (visible) {\n        element.classList.add(visibleClassName);\n      } else {\n        element.classList.remove(visibleClassName);\n      }\n    }\n  }\n\n}\n","import { conduitContext } from '../../common/main';\nimport { ProfileComponent } from './profile.component';\n\nconduitContext.load(ProfileComponent);\n"],"names":["UserInfoComponent","[object Object]","_context","this","noUserProfile","get","HierarchyContext","CurrentUserProfile","hierarchy","profile","document","BootstrapWindow","getElementById","setAttribute","username","image","innerText","bio","__decorate","StateProperty","Render","Component","Conduit__NS","feature","needs","FollowAuthorComponent","ProfileComponent","trackValue","userService","UserService","navigation","Navigation","provide","a","is","_response","read","keep","thru_","response","ok","body","whenOn","supply","page","PageHashURLParam","pathname","substring","tillOff","consume","userProfile","it","undefined","value","visibleClassName","css__naming","name","DefaultNamespaceAliaser","genErrors","ApiErrorGenerator","element","contentRoot","loader","hideLoader","setContentsVisible","errors","appendChild","displayErrors","createElement","remove","visible","classList","add","UserSupport","conduitContext","load"],"mappings":"ukBAcA,IAAaA,EAAb,MAKEC,YAA6BC,GAAAC,cAAAD,EAFrBC,aAA8BC,EAIlBF,EAASG,IAAIC,GAErBD,IAAIE,EAAdC,CACIC,GAAWN,KAAKM,QAAUA,GAKhCR,SAEE,MAAMS,SAAEA,GAAaP,KAAKD,SAASG,IAAIM,GAEvC,MAAO,WAEL,MAAMF,QAAEA,GAAYN,eACpBO,EAASE,eAAe,8BAAeC,aAAa,MAAOJ,EAAQK,UAAYL,EAAQM,OAAS,IAEhG,MAAMD,EAAWJ,EAASE,eAAe,iBAErCE,IACFA,EAASE,UAAYP,EAAQK,UAAY,IAG3C,MAAMG,EAAMP,EAASE,eAAe,YAEhCK,IACFA,EAAID,UAAYP,EAAQK,UAAYL,EAAQQ,KAAO,OA9BzDC,GADCC,mCAaDD,GADCE,gCAdUpB,KARZqB,EACG,CAAC,YAAaC,GACd,CACEC,QAAS,CACPC,MAAOC,MAIFzB,GCgBb,IAAa0B,EAAb,MAIEzB,YAA6BC,GAAAC,cAAAD,EAFZC,eAAYwB,IAI3B,MAAMC,EAAc1B,EAASG,IAAIwB,GAC3BC,EAAa5B,EAASG,IAAI0B,GACd7B,EAASG,IAAIC,GAErB0B,QAAQ,CAChBC,EAAG1B,EACH2B,GAAI/B,KAAKgC,UAAUC,KAAKC,KAAKC,MACzBC,GAAYA,GAAYA,EAASC,GAAKD,EAASE,KAAOrC,KAG5DF,EAASwC,OAAOC,IACdb,EAAWM,KACNE,MACGM,GAAQA,EAAKvC,IAAIwC,GAAkBC,SAASC,UAAU,IAEzDC,QAAQL,GACRM,QAAQnC,IACP,GAAKA,EAIL,OAAOc,EAAYsB,YAAYpC,EAAxBc,CAAkCW,GAAYpC,KAAKoC,SAAWA,GAHnEpC,KAAKgC,UAAUgB,QAAKC,MAQhCb,eACE,OAAOpC,KAAKgC,UAAUgB,GAIxBZ,aAAac,GACXlD,KAAKgC,UAAUgB,GAAKE,EAItBpD,SAEE,MAAMqD,EAAmBC,EAAYC,KAAK,CAAC,UAAWlC,GAAcnB,KAAKD,SAASG,IAAIoD,IAChFC,EAAYvD,KAAKD,SAASG,IAAIsD,IAC9BC,QAAEA,EAAOC,YAAEA,GAAyD1D,KAAKD,UACzEQ,SAAEA,GAAaP,KAAKD,SAASG,IAAIM,GACvC,IAAImD,EAEJ,MAAO,KAEL,MAAMvB,SAAEA,GAAapC,KAEhBoC,EAEOA,EAASC,IAQrBuB,IACAC,GAAmB,IAGrB,UAAuBC,OAAEA,IACvBF,IACAC,GAAmB,GACnBF,EAASJ,EAAUO,GACfH,GACFD,EAAYK,YAAYJ,GAhBxBK,CAAc5B,IAqBhByB,GAAmB,GACdF,IACHA,EAASD,EAAYK,YAAYxD,EAAS0D,cAAc,sBAI5D,SAASL,IACHD,IACFA,EAAOO,SACPP,OAASV,GAIb,SAASY,EAAmBM,GACtBA,EACFV,EAAQW,UAAUC,IAAIlB,GAEtBM,EAAQW,UAAUF,OAAOf,MA1D/BpC,GADCC,kCAMDD,GADCE,gCAzCUM,KAXZL,EACG,CAAC,UAAWC,GACZ,CACEC,QAAS,CACPC,MAAO,CACLxB,EACAyE,OAKG/C,GC3BbgD,EAAeC,KAAKjD"}