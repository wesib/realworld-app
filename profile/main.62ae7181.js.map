{"version":3,"file":"main.62ae7181.js","sources":["../../src/pages/profile/user-feed-toggle.component.ts","../../src/pages/profile/user-feed.component.ts","../../src/pages/profile/user-info.component.ts","../../src/pages/profile/profile.component.ts","../../src/pages/profile/main.ts"],"sourcesContent":["import { afterAll, supplyAfter } from '@proc7ts/fun-events';\nimport { ActivateNavLink, ComponentNode, HandleNavLinks, Navigation, PageHashURLSupport } from '@wesib/generic';\nimport { Component, ComponentContext } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { FeedRequest } from '../../core/feed';\nimport { PageUserProfileParam } from './page-user-profile-param';\n\nconst favoriteURLPattern = /#\\/.+\\/favorite$/;\n\n@Component(\n    ['user-feed-toggle', Conduit__NS],\n    {\n      feature: {\n        needs: PageHashURLSupport,\n      },\n    },\n    ActivateNavLink({ active: 'active' }),\n    HandleNavLinks(),\n)\nexport class UserFeedToggleComponent {\n\n  constructor(context: ComponentContext) {\n\n    const navigation = context.get(Navigation);\n\n    context.whenConnected(() => {\n      afterAll({\n        page: navigation,\n        links: context.get(ComponentNode).select('a', { all: true, deep: true }),\n      }).do(supplyAfter(context))(\n          ({\n            page: [page],\n            links: [links],\n          }) => {\n            for (const node of links) {\n\n              const element = node.element as HTMLAnchorElement;\n              const profileParam = page.get(PageUserProfileParam);\n              const user = profileParam.author || profileParam.favorited;\n              let request: FeedRequest;\n\n              if (favoriteURLPattern.test(element.href)) {\n                request = { favorited: user };\n              } else {\n                request = { author: user };\n              }\n\n              const targetPage = navigation.with(PageUserProfileParam, request).pretend();\n\n              if (targetPage) {\n\n                const href = targetPage.url.href;\n\n                if (element.href !== href) {\n\n                  const clone = element.cloneNode(true) as HTMLLinkElement;\n\n                  clone.href = href;\n                  element.replaceWith(clone);\n                }\n              }\n            }\n          },\n      );\n    });\n  }\n\n}\n","import { supplyAfter } from '@proc7ts/fun-events';\nimport { Navigation } from '@wesib/generic';\nimport { Component, ComponentContext } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { FeedRequest } from '../../core/feed';\nimport { RenderFeed } from '../home/render-feed.decorator';\nimport { PageUserProfileParam } from './page-user-profile-param';\n\n@Component(['user-feed', Conduit__NS])\nexport class UserFeedComponent {\n\n  @RenderFeed({ requestParam: PageUserProfileParam })\n  request: FeedRequest = {};\n\n  constructor(context: ComponentContext) {\n\n    const navigation = context.get(Navigation);\n\n    context.whenConnected(() => {\n      navigation.read.do(supplyAfter(context))(page => {\n        this.request = page.get(PageUserProfileParam);\n      });\n    });\n  }\n\n}\n","import { HierarchyContext } from '@wesib/generic';\nimport { BootstrapWindow, Component, ComponentContext, ElementRenderer, Render, StateProperty } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { CurrentUserProfile, noUserProfile } from './current-user-profile';\nimport { FollowAuthorBtnComponent } from './follow-author-btn.component';\n\n@Component(\n    ['user-info', Conduit__NS],\n    {\n      feature: {\n        needs: FollowAuthorBtnComponent,\n      },\n    },\n)\nexport class UserInfoComponent {\n\n  @StateProperty()\n  private profile: CurrentUserProfile = noUserProfile;\n\n  constructor(private readonly _context: ComponentContext) {\n\n    const hierarchy = _context.get(HierarchyContext);\n\n    hierarchy.get(CurrentUserProfile)(\n        profile => this.profile = profile,\n    );\n  }\n\n  @Render()\n  render(): ElementRenderer {\n\n    const { document } = this._context.get(BootstrapWindow);\n\n    return () => {\n\n      const { profile } = this;\n      document.getElementById('user:image')?.setAttribute('src', profile.username && profile.image || '');\n\n      const username = document.getElementById('user:username');\n\n      if (username) {\n        username.innerText = profile.username || '';\n      }\n\n      const bio = document.getElementById('user:bio');\n\n      if (bio) {\n        bio.innerText = profile.username && profile.bio || '';\n      }\n    };\n  }\n\n}\n","import { consumeEvents, mapAfter_, mapOn_, supplyOn, trackValue } from '@proc7ts/fun-events';\nimport { HierarchyContext, Navigation } from '@wesib/generic';\nimport { Component, ComponentContext } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { ApiResponse, notAuthenticatedError } from '../../core/api';\nimport { RenderLoader } from '../../core/loader';\nimport { UserProfile, UserService, UserSupport } from '../../core/users';\nimport { CurrentUserProfile, currentUserProfileBy, noUserProfile } from './current-user-profile';\nimport { PageUserProfileParam } from './page-user-profile-param';\nimport { UserFeedToggleComponent } from './user-feed-toggle.component';\nimport { UserFeedComponent } from './user-feed.component';\nimport { UserInfoComponent } from './user-info.component';\n\n@Component(\n    ['profile', Conduit__NS],\n    {\n      feature: {\n        needs: [\n          UserFeedComponent,\n          UserFeedToggleComponent,\n          UserInfoComponent,\n          UserSupport,\n        ],\n      },\n    },\n)\nexport class ProfileComponent {\n\n  private readonly _response = trackValue<ApiResponse<UserProfile>>();\n\n  constructor(context: ComponentContext) {\n\n    const userService = context.get(UserService);\n    const navigation = context.get(Navigation);\n    const hierarchy = context.get(HierarchyContext);\n    const profile = currentUserProfileBy(\n        this._response.read.do(\n            mapAfter_(response => response && response.ok ? response.body : noUserProfile),\n        ),\n    );\n\n    hierarchy.provide({ a: CurrentUserProfile, is: profile.read });\n    context.whenConnected(() => {\n      navigation.read.do(\n          mapOn_(page => {\n\n            const param = page.get(PageUserProfileParam);\n\n            return param.author || param.favorited;\n          }),\n          supplyOn(context),\n          consumeEvents(username => {\n            if (!username) {\n              this.response = { ok: false, errors: notAuthenticatedError() };\n              return;\n            }\n            if (this.response && this.response.ok && this.response.body.username === username) {\n              return; // User didn't change\n            }\n\n            return userService.userProfile(username)(\n                response => this.response = response,\n            );\n          }),\n      );\n    });\n  }\n\n  get response(): ApiResponse<UserProfile> | undefined {\n    return this._response.it;\n  }\n\n  @RenderLoader()\n  set response(value: ApiResponse<UserProfile> | undefined) {\n    this._response.it = value;\n  }\n\n}\n","import { conduitContext } from '../../core/main';\nimport { ProfileComponent } from './profile.component';\n\nconduitContext.load(ProfileComponent);\n"],"names":["favoriteURLPattern","UserFeedToggleComponent","[object Object]","context","navigation","get","Navigation","whenConnected","afterAll","page","links","ComponentNode","select","all","deep","do","supplyAfter","node","element","profileParam","PageUserProfileParam","user","author","favorited","request","test","href","targetPage","with","pretend","url","clone","cloneNode","replaceWith","Component","Conduit__NS","feature","needs","PageHashURLSupport","ActivateNavLink","active","HandleNavLinks","UserFeedComponent","this","read","__decorate","RenderFeed","requestParam","UserInfoComponent","_context","noUserProfile","HierarchyContext","CurrentUserProfile","hierarchy","profile","document","BootstrapWindow","getElementById","setAttribute","username","image","innerText","bio","StateProperty","Render","FollowAuthorBtnComponent","ProfileComponent","trackValue","userService","UserService","currentUserProfileBy","_response","mapAfter_","response","ok","body","provide","a","is","mapOn_","param","supplyOn","consumeEvents","userProfile","errors","notAuthenticatedError","it","value","RenderLoader","UserSupport","conduitContext","load"],"mappings":"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"}