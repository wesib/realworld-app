import{c as e}from"../js/core/main.34ec5e59.js";import{_ as t}from"../js/helpers.e1623395.js";import{D as s,s as o}from"../js/frontmeans/dom-events.1d1a7091.js";import{d as r,s as n,t as a,m as c,G as i}from"../js/proc7ts/fun-events.3257bf57.js";import{c as m,d as l,h as d,i as p,S as u,j as h,O as f,k as j,g as b,N as y,P as g}from"../js/wesib/generic.daf122de.js";import{S as v,C,B as x,D as E,R as _,u as w}from"../js/wesib/wesib.c496f508.js";import{C as F}from"../js/core.10059585.js";import{A as S}from"../js/core/articles.101ad419.js";import{R as N,f as O,a as T}from"../js/core/loader.b1c22415.js";import{F as k,c as M,n as I,C as A}from"../js/follow-author-btn.component.2aa1cd92.js";import{n as D,b as R}from"../js/core/auth.3f3b4c69.js";import{C as $,A as q,D as B,E as L}from"../js/article-buttons-support.feature.8a881d48.js";import{n as H,C as P}from"../js/core/feed.d56f0914.js";import{g as U,u as G,I as Q,v as z,m as J,w as K,c as V,x as W,b as X}from"../js/frontmeans/input-aspects.f8acf040.js";import{C as Y,a as Z}from"../js/core/comments.750cef62.js";import{C as ee,s as te}from"../js/core/forms.d987144f.js";import{e as se}from"../js/frontmeans/httongue.6b868a5b.js";import{a as oe}from"../js/core/api.51544e65.js";import"../js/core/layout.43733f82.js";import"../js/frontmeans/namespace-aliaser.9467f14d.js";import"../js/proc7ts/primitives.38e5298b.js";import"../js/proc7ts/supply.9762ee6d.js";import"../js/proc7ts/context-values.24d38e04.js";import"../js/proc7ts/push-iterator.c8328864.js";import"../js/proc7ts/call-thru.f4f68410.js";import"../js/hatsy/http-header-value.851567fb.js";import"../js/proc7ts/workbench.31425b55.js";import"../js/frontmeans/render-scheduler.6f331202.js";import"../js/lib/dompurify.f5eadf9f.js";import"../js/lib/marked.9d494571.js";import"../js/proc7ts/delta-set.d5d9e832.js";import"../js/core/users.39a49fc0.js";let re=class{constructor(e){this._context=e,this.user=D,this.article=H;e.get(R).user((e=>{this.user=e})).needs(e).whenOff((()=>{this.user=D})),$.articleFor(e)((e=>{this.article=e}))}render(){const{document:e}=this._context.get(x),t=e.createDocumentFragment();if(this.article.slug&&this.article.author.username===this.user.username){t.appendChild(e.createElement("conduit-edit-post-btn")).tabIndex=0;t.appendChild(e.createElement("conduit-delete-post-btn")).tabIndex=0}else{t.appendChild(e.createElement("conduit-follow-author-btn")).tabIndex=0;const s=t.appendChild(e.createElement("conduit-favorite-post-btn"));s.innerText="Favorite Post",s.tabIndex=0}return t}};t([v()],re.prototype,"user",void 0),t([v()],re.prototype,"article",void 0),t([N()],re.prototype,"render",null),re=t([C(["article-actions",F],{feature:{needs:[q,B,L]}})],re);class ne extends CustomEvent{}let ae=class{constructor(e){this._context=e,this.article=H,this.user=D;e.get(R).user((e=>{this.user=e})).needs(e).whenOff((()=>{this.user=D})),$.articleFor(e)((e=>{this.article=e})),m[l].valueFor(e)(((e,t)=>{this.form=e}))}render(){var e;const t=this.articleComment;if(!t)return;const r=this._context.get(Y),{document:n}=this._context.get(x),{author:a}=t,c=`profile/#/${encodeURIComponent(a.username)}`,i=a.image?'<img src="http://i.imgur.com/Qr71crq.jpg" class="comment-author-img" />':"",m=O(new Date(t.createdAt)),l=n.createDocumentFragment(),d=l.appendChild(n.createElement("div"));d.className="card-body";const p=d.appendChild(n.createElement("p"));p.className="card-text",p.innerText=t.body;const u=l.appendChild(n.createElement("div"));u.className="card-footer",u.innerHTML=`\n<a href="${c}" class="comment-author">${i}</a>\n<a href="${c}" class="comment-author">${se(a.username)}</a>\n<span class="date-posted">${m}</span>`;const h=null===(e=this.form)||void 0===e?void 0:e.control,{slug:f}=this.article;if(this.user.username===a.username&&h&&f){const e=u.appendChild(n.createElement("span"));e.className="mod-options";const a=e.appendChild(n.createElement("button"));a.type="button",a.className="btn btn-sm",a.innerHTML='<i class="ion-trash-a"></i>',U(a,{form:h}),new s(a).on("click").do(o)((()=>{h.aspect(G).submit((()=>oe(r.deleteComment(f,t.id)))).then((()=>{this._context.dispatchEvent(new ne("conduit:comment",{bubbles:!0,detail:{removed:t.id}}))})).catch((e=>{e instanceof Q?console.error("Failed to remove comment",...e.errors):console.error("Failed to remove comment",e)}))}))}return l}};t([E()],ae.prototype,"articleComment",void 0),t([v()],ae.prototype,"article",void 0),t([v()],ae.prototype,"user",void 0),t([N({comment:"COMMENT"})],ae.prototype,"render",null),ae=t([C(["article-comment",F])],ae);let ce=class{constructor(e){this._context=e,this.comments=[];const t=e.get(Y);this._context.on("conduit:comment")((({detail:{added:e,removed:t}})=>{this.comments=e?[e,...this.comments]:this.comments.filter((e=>e.id!==t))}));let s=H;$.articleFor(e).do(r((e=>{if(e.slug&&e.slug!==s.slug)return s=e,t.articleComments(e.slug)})))((e=>{this.response=e,e.ok&&(this.comments=e.body.comments)}));const o=e.element;this.form=p.by((e=>z({},e)),(e=>J(o,e)))}render(){const{document:e}=this._context.get(x),{contentRoot:t}=this._context,s=e.createRange();return s.setStartAfter(t.appendChild(e.createComment("[COMMENTS["))),s.setEndBefore(t.appendChild(e.createComment("]COMMENTS]"))),()=>{s.deleteContents();const{comments:t}=this;if(!t.length)return;const o=e.createDocumentFragment();t.forEach((t=>{o.appendChild(e.createElement("conduit-article-comment")).articleComment=t})),s.insertNode(o)}}};t([T({comment:"COMMENTS"})],ce.prototype,"response",void 0),t([v()],ce.prototype,"comments",void 0),t([d()],ce.prototype,"form",void 0),t([_()],ce.prototype,"render",null),ce=t([C(["article-comments",F],{feature:{needs:[ae,Z,ee]}})],ce);let ie=class{constructor(e){const t=e.get(S);e.supply.whenOff((()=>this.content=void 0)),$.articleFor(e)((s=>{s.slug?t.htmlContents(s).then((t=>{e.connected&&(this.content=t)})).catch((t=>{e.connected&&(this.content=void 0,console.error("Failed to parse article",t))})):this.content=void 0})).whenOff((()=>{this.content=void 0}))}render(){return this.content}};t([v()],ie.prototype,"content",void 0),t([N({comment:"ARTICLE(content)"})],ie.prototype,"render",null),ie=t([C(["article-content",F])],ie);let me=class{constructor(e){e.whenSettled((({element:e})=>{this.text=h.by((t=>K(e.querySelector("textarea"),t).setup(V,(e=>e.by(W())))))}))}};t([u()],me.prototype,"text",void 0),me=t([C(["article-comment-text",F])],me);let le=class{constructor(e){this._context=e,this.article=H,this.user=D,this._commentService=e.get(Y);e.get(R).user.do(n(e))((e=>{this.user=e})).whenOff((()=>{this.user=D})),$.articleFor(e)((e=>{this.article=e})).whenOff((()=>{this.article=H})),e.whenSettled((({element:e})=>{this.form=p.by((e=>z({text:""},e)),(t=>J(e.querySelector("form"),t))),this.submitButton=te(e.querySelector("button"))}))}render(){const{element:e}=this._context,t=e.querySelector(".comment-author-img");return()=>{this.user.email&&this.user.image?null==t||t.setAttribute("src",this.user.image):null==t||t.removeAttribute("src")}}submit({control:e}){const{article:t}=this;t.slug&&(e.aspect(X).markEdited(),e.aspect(G).submit((e=>oe(this._commentService.addComment(t.slug,e.text)))).then((t=>{e.it={text:""},e.aspect(X).markTouched(!1),e.aspect(G).reset(),this._context.dispatchEvent(new ne("conduit:comment",{bubbles:!0,detail:{added:t}}))})).catch((e=>{e instanceof Q?console.error("Failed to comment",...e.errors):console.error("Failed to comment",e)})))}};t([v()],le.prototype,"user",void 0),t([d()],le.prototype,"form",void 0),t([u({form:{share:m,local:!0},name:""})],le.prototype,"submitButton",void 0),t([_()],le.prototype,"render",null),t([f()],le.prototype,"submit",null),le=t([C(["new-article-comment",F],{feature:{needs:[me,Z]}})],le);let de=class{constructor(e){this._context=e,this._response=a();const t=e.get(S),s=e.get(y),r=(new P).byArticles(this._response.read.do(c((e=>e&&e.ok?e.body:H)))),m=M(this._response.read.do(c((e=>e&&e.ok?e.body.author:I))));this.author=m.read,this.article=r.read,e.whenConnected((()=>{s.read.do(n(e),i((e=>{const s=decodeURIComponent(e.get(g).pathname.substring(1));return t.article(s)((e=>this.response=e))}))),e.on("conduit:article").do(o)((()=>{s.open("").catch(console.error)}))}))}get response(){return this._response.it}set response(e){this._response.it=e}render(){const{document:e}=this._context.get(x);return()=>{const{response:t}=this;t&&t.ok&&(e.getElementById("article:title").innerText=t.body.title)}}};t([j(A)],de.prototype,"author",void 0),t([j($)],de.prototype,"article",void 0),t([v(),T()],de.prototype,"response",null),t([_({on:w("response")})],de.prototype,"render",null),de=t([C(["article",F],{feature:{needs:[ce,ie,q,re,k,le]}},b())],de),e.load(de);//# sourceMappingURL=main.00681533.js.map
