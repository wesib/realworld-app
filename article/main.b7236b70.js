import{c as e}from"../js/core/main.65d7bafb.js";import{_ as t}from"../js/helpers.e1623395.js";import{D as s,s as o}from"../js/frontmeans/dom-events.fbc8d9ac.js";import{s as r,F as n,d as a,t as c,m as i,l as m}from"../js/proc7ts/fun-events.2a5b87d8.js";import{a as d,I as l,i as p,S as h,O as u,d as f,N as j,P as b}from"../js/wesib/generic.2dcf3479.js";import{S as g,C,B as x,D as y,R as v,x as _}from"../js/wesib/wesib.8c9ee002.js";import{C as E}from"../js/core.10059585.js";import{A as w}from"../js/core/articles.dcb8de86.js";import{R as O,f as F,a as M}from"../js/core/loader.9029aa45.js";import{F as N,c as T,n as k,C as I}from"../js/follow-author-btn.component.c6dc8c30.js";import{n as S,b as A}from"../js/core/auth.97776b50.js";import{A as D,D as R,E as $}from"../js/article-buttons-support.feature.24f619fe.js";import{n as q,C as B,a as L}from"../js/current-article.5d42c2d4.js";import{f as U,q as H,I as P,g as Q,r as z,c as G,s as J,b as K}from"../js/frontmeans/input-aspects.453491d0.js";import{C as V,a as W}from"../js/core/comments.4db4eb6f.js";import{C as X,U as Y,F as Z}from"../js/core/input.475c0ace.js";import{e as ee}from"../js/frontmeans/httongue.6b868a5b.js";import{a as te}from"../js/core/api.e1bac610.js";import"../js/core/layout.52c96865.js";import"../js/frontmeans/namespace-aliaser.9467f14d.js";import"../js/proc7ts/primitives.d6f0dd1c.js";import"../js/proc7ts/context-values.20584faa.js";import"../js/proc7ts/push-iterator.8feb4ef8.js";import"../js/proc7ts/call-thru.f4f68410.js";import"../js/hatsy/http-header-value.851567fb.js";import"../js/proc7ts/workbench.03f3f31a.js";import"../js/frontmeans/render-scheduler.6f331202.js";import"../js/lib/dompurify.f5eadf9f.js";import"../js/lib/marked.2adf5b72.js";import"../js/proc7ts/delta-set.d5d9e832.js";import"../js/core/users.8f3cdaa1.js";import"../js/core/feed.aabbc2ee.js";let se=class{constructor(e){this._context=e,this.user=S,this.article=q;const t=e.get(A),s=e.get(d);t.user.do(r(e))((e=>this.user=e)).whenOff((()=>this.user=S)),s.get(B).do(r(e))((e=>this.article=e)).whenOff((()=>this.article=q))}render(){const{document:e}=this._context.get(x),t=e.createDocumentFragment();if(this.article.slug&&this.article.author.username===this.user.username){t.appendChild(e.createElement("conduit-edit-post-btn")).tabIndex=0;t.appendChild(e.createElement("conduit-delete-post-btn")).tabIndex=0}else{t.appendChild(e.createElement("conduit-follow-author-btn")).tabIndex=0;const s=t.appendChild(e.createElement("conduit-favorite-post-btn"));s.innerText="Favorite Post",s.tabIndex=0}return t}};t([g()],se.prototype,"user",void 0),t([g()],se.prototype,"article",void 0),t([O()],se.prototype,"render",null),se=t([C(["article-actions",E],{feature:{needs:[D,R,$]}})],se);class oe extends CustomEvent{}let re=class{constructor(e){this._context=e,this.article=q,this.user=S,this.form={};const t=e.get(A),s=e.get(d);t.user.do(r(e))((e=>this.user=e)).whenOff((()=>this.user=S)),s.get(B).do(r(e))((e=>this.article=e)).whenOff((()=>this.article=q)),s.get(l).do(r(e))((e=>this.form=e)).whenOff((()=>this.form={}))}render(){const e=this.articleComment;if(!e)return;const t=this._context.get(V),{document:r}=this._context.get(x),{author:n}=e,a=`profile/#/${encodeURIComponent(n.username)}`,c=n.image?'<img src="http://i.imgur.com/Qr71crq.jpg" class="comment-author-img" />':"",i=F(new Date(e.createdAt)),m=r.createDocumentFragment(),d=m.appendChild(r.createElement("div"));d.className="card-body";const l=d.appendChild(r.createElement("p"));l.className="card-text",l.innerText=e.body;const p=m.appendChild(r.createElement("div"));p.className="card-footer",p.innerHTML=`\n<a href="${a}" class="comment-author">${c}</a>\n<a href="${a}" class="comment-author">${ee(n.username)}</a>\n<span class="date-posted">${i}</span>`;const{control:h}=this.form,{slug:u}=this.article;if(this.user.username===n.username&&h&&u){const n=p.appendChild(r.createElement("span"));n.className="mod-options";const a=n.appendChild(r.createElement("button"));a.type="button",a.className="btn btn-sm",a.innerHTML='<i class="ion-trash-a"></i>',U(a,{form:h}),new s(a).on("click").do(o)((()=>{h.aspect(H).submit((()=>te(t.deleteComment(u,e.id)))).then((()=>{this._context.dispatchEvent(new oe("conduit:comment",{bubbles:!0,detail:{removed:e.id}}))})).catch((e=>{e instanceof P?console.error("Failed to remove comment",...e.errors):console.error("Failed to remove comment",e)}))}))}return m}};t([y()],re.prototype,"articleComment",void 0),t([g()],re.prototype,"article",void 0),t([g()],re.prototype,"user",void 0),t([O({comment:"COMMENT"})],re.prototype,"render",null),re=t([C(["article-comment",E])],re);let ne=class{constructor(e){this._context=e,this.comments=[];const t=e.get(V),s=this._context.get(d);this._context.on("conduit:comment")((({detail:{added:e,removed:t}})=>{this.comments=e?[e,...this.comments]:this.comments.filter((e=>e.id!==t))}));let o=q;s.get(B).do(n(e),a((e=>{if(e.slug&&e.slug!==o.slug)return o=e,t.articleComments(e.slug)})))((e=>{this.response=e,e.ok&&(this.comments=e.body.comments)}));const r=Q({});r.supply.needs(e),p(e,r)}render(){const{document:e}=this._context.get(x),{contentRoot:t}=this._context,s=e.createRange();return s.setStartAfter(t.appendChild(e.createComment("[COMMENTS["))),s.setEndBefore(t.appendChild(e.createComment("]COMMENTS]"))),()=>{s.deleteContents();const{comments:t}=this;if(!t.length)return;const o=e.createDocumentFragment();t.forEach((t=>{o.appendChild(e.createElement("conduit-article-comment")).articleComment=t})),s.insertNode(o)}}};t([M({comment:"COMMENTS"})],ne.prototype,"response",void 0),t([g()],ne.prototype,"comments",void 0),t([v()],ne.prototype,"render",null),ne=t([C(["article-comments",E],{feature:{needs:[re,W,X]}})],ne);let ae=class{constructor(e){this._context=e;const t=e.get(w),s=this._context.get(d);e.supply.whenOff((()=>this.content=void 0)),s.get(B).do(r(e))((s=>{s.slug?t.htmlContents(s).then((t=>{e.connected&&(this.content=t)})).catch((t=>{e.connected&&(this.content=void 0,console.error("Failed to parse article",t))})):this.content=void 0}))}render(){return this.content}};t([g()],ae.prototype,"content",void 0),t([O({comment:"ARTICLE(content)"})],ae.prototype,"render",null),ae=t([C(["article-content",E])],ae);let ce=class{};ce=t([C(["article-comment-text",E],Y({select:"textarea",makeControl:({node:e,aspects:t})=>z(e.element,{aspects:t}).setup(G,(e=>e.by(J())))}),h("text"))],ce);let ie=class{constructor(e){this._context=e,this.article=q,this.user=S,this._commentService=e.get(V);const t=e.get(A),s=e.get(d);t.user.do(r(e))((e=>this.user=e)).whenOff((()=>this.user=S)),s.get(B)((e=>this.article=e)).whenOff((()=>this.article=q))}render(){const{element:e}=this._context,t=e.querySelector(".comment-author-img");return()=>{this.user.email&&this.user.image?null==t||t.setAttribute("src",this.user.image):null==t||t.removeAttribute("src")}}submit({control:e}){const{article:t}=this;t.slug&&(e.aspect(K).markEdited(),e.aspect(H).submit((e=>te(this._commentService.addComment(t.slug,e.text)))).then((t=>{e.it={text:""},e.aspect(K).markTouched(!1),e.aspect(H).reset(),this._context.dispatchEvent(new oe("conduit:comment",{bubbles:!0,detail:{added:t}}))})).catch((e=>{e instanceof P?console.error("Failed to comment",...e.errors):console.error("Failed to comment",e)})))}};t([g()],ie.prototype,"user",void 0),t([v()],ie.prototype,"render",null),t([u()],ie.prototype,"submit",null),ie=t([C(["new-article-comment",E],{feature:{needs:[ce,W]}},Z({emptyModel:{text:""}}))],ie);let me=class{constructor(e){this._context=e,this._response=c();const t=e.get(w),s=e.get(j),n=this._context.get(d),a=(new L).byArticles(this._response.read.do(i((e=>e&&e.ok?e.body:q)))),l=T(this._response.read.do(i((e=>e&&e.ok?e.body.author:k))));n.provide({a:B,is:a.read}),n.provide({a:I,is:l.read}),e.whenConnected((()=>{s.read.do(r(e),m((e=>{const s=decodeURIComponent(e.get(b).pathname.substring(1));return t.article(s)((e=>this.response=e))}))),e.on("conduit:article").do(o)((()=>{s.open("").catch(console.error)}))}))}get response(){return this._response.it}set response(e){this._response.it=e}render(){const{document:e}=this._context.get(x);return()=>{const{response:t}=this;t&&t.ok&&(e.getElementById("article:title").innerText=t.body.title)}}};t([g(),M()],me.prototype,"response",null),t([v({on:_("response")})],me.prototype,"render",null),me=t([C(["article",E],{feature:{needs:[ne,ae,D,se,N,ie]}},f())],me),e.load(me);//# sourceMappingURL=main.b7236b70.js.map
