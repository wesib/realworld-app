{"version":3,"file":"main.1fe855b5.js","sources":["../../src/pages/article/follow-author.component.ts","../../src/pages/article/article.component.ts","../../src/pages/article/index.ts"],"sourcesContent":["import { HierarchyContext } from '@wesib/generic';\nimport { Component, ComponentContext, ElementRenderer, Render, StateProperty } from '@wesib/wesib';\nimport { Conduit__NS } from '../../common';\nimport { UserProfile } from '../../common/users';\nimport { escapeHtml } from '../../common/util';\nimport { CurrentArticle } from './current-article';\n\n@Component(['follow-author', Conduit__NS])\nexport class FollowAuthorComponent {\n\n  @StateProperty()\n  private author?: UserProfile;\n\n  constructor(private readonly _context: ComponentContext) {\n\n    const hierarchy = _context.get(HierarchyContext);\n\n    _context.whenOn(supply => {\n      hierarchy.get(CurrentArticle).tillOff(supply)(article => {\n        this.author = article.slug ? article.author : undefined;\n      });\n    });\n  }\n\n  @Render()\n  render(): ElementRenderer {\n\n    const { contentRoot }: { contentRoot: Element } = this._context;\n\n    return () => {\n      if (this.author) {\n        contentRoot.className = this.author.following ? 'btn-outline-primary' : 'btn-outline-secondary';\n        contentRoot.innerHTML = `<i class=\"ion-plus-round\"></i> Follow ${escapeHtml(this.author.username)}`;\n      } else {\n        contentRoot.innerHTML = '';\n      }\n\n    };\n  }\n\n}\n","import { HandleNavLinks, HierarchyContext, Navigation, PageHashURLParam } from '@wesib/generic';\nimport {\n  BootstrapWindow,\n  Component,\n  ComponentContext,\n  DefaultNamespaceAliaser,\n  ElementRenderer,\n  Render,\n  StateProperty,\n  statePropertyPathTo,\n} from '@wesib/wesib';\nimport { trackValue } from 'fun-events';\nimport { css__naming } from 'namespace-aliaser';\nimport { Conduit__NS } from '../../common';\nimport { ApiResponse } from '../../common/api';\nimport { Article, ArticleService } from '../../common/articles';\nimport { ArticlesSupport } from '../../common/articles/articles-support.feature';\nimport { ApiErrorGenerator } from '../../common/input';\nimport { LoaderComponent } from '../../generic/loader';\nimport { ArticleMetaSupport } from './article-meta-support.feature';\nimport { CurrentArticle } from './current-article';\nimport { FollowAuthorComponent } from './follow-author.component';\n\n@Component(\n    ['article', Conduit__NS],\n    {\n      feature: {\n        needs: [\n          ArticleMetaSupport,\n          ArticlesSupport,\n          FollowAuthorComponent,\n          LoaderComponent,\n        ],\n      },\n    },\n    HandleNavLinks(),\n)\nexport class ArticleComponent {\n\n  private readonly _response = trackValue<ApiResponse<Article>>();\n\n  @StateProperty()\n  private content?: Node;\n\n  constructor(private readonly _context: ComponentContext) {\n\n    const articleService = _context.get(ArticleService);\n    const navigation = _context.get(Navigation);\n    const hierarchy = this._context.get(HierarchyContext);\n\n    hierarchy.provide({\n      a: CurrentArticle,\n      is: this._response.read.keep.thru_(response => response && response.ok ? response.body : {}),\n    });\n    _context.whenOn(supply => {\n      supply.whenOff(() => this.content = undefined);\n      this._response.read.tillOff(supply)(response => {\n        if (response && response.ok) {\n          articleService.htmlContents(response.body)\n              .then(content => {\n                if (_context.connected) {\n                  this.content = content;\n                }\n              })\n              .catch(error => {\n                if (_context.connected) {\n                  this.content = undefined;\n                  this.response = { ok: false, errors: { article: [`can not be parser ${String(error)}`] } };\n                }\n              });\n        } else {\n          this.content = undefined;\n        }\n      });\n    });\n    _context.whenOn(supply => {\n      navigation.read.tillOff(supply).consume(page => {\n\n        const slug = page.get(PageHashURLParam).pathname.substring(0);\n\n        return articleService.article(slug)(response => this.response = response);\n      });\n    });\n  }\n\n  get response(): ApiResponse<Article> | undefined {\n    return this._response.it;\n  }\n\n  @StateProperty()\n  set response(value: ApiResponse<Article> | undefined) {\n    this._response.it = value;\n  }\n\n  @Render({ path: statePropertyPathTo('response') })\n  render(): ElementRenderer {\n\n    const visibleClassName = css__naming.name(['visible', Conduit__NS], this._context.get(DefaultNamespaceAliaser));\n    const genErrors = this._context.get(ApiErrorGenerator);\n    const { element, contentRoot }: { element: Element; contentRoot: Node } = this._context;\n    const { document } = this._context.get(BootstrapWindow);\n    let loader: Element | undefined;\n\n    return () => {\n\n      const { response } = this;\n\n      if (!response) {\n        displayLoader();\n      } else if (!response.ok) {\n        displayErrors(response);\n      } else {\n        displayContents(response);\n      }\n\n      function displayLoader(): void {\n        setContentsVisible(false);\n        if (!loader) {\n          loader = contentRoot.appendChild(document.createElement('conduit-loader'));\n        }\n      }\n\n      function hideLoader(): void {\n        if (loader) {\n          loader.remove();\n          loader = undefined;\n        }\n      }\n\n      function displayContents({ body }: ApiResponse.Ok<Article>): void {\n        hideLoader();\n        setContentsVisible(true);\n        element.classList.add(visibleClassName);\n        document.getElementById('article:title')!.innerText = body.title;\n      }\n\n      function displayErrors({ errors }: ApiResponse.Failure): void {\n        hideLoader();\n        setContentsVisible(false);\n        element.classList.remove(visibleClassName);\n        loader = genErrors(errors);\n        if (loader) {\n          contentRoot.appendChild(loader);\n        }\n      }\n\n      function setContentsVisible(visible: boolean): void {\n        if (visible) {\n          element.classList.add(visibleClassName);\n        } else {\n          element.classList.remove(visibleClassName);\n        }\n      }\n    };\n  }\n\n  @Render({ path: statePropertyPathTo('content') })\n  renderContent(): ElementRenderer {\n\n    const { document } = this._context.get(BootstrapWindow);\n\n    return () => {\n\n      const contentParent = document.getElementById('article:content');\n\n      if (contentParent) {\n        contentParent.innerHTML = '';\n\n        const content = this.content;\n\n        if (content) {\n          contentParent.appendChild(content);\n        }\n      }\n    };\n  }\n\n}\n","import { conduitContext } from '../../common/main';\nimport { ArticleComponent } from './article.component';\n\nconduitContext.load(ArticleComponent);\n"],"names":["FollowAuthorComponent","[object Object]","_context","this","hierarchy","get","HierarchyContext","whenOn","supply","CurrentArticle","tillOff","article","author","slug","undefined","contentRoot","className","following","innerHTML","escapeHtml","username","__decorate","StateProperty","Render","Component","Conduit__NS","ArticleComponent","trackValue","articleService","ArticleService","navigation","Navigation","provide","a","is","_response","read","keep","thru_","response","ok","body","whenOff","content","htmlContents","then","connected","catch","error","errors","String","consume","page","PageHashURLParam","pathname","substring","it","value","visibleClassName","css__naming","name","DefaultNamespaceAliaser","genErrors","ApiErrorGenerator","element","document","BootstrapWindow","loader","hideLoader","remove","setContentsVisible","visible","classList","add","getElementById","innerText","title","displayContents","appendChild","displayErrors","createElement","contentParent","path","statePropertyPathTo","feature","needs","ArticleMetaSupport","ArticlesSupport","LoaderComponent","HandleNavLinks","conduitContext","load"],"mappings":"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"}