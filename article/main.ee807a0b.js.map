{"version":3,"file":"main.ee807a0b.js","sources":["../../src/pages/article/article-content.component.ts","../../src/pages/article/article.component.ts","../../src/pages/article/main.ts"],"sourcesContent":["import { HierarchyContext } from '@wesib/generic';\nimport { Component, ComponentContext } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { ArticleService } from '../../core/articles';\nimport { RenderHTML } from '../../reusable';\nimport { CurrentArticle } from './current-article';\n\n@Component(['article-content', Conduit__NS])\nexport class ArticleContentComponent {\n\n  @RenderHTML({ comment: 'ARTICLE(content)', offline: true })\n  content?: Node;\n\n  constructor(private readonly _context: ComponentContext) {\n\n    const articleService = _context.get(ArticleService);\n    const hierarchy = this._context.get(HierarchyContext);\n\n    _context.whenOn(supply => {\n      supply.whenOff(() => this.content = undefined);\n      hierarchy.get(CurrentArticle).tillOff(supply)(article => {\n        if (article.slug) {\n          articleService.htmlContents(article)\n              .then(content => {\n                if (_context.connected) {\n                  this.content = content;\n                }\n              })\n              .catch(error => {\n                if (_context.connected) {\n                  this.content = undefined;\n                  console.error('Failed to parse article', error);\n                }\n              });\n        } else {\n          this.content = undefined;\n        }\n      });\n    });\n  }\n\n}\n","import { HandleNavLinks, HierarchyContext, Navigation, PageHashURLParam } from '@wesib/generic';\nimport {\n  BootstrapWindow,\n  Component,\n  ComponentContext,\n  ElementRenderer,\n  Render,\n  StateProperty,\n  statePropertyPathTo,\n} from '@wesib/wesib';\nimport { trackValue } from 'fun-events';\nimport { Conduit__NS } from '../../core';\nimport { ApiResponse } from '../../core/api';\nimport { Article, ArticleService, ArticlesSupport } from '../../core/articles';\nimport { RenderLoader } from '../../core/loader';\nimport { CurrentUserProfile, currentUserProfileBy, noUserProfile } from '../profile/current-user-profile';\nimport { FollowAuthorComponent } from '../profile/follow-author.component';\nimport { ArticleContentComponent } from './article-content.component';\nimport { ArticleMetaComponentsSupport } from './article-meta-components-support.feature';\nimport { CurrentArticle, CurrentArticleTracker, noArticle } from './current-article';\n\n@Component(\n    ['article', Conduit__NS],\n    {\n      feature: {\n        needs: [\n          ArticleContentComponent,\n          ArticleMetaComponentsSupport,\n          ArticlesSupport,\n          FollowAuthorComponent,\n        ],\n      },\n    },\n    HandleNavLinks(),\n)\nexport class ArticleComponent {\n\n  private readonly _response = trackValue<ApiResponse<Article>>();\n\n  constructor(private readonly _context: ComponentContext) {\n\n    const articleService = _context.get(ArticleService);\n    const navigation = _context.get(Navigation);\n    const hierarchy = this._context.get(HierarchyContext);\n    const article = new CurrentArticleTracker().byArticles(\n        this._response.read.keep.thru_(\n            response => response && response.ok ? response.body : noArticle,\n        ),\n    );\n    const author = currentUserProfileBy(\n        this._response.read.keep.thru_(\n            response => response && response.ok ? response.body.author : noUserProfile,\n        ),\n    );\n\n    hierarchy.provide({ a: CurrentArticle, is: article });\n    hierarchy.provide({ a: CurrentUserProfile, is: author });\n    _context.whenOn(supply => {\n      navigation.read.tillOff(supply).consume(page => {\n\n        const slug = decodeURIComponent(page.get(PageHashURLParam).pathname.substring(1));\n\n        return articleService.article(slug)(response => this.response = response);\n      });\n    });\n  }\n\n  get response(): ApiResponse<Article> | undefined {\n    return this._response.it;\n  }\n\n  @StateProperty()\n  @RenderLoader()\n  set response(value: ApiResponse<Article> | undefined) {\n    this._response.it = value;\n  }\n\n  @Render({ path: statePropertyPathTo('response') })\n  render(): ElementRenderer {\n\n    const { document } = this._context.get(BootstrapWindow);\n\n    return () => {\n\n      const { response } = this;\n\n      if (response && response.ok) {\n        document.getElementById('article:title')!.innerText = response.body.title;\n      }\n    };\n  }\n\n}\n","import { conduitContext } from '../../core/main';\nimport { ArticleComponent } from './article.component';\n\nconduitContext.load(ArticleComponent);\n"],"names":["ArticleContentComponent","[object Object]","_context","this","articleService","get","ArticleService","hierarchy","HierarchyContext","whenOn","supply","whenOff","content","undefined","CurrentArticle","tillOff","article","slug","htmlContents","then","connected","catch","error","console","__decorate","RenderHTML","comment","offline","Component","Conduit__NS","ArticleComponent","trackValue","navigation","Navigation","CurrentArticleTracker","byArticles","_response","read","keep","thru_","response","ok","body","noArticle","author","currentUserProfileBy","noUserProfile","provide","a","is","CurrentUserProfile","consume","page","decodeURIComponent","PageHashURLParam","pathname","substring","it","value","document","BootstrapWindow","getElementById","innerText","title","StateProperty","RenderLoader","Render","path","statePropertyPathTo","feature","needs","ArticleMetaComponentsSupport","ArticlesSupport","FollowAuthorComponent","HandleNavLinks","conduitContext","load"],"mappings":"+nBAQA,IAAaA,EAAb,MAKEC,YAA6BC,GAAAC,cAAAD,EAE3B,MAAME,EAAiBF,EAASG,IAAIC,GAC9BC,EAAYJ,KAAKD,SAASG,IAAIG,GAEpCN,EAASO,OAAOC,IACdA,EAAOC,QAAQ,IAAMR,KAAKS,aAAUC,GACpCN,EAAUF,IAAIS,GAAgBC,QAAQL,EAAtCH,CAA8CS,IACxCA,EAAQC,KACVb,EAAec,aAAaF,GACvBG,KAAKP,IACAV,EAASkB,YACXjB,KAAKS,QAAUA,KAGlBS,MAAMC,IACDpB,EAASkB,YACXjB,KAAKS,aAAUC,EACfU,QAAQD,MAAM,0BAA2BA,MAIjDnB,KAAKS,aAAUC,QAxBvBW,GADCC,EAAW,CAAEC,QAAS,mBAAoBC,SAAS,mCAFzC3B,KADZ4B,EAAU,CAAC,kBAAmBC,KAClB7B,GC2Bb,IAAa8B,EAAb,MAIE7B,YAA6BC,GAAAC,cAAAD,EAFZC,eAAY4B,IAI3B,MAAM3B,EAAiBF,EAASG,IAAIC,GAC9B0B,EAAa9B,EAASG,IAAI4B,GAC1B1B,EAAYJ,KAAKD,SAASG,IAAIG,GAC9BQ,GAAU,IAAIkB,GAAwBC,WACxChC,KAAKiC,UAAUC,KAAKC,KAAKC,MACrBC,GAAYA,GAAYA,EAASC,GAAKD,EAASE,KAAOC,IAGxDC,EAASC,EACX1C,KAAKiC,UAAUC,KAAKC,KAAKC,MACrBC,GAAYA,GAAYA,EAASC,GAAKD,EAASE,KAAKE,OAASE,IAIrEvC,EAAUwC,QAAQ,CAAEC,EAAGlC,EAAgBmC,GAAIjC,IAC3CT,EAAUwC,QAAQ,CAAEC,EAAGE,EAAoBD,GAAIL,IAC/C1C,EAASO,OAAOC,IACdsB,EAAWK,KAAKtB,QAAQL,GAAQyC,QAAQC,IAEtC,MAAMnC,EAAOoC,mBAAmBD,EAAK/C,IAAIiD,GAAkBC,SAASC,UAAU,IAE9E,OAAOpD,EAAeY,QAAQC,EAAvBb,CAA6BoC,GAAYrC,KAAKqC,SAAWA,OAKtEA,eACE,OAAOrC,KAAKiC,UAAUqB,GAKxBjB,aAAakB,GACXvD,KAAKiC,UAAUqB,GAAKC,EAItBzD,SAEE,MAAM0D,SAAEA,GAAaxD,KAAKD,SAASG,IAAIuD,GAEvC,MAAO,KAEL,MAAMpB,SAAEA,GAAarC,KAEjBqC,GAAYA,EAASC,KACvBkB,EAASE,eAAe,iBAAkBC,UAAYtB,EAASE,KAAKqB,UAd1EvC,GAFCwC,IACAC,kCAMDzC,GADC0C,EAAO,CAAEC,KAAMC,EAAoB,0CA1CzBtC,KAdZF,EACG,CAAC,UAAWC,GACZ,CACEwC,QAAS,CACPC,MAAO,CACLtE,EACAuE,EACAC,EACAC,KAINC,MAES5C,GChCb6C,EAAeC,KAAK9C"}