{"version":3,"file":"common.28d2fa39.js","sources":["../../src/common/conduit.ns.ts","../../src/common/layout/main.component.ts","../../src/common/layout/nav.component.ts","../../src/common/layout/container.component.ts","../../src/common/layout/layout-support.feature.ts","../../src/common/conduit.feature.ts","../../src/common/index.ts"],"sourcesContent":["import { NamespaceDef } from 'namespace-aliaser';\n\nexport const Conduit__NS: NamespaceDef = new NamespaceDef(\n    'https://wesib.github.io/realworld-app/ns/',\n    'conduit',\n);\n","import { importNodeContent, Navigation, pageLoadParam, PageLoadResponse } from '@wesib/generic';\nimport { BootstrapWindow, Component, ComponentContext, ElementRender, Render } from '@wesib/wesib';\nimport { trackValue } from 'fun-events';\nimport { Conduit__NS } from '../conduit.ns';\n\n@Component(['main', Conduit__NS])\nexport class MainComponent {\n\n  private readonly _response = trackValue<PageLoadResponse>();\n\n  constructor(private readonly _context: ComponentContext) {\n    this._response.on((n, o) => _context.updateState('response', n, o));\n\n    const navigation = _context.get(Navigation);\n\n    _context.whenOn(supply => {\n      navigation.read.once(page => {\n        page.put(\n            pageLoadParam,\n            {\n              fragment: { tag: _context.element.tagName },\n              receiver: {\n                supply,\n                receive: (_ctx, response) => this._response.it = response,\n              },\n            },\n        );\n      });\n    });\n  }\n\n  @Render()\n  render(): ElementRender {\n\n    const document = this._context.get(BootstrapWindow).document;\n    const range = document.createRange();\n\n    range.selectNodeContents(this._context.element);\n\n    return () => {\n\n      const response = this._response.it;\n\n      if (response) {\n        range.deleteContents();\n        if (response.ok) {\n\n          const target = document.createDocumentFragment();\n          const { fragment } = response;\n\n          if (fragment) {\n            importNodeContent(fragment, target);\n            range.insertNode(target);\n          }\n        } else if (response.ok == null) {\n          range.insertNode(document.createTextNode('Loading...'));\n        } else {\n          range.insertNode(document.createTextNode(`Error. ${response.error}`));\n        }\n      }\n    };\n  }\n\n}\n","import { ComponentNode, ElementNode, Navigation } from '@wesib/generic';\nimport { Component, ComponentContext } from '@wesib/wesib';\nimport { afterAll, DomEventDispatcher, EventSupply } from 'fun-events';\nimport { Conduit__NS } from '../conduit.ns';\n\nconst activeClass = 'active';\n\n@Component(['nav', Conduit__NS])\nexport class NavComponent {\n\n  constructor(context: ComponentContext) {\n\n    const node = context.get(ComponentNode);\n    const navigation = context.get(Navigation);\n\n    context.whenOn(supply => {\n\n      const navLinks = node.select('a', { all: true, deep: true });\n      const linkSupplies = new Map<ElementNode, EventSupply>();\n\n      navLinks.track.tillOff(supply)((added, removed) => {\n        removed.forEach(link => {\n\n          const linkSupply = linkSupplies.get(link);\n\n          if (linkSupply) {\n            linkSupplies.delete(link);\n            linkSupply.off();\n          }\n        });\n        added.forEach(\n            link => {\n\n              const element: Element = link.element;\n              const linkSupply = new DomEventDispatcher(element)\n                  .on('click')\n                  .instead(() => {\n                    if (!element.classList.contains(activeClass)) {\n                      navigation.open(element.getAttribute('href') || '');\n                    }\n                  })\n                  .needs(supply);\n\n              linkSupplies.set(link, linkSupply);\n            },\n        );\n      });\n      afterAll({\n        links: navLinks,\n        page: navigation,\n      })({\n        supply,\n        receive(\n            _ctx,\n            {\n              links: [links],\n              page: [page],\n            },\n        ) {\n\n          const pageDir = dirName(page.url);\n          let activeElement: Element | undefined;\n          let activeDir = '';\n\n          links.forEach(link => {\n\n            const element: HTMLAnchorElement = link.element;\n            const linkDir = dirName(new URL(element.href));\n\n            element.classList.remove(activeClass);\n\n            if (pageDir.startsWith(linkDir) && activeDir.length < linkDir.length) {\n              activeElement = element;\n              activeDir = linkDir;\n            }\n          });\n\n          if (activeElement) {\n            activeElement.classList.add(activeClass);\n          }\n        },\n      });\n    });\n  }\n\n}\n\nfunction dirName(url: URL): string {\n\n  const path = url.pathname;\n\n  if (path.endsWith('/')) {\n    return path;\n  }\n\n  return path + '/';\n}\n","import { Component } from '@wesib/wesib';\nimport { Conduit__NS } from '../conduit.ns';\nimport { MainComponent } from './main.component';\nimport { NavComponent } from './nav.component';\n\n@Component({\n  name: ['container', Conduit__NS],\n  feature: {\n    needs: [MainComponent, NavComponent],\n  },\n})\nexport class ContainerComponent {\n}\n","import { ComponentTreeSupport, PageLoadSupport } from '@wesib/generic';\nimport { Feature } from '@wesib/wesib';\nimport { ContainerComponent } from './container.component';\n\n@Feature({\n  needs: [\n    ComponentTreeSupport,\n    ContainerComponent,\n    PageLoadSupport,\n  ],\n})\nexport class LayoutSupport {\n}\n","import { Feature } from '@wesib/wesib';\nimport { LayoutSupport } from './layout';\n\n@Feature({\n  needs: LayoutSupport,\n})\nexport class ConduitFeature {\n}\n","import { bootstrapComponents } from '@wesib/wesib';\nimport { ConduitFeature } from './conduit.feature';\n\nexport * from './conduit.feature';\nexport * from './conduit.ns';\n\nexport const conduitContext = bootstrapComponents(ConduitFeature);\n"],"names":["Conduit__NS","NamespaceDef","MainComponent","[object Object]","_context","this","trackValue","_response","on","n","o","updateState","navigation","get","Navigation","whenOn","supply","read","once","page","put","pageLoadParam","fragment","tag","element","tagName","receiver","receive","_ctx","response","it","document","BootstrapWindow","range","createRange","selectNodeContents","deleteContents","ok","target","createDocumentFragment","importNodeContent","insertNode","createTextNode","error","__decorate","Render","Component","NavComponent","context","node","ComponentNode","navLinks","select","all","deep","linkSupplies","Map","track","tillOff","added","removed","forEach","link","linkSupply","delete","off","DomEventDispatcher","instead","classList","contains","open","getAttribute","needs","set","afterAll","links","pageDir","dirName","url","activeElement","activeDir","linkDir","URL","href","remove","startsWith","length","add","path","pathname","endsWith","ContainerComponent","name","feature","LayoutSupport","Feature","ComponentTreeSupport","PageLoadSupport","ConduitFeature","conduitContext","bootstrapComponents"],"mappings":"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"}