import{S as e,a as t,Y as s,F as n,e as a,o as r,a0 as o,t as i,d as u,a1 as c,j as h,s as d,a2 as l,N as p,J as f,a3 as g,a4 as _,a5 as m}from"./lib.ab61c7eb.js";import{b,H as k,B as w,F as y,C as v,I as x,A as R,a as T,R as q,D as N,c as O}from"./wesib.da363571.js";const $=new e("auth-service");class j{static get[t](){return $}}const C=new s("api-root-url",{byDefault:()=>new URL("https://conduit.productionready.io/api/")}),I=new n("api-fetch",{byDefault:b((function(e){const t=e.get(k),s=e.get(C);return({path:n,init:r,auth:o})=>s.thru_(e=>new URL(n,e),e=>function(e,t={}){const s=new Request(e.href,Object.assign({mode:"cors"},t)),{headers:n}=s;n.set("X-Requested-With","XMLHttpRequest"),null==s.body||n.has("Content-Type")||n.set("Content-Type","application/json");return s}(e,r)).dig_(t=>!1===o?a({request:t}):function(e,t,s){return e.get($).user.keep.thru_((e,n)=>e?(t.headers.set("Authorization",`Token ${e.token}`),{request:t}):s?(n||(n={ok:!1,errors:{api:["Not authenticated"]}}),{failure:n}):{request:t})}(e,t,o)).dig_(e=>e.request?t(e.request).thru_(e=>({response:e})):a({failure:e.failure})).dig_(L)}))});function L(e){return r(t=>{const s=new o;if(s.on(t),e.response){const{response:t}=e;t.json().then(e=>{t.ok?s.send({ok:!0,response:t,body:e}):s.send({ok:!1,response:t,errors:e.errors||{http:[t.statusText?`${t.status}: ${t.statusText}`:`ERROR ${t.status}`]}})}).catch(e=>{s.send({ok:!1,response:t,errors:{api:[`Failed to parse response: ${e}`]}})})}else s.send(e.failure);s.done()})}class S extends j{constructor(e){super(),this._context=e;const t=e.get(w).localStorage;this._auth=i(t.getItem("wesib-conduit:auth")),this._auth.on((function(e){e?t.setItem("wesib-conduit:auth","string"==typeof e?e:e.token):t.removeItem("wesib-conduit:auth")})),this.user=this._auth.read.keep.dig((function(t){if(!t)return a();if("string"==typeof t)return function(t){const s=e.get(I);return u(e=>{s({path:"user",init:{headers:{Authorization:`Token ${t}`}},auth:!1}).thru_(e=>e.ok?h(e.body):h(void 0,e))({supply:d().needs(e.supply),receive(t,...s){e.receive(t,...s)}})},c())}(t);return a(t)}))}signIn(e){return this._context.get(I)({path:"users/login",init:{method:"POST",body:JSON.stringify(e)},auth:!1}).thru_(e=>(e.ok?this._auth.it=e.body:this._auth.it=null,e))}signOut(){this._auth.it=null}}let A=class{};A=l([y({setup(e){e.provide({a:j,as:S})}})],A);const D=new p("https://wesib.github.io/realworld-app/ns/","conduit");let F=class{};F=l([v(["main",D],x({onResponse({response:e,range:t}){e.ok||(t.deleteContents(),null==e.ok?t.insertNode(document.createTextNode("Loading...")):t.insertNode(document.createTextNode(`Error. ${e.error}`)))}}))],F);let z=class{};z=l([v(["navbar",D],T(),R({active:"active"}))],z);const E=["authenticated",D],H=["not-authenticated",D];let J=class{constructor(e){this._context=e,e.whenOn(t=>{e.get(j).user.tillOff(t)((e,t)=>{this.user=e})})}get user(){return this._user}set user(e){const t=this._user;this._user=e,this._context.updateState("user",e,t)}render(){const e=this._context.get(N),t=f.name(E,e),s=f.name(H,e),{classList:n}=this._context.element;return()=>{this.user?(n.remove(s),n.add(t)):(n.remove(t),n.add(s))}}};l([q()],J.prototype,"render",null),J=l([v({name:["container",D],feature:{needs:[F,z]}})],J);let U=class{};U=l([v(["footer",D],T())],U);let X=class{};X=l([y({needs:[J,U]})],X);let B=class{};function M({mark:e="is-invalid",when:t}={}){return s=>{const n=s.aspect(g);return s.aspect(_).read.keep.dig(({touched:s})=>s?n.specs(m({mark:e,when:t})):a())}}B=l([y({needs:[A,X]})],B);const P=O(B);export{D as C,M as b,P as c};//# sourceMappingURL=common.67131230.js.map
