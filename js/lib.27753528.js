function t(t){return t}function e(){}function s(t){return null!=t}function n(t){return()=>t}function r(...t){return()=>t}const i=Symbol("next-call");function o(t){const e=()=>e;return e[i]=(e,s)=>t(e,s),e}function u(t){return"function"==typeof t&&i in t}function c(t){return o((e,s)=>e.pass(s,t))}function a(...t){return o((e,s)=>e.call(s,t))}function h(t){return o((e,s)=>{for(const n of t)e.pass(s,n)})}const l=o(t=>t.skip());function d(t){return"length"in t}function f(t){return"reverse"in t}function p(t){return t[Symbol.iterator]()}function y(t){return function*(){yield*t}()}function _(t,e){const s={[Symbol.iterator]:t};if(!e)return s;const n=s;return n.reverse=e,n}function g(t){if(d(t))return m(t);if(f(t)){const e=t.reverse();return _(()=>p(e))}return m(Array.from(t))}function m(t){return _((function*(){for(let e=t.length-1;e>=0;--e)yield t[e]}))}function v(t,e){for(const s of t)e(s)}function b(t,e){for(const s of t)if(!e(s))return!1;return!0}function w(t){return p(t).next().value}function O(t,e,s){let n=s;for(const s of t)n=e(n,s);return n}function k(t,e){return _((function*(){for(const s of t)e(s)&&(yield s)}))}function x(e,s=t){return _((function*(){for(const t of e)yield*s(t)}))}function A(t,e){return _((function*(){for(const s of t)yield e(s)}))}function j(s,...n){let r=[];const o=t=>{const s=t>=n.length,c=++t<n.length?n[t]:e,a=(e,n)=>{u(e)?e[i](o(t),c):s?r.push([n]):o(t).pass(c,e)};return{call(t,e){a(t(...e),e)},pass(t,e){a(t(e),e)},skip(){},iterate(t,e){r.push({*[Symbol.iterator](){for(const s of e){const e=r,n=[];try{r=n,a(t(s),s)}finally{r=e}for(const t of n)yield*t}}})}}};return o(0).iterate(n[0],s),x(r,t)}const E=["every","filter","flatMap","forEach","map","reduce","reverse","some"];class T{static none(){return D}static is(t){return E.every(e=>e in t)}static of(t){return T.is(t)?t:T.from(t)}static from(t){return M(()=>t,()=>g(t))}every(t){return b(this,t)}filter(t){return M(()=>k(this,t),()=>k(this.reverse(),t))}flatMap(t){return M(()=>x(this,t),()=>x(this.reverse(),e=>g(t(e))))}forEach(t){v(this,t)}map(t){return M(()=>A(this,t),()=>A(this.reverse(),t))}reduce(t,e){return O(this,t,e)}reverse(){return M(()=>m(Array.from(this)),()=>this)}some(t){return function(t,e){for(const s of t)if(e(s))return!0;return!1}(this,t)}thru(...t){const e=j;return M(()=>e(this,...t))}}class S extends T{*[Symbol.iterator](){}reverse(){return this}}const D=new S;function M(t,e){return new class extends T{[Symbol.iterator](){return p(t())}reverse(){return e?T.from(_(()=>p(e()),()=>this)):super.reverse()}}}function K(t){return _((function*(){for(let e=0;e<t.length;++e)yield t[e]}),()=>m(t))}const R={*[Symbol.iterator](){},reverse(){return this}};function $(t){const e=function(t){return K(Reflect.ownKeys(t))}(t);function s(e){return A(e,e=>[e,t[e]])}return _(()=>p(s(e)),()=>s(e.reverse()))}const F=Symbol("context-key");class C{constructor(t){this.name=t}get[F](){return this}toString(){return`ContextKey(${this.name})`}}class z extends C{constructor(t){super(`${t.name}:seed`)}get seedKey(){return this}grow(t){const{seeder:e,seed:s}=t;return e.isEmpty(s)?t.byDefault(()=>s):s}}class q extends Error{constructor(t,e=`There is no value with key ${t}`){super(e),this.key=t}}function P(t){if(function(t){return"by"in t}(t)){if(!U(t))return t;const{a:e,by:s,with:n}=t;return{a:e,by:t=>s(...n.map(e=>t.get(e)))}}if(function(t){return"is"in t}(t)){const{a:e,is:s}=t;return{a:e,by:n(s)}}if(function(t){return"via"in t}(t)){const{a:e,via:s}=t;return{a:e,by:t=>t.get(s)}}if(function(t){return"as"in t}(t)){if(function(t){return!("a"in t)}(t)&&(t=function(t){return Object.assign(Object.assign({},t),{a:t.as})}(t)),!U(t)){const{as:e}=t;return{a:t.a,by:t=>new e(t)}}const{as:e,with:s}=t;return{a:t.a,by:t=>new e(...s.map(e=>t.get(e)))}}throw new TypeError(`Malformed context value specifier: ${t}`)}function U(t){return"with"in t}class I{}class N{constructor(t){this._seeds=new Map,this._initial=null==t?e:"function"==typeof t?t:e=>t.get(e)}provide(t){const{a:{[F]:{seedKey:e}},by:s}=P(t),[n]=this._seeding(e);return n.provide(s)}_seeding(t){const e=this._seeds.get(t);if(e)return e;const s=t.seeder(),n=[s,e=>s.seed(e,this._initial(t,e))];return this._seeds.set(t,n),n}seed(t,e){const[,s]=this._seeding(e);return s(t)}seedIn(t,e){return this.newValues(e).get.bind(t)}newValues(t=!0){if(!t&&this._nonCachedValues)return this._nonCachedValues;const e=new Map,s=this;class n extends I{get({[F]:n},r){const i=e.get(n);if(null!=i)return i;const[o,u]=function(t,e,n){const[r,i]=function(t,e){const{seedKey:n}=e,[r,i]=s._seeding(n);if(n!==e)return[r,t.get(n)];return[r,i(t)]}(t,e);let o=!1;const u={context:t,seeder:r,seed:i,byDefault:n&&"or"in n?()=>(o=!0,n.or):t=>{const s=t();if(null==s)throw new q(e);return s}};n&&"or"in n&&(u.or=n.or);return[e.grow(u),o]}(this,n,r);return t&&!u&&e.set(n,o),o}}return t?new n:this._nonCachedValues=new n}append(t){return new N((e,s)=>{const[n,r]=this._seeding(e);return n.combine(r(s),t.seed(s,e),s)})}}class V{constructor(){this._providers=[]}provide(t){return this._providers.push(t),()=>{const e=this._providers.indexOf(t);e>=0&&this._providers.splice(e,1)}}seed(e,s=T.from(R)){return T.from([s,W(e,this._providers)]).flatMap(t)}isEmpty(t){return!!p(t).next().done}combine(e,s){return T.from([e,s]).flatMap(t)}}class B extends z{seeder(){return new V}}class J extends C{constructor(t,e){super(t),this.seedKey=e||new B(this)}}class L extends J{constructor(t,{seedKey:s,byDefault:n=e}={}){super(t,s),this.byDefault=n}grow(t){const e=function(t){if(d(t))return t[t.length-1];if(f(t))return w(t.reverse());let e;for(const s of t)e=s;return e}(t.seed);return null!=e?e:t.byDefault(()=>this.byDefault(t.context,this))}}class Q extends J{constructor(t,{seedKey:e,byDefault:s=r()}={}){super(t,e),this.byDefault=s}grow(t){const e=Array.from(t.seed);return e.length?e:t.byDefault(()=>{const e=this.byDefault(t.context,this);if(e)return Array.from(e)})}}function W(t,e){return T.from(K(e.map(t=>[t]))).map(e=>{if(e.length>1)return e[1];const s=e[0](t);return e.push(s),s}).filter(s)}const G=Symbol("after-event");function H(t){return G in t}const X=Symbol("events-supply");class Y{get[X](){return this}needs(t){return Z(t).whenOff(t=>this.off(t)),this}}function Z(t){return t[X]}function tt(t=e){let s,n=r=>{s=t=>t(r),n=e,t(r)};s=t=>{const e=n;n=s=>{e(s),t(s)}};return new class extends Y{get isOff(){return n===e}off(t){return n(t),this}whenOff(t){return s(t),this}}}class et extends Y{get isOff(){return!0}off(){return this}whenOff(t){return t(),this}}const st=new et;function nt(){return st}function rt(t){let s;return s="function"==typeof t?{supply:tt(),receive(e,...s){t(...s)}}:{supply:t.supply||tt(),receive(e,...s){this.supply.isOff||t.receive(e,...s)}},s.supply.whenOff(()=>s.receive=e),s}const it=Symbol("on-event");class ot{constructor(){this._rcvs=new Set,this.send=function(t){let e=function s(n){let r=t;const i=[];e=t=>i.push(t);try{for(;;){r=ut(r,n);const t=i.shift();if(!t)break;n=t}}finally{e=s}};return(...t)=>e(t)}(this._rcvs),this[X]=tt(t=>{this._rcvs.forEach(({supply:e})=>e.off(t))})}get size(){return this._rcvs.size}[it](t){return this.on(t)}on(t){const e=rt(t);return this._rcvs.add(e),e.supply.needs(this).whenOff(()=>this._rcvs.delete(e))}done(t){return Z(this).off(t),this}}function ut(t,e){const s=[];for(const n of t){const t=s.length;s.push(n);const r={onRecurrent(e){s[t]=rt({supply:n.supply,receive(t,...s){e(...s)}})}};n.receive(r,...e)}return s}function ct(t){return e=>t({supply:e.supply,receive:(t,...s)=>{e.receive(t,...s),e.supply.off()}})}function at(t){const e=new ot;let s,n;return r=>{if(e.size||(n=[],s=tt(()=>n=void 0),t({supply:s,receive(t,...s){n&&(e.size?n=void 0:n.push(s)),e.send(...s)}})),r.supply.needs(s),e.on(r).whenOff(t=>{e.size||s.off(t)}),n){const t=new ot;t.on(r),n.forEach(e=>t.send(...e))}}}function ht(t,e,s){const n=Z(e);return e=>{if(s){const r=tt().needs(n);s.needs(r),t({supply:r,receive:e.receive.bind(e)})}else e.supply.needs(n),t(e)}}class lt extends Function{get[it](){return this}get once(){return dt(ct(this))}tillOff(t,e){return dt(ht(this,t,e))}consume(t){let e=nt();const s=this((...s)=>{const n=e;try{e=Z(t(...s)||nt())}finally{e!==n&&n.off()}});return tt(t=>{e.off(t),s.off(t)}).needs(s)}share(){return dt(at(this))}thru(...t){return dt(at(this.thru_(...t)))}thru_(...t){return function(t,s,n,r){return s(s=>{const o=[];t({supply:s.supply,receive(t,...c){const a=(c,h)=>{const l=c>=r.length;++c;const d=o[c];if(d){const t=d.supply;return d.supply=h,[d.chain,t]}const f=c<r.length?r[c]:e,p={chain:{call(t,e){y(t(...e),e)},pass(t,e){y(t(e),[e])},skip(){p.supply.off()},onEvent(t,e){const s=tt().needs(p.supply);n(e)({supply:s,receive(e,...n){y(t(...n),n,s)}})}},supply:h};return o[c]=p,[p.chain,nt()];function y(e,n,r=p.supply){const[o,h]=a(c,tt().needs(r));try{u(e)?e[i](o,f):l?s.receive(t,...n):o.pass(f,e)}finally{h.off()}}},[h,l]=a(0,tt().needs(s.supply));try{h.call(r[0],c)}finally{l.off()}}})})}(this,dt,ft,t)}}function dt(t){const e=e=>{const s=rt(e),{supply:n}=s;return n.isOff||t(s),n};return Object.setPrototypeOf(e,lt.prototype),e}function ft(t){const e=it in t?t[it]:t[G];return e instanceof lt?e:dt(e.bind(t))}const pt=dt(({supply:t})=>t.off());class yt{constructor(t){this._keeper=t}thru(...t){return this.thru_(...t).share()}thru_(...t){return mt(this._keeper.thru_(...t))}}class _t extends lt{get[G](){return this}get keep(){return new yt(this)}get once(){return gt(ct(this))}tillOff(t,e){return gt(ht(this,t,e))}share(){return gt(at(this))}}function gt(t,s=bt){let n,r=0;const i=i=>{let o=e;const u=rt(i);if(u.supply.isOff)return u.supply;const c=tt().needs(u.supply);let a=!1;return t({supply:c,receive(t,...e){a=!0,n=e,o(t,...e)}}),++r,c.isOff&&!a||(u.receive({onRecurrent(t){o=(e,...s)=>t(...s)}},...n||(n=s())),o=(t,...e)=>u.receive(t,...e)),c.whenOff(t=>{--r||(n=void 0),u.supply.off(t)}),c};return Object.setPrototypeOf(i,_t.prototype),i}function mt(t,e){if(!H(t))return function(t,e){return gt(e=>t[it](e),e)}(t,e);const s=t[G];return s instanceof _t?s:gt(s.bind(t))}function vt(...t){return gt(()=>tt(),n(t))}function bt(){throw new Error("No events to send")}function wt(t){const s=Object.keys(t);return gt((function(n){const r=new ot,i=r.on(n);let o=e;const u={};s.forEach(e=>{i.needs(t[e][G]((...t)=>{u[e]=t,o()}).needs(i))}),i.isOff||(o=()=>r.send(u))}),(function(){const e={};return s.forEach(s=>mt(t[s]).once((...t)=>e[s]=t)),[e]})).share()}function Ot(...t){return gt((function(s){const n=new ot,r=n.on(s);let i=e;const o=[];t.forEach((t,e)=>{r.needs(t[G]((...t)=>{o[e]=t,i()}).needs(r))}),r.isOff||(i=()=>n.send(...o))}),(function(){const e=[];return t.forEach(t=>mt(t).once((...t)=>e.push(t))),e})).share()}function kt(t){return o((e,s)=>e.onEvent(s,mt(t)))}function xt(t){return o((e,s)=>e.onEvent(s,t))}var At;class jt extends ot{constructor(){super(...arguments),this.on=dt(t=>super.on(t)),this[At]=this.on}}function Et(...t){return t.length?dt(e=>{const{supply:s}=e;let n=t.length;const r=t=>{--n||s.off(t)},i=(t,...s)=>{e.receive(t,...s)};t.forEach(t=>ft(t)({supply:tt(r).needs(s),receive:i}))}).share():pt}function Tt(t){return dt(e=>{const{supply:s}=e,n=new ot;n.on(e);const r=tt();let i=0;const o=ft(t).tillOff(s,r).thru_(t=>(++i,t));let u=[],c=1,a=0;r.whenOff(t=>{i||e.supply.off(t)}),function(t){return dt(e=>{const{supply:s}=e,n=new ot;n.on(e);let r=0;t[it]({supply:s,receive(t,e){const i=++r;Promise.resolve().then(()=>e).then(t=>n.send(t,i),t=>s.off(t))}})})}(o)({supply:s,receive(t,s,o){const h=o-c;if(u[h]=s,++a,a>h){let t;a===u.length?(t=u,u=[]):t=u.splice(0,h+1),c+=t.length,a-=t.length,i-=t.length,n.send(...t),!i&&r.isOff&&e.supply.needs(r)}}})})}function St(t){return Array.isArray(t)?t:[t]}At=it;class Dt{constructor(t){this._drop=t,this.emitter=new jt,this._nested=new Map,this.emitter.on((t,e,s)=>{const n=(t=St(t))[0],r=this._nested.get(n);r&&r.emitter.send(t.slice(1),e,s)})}on(t){const e=this.emitter.on(t);return tt(t=>{e.off(t),this._dropIfEmpty()}).needs(e)}nest(t,e){const s=this._nested.get(t);if(s||e)return s;const n=new Dt(()=>this._remove(t));return this._nested.set(t,n),n}done(t){for(const e of this._nested.values())e.done(t);this.emitter.done(t)}_remove(t){this._nested.delete(t),this._dropIfEmpty()}_dropIfEmpty(){!this._nested.size&&this.emitter.size<=1&&this._drop()}}class Mt{constructor(){this._root=new Dt(e)}on(t,e){return this._entry(t).on(e)}send(t,e,s){this._root.emitter.send(t,e,s)}done(t,e){const s=this._entry(t,!0);s&&s.done(e)}_entry(t,e){let s=this._root;for(const n of t){const t=s.nest(n,e);if(!t)return;s=t}return s}}class Kt{constructor(t,e){this._trackers=t,this._path=e,this.update=(t,e,s)=>{this._trackers.send([...this._path,...St(t)],e,s)},this.onUpdate=dt(t=>this._trackers.on(this._path,t))}get _tracker(){return this}get[it](){return this.onUpdate}track(t){return(t=St(t)).length?new Kt(this._trackers,[...this._path,...t]):this}done(t){this._trackers.done(this._path,t)}}class Rt{constructor(){this._tracker=new Kt(new Mt,[])}get onUpdate(){return this._tracker.onUpdate}get[it](){return this.onUpdate}get update(){return this._tracker.update}track(t){const e=this._tracker.track(t);return e===this._tracker?this:e}done(t){this._tracker.done(t)}}class $t{constructor(){this._by=nt(),this.read=gt(t=>{return this.on({supply:(e=t).supply,receive(t,s){e.receive({onRecurrent(e){t.onRecurrent(t=>e(t))}},s)}});var e},()=>[this.it])}get[it](){return this.on}get[G](){return this.read}by(t,e){const s=t=>(H(t)?t[G]:t[it])(t=>this.it=t);if(this.byNone(),e){const n=t;this._by=ft(n).consume((...t)=>{const n=e(...t);if(n)return s(n)})}else{const e=t;this._by=s(e)}return this._by.whenOff(()=>this._by=nt()),this}byNone(t){return this._by.off(t),this}done(t){return Z(this).off(t),this}}class Ft extends $t{constructor(t){super(),this._it=t,this._on=new jt}get on(){return this._on.on}get[X](){return Z(this._on)}get it(){return this._it}set it(t){const e=this._it;e!==t&&(this._it=t,this._on.send(t,e))}}function Ct(t){return new Ft(t)}class zt{name(t,e){if("string"==typeof t)return t;const[s,n]=t;return n.name(e(n),s,this)}}class qt extends zt{applyAlias(t,e){return`${e}-${t}`}}const Pt=new qt,Ut=new qt;class It extends zt{applyAlias(t,e){return`${t}@${e}`}}const Nt=new It;class Vt{constructor(t,...e){this.url=t,this.aliases=e}get alias(){return this.aliases[0]||"ns"}name(t,e,s=Pt){return s.applyAlias(e,t,this)}}function Bt(t){return"string"==typeof t||function(t){return Array.isArray(t)&&2===t.length&&"string"==typeof t[0]&&t[1]instanceof Vt}(t)}function Jt(){const t=new Map,e=new Map;return function(s){const n=t.get(s.url);if(n)return n;const r=s.alias;let i=0;for(const n of[r,...s.aliases]){const r=e.get(n);if(!r)return t.set(s.url,n),e.set(n,1),n;i||(i=r)}const o=r+ ++i;return t.set(s.url,o),e.set(r,i),o}}class Lt{constructor(){this._providers=Ct([])}provide(t){return this._providers.it=[...this._providers.it,t],()=>{const e=this._providers.it,s=e.indexOf(t);s>=0&&(this._providers.it=e.slice(0,s).concat(e.slice(s+1)))}}seed(t,e=vt()){return this.combine(e,function(t,e){return e.read.keep.thru(e=>e.length?kt(Ot(...A(A(K(e),e=>e(t)),Qt))):a(),Wt)}(t,this._providers))}isEmpty(){return!1}combine(t,e){return Ot(t,e).keep.thru(Wt)}}function Qt(t){return null==t?vt():function(t){return("object"==typeof t||"function"==typeof t)&&H(t)}(t)?mt(t):vt(t)}function Wt(...t){return a(...x(t))}class Gt extends z{seeder(){return new Lt}}class Ht extends C{constructor(t,e){super(t.name+":up"),this._key=t,this.grow=e}get seedKey(){return this._key.seedKey}}class Xt extends C{constructor(t,e){super(t),this.seedKey=e||new Gt(this)}createUpKey(t){return new Ht(this,t)}}class Yt extends Xt{constructor(t,{seedKey:s,byDefault:n=e}={}){super(t,s),this.byDefault=n}get upKey(){return this}grow(t){return t.seed.keep.thru((...e)=>{if(e.length)return c(e[e.length-1]);const s=t.byDefault(()=>{const e=this.byDefault(t.context,this);return e&&vt(e)});return kt(null!=s?s:gt(()=>{throw new q(this)}))})}}class Zt extends Xt{constructor(t,{seedKey:s,byDefault:n=e}={}){super(t,s),this.byDefault=(t,e)=>n(t,e)||(()=>{throw new q(this)}),this.upKey=this.createUpKey(t=>t.seed.keep.thru((...e)=>{if(e.length)return e[e.length-1];const s=()=>vt(this.byDefault(t.context,this));return kt(t.byDefault(s)||s())}))}grow(t){let e;return t.context.get(this.upKey,"or"in t?{or:null!=t.or?vt(t.or):t.or}:void 0)(t=>e=t),(...t)=>e(...t)}}const te={by(t={}){let e;return{get node(){return t.node},get window(){return e||(e=t.window||t.node&&((s=t.node).ownerDocument||s).defaultView||window);var s},error(...e){t&&t.error?t.error(...e):console.error(...e)}}}};const ee={by({schedule:t,replace:e=(()=>{})}){const s=[];return{schedule:t,add(t){s.push(t)},pull:()=>s.shift(),reset(){const s=ee.by({schedule:t,replace:e});return e(s),s}}}},se=Symbol("scheduled-render-q");class ne{constructor(t,e){this.q=t,this.schedule=this.doSchedule,this.ref=e||[this]}static by(t,e){return t[se]||(t[se]=new ne(t,e))}add(t){this.q.add(t)}doSchedule(t){this.schedule=()=>{};const e={get config(){return t},postpone:t=>this.add(t)};this.q.schedule(()=>{const t=this.reset();t.suspend(),this.exec(e),t.resume()})}exec(t){for(;;){const e=this.q.pull();if(!e)break;e(t)}}reset(){return this.ref[0]=ne.by(this.q.reset(),this.ref)}suspend(){this.schedule=t=>{this.scheduled=t,this.schedule=()=>{}}}resume(){this.scheduled?this.doSchedule(this.scheduled):this.schedule=this.doSchedule}}function re(t){return e=>{const s=te.by(e),n=ne.by(t.newQueue(s)).ref;let r=[];return t=>{const[e]=r,[i]=n;if(e===i)r[1]=t;else{const e=r=[i,t];i.add(t=>{try{e[1]({get config(){return s},postpone(e){t.postpone(e)}})}catch(t){s.error(t)}})}i.schedule(s)}}}const ie=new WeakMap;let oe=re({newQueue({window:t}){const e=ie.get(t);if(e)return e;const s=ee.by({schedule:e=>t.requestAnimationFrame(e),replace:e=>ie.set(t,e)});return ie.set(t,s),s}});function ue(t){return oe(t)}class ce extends lt{get once(){return ae(ct(this))}tillOff(t,e){return ae(ht(this,t,e))}get capture(){return ae((t,e)=>null==e?this(t,!0):"object"==typeof e&&null==e.capture?this(t,Object.assign(Object.assign({},e),{capture:!0})):this(t,e))}get instead(){return ae((t,e)=>{const s=rt(t);return this({supply:s.supply,receive(t,e){e.preventDefault(),s.receive(t,e)}},e)})}get just(){return ae((t,e)=>{const s=rt(t);return this({supply:s.supply,receive(t,e){e.stopPropagation(),s.receive(t,e)}},e)})}get last(){return ae((t,e)=>{const s=rt(t);return this({supply:s.supply,receive(t,e){e.stopImmediatePropagation(),s.receive(t,e)}},e)})}get passive(){return ae((t,e)=>null==e?this(t,{passive:!0}):"boolean"==typeof e?this(t,{capture:e,passive:!0}):null==e.passive?this(t,Object.assign(Object.assign({},e),{passive:!0})):this(t,e))}}function ae(t){const e=(e,s)=>{const n=rt(e);return t(n,s),n.supply};return Object.setPrototypeOf(e,ce.prototype),e}var he;const le={onRecurrent:e};class de{constructor(t){this[he]=tt(),this._target=t}on(t){return ae((e,s)=>{const{supply:n}=e;if(n.needs(Z(this)),!n.isOff){const n=t=>e.receive(le,t);this._target.addEventListener(t,n,s),e.supply.whenOff(()=>this._target.removeEventListener(t,n))}})}dispatch(t){return!Z(this).isOff&&this._target.dispatchEvent(t)}done(t){return Z(this).off(t),this}}function fe(t,e,s,n){var r,i=arguments.length,o=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,s,n);else for(var u=t.length-1;u>=0;u--)(r=t[u])&&(o=(i<3?r(o):i>3?r(e,s,o):r(e,s))||o);return i>3&&o&&Object.defineProperty(e,s,o),o}function pe({$:t,n:e,t:s,v:n,x:r=[],p:i={},pl:o=[]}){return{$:t,n:e,t:s,v:n,x:r,p:i,pl:o}}function ye({p:t,pl:e},s){const n=s.n||s.v,r=t[n];(!r||!r.n&&s.n)&&(t[n]=s),e.push(s)}function _e(t){return e=>{const s=e.s[e.i];return e.d=t.delimiterOf(s),s}}he=X;const ge=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), \d\d (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) \d\d\d\d \d\d:\d\d:\d\d GMT/;function me(t,e){return t.s=t.s.substring(t.i),t.i=0,!!t.s.match(ge)&&(e(t.s.substring(t.i,t.i+=29)),!0)}const ve=()=>!1;function be(t,{named:e=!0,tagged:s=!0,extra:n=!0,next:r=_e(t)}={}){const i=function(t){return(e,s)=>{let n="";for(++e.i;e.i<e.s.length;++e.i){const r=e.s[e.i];if("\\"===r){const t=e.s[++e.i];n+=t||r}else{if(65536&t.delimiterOf(r))return++e.i,void s(n);n+=r}}s(n)}}(t),o=function(t){return(e,s)=>{if(!(262144&t.delimiterOf(e.s[e.i])))return!1;let n="";for(++e.i;e.i<e.s.length;){const s=e.s[e.i++];if(524288&t.delimiterOf(s))break;n+=s}return s(n),!0}}(t),u=n?be(t,{next:r,tagged:!1,named:!1,extra:!1}):ve;return(t,n)=>{let c,a,h,l="",d="raw";for(;t.i<t.s.length;){const n=r(t);if(t.d){if(12&t.d)break;if(null==a){if(16&t.d){a=l?"":n,++t.i;continue}if(65536&t.d){!s&&l||i(t,t=>{l?(d="tagged-string",c=l):d="quoted-string",l="",a=t});break}if(!l&&o(t,t=>{d="angle-bracketed-string",a=t}))break;a=l,l=""}else{if(65536&t.d){!s&&a||i(t,t=>{a?(d="tagged-string",c=a):d="quoted-string",a=t});break}if(!a&&o(t,t=>{d="angle-bracketed-string",a=t}))break}}if(null==a){if(!l&&me(t,t=>a=t)){d="date-time";break}e?l+=n:a=n}else{if(!a&&me(t,t=>a=t)){d="date-time";break}a+=n}++t.i}if(null==a){if(!l)return!1;h=pe({$:d,v:l})}else h=pe({$:d,n:l||void 0,t:c,v:a});for(;u(t,t=>h.x.push(t)););return n(h),!0}}function we(t){return e=>{let s=e.s[e.i];return"\\"!==s?(e.d=t.delimiterOf(s),s):(++e.i,e.i<e.s.length?(s=e.s[e.i],e.d=t.delimiterOf(s)?1:0):e.d=1,s)}}function Oe(t){return e=>{const s=e.i;do{const s=e.s[e.i];if(!(2&t.delimiterOf(s)))break;e.i++}while(e.i<e.s.length);return e.i!==s}}function ke(t,e={}){const s=Oe(t),n=be(t,Object.assign(Object.assign({},e),{tagged:!1}));return(e,r)=>!!(8&t.delimiterOf(e.s[e.i]))&&(++e.i,s(e),n(e,r))}const xe={" ":7,"\t":7,",":5,";":9,'"':65569,"\\":33,"<":262145,">":524289,"=":17,"(":1,")":1,"/":1,":":1,"?":1,"@":1,"[":1,"]":1,"{":1,"}":1};function Ae({delimit:t}={}){const e=t?Object.assign(Object.assign({},xe),t):xe;return{delimiterOf:t=>e[t]||(t>="\0"&&t<=" "||"\x7f"===t?1:0)}}const je=Ae(),Ee=Ae({delimit:{":":17,"(":131105,")":37," ":3,"\t":3,"=":1,",":1}});function Te(t){var e;const s=t?Ae(t):je,n=function(t){const e=Oe(t);return s=>!!(4&t.delimiterOf(s.s[s.i]))&&(s.i++,e(s),!0)}(s),r=ke(s),i=be(s),o=(null===(e=t)||void 0===e?void 0:e.comments)?function(t){const e=Oe(t),s={next:we(t)},n=be(t,s),r=ke(t,s);return(s,i)=>{if(!(131072&t.delimiterOf(s.s[s.i])))return!1;let o;for(++s.i;e(s)||r(s,t=>{o||(o=pe({$:"raw",v:""})),ye(o,t)})||n(s,t=>o=t););return++s.i,i(o||pe({$:"raw",v:""})),!0}}(Ee):ve;return t=>{const e=[],s={i:0,s:t};for(;s.i<s.s.length&&(n(s)||r(s,t=>{e.length||e.push(pe({$:"raw",v:""})),ye(e[e.length-1],t)})||o(s,t=>e.push(t))||i(s,t=>e.push(t))););return e}}const Se=Te();function De(t){if(!t)return'""';let e,s=!1;for(let n=0;n<t.length;++n){const r=t[n],i=je.delimiterOf(r);i?(32&i&&(e||(e=t.substring(0,n)),e+="\\"+r),s=!0):e&&(e+=r)}return s?`"${e||t}"`:t}class Me extends Set{constructor(t){super(),this._added=new Set(t),this._removed=new Set,this._added.forEach(t=>this.add(t))}add(t){return this.has(t)||(this._added.add(t),this._removed.delete(t),super.add(t)),this}delete(t){return!!super.delete(t)&&(this._added.delete(t),this._removed.add(t),!0)}clear(){this._added.clear(),this.forEach(t=>this._removed.add(t)),super.clear()}delta(t,e=[]){return Ke(this)(t,e),this}redelta(t){return("function"==typeof t?t:Ke(t))([...this._added],[...this._removed]),this}undelta(){return this._added.clear(),this._removed.clear(),this}}function Ke(t){return(e,s)=>{for(const e of s)t.delete(e);for(const s of e)t.add(s)}}const Re=Symbol("in-aspect"),$e={instance:null,convertTo:e};function Fe(t,e,s,n,r){return void 0===n&&(n=s(t,r)),{instance:n,convertTo:n=>Fe(n,e,s,void 0,t),attachTo:n=>Fe(n,e,s,t.aspect(e)||s(n))}}function Ce(t,e,s=null){return Fe(t,e,n(null),s)}function ze(t){return{instance:t,convertTo(){return this}}}const qe=new Vt("https://surol.github.io/input-aspects/ns","inasp","input-aspects"),Pe={applyTo:()=>ze(Jt())},Ue={get[Re](){return Pe},to:t=>({applyAspect:e=>e===Pe?ze(t):void 0})},Ie={applyTo:()=>ze(ue)},Ne={get[Re](){return Ie},to:t=>({applyAspect:e=>e===Ie?ze(t):void 0})};function Ve(t,...n){if(!t)return Le;const r=We(t);if(!n.length)return r;const i=A(n,We);return(t,n)=>{const o=r(t,n),u=O(x([[o],k(A(i,e=>e(t,n)),s)]),(t,e)=>e.applyAspect?s=>t(s)||e.applyAspect(s):t,e);return Qe(o)?{applyAspect:u}:{set:o.set.bind(o),get:o.get.bind(o),applyAspect:u}}}function Be(t){return t?(e=t,Array.isArray(e)?Ve(...t):Ve(t)):Ve();var e}const Je={applyAspect(){}};function Le(){return Je}function Qe(t){return!t.set}function We(t){return"function"==typeof t?t:n(t)}class Ge extends $t{constructor(){super(...arguments),this._aspects=new Map}aspect(t){return this._aspect(t[Re]).instance}setup(t,s=e){return Re in t?s(this.aspect(t),this):t(this),this}convert(t,...e){return new He(this,Ve(t,...e))}_aspect(t){const e=this._aspects.get(t);if(e)return e;const s=this._applyAspect(t)||t.applyTo(this);return this._aspects.set(t,s),s}_applyAspect(t){}}class He extends Ge{constructor(e,s){super(),this._supply=tt().needs(e);let n,r=0;const i=new jt;this.on=i.on;const o=s(e,this);let u,c,a;Qe(o)?(u=t,c=t,a=t=>{const s=e._aspect(t);return s.attachTo?s.attachTo(this):s.convertTo(this)}):(u=o.set,c=o.get,a=t=>e._aspect(t).convertTo(this)),this._applyAspect=t=>{var e,s;return(null===(s=(e=o).applyAspect)||void 0===s?void 0:s.call(e,t))||a(t)},this._it=Ct([u(e.it),0]),Z(this._it).needs(this._supply),this._it.on(([t],[e])=>{t!==e&&i.send(t,e)}).whenOff(t=>i.done(t)),e.on(t=>{t!==n&&(this._it.it=[u(t),++r])}).whenOff(t=>this.done(t)),this._it.on(([t,s])=>{if(s!==r){r=s,n=c(t);try{e.it=n}finally{n=void 0}}})}get[X](){return this._supply}get it(){return this._it.it[0]}set it(t){const[e,s]=this._it.it;t!==e&&(this._it.it=[t,s+1])}}class Xe extends Ge{constructor({aspects:t}){super(),this._aspectConversion=Be(t)(function(t){let e;return new class extends Ge{get it(){return t.it}set it(e){t.it=e}get on(){return t.on}get[X](){return e||(e=tt().needs(t))}}}(this),this)}_applyAspect(t){return this._aspectConversion.applyAspect(t)||super._applyAspect(t)}}const Ye={applyTo:t=>Ce(t,Ze)};class Ze extends Xe{static get[Re](){return Ye}_applyAspect(t){return t===Ye?Ce(this,Ze,this):super._applyAspect(t)}}const ts={applyTo:t=>ze(new ss(t))};class es{static get[Re](){return ts}get[it](){return this.on}get[G](){return this.read}}class ss extends es{constructor(t){super(),this._control=t,this._map=new Map,this._on=new jt;const e=this._map;function s(){return e.keys()}this.on=this._on.on.tillOff(t),this.read=gt(this.on.thru(s),()=>[s()])}add(t){const e=this._map.get(t);if(e)return e;const s=tt(()=>{this._map.delete(t),this._on.send([],[t])});return this._map.set(t,s),this._on.send([t],[]),s.needs(this._control).needs(t.parent)}}const ns={applyTo:t=>Ce(t,rs)};class rs extends Xe{static get[Re](){return ns}_applyAspect(t){return t===ns?Ce(this,rs,this):super._applyAspect(t)}}const is={applyTo:t=>Fe(t,os,t=>new as(t))};class os{static get[Re](){return is}get[it](){return this.on}get[G](){return this.read}static hasData(t){return"off"!==t&&"-"!==t[0]}done(t){return this.own.done(t),this}}class us extends $t{constructor(t){super(),this._tracker=Ct(t?function(t){return null!=t.getAttribute("disabled")?"off":null!=t.getAttribute("readonly")?"ro":"on"}(t.element):"on")}get on(){return this._tracker.on}get[X](){return Z(this._tracker)}get it(){return this._tracker.it}set it(t){switch(t){case"off":case"ro":case"-on":case"-ro":break;default:t="on"}this._tracker.it=t}}class cs{constructor(){this._all=new Set,this._on=new jt;const t=gt(this._on.on.thru(()=>this._all),r(this._all));this.read=t.keep.thru(t=>kt(Ot(...t)),ls)}add(t){const e=tt(()=>{this._all.delete(t),this._on.send()});return this._all.add(t),this._on.send(),e}}class as extends os{constructor(t){super(),this._control=t,this._derived=new cs;const e=t.aspect(rs);this.own=new us(e),Z(this.own).needs(t),this.derive(t.aspect(es).read.keep.thru_(hs));let s="on";this.read=gt(wt({derived:this._derived.read,own:this.own}).thru(({derived:[t],own:[e]})=>{let n;if("off"===e||"off"===t)n="off";else{let s=!1;"-"===e[0]&&(s=!0,e=e.substring(1)),"-"===t[0]&&(s=!0,t=t.substring(1)),n="ro"===t?"ro":e,s&&(n="-"+n)}return s===n?l():a(s=n)}),r(s)).tillOff(t),e&&this.read(t=>function(t,e){switch(e){case"off":t.setAttribute("disabled","");break;case"ro":case"-ro":t.setAttribute("disabled",""),t.removeAttribute("disabled"),t.setAttribute("readonly","");break;default:t.setAttribute("disabled",""),t.removeAttribute("disabled"),t.setAttribute("readonly",""),t.removeAttribute("readonly")}}(e.element,t));let n="on";this.on=this.read.thru(t=>{const e=n;return e===t?l():a(n=t,e)})}derive(t){return this._derived.add(mt(H(t)?t:t(this._control)).tillOff(this._control)).needs(this._control)}}function hs(t){const e=Array.from(t);return e.length?kt(Ot(...e.map(({parent:t})=>t.aspect(os))).keep.thru_(ls)):a("on")}function ls(...t){return ds(...x(t))}function ds(...t){let e=!1,s=!1;for(const n of t)switch(n){case"off":return"off";case"ro":e=!0;break;case"-on":s=!0;break;case"-ro":s=!0,e=!0}return s?e?"-ro":"-on":e?"ro":"on"}const fs={applyTo:t=>Fe(t,ps,t=>wt({value:t,mode:t.aspect(os)}).keep.thru(({value:[t],mode:[e]})=>os.hasData(e)?a(t):a()))},ps={get[Re](){return fs}},ys={applyTo:t=>Ce(t,_s)};class _s extends Ze{static get[Re](){return ys}_applyAspect(t){return t===ys?Ce(this,_s,this):super._applyAspect(t)}}const gs={};class ms{constructor(t){this._map=t}get(t){const e=this._map.get(t);return e&&e[0]}[Symbol.iterator](){return y(A(this._map.values(),([t])=>t))}entries(){return y(A(this._map.entries(),([t,[e]])=>[t,e]))}}class vs{constructor(t){this._controls=t,this._supply=tt(),this._map=new Map}set(t,e,s,n){const r=this._map.get(t);let i;if(e){i=tt();const o=this.newEntry(t,e,i);let u=!0;r&&(r[0]===e?u=!1:n.push([t,r])),u?(this.modify().set(t,o),s.push([t,o])):this._map.set(t,o)}else i=nt(),r&&(n.push([t,r]),this.modify().delete(t));return r&&r[1].off(gs),i}newEntry(t,e,s){return[e,tt(e=>{e!==gs&&this._controls.remove(t)}).needs(this._supply).needs(s).whenOff(t=>s.off(t===gs?void 0:t))]}modify(){if(this._shot){const t=new Map;v(this._map.entries(),([e,s])=>t.set(e,s)),this._shot=void 0,this._map=t}return this._map}snapshot(){return this._shot||(this._shot=new ms(this._map))}clear(){const t=[],e=[];return v(this._map.keys(),s=>this.set(s,void 0,t,e)),e}}class bs extends class extends class{get[it](){return this.on}get[G](){return this.read}}{remove(t){this.set(t,void 0)}}{constructor(t){super(),this._group=t,this._updates=new jt;const e=this;this._map=new vs(this),this.on=this._updates.on.thru((t,e)=>a(t.map(ws),e.map(ws))),this.read=gt(this._updates.on.thru(()=>this._map.snapshot()),()=>[this._map.snapshot()]),this._map._supply.needs(t.read((function(t){e.read.once(e=>{const s=new Set;v($(t),([t,n])=>{s.add(t);const r=e.get(t);r&&(r.it=n)}),v(e.entries(),([t,e])=>{s.has(t)||(e.it=void 0)})})})))}set(t,e){const s=this._group,n=[],r=[];let i;return"object"==typeof t?(i=tt(),v($(t),([t,e])=>{this._map.set(t,e,n,r).needs(i)})):i=this._map.set(t,e,n,r),(n.length||r.length)&&(this._updates.send(n,r),n.length&&function(){let t;n.forEach(([e,[n,r]])=>{r.needs(n.aspect(es).add({parent:s}).needs(r));const i=n.it;if(t)t[e]=i;else{const n=s.it;n[e]!==i&&(t=Object.assign(Object.assign({},n),{[e]:i}))}}),t&&(s.it=t);n.forEach(([t,[e,n]])=>{n.needs(e.read(e=>{s.it[t]!==e&&(s.it=Object.assign(Object.assign({},s.it),{[t]:e}))}).needs(n))})}()),i}clear(){const t=this._map.clear();t.length&&this._updates.send([],t)}}function ws([t,[e]]){return[t,e]}class Os extends _s{constructor(t,e){super(e),this._model=Ct(t),this.controls=new bs(this),Z(this).whenOff(()=>this.controls.clear())}get on(){return this._model.on}get[X](){return Z(this._model)}get it(){return this._model.it}set it(t){this._model.it=t}_applyAspect(t){return t===ps[Re]?{instance:(s=this,wt({cs:s.controls,model:s,mode:s.aspect(os)}).keep.thru_(ks)),convertTo:e}:super._applyAspect(t);var s}}function ks({cs:[t],model:[e],mode:[s]}){if(!os.hasData(s))return a();const n={};return v(t.entries(),([t,e])=>{n[t]=e.aspect(ps)}),kt(wt(n).keep.thru(t=>{const s=Object.assign({},e);return v($(t),([t,[e]])=>{s[t]=e}),c(s)}))}function xs(t,{aspects:e}={}){return new Os(t,{aspects:e})}const As=vt();function js(){return As}function Es(t){return H(t)?n(mt(t)):"function"==typeof t?e=>mt(t(e)):e=>e.read.keep.thru(function(t,e){return()=>{const s=e.validate(t);return null==s?a():Array.isArray(s)?a(...s):a(s)}}(e,t))}const Ts={};class Ss{constructor(s){const n=new jt,i=new Map,o=new Map;let u=e,c=e;this[G]=gt(s=>{const a=mt(n,r())(s).whenOff(()=>{u=e,c=e});c=(t,e)=>{const s=t((...e)=>{if(e.length)o.set(t,e);else if(!o.delete(t))return;u()}).needs(e).whenOff(s=>{s!==Ts&&e.off(s),o.delete(t)&&u()});a.whenOff(()=>s.off(Ts))},v(i.entries(),([t,e])=>c(t,e)),u=()=>{n.send(...x(o.values(),t))},o.size&&u()}).share().tillOff(s),this.from=t=>{const e=Es(t)(s),n=tt(()=>{i.delete(e)});return i.set(e,n),c(e,n),n.needs(s)}}}const Ds={applyTo:t=>Fe(t,Ms,(t,e)=>{const s=new Fs(t);if(e){const t=e.aspect(Ms);s.by(t.read.keep.thru(t=>a(...t.messages())))}return s})};class Ms{static get[Re](){return Ds}get[G](){return this.read}}const Ks={get ok(){return!0},messages:()=>[],has:()=>!1,hasBut:()=>!1,[Symbol.iterator]:()=>[][Symbol.iterator]()};class Rs{constructor(t){this._byCode=new Map,this._all=[],v(t,t=>{let e=!1;v($(t),([s,n])=>{if(n){e=!0;const n=this._byCode.get(s);n?n.push(t):this._byCode.set(s,[t])}}),e&&this._all.push(t)})}get ok(){return!this._all.length}messages(t){return null==t?this._all:this._byCode.get(t)||[]}has(t){return null==t||this._byCode.has(t)}hasBut(...t){return this._all.some(e=>t.every(t=>!e[t]))}[Symbol.iterator](){return this._all[Symbol.iterator]()}}function $s(...t){return t.length?new Rs(t):Ks}class Fs extends Ms{constructor(t){super(),this._messages=new Ss(t);const e=t.aspect(Ze);e&&this._messages.from(function(t){return t.controls.read.keep.thru(Cs,zs)}(e)),this.read=mt(this._messages).keep.thru($s)}by(...t){return this._messages.from(function(...t){const e=t.length;return 1===e?t[0]:e?e=>{const s=new Ss(e);return t.forEach(t=>s.from(t)),s}:js}(...t))}}function Cs(t){return kt(Ot(...A(t,t=>t.aspect(Ms))))}function zs(...t){return a(...x(A(t,t=>t[0])))}function qs(t){return t?t.read.keep.thru(t=>t?a():{missing:"missing"}):qs}const Ps={applyTo:t=>Fe(t,Ns,t=>new Vs(t))};class Us extends Error{constructor(...t){super(),this.errors=$s(...A(t,t=>t.submit?t:Object.assign(Object.assign({},t),{submit:!0})))}}class Is extends Us{constructor(t){super({submit:"rejected",rejected:t,[t]:!0})}}class Ns{static get[Re](){return Ps}get[G](){return this.read}}class Vs extends Ns{constructor(t){super(),this._control=t,this._flags=Ct({submitted:!1,busy:!1}),this._errors=Ct([]);const e=t.aspect(Ms);e.by(this._errors.read.keep.thru(t=>a(...t))),this.read=wt({flags:this._flags,data:t.aspect(ps),messages:e}).keep.thru(({flags:[t],data:[e],messages:[s]})=>({ready:void 0!==e&&(s.ok||b(s,t=>t.submit)),submitted:t.submitted,busy:t.busy})).tillOff(t)}async submit(t){if(Z(this._control).isOff)throw new Is("noInput");if(this._flags.it.busy)throw new Is("busy");const e=this,s=this._control;let n;this._flags.it=Object.assign(Object.assign({},this._flags.it),{submitted:!0,busy:!0});try{return this._errors.it.length&&(this._errors.it=[]),await t(await new Promise((t,n)=>{wt({data:s.aspect(ps),flags:e.read}).once(({data:[e],flags:[{ready:s}]})=>{s?t(e):n(new Is("notReady"))})}),s)}catch(t){throw n=function(t){if(t instanceof Us)return[...t.errors];return[{submit:t}]}(t),t}finally{this._flags.it=Object.assign(Object.assign({},this._flags.it),{busy:!1}),n&&(this._errors.it=n)}}reset(){const t=this._flags.it;t.submitted&&(this._flags.it=Object.assign(Object.assign({},t),{submitted:!1})),this._errors.it.length&&(this._errors.it=[])}}function Bs(t,{notReady:e="on",invalid:s="on",busy:n="ro"}={}){return t.aspect(Ns).read.keep.thru(t=>ds(t.busy?n:"on",t.ready?"on":t.submitted?s:e))}function Js({invalid:t="-on",ignore:e="submit"}={}){return s=>s.aspect(Ms).read.keep.thru(s=>s.hasBut(..."string"==typeof e?[e]:e)?t:"on")}class Ls extends rs{constructor(e,{aspects:s,get:n,set:r}){super({aspects:s}),this.element=e,this._input=new jt,this._get=n,this._set=r,this._value=this.it;const i=this._update=(t,e)=>h({value:t},e);this.input=mt(this._input.on.thru(t),()=>[{value:this.it}]),this.on=this._input.on.thru(({value:t},e)=>t===e?l():a(t,e)),this.events=new de(e);const o=this,u=Z(this),c=t=>h({value:o.it,event:t},o._value);function h(t,e){for(;;){let s;o._value=t.value,o._update=(e,n)=>{s=[Object.assign(Object.assign({},t),{value:e}),n]};try{o._input.send(t,e)}finally{o._update=i}if(!s)break;[t,e]=s}}this.events.on("input")(c).needs(u),this.events.on("change")(c).needs(u)}get[X](){return Z(this._input)}get it(){return this._get()}set it(t){const e=this.it;t!==e&&(this._set(t),this._update(this._get(),e))}}function Qs(t,{aspects:e}={}){return new Ls(t,{get(){return this.element.value},set(t){this.element.value=t},aspects:e})}const Ws={applyTo:t=>Fe(t,Gs,t=>{const e=t.aspect(rs);return e&&new Hs(e)})};class Gs extends $t{static get[Re](){return Ws}}class Hs extends Gs{constructor(t){super();const{element:s,events:n}=t,r=s.getRootNode?s.getRootNode():s.ownerDocument;this._it=Ct(!!r&&r.activeElement===s),Z(this).needs(t),n.on("focus")(()=>this._it.it=!0),n.on("blur")(()=>this._it.it=!1),this.on({receive(t,n){t.onRecurrent(e),n?s.focus():s.blur()}})}get on(){return this._it.on}get[X](){return Z(this._it)}get it(){return this._it.it}set it(t){this._it.it=t}}const Xs={applyTo:t=>Fe(t,Ys,t=>{const e=t.aspect(Ze);return null!=e?new en(e):new tn(t)})};class Ys{static get[Re](){return Xs}get[G](){return this.read}}const Zs={hasFocus:!1,touched:!1,edited:!1};class tn extends Ys{constructor(t){super(),this._flags=Ct(Zs),this._flags.by(function(t,e){const s=e.aspect(rs);return wt({hasFocus:e.aspect(Gs)||vt(!1),edited:s?s.input.keep.thru(({event:t})=>!!t):vt(!1)}).keep.thru(({hasFocus:[e],edited:[s]})=>function(t,e,s){t=e?Object.assign(Object.assign({},t),{hasFocus:e,touched:!0}):Object.assign(Object.assign({},t),{hasFocus:e});s&&(t=Object.assign(Object.assign({},t),{edited:s,touched:!0}));return t}(t.it,e,s))}(this._flags,t)),this.read=this._flags.read.tillOff(t)}markTouched(t=!0){const e=this._flags.it;return t?e.touched||(this._flags.it=Object.assign(Object.assign({},e),{touched:t})):e.touched&&(this._flags.it=Object.assign(Object.assign({},e),{touched:e.hasFocus,edited:!1})),this}markEdited(t=!0){const e=this._flags.it;return t?e.edited||(this._flags.it=Object.assign(Object.assign({},e),{touched:!0,edited:t})):e.edited&&(this._flags.it=Object.assign(Object.assign({},e),{edited:t})),this}}class en extends Ys{constructor(t){var e;super(),this._container=t,this.read=(e=t,e.controls.read.keep.thru_(t=>kt(Ot(...function(t){return A(t,t=>t.aspect(Ys))}(t))),sn)).tillOff(t)}markEdited(t){return this._container.controls.read.once(e=>v(e,e=>e.aspect(Ys).markEdited(t))),this}markTouched(t){return this._container.controls.read.once(e=>v(e,e=>e.aspect(Ys).markTouched(t))),this}}function sn(...t){const e={hasFocus:!1,touched:!1,edited:!1};return v(t,([{hasFocus:t,touched:s,edited:n}])=>{s&&(e.touched=!0),t&&(e.hasFocus=e.touched=!0),n&&(e.edited=e.touched=!0)}),e}function nn(t,s){const{form:n,aspects:r,modes:i}=s,o=new Ls(t,{aspects:[Be(r)],get:e,set:e});return Z(o).needs(n),o.aspect(os).derive(Bs(n,i)),o}function rn(t,s){const{form:n,aspects:r,modes:{notReady:i="on",invalid:o="off",busy:u="off"}={}}=s,c=new Ls(t,{aspects:[Be(r)],get:e,set:e});return Z(c).needs(n),c.aspect(os).derive(Bs(n,{notReady:i,invalid:o,busy:u})),c}const on={applyTo(t){const e=t.aspect(rs);return e?ze(e.element):$e}},un={get[Re](){return on},to:(t=null)=>({applyAspect:e=>e===on?ze(t):void 0})},cn={applyTo:t=>({instance:new dn(t),convertTo:e})};class an{static get[Re](){return cn}get[G](){return this.read}}const hn=Symbol("reason");function ln(t){return t&&"object"==typeof t&&hn in t}class dn extends an{constructor(t){super(),this._control=t,this._sources=Ct([new Map]),this.read=this._sources.read.keep.thru_(([t])=>kt(Ot(...t.keys())),(...t)=>{const e={};return t.forEach(([t])=>fn(t,e)),e}).tillOff(t),this.track=gt(t=>{const e=new Me,s=new ot;let n=!1;return s.on(t),this.read(t=>{const r=new Set(e),i=[];v(k($(t),([,t])=>!!t),([t])=>{r.delete(t)||i.push(t)}),(!n||i.length||r.size)&&(e.delta(i,r),n=!0,e.redelta((t,e)=>s.send(t,e)).undelta())})}).tillOff(t);const e=t.aspect(un);e&&this.applyTo(e,this.schedule),Z(t).whenOff(t=>this.done(t))}get schedule(){return this._schedule||(this._schedule=pn(this._control,this._control.aspect(un)))}specs(t){return mt(H(t)?t:t(this._control))}resolve(t){const e=this._control.aspect(Ue);return this.specs(t).keep.thru((...t)=>{const s={};return t.forEach(t=>{Bt(t)?s[Nt.name(t,e)]=!0:fn(t,s)}),s})}add(t){const e=Z(this._control);if(e.isOff)return e;const s=tt(),n=gt(e=>{const n=this.resolve(t)({receive(t,...s){e.receive(t,...s)}});e.supply.whenOff(t=>{s.off({[hn]:t})}),s.needs(n).whenOff(t=>{ln(t)&&n.off(t[hn])})}).share(),[r]=this._sources.it;return r.set(n,s),s.whenOff(t=>{ln(t)||(r.delete(n),this._sources.it=[r])}),this._sources.it=[r],s.needs(e)}applyTo(t,e=pn(this._control,t)){const{classList:s}=t,n=new Me,r=()=>{n.redelta((t,e)=>{s.remove(...e),s.add(...t)}).undelta()};return this.track((t,s)=>{n.delta(t,s),e(r)}).whenOff(()=>{n.size&&(n.clear(),e(r))})}done(t){return v(this._sources.it[0].values(),e=>e.off(t)),this._sources.done(t),this}}function fn(t,e){v($(t),([t,s])=>{null!=s&&(e[t]=s)})}function pn(t,e){return t.aspect(Ne)({node:e})}const yn=[["has-error",qe]];function _n(t){return!t.ok}function gn({mark:t,when:e}={}){let s,n;return s=e?Array.isArray(e)?e.length?t=>e.every(e=>t.has(e)):_n:t=>t.has(e):_n,n=t?Array.isArray(t)?t.length?t:yn:[t]:yn,t=>t.aspect(Ms).read.keep.thru(t=>s(t)?a(...n):a())}function mn({ns:t=qe}={}){return e=>{const s=e=>[e,t];return wt({md:e.aspect(os),vl:e.aspect(Ms),st:e.aspect(Ys)}).keep.thru(({md:[t],vl:[e],st:[{hasFocus:n,touched:r,edited:i}]})=>{const o=[];return os.hasData(t)||o.push(s("disabled")),"ro"!==t&&"-ro"!==t||o.push(s("readonly")),e.ok||o.push(s("invalid")),e.has("missing")&&o.push(s("missing")),e.has("incomplete")&&o.push(s("incomplete")),n&&o.push(s("has-focus")),r&&o.push(s("touched")),i&&o.push(s("edited")),a(...o)})}}export{nt as $,T as A,G as B,I as C,Bt as D,jt as E,Zt as F,de as G,Z as H,s as I,Ut as J,mt as K,Nt as L,Q as M,Vt as N,it as O,p as P,rt as Q,ot as R,L as S,Tt as T,h as U,$t as V,De as W,Se as X,w as Y,c as Z,ft as _,F as a,Yt as a0,_s as a1,Ge as a2,Ve as a3,Ue as a4,Ne as a5,xt as a6,Us as a7,r as a8,fe as a9,an as aa,Ys as ab,Ms as ac,gn as ad,un as ae,mn as af,rn as ag,xs as ah,os as ai,Js as aj,nn as ak,Qs as al,qs as am,Ns as an,N as b,Xt as c,gt as d,vt as e,wt as f,a as g,kt as h,O as i,Ot as j,l as k,k as l,A as m,ue as n,dt as o,Jt as p,Et as q,e as r,tt as s,Ct as t,v as u,n as v,K as w,Rt as x,X as y,x as z};//# sourceMappingURL=lib.27753528.js.map
