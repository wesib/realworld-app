import{g as t,a as e,d as s,e as a}from"../lib/call-thru.00f7427a.js";import{e as r,t as i}from"../lib/a-iterable.5fab0d69.js";import{S as o}from"../lib/context-values.d686e0c8.js";import{o as c,s as n,d as l}from"../lib/fun-events.a21352be.js";import{B as h,F as p}from"../wesib/wesib.5eadef04.js";import{_ as d}from"../helpers.920c7f83.js";import{A as f}from"./api.689b3fef.js";import{m as u}from"../lib/marked.8e5d3ae9.js";import{D as m}from"../lib/dompurify.780c3c3d.js";const _=new o("article-service"),b=["feed","tag","author","favorited","limit","offset"];function g(t,e){return b.every(s=>t[s]===e[s])}function j(e){const s=new URLSearchParams;return r(i(b,e=>"feed"!==e?e:t,s=>{const a=e[s];return a?[s,String(a)]:t}),([t,e])=>s.set(t,e)),s}const A=new o("feed-service");class F{constructor(t){this._apiFetch=t.get(f);const e=t.get(h);this._purify=m(e),e.requestIdleCallback?this._schedule=t=>e.requestIdleCallback(t,{timeout:750}):this._schedule=t=>e.setTimeout(t)}article(t){const e={path:`articles/${encodeURIComponent(t)}`,init:{method:"GET",headers:{Accept:"application/json"}},respondAs:"article"};return this._apiFetch(e)}async htmlContents(t){const e=await new Promise((e,s)=>{this._schedule(()=>{u(t.body,(t,a)=>{null!=t?s(t):e(a)})})});return this._purify.sanitize(e,{RETURN_DOM_FRAGMENT:!0,RETURN_DOM_IMPORT:!0})}}const v={"/personal-feed":{path:"articles/feed",auth:!0},"/global-feed":{path:"articles"}};class R{constructor(t){this._apiFetch=t.get(f)}articles(t){const{path:s,auth:a}=v[t.feed||"/global-feed"],r={path:`${s}?${j(t)}`,init:{method:"GET",headers:{Accept:"application/json"}},auth:a,respondAs:e};return this._apiFetch(r)}tags(){if(this._tags)return this._tags;let e;return this._tags=c(r=>{if(!e){const r={path:"tags",init:{method:"GET",headers:{Accept:"application/json"}},respondAs:"tags",auth:!1},i=this._apiFetch(r).thru_(e=>e.ok?s(e.body):!1===e.ok?(console.log("Failed to load tags",e.errors),s([])):t),o=n(l(i,()=>[]));e=o.read.thru_(e=>e?a(...e):t)}e(r)})}}let T=class{};T=d([p({setup(t){t.provide({a:_,as:F}),t.provide({a:A,as:R})}})],T);export{_ as A,T as F,A as a,g as b,j as f};//# sourceMappingURL=articles.2a834336.js.map
