import{S as e,a1 as t,F as s,g as r,a6 as n,T as a,a7 as o,a8 as i,a9 as c,Z as u,k as p,aa as h,ab as l,a as d,t as f,d as g,ac as m,r as _,A as b,ad as k,f as w,ae as y,af as j,h as v,ag as O,N as x,ah as R,ai as A,aj as T,ak as L,al as $,am as q,an as C,a0 as S,K as U,L as F}from"./lib.e4c19b17.js";import{b as E,H as N,F as D,B as I,R as P,C as z,a as G,I as H,c as J,A as M,t as X,d as B,e as K,D as W,f as Z,U as Q,g as V,h as Y,i as ee,j as te,k as se}from"./wesib.026f685a.js";const re=["tag","author","favorited","limit","offset"];function ne(e,t){return re.every(s=>e[s]===t[s])}const ae=new e("feed-service"),oe=new t("api-root-url",{byDefault:()=>new URL("https://conduit.productionready.io/api/")}),ie=new e("auth-service"),ce=new s("api-fetch",{byDefault:E((function(e){const t=e.get(N),s=e.get(oe);return o=>{const{path:i,init:c,auth:u}=o,p=s.thru_(e=>new URL(i,e),e=>function(e,t={}){const s=new Request(e.href,Object.assign({mode:"cors"},t)),{headers:r}=s;return r.set("X-Requested-With","XMLHttpRequest"),s}(e,c)).thru_(t=>!1===u?r({request:t}):n(function(e,t,s){return e.get(ie).user.keep.thru_((e,r)=>e?(t.headers.set("Authorization",`Token ${e.token}`),{request:t}):s?(r||(r={ok:!1,errors:{api:["Not authenticated"]}}),{failure:r}):{request:t})}(e,t,u)),e=>e.request?n(t(e.request).thru_(e=>({response:e}))):r({failure:e.failure}));return a(p.thru_(ue)).thru_(([e,t])=>function({respondAs:e},t,s){if(!t.response)return t.failure;const{response:r}=t;if(r.ok)return{ok:!0,response:r,body:"function"==typeof e?e(s):s[e]};return{ok:!1,response:r,errors:s.errors||{http:[r.statusText?`${r.status}: ${r.statusText}`:`ERROR ${r.status}`]}}}(o,e,t))}}))});function ue(e){return e.response?Promise.all([e,e.response.json()]).catch(t=>[{failure:{ok:!1,response:e.response,errors:{api:[`Failed to parse response: ${t}`]}}}]):[e]}new s("api-submitter",{byDefault:E((function(e){const t=e.get(ce);return e=>{const{init:s={}}=e,{method:r="POST",headers:n={}}=s;return a=>{const o=Object.assign(Object.assign({},e),{init:Object.assign(Object.assign({},s),{method:r,body:JSON.stringify(a),headers:Object.assign(Object.assign({},n),{Accept:"application/json","Content-Type":"application/json"})})});return pe(t(o))}}}))});function pe(e){return new Promise((t,s)=>{e.once(e=>{e.ok?t(e.body):s(new o({submit:"api",api:e.errors}))}).whenOff(e=>{s(e instanceof o?e:new o({submit:"cancel",cancel:e}))})})}class he{constructor(e){this._apiFetch=e.get(ce)}articles(e){return this._articles("articles",e)}feed(e){return this._articles("articles/feed",e,!0)}article(e){const t={path:`articles/${encodeURIComponent(e)}`,init:{method:"GET",headers:{Accept:"application/json"}},respondAs:"article"};return this._apiFetch(t)}_articles(e,t,s){const r=Array.from(i(c(t),([e,t])=>t?u([e,String(t)]):p));r.length&&(e=`${e}?${new URLSearchParams(r)}`);const n={path:e,init:{method:"GET",headers:{Accept:"application/json"}},auth:s,respondAs:h};return this._apiFetch(n)}}let le=class{};le=l([D({setup(e){e.provide({a:ae,as:he})}})],le);class de{static get[d](){return ie}}class fe extends de{constructor(e){super(),this._context=e;const t=e.get(I).localStorage;this._auth=f(t.getItem("wesib-conduit:auth")),this._auth.on((function(e){e?t.setItem("wesib-conduit:auth","string"==typeof e?e:e.token):t.removeItem("wesib-conduit:auth")})),this.user=this._auth.read.keep.thru((function(t){if(!t)return r();if("string"==typeof t)return n(function(t){const s=e.get(ce),n={path:"user",init:{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Token ${t}`}},respondAs:"user",auth:!1};return g(e=>{s(n).thru_(e=>e.ok?r(e.body):r(void 0,e))({supply:_().needs(e.supply),receive(t,...s){e.receive(t,...s)}})},m())}(t));return r(t)}))}login(e){return this._request("users/login",e)}register(e){return this._request("users",e)}logout(){this._auth.it=null}_request(e,t){return this._context.get(ce)({path:e,init:{method:"POST",body:JSON.stringify({user:t}),headers:{Accept:"application/json","Content-Type":"application/json"}},respondAs:"user",auth:!1}).thru_(e=>(e.ok?this._auth.it=e.body:this._auth.it=null,e))}}let ge=class{};ge=l([D({setup(e){e.provide({a:de,as:fe})}})],ge);const me=new s("api-error-generator",{byDefault:E(e=>{const t=e.get(I).document;return e=>{let s;return b.from(c(e)).forEach(([e,r])=>{s||(s=t.createElement("ul"),s.classList.add("error-messages"));const n=s;r.forEach(s=>{const r=t.createElement("li");r.innerText=`${e} ${s}`,n.appendChild(r)})}),s}})});function _e({mark:e="is-invalid",when:t}={}){return s=>{const n=s.aspect(k);return w({status:s.aspect(y),validity:s.aspect(j)}).keep.thru(({status:[{touched:s,hasFocus:a}],validity:[o]})=>{const i=o.has("incomplete")||o.has("missing");return!s||a&&i?r():v(n.specs(O({mark:e,when:t})))})}}const be=new x("https://wesib.github.io/realworld-app/ns/","conduit"),ke={};let we=class{constructor(e){this._context=e,this._errors=ke,e.get(G).get(H).thru_(({control:e})=>e?v(e.aspect(j).read.keep.thru_(e=>e.messages("api").reduce((e,t)=>Object.assign(Object.assign({},e),t.api),ke))):r(ke))(e=>this.errors=e)}get errors(){return this._errors}set errors(e){const t=this._errors;t!==e&&(this._errors=e,this._context.updateState("errors",e,t))}render(){const{contentRoot:e}=this._context;let t;return()=>{t&&(t.remove(),t=void 0),t=this._context.get(me)(this.errors),t&&e.append(t)}}};l([P()],we.prototype,"render",null),we=l([z(["api-errors",be])],we);let ye=class{};ye=l([z(["in-error",be],M("code"),J(({control:{control:e},aspects:t,context:s})=>X(s,"code").read.keep.thru_(e=>e?e.trim().split(/\s+/):[]).keep.thru(r=>e.convert(R.to(s.element),t).setup(k,e=>{e.add(A()),e.add(_e({when:r}))}))))],ye);let je=class{};function ve({emptyModel:e={},form:t={makeForm({node:t,aspects:s}){const r=L(e).setup(k,e=>e.add(A())).setup($,e=>e.derive(q())),n=C(t.element,{form:r,aspects:s}).setup(k,e=>e.add(r.aspect(k)));return[r,n]}},button:s}={}){return z(Z(t),function({select:e="button",pick:t={deep:!0,all:!0}}={}){return z({feature:{needs:B},define(s){s.whenComponent(s=>{const r=s.get(K),n=s.get(G);s.whenOn(a=>{w({form:n.get(H),button:r.select(e,t).first,aspects:s.get(W)}).tillOff(a).consume(({form:[{control:e}],button:[t],aspects:[s]})=>e&&t&&T(t.element,{form:e,aspects:s}))})})}})}(s))}function Oe(e){return Q(Object.assign(Object.assign({},e),{makeControl:t=>t.context.get(G).get(H).keep.thru_(({form:s})=>{const n=e.makeControl(t);return n?n instanceof S?a(n):v(U(n).keep.thru_((e,t)=>e?(a(e),t?r(e,t):r(e)):r())):r();function a(e){s&&e.aspect($).derive(s.aspect($));const t=e.aspect(k);return t.add(A()),t.add(_e()),e}})}))}je=l([D({needs:[we,ye]})],je);let xe=class{};xe=l([z(["main",be],V({onResponse({response:e,range:t}){e.ok||(t.deleteContents(),null==e.ok?t.insertNode(document.createTextNode("Loading...")):t.insertNode(document.createTextNode(`Error. ${e.error}`)))}}))],xe);let Re=class{};Re=l([z(["navbar",be],ee(),Y({active:"active"}))],Re);const Ae=["authenticated",be],Te=["not-authenticated",be];let Le=class{constructor(e){this._context=e,e.whenOn(t=>{e.get(de).user.tillOff(t)((e,t)=>{this.user=e})})}get user(){return this._user}set user(e){const t=this._user;this._user=e,this._context.updateState("user",e,t)}render(){const e=this._context.get(te),t=F.name(Ae,e),s=F.name(Te,e),{classList:r}=this._context.element;return()=>{this.user?(r.remove(s),r.add(t)):(r.remove(t),r.add(s))}}};l([P()],Le.prototype,"render",null),Le=l([z({name:["container",be],feature:{needs:[xe,Re]}})],Le);let $e=class{};$e=l([z(["footer",be],ee())],$e);let qe=class{};qe=l([D({needs:[Le,$e]})],qe);let Ce=class{};Ce=l([D({needs:[ge,je,qe,le]})],Ce);const Se={"&":"&amp;","<":"&lt;",">":"&gt;"};function Ue(e){return Se[e]||e}function Fe(e){return e?e.replace(/[&<>]/g,Ue):""}function Ee(e){const t=new URL("/",e.href);return new URL(e.hash.substring(1),t)}function Ne(e,t){const s=new URL("/",t).href.length,r=new URL(e.href);return r.hash=t.href.substring(s),r}const De=se(Ce);export{de as A,be as C,ae as F,Oe as U,me as a,ve as b,De as c,pe as d,Fe as e,ne as f,Ee as h,Ne as s};//# sourceMappingURL=common.673eb9a1.js.map
