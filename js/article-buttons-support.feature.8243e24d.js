import{S as t,R as e,C as r,B as s,F as o}from"./wesib/wesib.fd49a6cd.js";import{_ as a}from"./helpers.e1623395.js";import{f as i,P as n,d as c,g as l,a as d,N as u}from"./wesib/generic.1df87fc1.js";import{C as h}from"./core.bba16f1a.js";import{f as p,R as m}from"./core/loader.46a2a88b.js";import{A as g,a as f}from"./core/articles.aa6b0084.js";import{f as v}from"./core/feed.e63c551e.js";import{C as b,n as x}from"./current-article.faae2888.js";const C=new class extends i{create(t,e){const r=this.byDefault(t);return r.put(e),r}byDefault(t){return{get(){const{searchParams:e,pathname:r}=t.get(n),s=r.indexOf("/",1),o=decodeURIComponent(s<0?r.substring(1):r.substring(1,s));let a,i;return s>0&&"favorite"===r.substr(s+1)?i=o:a=o,{tag:e.get("tag")||void 0,author:a,favorited:i,limit:parseInt(e.get("limit")||"",10)||void 0,offset:parseInt(e.get("offset")||"",10)||void 0}},put(e){const{favorited:r,author:s=""}=e,o=new URL(t.get(n).href);o.pathname=r?`/${encodeURIComponent(r)}/favorite`:`/${encodeURIComponent(s)}`;const a=v({...e,favorited:void 0,author:void 0}).toString();o.search=a?"?"+a:"",t.put(n,o)}}}};let E=class{constructor(t){this._context=t,this.article={};t.get(d).get(b).to((t=>this.article=t))}render(){const t=this._context.get(u),{document:e}=this._context.get(s),{contentRoot:r}=this._context,o=e.createDocumentFragment(),a=o.appendChild(e.createElement("a")),i=o.appendChild(e.createElement("div"));i.className="info";const n=i.appendChild(e.createElement("a"));n.className="author";const c=i.appendChild(e.createElement("time"));return c.className="date",r.appendChild(o),()=>{var e,r;const s=this.article;let o="",i="",l="",d="",u="";if(s.slug){const{author:a}=s;o=(null===(r=null===(e=t.with(C,{author:a.username}).pretend("profile/"))||void 0===e?void 0:e.url)||void 0===r?void 0:r.href)||"",i=a.image?`<img src="${encodeURI(a.image)}"/>`:"",l=a.username,d=s.createdAt,u=p(new Date(s.createdAt))}a.href=o,a.innerHTML=i,n.href=o,n.innerText=l,c.innerText=u,d?c.setAttribute("datetime",d):c.removeAttribute("datetime")}}};a([t()],E.prototype,"article",void 0),a([e()],E.prototype,"render",null),E=a([r(["article-author",h],{feature:{needs:l}},c())],E);const y=[];let _=class{constructor(t){this._context=t,this.tags=y;t.get(d).get(b).to((t=>this.tags=t.slug?t.tagList:y)).whenOff((()=>this.tags=[]))}render(){if(!this.tags.length)return;const{document:t}=this._context.get(s),e=t.createElement("ul");return this.tags.forEach((r=>{const s=e.appendChild(t.createElement("li")).appendChild(t.createElement("a"));s.href=`#/?tag=${encodeURIComponent(r)}`,s.innerText=r})),e}};a([t()],_.prototype,"tags",void 0),a([m()],_.prototype,"render",null),_=a([r(["article-tags",h],c())],_);class w extends CustomEvent{}let A=class{constructor(t){this._context=t,this.article=x;const e=t.get(g);t.get(d).get(b).to((t=>this.article=t)).whenOff((()=>this.article=x)),t.on("click").just((()=>{this.article.slug&&function(r){if(!confirm("Are you sure you want to delete this article?"))return;e.deleteArticle(r).once((e=>{e.ok?t.dispatchEvent(new w("conduit:article",{bubbles:!0,detail:{removed:r}})):console.error("Failed to remove article",e.errors)}))}(this.article.slug)}))}render(){const{article:t}=this;if(!t.slug)return;const{document:e}=this._context.get(s),r=e.createDocumentFragment();return r.appendChild(e.createElement("i")).className="ion-trash-a",r.append(" Delete Article"),r}};a([t()],A.prototype,"article",void 0),a([m()],A.prototype,"render",null),A=a([r(["delete-post-btn",h],{feature:{needs:f}})],A);let R=class{constructor(t){this._context=t,this.article=x;const e=t.get(u);t.get(d).get(b).to((t=>this.article=t)).whenOff((()=>this.article=x)),this._context.on("click").to((()=>{var t;this.article.slug&&(t=this.article.slug,e.with(n,encodeURIComponent(t)).open("editor/").catch((t=>console.error("Failed to edit article",t))))}))}render(){const{article:t}=this;if(!t.slug)return;const{document:e}=this._context.get(s),r=e.createDocumentFragment();return r.appendChild(e.createElement("i")).className="ion-edit",r.append(" Edit Article"),r}};a([t()],R.prototype,"article",void 0),a([m()],R.prototype,"render",null),R=a([r(["edit-post-btn",h],{feature:{needs:l}})],R);let N=class{constructor(t){this._context=t,this.article=x;const e=t.get(d),r=t.get(g);e.get(b).to((t=>{this.article=t})),t.on("click").to((()=>{const{article:t}=this;if(t.slug){const e=!t.favorited;t.update({...t,favorited:e}),r.likeArticle(t.slug,e).to((e=>{this.article.slug&&(e.ok?this.article.update(e.body):(this.article.update(t),console.error(`Failed to like article ${t.slug}`,e.errors)))}))}}))}render(){const{contentRoot:t,element:e}=this._context,{document:r}=this._context.get(s),o=r.createElement("i");t.insertBefore(o,t.childNodes[0]);const a=t.appendChild(r.createElement("span"));return a.className="counter",()=>{o.className=this.article.slug&&this.article.favorited?"ion-heart":"ion-ios-heart-outline",a.innerText=this.article.slug&&this.article.favoritesCount?String(this.article.favoritesCount):"",e.className=this.article.slug&&this.article.favorited?"btn-success":"btn-outline-success"}}};a([t()],N.prototype,"article",void 0),a([e()],N.prototype,"render",null),N=a([r(["favorite-post-btn",h],{feature:{needs:f}})],N);let j=class{};j=a([o({needs:[E,_,A,R,N]})],j);export{j as A,A as D,R as E,C as P};//# sourceMappingURL=article-buttons-support.feature.8243e24d.js.map
