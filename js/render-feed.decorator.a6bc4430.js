import{d as e}from"./proc7ts/call-thru.505a1d44.js";import{S as t,C as s,a as r}from"./proc7ts/context-values.36bc76d6.js";import{g as a,t as n,i,n as o}from"./proc7ts/fun-events.5a9906d8.js";import{g as c,i as l,h as p,B as d,S as u,D as h,C as f,s as m,R as g}from"./wesib/wesib.2306ec70.js";import{_ as b}from"./helpers.920c7f83.js";import{n as C,b as _}from"./core/auth.675216b2.js";import{f as x,g as v,P as E,a as y,N as P}from"./wesib/generic.88f59b08.js";import{C as w}from"./core.c852ba8c.js";import{R as j,a as q}from"./core/loader.6b44f08a.js";import"./core/input.bf0db094.js";import{A as D}from"./article-buttons-support.feature.0e8f7a01.js";import{r as R}from"./core/util.b9da7eca.js";import{f as S,n as A,F as M,a as N,b as O}from"./core/feed.931918f9.js";import{a as k,C as I}from"./current-article.944a5860.js";const T=Symbol("paging-info");const F=new class extends v{create(e,t){const s=this.byDefault(e);return s.put(t),s}byDefault(e){return{get(){const{searchParams:t,pathname:s}=e.get(E);return{feed:"/personal-feed"===s?s:void 0,tag:t.get("tag")||void 0,limit:parseInt(t.get("limit")||"",10)||void 0,offset:parseInt(t.get("offset")||"",10)||void 0}},put(t){const{feed:s}=t,r=new URL(e.get(E).href);r.pathname="/personal-feed"===s?s:"";const a=S(t).toString();r.search=a?"?"+a:"",e.put(E,r)}}}};let H=class{constructor(e){this._context=e,this._article=new k,this.user=C;const t=e.get(_),s=e.get(y);t.user().tillOff(e).to(e=>this.user=e).whenOff(()=>this.user=C),s.provide({a:I,is:this._article})}get article(){return this._article.it}set article(e){this._article.set(e)}postMeta(){if(!this.article.slug)return;const{author:e}=this.article,{document:t}=this._context.get(d),s=t.createDocumentFragment(),r=s.appendChild(t.createElement("div"));r.className="post-meta";const a=r.appendChild(t.createElement("conduit-article-author"));if(R(a,this._context),this.user.username===e.username){const e=r.appendChild(t.createElement("conduit-edit-post-btn"));e.tabIndex=0,R(e,this._context);const s=r.appendChild(t.createElement("conduit-delete-post-btn"));s.tabIndex=0,R(s,this._context)}else{const e=r.appendChild(t.createElement("conduit-favorite-post-btn"));e.tabIndex=0,R(e,this._context)}const n=s.appendChild(t.createElement("a"));n.className="preview-link",n.setAttribute("href","article/#/"+encodeURIComponent(this.article.slug)),n.appendChild(t.createElement("h1")).innerText=this.article.title,n.appendChild(t.createElement("p")).innerText=this.article.description,n.appendChild(t.createElement("span")).innerText="Read more...";const i=n.appendChild(t.createElement("conduit-article-tags"));return R(i,this._context),s}};b([u()],H.prototype,"user",void 0),b([h({propertyKey:"feedArticle"})],H.prototype,"article",null),b([j()],H.prototype,"postMeta",null),H=b([f(["article-preview",w],{feature:{needs:[D]}},x({href(e){let t=e.target;for(;;){const e=t.getAttribute("href");if(null!=e)return e;const{parentNode:s}=t;if(!s||!m(s))return;t=s}}}))],H);const L=new t("feed-article-list",{byDefault:()=>A});let B=class{constructor(e){this._context=e,this.articles=A,e.get(y).get(L).to(e=>this.articles=e).whenOff(()=>this.articles=A)}render(){const e=this._context.get(d).document,t=e.createRange();return t.selectNodeContents(this._context.contentRoot),()=>{if(t.deleteContents(),!this.articles.articlesCount)return;const s=e.createDocumentFragment();this.articles.articles.forEach(t=>{const r=s.appendChild(e.createElement("conduit-article-preview"));r.feedArticle=t,R(r,this._context)}),t.insertNode(s)}}};b([u()],B.prototype,"articles",void 0),b([g()],B.prototype,"render",null),B=b([f(["article-list",w],{feature:{needs:H}})],B);const U=new t("feed-request-page-param",{byDefault:()=>F});let $=class{constructor(e){this._feedPaging={};const t=e.get(y),s=e.get(P);e.whenConnected(()=>{a({param:t.get(U),page:s,list:t.get(L)}).tillOff(e).to(({param:[e],page:[t],list:[{articlesCount:r}]})=>{const a=t.get(e),{limit:n=20,offset:i=0}=a;this.feedPaging={totalPages:Math.ceil(r/n),currentPage:Math.floor(i/n),pageHref(t){var r;return(null===(r=s.with(e,Object.assign(Object.assign({},a),{offset:n*t})).pretend())||void 0===r?void 0:r.url.href)||""}}})})}get feedPaging(){return this._feedPaging}set feedPaging(e){this._feedPaging=e}};b([c(({get:e,set:t,key:s})=>{const r=[T,s];return{componentDef:l.all(j({path:r,comment:`PAGER(${String(s)})`}).As((function(){const t=p.of(this),{document:s}=t.get(d),r=e(this);if(!r.totalPages||r.totalPages<=1)return;const a=r,{totalPages:n,visiblePages:i=5,currentPage:o=0}=a,c=Math.max(1,i),l=Math.max(0,o),u=s.createElement("ul");u.className="pagination";let h=Math.max(0,l-(c>>1)),f=h+c;f>n&&(h=Math.max(0,h-(f-n)),f=n),u.appendChild(m("<<",0,l>0)),u.appendChild(m("<",l-1,l>0));for(let e=h;e<f;++e)u.appendChild(m(String(e+1),e,!0,l===e));return u.appendChild(m(">",l+1,l+1<n)),u.appendChild(m(">>",n-1,l+1<n)),u;function m(e,t,r,n=!1){const i=s.createElement("li");let o;return i.className="page-item",r&&!n?(o=s.createElement("a"),o.setAttribute("href",a.pageHref(t))):(i.classList.add(n?"active":"disabled"),o=s.createElement("span")),o.className="page-link",o.innerHTML=e,i.appendChild(o),i}}),s),x()),get:e,set(s,a){const n=e(s);t(s,a),p.of(s).updateState(r,a,n)}}})],$.prototype,"feedPaging",null),$=b([f(["feed-pager",w])],$);const G=new r("render-feed-state"),K=Symbol("render-feed-state");class z{constructor(e,t){this.response=n(),this._request=n({}),i(e).cuts(this._request);const s=e.get(N);this.response.on((s,r)=>e.updateState(t,s,r)),e.get(y).provide({a:L,is:this.response.read().keepThru_(e=>(null==e?void 0:e.ok)?e.body:{articles:[],articlesCount:0})}),this._request.read().thru_(e=>(this.response.it=void 0,o(s.articles(e)))).to(e=>this.response.it=e),e.on("conduit:article").to(()=>this._request.it=Object.assign({},this._request.it))}static get[s](){return G}get request(){return this._request.it}set request(e){const t=this.request;O(e,t)||(this._request.it=e)}}function J({requestParam:t}={}){return c(({get:s,set:r,key:a})=>{const n=[K,a];return{componentDef:l.all({feature:{needs:[B,$,M]},define(e){e.perComponent({a:z,by:e=>new z(e,n)}),t&&e.whenComponent(e=>{e.get(y).provide({a:U,is:t})})}},q({path:n,comment:`FEED(${String(a)})`}).By((function(e){return p.of(e).get(z).response.it}),a),g({path:n}).As((function(){const t=p.of(this),{contentRoot:s}=t,r=t.get(d).document;return s.appendChild(r.createElement("conduit-article-list")),s.appendChild(r.createElement("conduit-feed-pager")),e}),a)),get:s,set(e,t){r(e,t),p.of(e).get(z).request=t}}})}export{F as P,J as R};//# sourceMappingURL=render-feed.decorator.a6bc4430.js.map
