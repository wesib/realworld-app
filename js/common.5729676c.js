import{S as e,a as t,a0 as s,F as n,g as a,a6 as r,T as o,a7 as i,t as u,d as c,a8 as p,s as h,a9 as d,aa as l,f,ab as m,ac as g,h as b,ad as k,N as _,ae as w,af as y,ag as O,ah as j,ai as v,aj as x,ak as T,a2 as R,K as q,L as C}from"./lib.27753528.js";import{b as N,H as S,B as $,F as A,C as F,a as L,A as D,t as I,c as P,d as U,e as z,I as E,D as H,f as J,U as M,g as X,h as B,i as K,R as W,j as G,k as Q}from"./wesib.3869c13f.js";const V=new e("auth-service");class Y{static get[t](){return V}}const Z=new s("api-root-url",{byDefault:()=>new URL("https://conduit.productionready.io/api/")}),ee=new n("api-fetch",{byDefault:N((function(e){const t=e.get(S),s=e.get(Z);return({path:n,init:i,auth:u})=>{const c=s.thru_(e=>new URL(n,e),e=>function(e,t={}){const s=new Request(e.href,Object.assign({mode:"cors"},t)),{headers:n}=s;return n.set("X-Requested-With","XMLHttpRequest"),s}(e,i)).thru_(t=>!1===u?a({request:t}):r(function(e,t,s){return e.get(V).user.keep.thru_((e,n)=>e?(t.headers.set("Authorization",`Token ${e.token}`),{request:t}):s?(n||(n={ok:!1,errors:{api:["Not authenticated"]}}),{failure:n}):{request:t})}(e,t,u)),e=>e.request?r(t(e.request).thru_(e=>({response:e}))):a({failure:e.failure}));return o(c.thru_(te)).thru_(([e,t])=>function(e,t){if(!e.response)return e.failure;const{response:s}=e;if(s.ok)return{ok:!0,response:s,body:t};return{ok:!1,response:s,errors:t.errors||{http:[s.statusText?`${s.status}: ${s.statusText}`:`ERROR ${s.status}`]}}}(e,t))}}))});function te(e){return e.response?Promise.all([e,e.response.json()]).catch(t=>[{failure:{ok:!1,response:e.response,errors:{api:[`Failed to parse response: ${t}`]}}}]):[e]}new n("api-submitter",{byDefault:N((function(e){const t=e.get(ee);return e=>{const{init:s={}}=e,{method:n="POST",headers:a={}}=s;return r=>{const o=Object.assign(Object.assign({},e),{init:Object.assign(Object.assign({},s),{method:n,body:JSON.stringify(r),headers:Object.assign(Object.assign({},a),{Accept:"application/json","Content-Type":"application/json"})})});return se(t(o))}}}))});function se(e){return new Promise((t,s)=>{e.once(e=>{e.ok?t(e.body):s(new i({submit:"api",api:e.errors}))}).whenOff(e=>{s(e instanceof i?e:new i({submit:"cancel",cancel:e}))})})}class ne extends Y{constructor(e){super(),this._context=e;const t=e.get($).localStorage;this._auth=u(t.getItem("wesib-conduit:auth")),this._auth.on((function(e){e?t.setItem("wesib-conduit:auth","string"==typeof e?e:e.token):t.removeItem("wesib-conduit:auth")})),this.user=this._auth.read.keep.thru((function(t){if(!t)return a();if("string"==typeof t)return r(function(t){const s=e.get(ee);return c(e=>{s({path:"user",init:{headers:{Authorization:`Token ${t}`}},auth:!1}).thru_(e=>e.ok?a(e.body):a(void 0,e))({supply:h().needs(e.supply),receive(t,...s){e.receive(t,...s)}})},p())}(t));return a(t)}))}login(e){return this._context.get(ee)({path:"users/login",init:{method:"POST",body:JSON.stringify(e),headers:{Accept:"application/json","Content-Type":"application/json"}},auth:!1}).thru_(e=>(e.ok?this._auth.it=e.body:this._auth.it=null,e))}logout(){this._auth.it=null}}let ae=class{};function re({mark:e="is-invalid",when:t}={}){return s=>{const n=s.aspect(l);return f({status:s.aspect(m),validity:s.aspect(g)}).keep.thru(({status:[{touched:s,hasFocus:r}],validity:[o]})=>{const i=o.has("incomplete")||o.has("missing");return!s||r&&i?a():b(n.specs(k({mark:e,when:t})))})}}ae=d([A({setup(e){e.provide({a:Y,as:ne})}})],ae);const oe=new _("https://wesib.github.io/realworld-app/ns/","conduit");let ie=class{};ie=d([F(["in-error",oe],D("code"),L(({control:{control:e},aspects:t,context:s})=>I(s,"code").read.keep.thru_(e=>e?e.trim().split(/\s+/):[]).keep.thru(n=>e.convert(w.to(s.element),t).setup(l,e=>{e.add(y()),e.add(re({when:n}))}))))],ie);let ue=class{};function ce({emptyModel:e={},form:t={makeForm({node:t,aspects:s}){const n=j(e).setup(l,e=>e.add(y())).setup(v,e=>e.derive(x())),a=T(t.element,{form:n,aspects:s}).setup(l,e=>e.add(n.aspect(l)));return[n,a]}},button:s}={}){return F(J(t),function({select:e="button",pick:t={deep:!0,all:!0}}={}){return F({feature:{needs:P},define(s){s.whenComponent(s=>{const n=s.get(U),a=s.get(z);s.whenOn(r=>{f({form:a.get(E),button:n.select(e,t).first,aspects:s.get(H)}).tillOff(r).consume(({form:[{control:e}],button:[t],aspects:[s]})=>e&&t&&O(t.element,{form:e,aspects:s}))})})}})}(s))}function pe(e){return M(Object.assign(Object.assign({},e),{makeControl:t=>t.context.get(z).get(E).keep.thru_(({form:s})=>{const n=e.makeControl(t);return n?n instanceof R?r(n):b(q(n).keep.thru_((e,t)=>e?(r(e),t?a(e,t):a(e)):a())):a();function r(e){s&&e.aspect(v).derive(s.aspect(v));const t=e.aspect(l);return t.add(y()),t.add(re()),e}})}))}ue=d([A({needs:ie})],ue);let he=class{};he=d([F(["main",oe],X({onResponse({response:e,range:t}){e.ok||(t.deleteContents(),null==e.ok?t.insertNode(document.createTextNode("Loading...")):t.insertNode(document.createTextNode(`Error. ${e.error}`)))}}))],he);let de=class{};de=d([F(["navbar",oe],K(),B({active:"active"}))],de);const le=["authenticated",oe],fe=["not-authenticated",oe];let me=class{constructor(e){this._context=e,e.whenOn(t=>{e.get(Y).user.tillOff(t)((e,t)=>{this.user=e})})}get user(){return this._user}set user(e){const t=this._user;this._user=e,this._context.updateState("user",e,t)}render(){const e=this._context.get(G),t=C.name(le,e),s=C.name(fe,e),{classList:n}=this._context.element;return()=>{this.user?(n.remove(s),n.add(t)):(n.remove(t),n.add(s))}}};d([W()],me.prototype,"render",null),me=d([F({name:["container",oe],feature:{needs:[he,de]}})],me);let ge=class{};ge=d([F(["footer",oe],K())],ge);let be=class{};be=d([A({needs:[me,ge]})],be);let ke=class{};ke=d([A({needs:[ae,ue,be]})],ke);const _e=Q(ke);export{Y as A,oe as C,ce as F,pe as U,se as a,_e as c};//# sourceMappingURL=common.5729676c.js.map
