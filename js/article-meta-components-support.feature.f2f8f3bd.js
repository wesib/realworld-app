import{p as e,R as t,C as r,B as s,F as a}from"./wesib/wesib.698f6f57.js";import{_ as i}from"./helpers.920c7f83.js";import{g as o,P as n,a as c,h as l,b as d,N as h}from"./wesib/generic.0655e5c8.js";import{C as u}from"./core.f6946162.js";import{f}from"./core/loader.5d4e024f.js";import{A as m,a as p}from"./core/articles.530c016b.js";import{C as g,n as v}from"./current-article.10cd4166.js";import{f as b}from"./core/feed.2bac4641.js";const C=new class extends o{create(e,t){const r=this.byDefault(e);return r.put(t),r}byDefault(e){return{get(){const{searchParams:t,pathname:r}=e.get(n),s=r.indexOf("/",1),a=decodeURIComponent(s<0?r.substring(1):r.substring(1,s));let i,o;return s>0&&"favorite"===r.substring(s+1)?o=a:i=a,{tag:t.get("tag")||void 0,author:i,favorited:o,limit:parseInt(t.get("limit")||"",10)||void 0,offset:parseInt(t.get("offset")||"",10)||void 0}},put(t){const{favorited:r,author:s=""}=t,a=new URL(e.get(n).href);a.pathname=r?`/${encodeURIComponent(r)}/favorite`:`/${encodeURIComponent(s)}`;const i=b(Object.assign(Object.assign({},t),{favorited:void 0,author:void 0})).toString();a.search=i?"?"+i:"",e.put(n,a)}}}};let x=class{constructor(e){this._context=e,this.article={};const t=e.get(d);e.whenOn(e=>{t.get(g).tillOff(e)(e=>this.article=e)})}render(){const e=this._context.get(h),{document:t}=this._context.get(s),{contentRoot:r}=this._context,a=t.createDocumentFragment(),i=a.appendChild(t.createElement("a")),o=a.appendChild(t.createElement("div"));o.className="info";const n=o.appendChild(t.createElement("a"));n.className="author";const c=o.appendChild(t.createElement("time"));return c.className="date",r.appendChild(a),()=>{var t,r;const s=this.article;let a="",o="",l="",d="",h="";if(s.slug){const{author:i}=s;a=(null===(r=null===(t=e.with(C,{author:i.username}).pretend("profile/"))||void 0===t?void 0:t.url)||void 0===r?void 0:r.href)||"",o=i.image?`<img src="${encodeURI(i.image)}"/>`:"",l=i.username,d=s.createdAt,h=f(new Date(s.createdAt))}i.href=a,i.innerHTML=o,n.href=a,n.innerText=l,c.innerText=h,d?c.setAttribute("datetime",d):c.removeAttribute("datetime")}}};i([e()],x.prototype,"article",void 0),i([t()],x.prototype,"render",null),x=i([r(["article-author",u],{feature:{needs:l}},c())],x);let j=class{constructor(e){this._context=e,this.article=v;const t=e.get(d),r=e.get(m);e.whenOn(e=>{t.get(g).tillOff(e)(e=>{this.article=e})}),e.on("click")(()=>{const{article:e}=this;if(e.slug){const t=!e.favorited;e.update(Object.assign(Object.assign({},e),{favorited:t})),r.likeArticle(e.slug,t)(t=>{this.article.slug&&(t.ok?this.article.update(t.body):(this.article.update(e),console.error(`Failed to like article ${e.slug}`,t.errors)))})}})}render(){const{contentRoot:e}=this._context,{document:t}=this._context.get(s),r=t.createElement("i");e.insertBefore(r,e.childNodes[0]);const a=e.appendChild(t.createElement("span"));return a.className="counter",()=>{r.className=this.article.slug&&this.article.favorited?"ion-heart":"ion-ios-heart-outline",a.innerText=this.article.slug&&this.article.favoritesCount?String(this.article.favoritesCount):"",e.className=this.article.slug&&this.article.favorited?"btn-secondary":"btn-outline-secondary"}}};i([e()],j.prototype,"article",void 0),i([t()],j.prototype,"render",null),j=i([r(["favorite-post",u],{feature:{needs:p}})],j);let w=class{};w=i([a({needs:[x,j]})],w);export{w as A,C as P};//# sourceMappingURL=article-meta-components-support.feature.f2f8f3bd.js.map
