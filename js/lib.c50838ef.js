const t=Symbol("next-call"),e=Symbol("next-call:last-outcome");class n extends Function{static is(e){return"function"==typeof e&&t in e}static of(t){return n.is(t)?t:s(e=>e(t))}}const r=t=>t;function s(n,s=(()=>n(r))){const i=()=>i;return i[t]=t=>n(t),i[e]=s,i}const i=Symbol("passed-thru");class o{static is(t){return"object"==typeof t&&i in t}static get(t){return o.is(t)?t[i]:t}static items(t){return o.is(t)?t:{*[Symbol.iterator](){yield t}}}}function u(...r){return function(...s){return o.get(function s(i,o){const u=r.length;return i<u?n.is(o)?o[t]((function(...t){return s(i+1,r[i].apply(this,t))})):s(i+1,r[i].call(null,o)):n.is(o)?o[e]():o}(1,r[0].apply(this,s)))}}function c(t){return t}function f(){}function a(t){return null!=t}function l(t){return()=>t}function h(...t){return s(e=>e.apply(void 0,t),()=>t)}function d(r){return s(e=>({[Symbol.iterator]:()=>function*(e,r){for(const s of e)yield*o.items(n.is(s)?s[t](r):r(s))}(r,e)}),()=>({[Symbol.iterator]:()=>function*(t){for(const r of t)yield*o.items(n.is(r)?r[e]():r)}(r)}))}const p={[i]:void 0,*[Symbol.iterator](){}};function y(){return p}const g=s(y,y);function v(){return g}function b(t){return"length"in t}function m(t){return"reverse"in t}function _(t){return t[Symbol.iterator]()}function w(t,e){const n={[Symbol.iterator]:t};if(!e)return n;const r=n;return r.reverse=e,r}function O(t){if(b(t))return x(t);if(m(t)){const e=t.reverse();return w(()=>_(e))}return x([...t])}function x(t){return w((function*(){for(let e=t.length-1;e>=0;--e)yield t[e]}))}function k(t,e){for(const n of t)e(n)}function S(t){return _(t).next().value}function E(t,e,n){let r=n;for(const n of t)r=e(r,n);return r}function j(t,...e){return u(d(t),...e)()}function $(t,e){return w((function*(){for(const n of t)e(n)&&(yield n)}))}function M(t,e){return w((function*(){for(const n of t)yield*e(n)}))}function D(t,e){return w((function*(){for(const n of t)yield e(n)}))}const K=["every","filter","flatMap","forEach","map","reduce","reverse"];class A{static none(){return q}static is(t){return K.every(e=>e in t)}static of(t){return A.is(t)?t:A.from(t)}static from(t){return R(()=>t,()=>O(t))}every(t){return function(t,e){for(const n of t)if(!e(n))return!1;return!0}(this,t)}filter(t){return R(()=>$(this,t),()=>$(this.reverse(),t))}flatMap(t){return R(()=>M(this,t),()=>M(this.reverse(),e=>O(t(e))))}forEach(t){k(this,t)}map(t){return R(()=>D(this,t),()=>D(this.reverse(),t))}reduce(t,e){return E(this,t,e)}reverse(){const t=this;return R(()=>x([...t]),()=>this)}thru(...t){const e=j;return R(()=>e(this,...t))}}class U extends A{*[Symbol.iterator](){}reverse(){return this}}const q=new U;function R(t,e){return new class extends A{[Symbol.iterator](){return _(t())}reverse(){return e?A.from(w(()=>_(e()),()=>this)):super.reverse()}}}function z(t){return w((function*(){for(let e=0;e<t.length;++e)yield t[e]}),()=>x(t))}const P={*[Symbol.iterator](){},reverse(){return this}};const V=Symbol("after-event");function F(t){return V in t}class I{needs(t){return t.whenOff(t=>this.off(t)),this}}function T(t=f){let e,n=r=>{e=t=>t(r),n=f,t(r)};e=t=>{const e=n;n=n=>{e(n),t(n)}};return new class extends I{get isOff(){return n===f}off(t){return n(t),this}whenOff(t){return e(t),this}}}class C extends I{get isOff(){return!0}off(){return this}whenOff(t){return t(),this}}const N=new C;function J(){return N}function L(t){let e;return e="function"==typeof t?{supply:T(),receive(e,...n){t(...n)}}:{supply:t.supply||T(),receive(e,...n){this.supply.isOff||t.receive(e,...n)}},e.supply.whenOff(()=>e.receive=f),e}const Q=Symbol("on-event");function G(t){return Q in t}function W(t){return e=>t({supply:e.supply,receive:(t,...n)=>{e.receive(t,...n),e.supply.off()}})}class B{constructor(){this._rcvs=new Set,this.send=function(t){let e=function n(r){let s=t;const i=[];e=function(t){i.push(t)};try{for(;;){s=H(s,r);const t=i.shift();if(!t)break;r=t}}finally{e=n}};return(...t)=>e(t)}(this._rcvs)}get size(){return this._rcvs.size}[Q](t){return this.on(t)}on(t){const e=L(t);return this._rcvs.add(e),e.supply.whenOff(()=>this._rcvs.delete(e))}done(t){return this._rcvs.forEach(({supply:e})=>e.off(t)),this}}function H(t,e){const n=[];for(const r of t){const t=n.length;n.push(r);const s={onRecurrent(e){n[t]=L({supply:r.supply,receive(t,...n){e(...n)}})}};r.receive(s,...e)}return n}function X(t){const e=new B;let n,r;return s=>{if(e.size||(r=[],n=T(()=>r=void 0),t({supply:n,receive(t,...n){r&&(e.size?r=void 0:r.push(n)),e.send(...n)}})),s.supply.needs(n),e.on(s).whenOff(t=>{e.size||n.off(t)}),r){const t=new B;t.on(s),r.forEach(e=>t.send(...e))}}}function Y(t,e){return n=>{n.supply.needs(e),t(n)}}class Z extends Function{get[Q](){return this}get once(){return tt(W(this))}tillOff(t){return tt(Y(this,t))}dig(t){return tt(X(this.dig_(t)))}dig_(t){return tt(e=>{let n=J();this({supply:e.supply,receive(r,...s){const i=n,o=t(...s);try{n=o?et(o)({supply:T().needs(e.supply),receive(t,...n){e.receive(t,...n)}}):J()}finally{i.off()}}})})}consume(t){let e=J();const n=this((...n)=>{const r=e;try{e=t(...n)||J()}finally{r.off()}});return T(t=>{e.off(t),n.off(t)}).needs(n)}share(){return tt(X(this))}thru(...t){return tt(X(this.thru_(...t)))}thru_(...t){const e=u;return tt(n=>this({supply:n.supply,receive(r,...s){e(...t,(...t)=>n.receive(r,...t))(...s)}}))}}function tt(t){const e=e=>{const n=L(e),{supply:r}=n;return r.isOff||t(n),r};return Object.setPrototypeOf(e,Z.prototype),e}function et(t){const e=G(t)?t[Q]:t[V];return e instanceof Z?e:tt(e.bind(t))}const nt=tt(({supply:t})=>t.off());class rt{constructor(t){this._keeper=t}dig(t){return this.dig_(t).share()}dig_(t){return ot(this._keeper.dig_((...e)=>ot(t(...e))))}thru(...t){return this.thru_(...t).share()}thru_(...t){return ot(this._keeper.thru_(...t))}}class st extends Z{get[V](){return this}get keep(){return new rt(this)}get once(){return it(W(this))}tillOff(t){return it(Y(this,t))}share(){return it(X(this))}}function it(t,e=ft){let n,r=0;const s=s=>{let i=f;const o=L(s);if(o.supply.isOff)return o.supply;const u=T().needs(o.supply);let c=!1;return t({supply:u,receive(t,...e){c=!0,n=e,i(t,...e)}}),++r,u.isOff&&!c||(o.receive({onRecurrent(t){i=(e,...n)=>t(...n)}},...n||(n=e())),i=(t,...e)=>o.receive(t,...e)),u.whenOff(t=>{--r||(n=void 0),o.supply.off(t)}),u};return Object.setPrototypeOf(s,st.prototype),s}function ot(t,e){if(!F(t))return function(t,e){return it(e=>t[Q](e),e)}(t,e);const n=t[V];return n instanceof st?n:it(n.bind(t))}function ut(...t){return it(()=>T(),l(t))}const ct=it(({supply:t})=>t.off());function ft(){throw new Error("No events to send")}class at extends Z{get once(){return lt(W(this))}tillOff(t){return lt(Y(this,t))}get capture(){return lt((t,e)=>null==e?this(t,!0):"object"==typeof e&&null==e.capture?this(t,Object.assign(Object.assign({},e),{capture:!0})):this(t,e))}get instead(){return lt((t,e)=>{const n=L(t);return this({supply:n.supply,receive(t,e){e.preventDefault(),n.receive(t,e)}},e)})}get just(){return lt((t,e)=>{const n=L(t);return this({supply:n.supply,receive(t,e){e.stopPropagation(),n.receive(t,e)}},e)})}get last(){return lt((t,e)=>{const n=L(t);return this({supply:n.supply,receive(t,e){e.stopImmediatePropagation(),n.receive(t,e)}},e)})}get passive(){return lt((t,e)=>null==e?this(t,{passive:!0}):"boolean"==typeof e?this(t,{capture:e,passive:!0}):null==e.passive?this(t,Object.assign(Object.assign({},e),{passive:!0})):this(t,e))}}function lt(t){const e=(e,n)=>{const r=L(e);return t(r,n),r.supply};return Object.setPrototypeOf(e,at.prototype),e}const ht={onRecurrent:f};class dt{constructor(t){this._target=t}on(t){return lt((e,n)=>{const r=t=>e.receive(ht,t);this._target.addEventListener(t,r,n),e.supply.whenOff(()=>this._target.removeEventListener(t,r))})}dispatch(t){return this._target.dispatchEvent(t)}}var pt;class yt extends B{constructor(){super(...arguments),this.on=tt(t=>super.on(t)),this[pt]=this.on}}function gt(t){const e=Object.keys(t);return e.length?it((function(n){const r=new B,s=r.on(n);let i=f;const o={};e.forEach((function(e){s.needs(t[e][V]((...t)=>{o[e]=t,i()}).needs(s))})),s.isOff||(i=()=>r.send(o))}),(function(){const n={};return e.forEach(e=>ot(t[e]).once((...t)=>n[e]=t)),[n]})).share():ct}function vt(...t){return t.length?it((function(e){const n=new B,r=n.on(e);let s=f;const i=[];t.forEach((function(t,e){r.needs(t[V]((...t)=>{i[e]=t,s()}).needs(r))})),r.isOff||(s=()=>n.send(...i))}),(function(){const e=[];return t.forEach(t=>ot(t).once((...t)=>e.push(t))),e})).share():ct}function bt(...t){return t.length?tt(e=>{const{supply:n}=e;let r=t.length;const s=t=>{--r||n.off(t)},i=(t,...n)=>{e.receive(t,...n)};t.forEach(t=>et(t)({supply:T(s).needs(n),receive:i}))}).share():nt}function mt(t){return Array.isArray(t)?t:[t]}pt=Q;class _t{constructor(t){this._drop=t,this.emitter=new yt,this._nested=new Map,this.emitter.on((t,e,n)=>{const r=(t=mt(t))[0],s=this._nested.get(r);s&&s.emitter.send(t.slice(1),e,n)})}on(t){const e=this,n=this.emitter.on(t);return T(t=>{n.off(t),e._dropIfEmpty()}).needs(n)}nest(t,e){const n=this._nested.get(t);if(n||e)return n;const r=new _t(()=>this._remove(t));return this._nested.set(t,r),r}done(t){for(const e of this._nested.values())e.done(t);this.emitter.done(t)}_remove(t){this._nested.delete(t),this._dropIfEmpty()}_dropIfEmpty(){!this._nested.size&&this.emitter.size<=1&&this._drop()}}class wt{constructor(){this._root=new _t(f)}on(t,e){return this._entry(t).on(e)}send(t,e,n){this._root.emitter.send(t,e,n)}done(t,e){const n=this._entry(t,!0);n&&n.done(e)}_entry(t,e){let n=this._root;for(const r of t){const t=n.nest(r,e);if(!t)return;n=t}return n}}class Ot{constructor(t,e){this._trackers=t,this._path=e,this.update=(t,e,n)=>{this._trackers.send([...this._path,...mt(t)],e,n)},this.onUpdate=tt(t=>this._trackers.on(this._path,t))}get _tracker(){return this}get[Q](){return this.onUpdate}track(t){return(t=mt(t)).length?new Ot(this._trackers,[...this._path,...t]):this}done(t){this._trackers.done(this._path,t)}}class xt{constructor(){this._tracker=new Ot(new wt,[])}get onUpdate(){return this._tracker.onUpdate}get[Q](){return this.onUpdate}get update(){return this._tracker.update}track(t){const e=this._tracker.track(t);return e===this._tracker?this:e}done(t){this._tracker.done(t)}}class kt{constructor(){this._by=J(),this.read=it(t=>{return this.on({supply:(e=t).supply,receive(t,n){e.receive({onRecurrent(e){t.onRecurrent(t=>e(t))}},n)}});var e},()=>[this.it])}get[Q](){return this.on}get[V](){return this.read}by(t,e){const n=this;if(this.byNone(),e){const n=t;this._by=et(n).consume((...t)=>{const n=e(...t);if(n)return r(n)})}else{const e=t;this._by=r(e)}return this._by.whenOff(()=>this._by=J()),this;function r(t){return(F(t)?t[V]:t[Q])(t=>n.it=t)}}byNone(t){return this._by.off(t),this}}class St extends kt{constructor(t){super(),this._it=t,this._on=new yt}get on(){return this._on.on}get it(){return this._it}set it(t){const e=this._it;e!==t&&(this._it=t,this._on.send(t,e))}done(t){return this._on.done(t),this}}function Et(t){return new St(t)}const jt=Symbol("context-key");class $t{constructor(t){this.name=t}get[jt](){return this}toString(){return`ContextKey(${this.name})`}}class Mt extends $t{constructor(t){super(`${t.name}:seed`)}get seedKey(){return this}grow(t){const{seeder:e,seed:n}=t;return e.isEmpty(n)?t.byDefault(()=>n):n}}class Dt extends Error{constructor(t,e=`There is no value with key ${t}`){super(e),this.key=t}}function Kt(t){if(function(t){return"by"in t}(t)){if(!At(t))return t;const{a:e,by:n,with:r}=t;return{a:e,by:t=>n(...r.map(e=>t.get(e)))}}if(function(t){return"is"in t}(t)){const{a:e,is:n}=t;return{a:e,by:l(n)}}if(function(t){return"via"in t}(t)){const{a:e,via:n}=t;return{a:e,by:t=>t.get(n)}}if(function(t){return"as"in t}(t)){if(function(t){return!("a"in t)}(t)&&(t=function(t){return Object.assign(Object.assign({},t),{a:t.as})}(t)),!At(t)){const{as:e}=t;return{a:t.a,by:t=>new e(t)}}const{as:e,with:n}=t;return{a:t.a,by:t=>new e(...n.map(e=>t.get(e)))}}throw new TypeError(`Malformed context value specifier: ${t}`)}function At(t){return"with"in t}class Ut{}class qt{constructor(t){this._seeds=new Map,this._initial=null==t?f:"function"==typeof t?t:e=>t.get(e)}provide(t){const{a:{[jt]:{seedKey:e}},by:n}=Kt(t),[r]=this._seeding(e);return r.provide(n)}_seeding(t){const e=this._seeds.get(t);if(e)return e;const n=t.seeder(),r=[n,e=>n.seed(e,this._initial(t,e))];return this._seeds.set(t,r),r}seed(t,e){const[,n]=this._seeding(e);return n(t)}seedIn(t,e){const n=this.newValues(e);return e=>n.get.call(t,e)}newValues(t=!0){if(!t&&this._nonCachedValues)return this._nonCachedValues;const e=new Map,n=this;class r extends Ut{get({[jt]:r},s){const i=e.get(r);if(null!=i)return i;const[o,u]=function(t,e,r){const[s,i]=function(t,e){const{seedKey:r}=e,[s,i]=n._seeding(r);if(r!==e)return[s,t.get(r)];return[s,i(t)]}(t,e);let o=!1;const u={context:t,seeder:s,seed:i,byDefault:r&&"or"in r?()=>(o=!0,r.or):t=>{const n=t();if(null==n)throw new Dt(e);return n}};r&&"or"in r&&(u.or=r.or);return[e.grow(u),o]}(this,r,s);return t&&!u&&e.set(r,o),o}}return t?new r:this._nonCachedValues=new r}append(t){return new qt((e,n)=>{const[r,s]=this._seeding(e);return r.combine(s(n),t.seed(n,e),n)})}}class Rt{constructor(){this._providers=Et([])}provide(t){return this._providers.it=[...this._providers.it,t],()=>{const e=this._providers.it,n=e.indexOf(t);n>=0&&(this._providers.it=e.slice(0,n).concat(e.slice(n+1)))}}seed(t,e=ut()){return this.combine(e,function(t,e){return e.read.keep.dig(e=>e.length?vt(...D(D(z(e),e=>e(t)),zt)).keep.thru(Pt):ut())}(t,this._providers))}isEmpty(){return!1}combine(t,e){return vt(t,e).keep.thru(Pt)}}function zt(t){return null==t?ut():function(t){return("object"==typeof t||"function"==typeof t)&&F(t)}(t)?ot(t):ut(t)}function Pt(...t){return h(...M(z(t),c))}class Vt extends Mt{seeder(){return new Rt}}class Ft extends $t{constructor(t,e){super(t.name+":up"),this._key=t,this.grow=e}get seedKey(){return this._key.seedKey}}class It extends $t{constructor(t,e){super(t),this.seedKey=e||new Vt(this)}createUpKey(t){return new Ft(this,t)}}class Tt extends It{constructor(t,{seedKey:e,byDefault:n=f}={}){super(t,e),this.byDefault=(t,e)=>n(t,e)||(()=>{throw new Dt(this)}),this.upKey=this.createUpKey(t=>t.seed.keep.dig((...e)=>{if(e.length)return ut(e[e.length-1]);const n=()=>ut(this.byDefault(t.context,this));return t.byDefault(n)||n()}))}grow(t){let e;return t.context.get(this.upKey,"or"in t?{or:null!=t.or?ut(t.or):t.or}:void 0)(t=>e=t),(...t)=>e(...t)}}class Ct{constructor(){this._providers=[]}provide(t){return this._providers.push(t),()=>{const e=this._providers.indexOf(t);e>=0&&this._providers.splice(e,1)}}seed(t,e=A.from(P)){return A.from([e,Qt(t,this._providers)]).flatMap(c)}isEmpty(t){return!!_(t).next().done}combine(t,e){return A.from([t,e]).flatMap(c)}}class Nt extends Mt{seeder(){return new Ct}}class Jt extends $t{constructor(t,e){super(t),this.seedKey=e||new Nt(this)}}class Lt extends Jt{constructor(t,{seedKey:e,byDefault:n=f}={}){super(t,e),this.byDefault=n}grow(t){const e=function(t){if(b(t))return t[t.length-1];if(m(t))return S(t.reverse());let e;for(const n of t)e=n;return e}(t.seed);return null!=e?e:t.byDefault(()=>this.byDefault(t.context,this))}}function Qt(t,e){return A.from(z(e.map(t=>[t]))).map(e=>{if(e.length>1)return e[1];const n=e[0](t);return e.push(n),n}).filter(a)}class Gt extends class{name(t,e){if("string"==typeof t)return t;const[n,r]=t;return r.name(e(r),n,this)}}{applyAlias(t,e){return`${e}-${t}`}}const Wt=new Gt,Bt=new Gt;class Ht{constructor(t,...e){this.url=t,this.aliases=e}get alias(){return this.aliases[0]||"ns"}name(t,e,n=Wt){return n.applyAlias(e,t,this)}}function Xt(t){return"string"==typeof t||function(t){return Array.isArray(t)&&2===t.length&&"string"==typeof t[0]&&t[1]instanceof Ht}(t)}function Yt(t,e){if("string"==typeof t)return"string"==typeof e?Zt(t,e):e[1].url?-1:Zt(t,e[0]);const[n,{url:r}]=t;return"string"==typeof e?r?1:Zt(n,e):Zt(r,e[1].url)||Zt(n,e[0])}function Zt(t,e){return t<e?-1:t>e?1:0}function te(){const t=new Map,e=new Map;return function(n){const r=t.get(n.url);if(r)return r;const s=n.alias;let i=0;for(const r of[s,...n.aliases]){const s=e.get(r);if(!s)return t.set(n.url,r),e.set(r,1),r;i||(i=s)}const o=s+ ++i;return t.set(n.url,o),e.set(s,i),o}}const ee={by(t={}){let e;return{get node(){return t.node},get window(){return e||(e=t.window||t.node&&((n=t.node).ownerDocument||n).defaultView||window);var n},error(...e){t&&t.error?t.error(...e):console.error(...e)}}}};const ne={by({schedule:t,replace:e=(()=>{})}){const n=[];return{schedule:t,add(t){n.push(t)},pull:()=>n.shift(),reset(){const n=ne.by({schedule:t,replace:e});return e(n),n}}}},re=Symbol("scheduled-render-q");class se{constructor(t,e){this.q=t,this.schedule=this.doSchedule,this.ref=e||[this]}static by(t,e){return t[re]||(t[re]=new se(t,e))}add(t){this.q.add(t)}doSchedule(t){this.schedule=()=>{};const e={get config(){return t},postpone:t=>this.add(t)};this.q.schedule(()=>{const t=this.reset();t.suspend(),this.exec(e),t.resume()})}exec(t){for(;;){const e=this.q.pull();if(!e)break;e(t)}}reset(){return this.ref[0]=se.by(this.q.reset(),this.ref)}suspend(){this.schedule=t=>{this.scheduled=t,this.schedule=()=>{}}}resume(){this.scheduled?this.doSchedule(this.scheduled):this.schedule=this.doSchedule}}function ie(t){return e=>{const n=ee.by(e),r=se.by(t.newQueue(n)).ref;let s=[];return t=>{const[e]=s,[i]=r;if(e===i)s[1]=t;else{const e=s=[i,t];i.add(t=>{try{e[1]({get config(){return n},postpone(e){t.postpone(e)}})}catch(t){n.error(t)}})}i.schedule(n)}}}const oe=new WeakMap;let ue=ie({newQueue({window:t}){const e=oe.get(t);if(e)return e;const n=ne.by({schedule:e=>t.requestAnimationFrame(e),replace:e=>oe.set(t,e)});return oe.set(t,n),n}});function ce(t){return ue(t)}function fe(t,e,n,r){var s,i=arguments.length,o=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,r);else for(var u=t.length-1;u>=0;u--)(s=t[u])&&(o=(i<3?s(o):i>3?s(e,n,o):s(e,n))||o);return i>3&&o&&Object.defineProperty(e,n,o),o}function ae({$:t,n:e,t:n,v:r,x:s=[],p:i={},pl:o=[]}){return{$:t,n:e,t:n,v:r,x:s,p:i,pl:o}}function le({p:t,pl:e},n){const r=n.n||n.v,s=t[r];(!s||!s.n&&n.n)&&(t[r]=n),e.push(n)}function he(t){return e=>{const n=e.s[e.i];return e.d=t.delimiterOf(n),n}}const de=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), \d\d (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) \d\d\d\d \d\d:\d\d:\d\d GMT/;function pe(t,e){return t.s=t.s.substring(t.i),t.i=0,!!t.s.match(de)&&(e(t.s.substring(t.i,t.i+=29)),!0)}const ye=()=>!1;function ge(t,{named:e=!0,tagged:n=!0,extra:r=!0,next:s=he(t)}={}){const i=function(t){return(e,n)=>{let r="";for(++e.i;e.i<e.s.length;++e.i){const s=e.s[e.i];if("\\"===s){const t=e.s[++e.i];r+=t||s}else{if(65536&t.delimiterOf(s))return++e.i,void n(r);r+=s}}n(r)}}(t),o=function(t){return(e,n)=>{if(!(262144&t.delimiterOf(e.s[e.i])))return!1;let r="";for(++e.i;e.i<e.s.length;){const n=e.s[e.i++];if(524288&t.delimiterOf(n))break;r+=n}return n(r),!0}}(t),u=r?ge(t,{next:s,tagged:!1,named:!1,extra:!1}):ye;return(t,r)=>{let c,f,a,l="",h="raw";for(;t.i<t.s.length;){const r=s(t);if(t.d){if(12&t.d)break;if(null==f){if(16&t.d){f=l?"":r,++t.i;continue}if(65536&t.d){!n&&l||i(t,t=>{l?(h="tagged-string",c=l):h="quoted-string",l="",f=t});break}if(!l&&o(t,t=>{h="angle-bracketed-string",f=t}))break;f=l,l=""}else{if(65536&t.d){!n&&f||i(t,t=>{f?(h="tagged-string",c=f):h="quoted-string",f=t});break}if(!f&&o(t,t=>{h="angle-bracketed-string",f=t}))break}}if(null==f){if(!l&&pe(t,t=>f=t)){h="date-time";break}e?l+=r:f=r}else{if(!f&&pe(t,t=>f=t)){h="date-time";break}f+=r}++t.i}if(null==f){if(!l)return!1;a=ae({$:h,v:l})}else a=ae({$:h,n:l||void 0,t:c,v:f});for(;u(t,t=>a.x.push(t)););return r(a),!0}}function ve(t){return e=>{let n=e.s[e.i];return"\\"!==n?(e.d=t.delimiterOf(n),n):(++e.i,e.i<e.s.length?(n=e.s[e.i],e.d=t.delimiterOf(n)?1:0):e.d=1,n)}}function be(t){return e=>{const n=e.i;do{const n=e.s[e.i];if(!(2&t.delimiterOf(n)))break;e.i++}while(e.i<e.s.length);return e.i!==n}}function me(t,e={}){const n=be(t),r=ge(t,Object.assign(Object.assign({},e),{tagged:!1}));return(e,s)=>!!(8&t.delimiterOf(e.s[e.i]))&&(++e.i,n(e),r(e,s))}const _e={" ":7,"\t":7,",":5,";":9,'"':65569,"\\":33,"<":262145,">":524289,"=":17,"(":1,")":1,"/":1,":":1,"?":1,"@":1,"[":1,"]":1,"{":1,"}":1};function we({delimit:t}={}){const e=t?Object.assign(Object.assign({},_e),t):_e;return{delimiterOf:t=>e[t]||(t>="\0"&&t<=" "||"\x7f"===t?1:0)}}const Oe=we(),xe=we({delimit:{":":17,"(":131105,")":37," ":3,"\t":3,"=":1,",":1}});function ke(t){var e;const n=t?we(t):Oe,r=function(t){const e=be(t);return n=>!!(4&t.delimiterOf(n.s[n.i]))&&(n.i++,e(n),!0)}(n),s=me(n),i=ge(n),o=(null===(e=t)||void 0===e?void 0:e.comments)?function(t){const e=be(t),n={next:ve(t)},r=ge(t,n),s=me(t,n);return(n,i)=>{if(!(131072&t.delimiterOf(n.s[n.i])))return!1;let o;for(++n.i;e(n)||s(n,t=>{o||(o=ae({$:"raw",v:""})),le(o,t)})||r(n,t=>o=t););return++n.i,i(o||ae({$:"raw",v:""})),!0}}(xe):ye;return t=>{const e=[],n={i:0,s:t};for(;n.i<n.s.length&&(r(n)||s(n,t=>{e.length||e.push(ae({$:"raw",v:""})),le(e[e.length-1],t)})||o(n,t=>e.push(t))||i(n,t=>e.push(t))););return e}}const Se=ke();function Ee(t){if(!t)return'""';let e,n=!1;for(let r=0;r<t.length;++r){const s=t[r],i=Oe.delimiterOf(s);i?(32&i&&(e||(e=t.substring(0,r)),e+="\\"+s),n=!0):e&&(e+=s)}return n?`"${e||t}"`:t}function je(t){return Array.isArray(t)}function $e(t){return!!t.length}function Me(t){return">"===t||"+"===t||"~"===t}function De(t){if(!je(t))return[Ke(t)];const e=[];let n;for(const r of t){const t=n;let s;if(n&&(e.push(n),n=void 0),Me(r)){if(n=r,!t)continue;s={}}else s=Ke(r);e.push(s)}return n&&e.push(n,{}),e}function Ke(t){return"string"==typeof t?t?{s:t}:{}:Ae(t)}function Ae(t){const e=t.ns||void 0,n=t.i||void 0,r=function(t){if(!t)return;if(Xt(t))return[t];const e=t.filter(t=>!!t);return $e(e)?e.sort(Yt):void 0}(t.c),s=function(t){if(!t)return;if(function(t){return"string"!=typeof t[0]}(t)){const e=t.map(Ue);return $e(e)?e:void 0}return[Ue(t)]}(t.u);return{ns:e,e:("*"!==t.e||!e&&!n&&!r&&s&&qe(s[0]))&&t.e||void 0,i:n,c:r,u:s,s:t.s||void 0,$:Re(t.$)}}function Ue(t){if(!qe(t))return t;if(t.length<3)return t;const[e,n,...r]=t;return je(r[0])?[e,n,...r.map(De)]:[e,n,De(r)]}function qe(t){return t.length>1&&(":"===t[0]||"::"===t[0])}function Re(t){if(t)return $e(t=je(t)?[...new Set(M(t,Pe))].sort():[...Pe(t)])?t:void 0}const ze=new Set;function Pe(t){if(!t)return ze;const e=t.indexOf("="),n=e<0?t:t.substring(0,e),r=new Set;let s;for(const t of n.split(":"))s?s+=":"+t:s=t,r.add(s);return e>=0&&r.add(t),r}function Ve(t,e){return t&&e.every(e=>t.find(t=>function(t,e){if("string"==typeof t)return"string"==typeof e?t===e:!e[1].url&&e[0]===t;const[n,{url:r}]=t;return"string"==typeof e?!r&&n===e:n===e[0]&&r===e[1].url}(e,t)))}class Fe{get[V](){return this.read}add(t){return this.rules.add([],t)}clear(){return this.set()}}class Ie{get[V](){return this.read}get[Q](){return this.onUpdate}}class Te extends Ie{constructor(t,e){let n,r,s;super(),e?(n=()=>$(t,e),r=t=>t.filter(e)):(n=()=>t,r=c),this.onUpdate=tt(e=>{const i=s||(s=new Set(n()));et(t)({supply:e.supply.whenOff(()=>s=void 0),receive(t,n,s){n=r(n),((s=r(s)).length||n.length)&&(s.forEach(t=>i.delete(t)),n.forEach(t=>i.add(t)),e.receive(t,n,s))}})}).share(),this.read=ot(this.onUpdate.thru(l(this)),function(...t){return()=>t}(this)),this[Symbol.iterator]=()=>{return s?s.values():(t=n(),function*(){yield*t}());var t}}grab(t){return function(t,e){const n=function(t){return Ae(t)}(e);return new Te(t,t=>function(t,e){if(!t.length)return!1;const n=t[t.length-1];return(!e.ns||n.ns===e.ns)&&((!e.e||n.e===e.e)&&((!e.i||n.i===e.i)&&(!(e.c&&!Ve(n.c,e.c))&&!(e.$&&!Ve(n.$,e.$)))))}(t.selector,n))}(this,t)}}const Ce=new Te({[Q]:nt,[Symbol.iterator]:()=>[][Symbol.iterator]()});function Ne(...t){return t.length?function(t){if(1===t.length){const e=t[0];return e instanceof Ie?e:new Te(e)}return new Te({*[Symbol.iterator](){for(const e of t)yield*e},get[Q](){return tt(e=>{t.forEach(t=>et(t)({supply:T().needs(e.supply),receive(t,n,r){e.receive(t,n,r)}}))}).share()}})}(t.map(Je)):Ce}function Je(t){return"function"==typeof t?function(t){let e;return{[Symbol.iterator]:()=>n()[Symbol.iterator](),get[Q](){return n()[Q]}};function n(){return e||(e=Le(t()))}}(t):Le(t)}function Le(t){return t instanceof Fe?t.rules.self:G(t)?t:function(t){const e=new Set,n=tt(n=>{let r=J();const{supply:s}=n;s.whenOff(t=>{r.off(t),e.clear()}),t.then(t=>{if(!s.isOff){const i=t instanceof Fe?t.rules:t;!function(t,e,n){const r=[];if(k(t,t=>{r.push(t),e.add(t)}),r.length){const t=new B;t.on(n),t.send(r,[])}}(i,e,n),r=et(i)({receive(t,r,s){s.forEach(t=>e.delete(t)),r.forEach(t=>e.add(t)),n.receive(t,r,s)}}).needs(s)}})}).share();return{[Q]:n,[Symbol.iterator]:()=>e.values()}}(t)}export{A,a as B,qt as C,c as D,yt as E,Tt as F,Bt as G,dt as H,Jt as I,Ne as J,_ as K,L,Ee as M,Se as N,Q as O,S as P,et as Q,J as R,Lt as S,ot as T,Ht as U,kt as V,fe as _,jt as a,Ut as b,It as c,it as d,h as e,te as f,ce as g,Xt as h,E as i,ut as j,gt as k,vt as l,D as m,v as n,$ as o,tt as p,xt as q,M as r,V as s,Et as t,f as u,l as v,bt as w,T as x,k as y,z};
//# sourceMappingURL=lib.c50838ef.js.map
