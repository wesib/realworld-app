import{d as e,a as t,S as r}from"./lib/context-values.956fc686.js";import{t as s,e as n,k as a}from"./lib/fun-events.a21352be.js";import{r as o,R as i,C as c,o as l,B as f,l as d,u,d as p}from"./wesib/wesib.c03111fd.js";import{_ as g}from"./helpers.920c7f83.js";import{P as h,f as m,a as v,b,N as w}from"./wesib/generic.7ab3ed7c.js";import{C as _}from"./core.f6946162.js";import{A as C}from"./core/input.5459c5de.js";import{e as y}from"./core/util.4298e8ae.js";import{f as j,F as P,a as R,b as q}from"./core/feed.f5352ff3.js";import{A as O,C as x}from"./article-meta-components-support.feature.7964e674.js";import{R as A}from"./core/pager.55736aba.js";const E=new class extends h{create(e,t){const r=this.byDefault(e);return r.put(t),r}byDefault(e){return{get(){const{searchParams:t,pathname:r}=e.get(m);return{feed:"/personal-feed"===r?r:void 0,tag:t.get("tag")||void 0,limit:parseInt(t.get("limit")||"",10)||void 0,offset:parseInt(t.get("offset")||"",10)||void 0}},put(t){const{feed:r}=t,s=new URL(e.get(m).href);s.pathname="/personal-feed"===r?r:"";const n=j(t).toString();s.search=n?"?"+n:"",e.put(m,s)}}}};let k=class{constructor(e){this._context=e,this._article=s({});const t=e.get(b);e.whenOn(e=>{const r=t.provide({a:x,is:this._article.read});e.whenOff(r)})}get article(){return this._article.it}set article(e){this._article.it=e}render(){if(!this.article.slug)return;const e=this._context.contentRoot,t=`article/#/${encodeURIComponent(this.article.slug)}`;e.innerHTML=`\n<div class="post-meta">\n<conduit-article-author></conduit-article-author>\n<conduit-favorite-post></conduit-favorite-post>\n</div>\n<a href="${t}" class="preview-link">\n<h1>${y(this.article.title)}</h1>\n<p class="post-content">${y(this.article.description)}</p>\n<span>Read more...</span>\n</a>\n`}};g([o({propertyKey:"feedArticle"})],k.prototype,"article",null),g([i({offline:!0})],k.prototype,"render",null),k=g([c(["article-preview",_],{feature:{needs:[O]}},v({href(e){let t=e.target;for(;;){const e=t.getAttribute("href");if(null!=e)return e;const{parentNode:r}=t;if(!r)return;t=r}}}))],k);const D=new e("feed-article-list",{byDefault:()=>({articles:[],articlesCount:0})});let N=class{constructor(e){this._context=e,this.articles={articles:[],articlesCount:0};const t=e.get(b);e.whenOn(e=>{t.get(D).tillOff(e)(e=>this.articles=e)})}render(){const e=this._context.get(f).document,t=e.createRange();return t.selectNodeContents(this._context.contentRoot),()=>{if(t.deleteContents(),!this.articles.articlesCount)return;const r=e.createDocumentFragment();this.articles.articles.forEach(t=>{r.appendChild(e.createElement("conduit-article-preview")).feedArticle=t}),t.insertNode(r)}}};g([l()],N.prototype,"articles",void 0),g([i()],N.prototype,"render",null),N=g([c(["article-list",_],{feature:{needs:k}})],N);const S=new e("feed-request-page-param",{byDefault:()=>E});let $=class{constructor(e){this._feedPaging={};const t=e.get(b),r=e.get(w);e.whenOn(e=>{n({param:t.get(S),page:r,list:t.get(D)}).tillOff(e)(({param:[e],page:[t],list:[{articlesCount:s}]})=>{const n=t.get(e),{limit:a=20,offset:o=0}=n;this.feedPaging={totalPages:Math.ceil(s/a),currentPage:Math.floor(o/a),pageHref(t){var s;return(null===(s=r.with(e,Object.assign(Object.assign({},n),{offset:a*t})).pretend())||void 0===s?void 0:s.url.href)||""}}})})}get feedPaging(){return this._feedPaging}set feedPaging(e){this._feedPaging=e}};g([A()],$.prototype,"feedPaging",null),$=g([c(["feed-pager",_])],$);const F=new r("render-feed-state"),I=Symbol("render-feed-state");class M{constructor(e,t){this.response=s(),this._request=s({});const r=e.get(R);this.response.on((r,s)=>e.updateState(t,r,s)),e.get(b).provide({a:D,is:this.response.read.keep.thru_(e=>(null==e?void 0:e.ok)?e.body:{articles:[],articlesCount:0})}),e.whenOn(e=>{this._request.read.tillOff(e).thru_(e=>(this.response.it=void 0,a(r.articles(e))))(e=>this.response.it=e)})}static get[t](){return F}get request(){return this._request.it}set request(e){const t=this.request;q(e,t)||(this._request.it=e)}}function B({requestParam:e}={}){return d(({get:t,set:r,key:s})=>{const n=[I,s];return{componentDef:u.all({feature:{needs:[N,$,P]},define(t){t.perComponent({a:M,by:e=>new M(e,n)}),e&&t.whenComponent(t=>{t.get(b).provide({a:S,is:e})})}},i({path:n}).As((function(){const e=p.of(this),{contentRoot:t}=e,r=e.get(f).document,s=e.get(C),n=t.appendChild(r.createElement("conduit-article-list")),a=t.appendChild(r.createElement("conduit-feed-pager")),o=r.createRange(),i=e.get(M);return o.setStartAfter(n),o.setEndBefore(a),()=>{o.deleteContents();const e=i.response.it;e?e.ok||o.insertNode(function(e){const t=s(e);if(t)return t;const n=r.createElement("conduit-loader");return n.setAttribute("load-error","Failed to load articles"),n}(e.errors)):o.insertNode(r.createElement("conduit-loader"))}}),s)),get:t,set(e,t){r(e,t),p.of(e).get(M).request=t}}})}export{E as P,B as R};//# sourceMappingURL=render-feed.decorator.7847fe1c.js.map
