import{S as e,F as s}from"../proc7ts/context-values.69c73302.js";import{m as t,d as r,a as o,r as n,b as a,o as i}from"../proc7ts/fun-events.f7c44dc9.js";import{a as u}from"./auth.e0c9460a.js";import{a as c}from"../wesib/wesib.acbfb4f5.js";import{H as f}from"../wesib/generic.5b4ac940.js";import{I as p}from"../frontmeans/input-aspects.a58ff15b.js";const m=new e("api-root-url",{byDefault:()=>new URL("https://conduit.productionready.io/api/")}),d=new s("api-fetch",{byDefault:c((function(e){const s=e.get(f),i=e.get(m);return c=>{const{path:f,init:p,auth:m}=c;return i.do(t((e=>new URL(f,e))),t((e=>function(e,s={}){const t=new Request(e.href,{mode:"cors",...s}),{headers:r}=t;return r.set("X-Requested-With","XMLHttpRequest"),t}(e,p))),r((s=>!1===m?a({request:s}):function(e,s,r){return e.get(u).token.do(t((({token:e,failure:t})=>e?(s.headers.set("Authorization",`Token ${e}`),{request:s}):r?(t||(t={ok:!1,errors:{authentication:["absent"]}}),{failure:t}):{request:s})))}(e,s,m))),r((e=>e.request?s(e.request).do(o((e=>({response:e})))):a({failure:e.failure})))).do(o(l),n,o((([e,s])=>function({respondAs:e},s,t){if(!s.response)return s.failure;const{response:r}=s;if(r.ok)return{ok:!0,response:r,body:"function"==typeof e?e(t):t[e]};return{ok:!1,response:r,errors:t.errors||h(r)}}(c,e,s))))}}))});function b(){return{authentication:["absent"]}}function l(e){return e.response?Promise.all([e,e.response.json()]).catch((s=>[{failure:{ok:!1,response:e.response,errors:e.response.ok?{api:[`Failed to parse response: ${s}`]}:h(e.response)}}])):[e]}function h(e){return{HTTP:[`ERROR ${e.status}${e.statusText?": "+e.statusText:""}`]}}function w(e){return new Promise(((s,t)=>{e.do(i)((e=>{e.ok?s(e.body):t(new p({submit:"api",api:e.errors}))})).whenOff((e=>{t(e instanceof p?e:new p({submit:"cancel",cancel:e}))}))}))}export{d as A,w as a,b as n};//# sourceMappingURL=api.f9177210.js.map
