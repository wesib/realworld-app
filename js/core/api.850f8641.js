import{S as e,F as t}from"../proc7ts/context-values.de0fa082.js";import{n as r}from"../proc7ts/call-thru.104a1934.js";import{n as s,o as n}from"../proc7ts/fun-events.751f4123.js";import{a as o}from"../wesib/wesib.fd49a6cd.js";import{a}from"./auth.2372f198.js";import{H as u}from"../wesib/generic.1df87fc1.js";import{I as i}from"../frontmeans/input-aspects.8b5674f5.js";const f=new e("api-root-url",{byDefault:()=>new URL("https://conduit.productionready.io/api/")}),p=new t("api-fetch",{byDefault:o((function(e){const t=e.get(u),o=e.get(f);return u=>{const{path:i,init:f,auth:p}=u,c=o.thru_((e=>new URL(i,e)),(e=>function(e,t={}){const r=new Request(e.href,{mode:"cors",...t}),{headers:s}=r;return s.set("X-Requested-With","XMLHttpRequest"),r}(e,f))).thru_((t=>!1===p?r({request:t}):s(function(e,t,r){return e.get(a).token().keepThru_((({token:e,failure:s})=>e?(t.headers.set("Authorization",`Token ${e}`),{request:t}):r?(s||(s={ok:!1,errors:{authentication:["absent"]}}),{failure:s}):{request:t}))}(e,t,p))),(e=>e.request?s(t(e.request).thru_((e=>({response:e})))):r({failure:e.failure})));return n(c.thru_(h)).thru_((([e,t])=>function({respondAs:e},t,r){if(!t.response)return t.failure;const{response:s}=t;if(s.ok)return{ok:!0,response:s,body:"function"==typeof e?e(r):r[e]};return{ok:!1,response:s,errors:r.errors||m(s)}}(u,e,t)))}}))});function c(){return{authentication:["absent"]}}function h(e){return e.response?Promise.all([e,e.response.json()]).catch((t=>[{failure:{ok:!1,response:e.response,errors:e.response.ok?{api:[`Failed to parse response: ${t}`]}:m(e.response)}}])):[e]}function m(e){return{HTTP:[`ERROR ${e.status}${e.statusText?": "+e.statusText:""}`]}}function l(e){return new Promise(((t,r)=>{e.once((e=>{e.ok?t(e.body):r(new i({submit:"api",api:e.errors}))})).whenOff((e=>{r(e instanceof i?e:new i({submit:"cancel",cancel:e}))}))}))}export{p as A,l as a,c as n};//# sourceMappingURL=api.850f8641.js.map
