import{a as s,b as e,c as t,i as o,d as a,e as r,f as n,g as c,h as i,j as p,k as d,l as m}from"../frontmeans/input-aspects.453491d0.js";import{a as l,I as u,C as f,b as h,c as g,D as b,F as j,U as v}from"../wesib/generic.2dcf3479.js";import{S as k,R as w,C,A as x,t as y,F}from"../wesib/wesib.8c9ee002.js";import{i as _,c as A,b as R,j as U,m as D,k as I,s as M,l as S,g as q,n as z}from"../proc7ts/fun-events.2a5b87d8.js";import{_ as B}from"../helpers.e1623395.js";import{A as E}from"./loader.9029aa45.js";import{C as G}from"../core.10059585.js";import"../proc7ts/workbench.03f3f31a.js";function H({mark:a="is-invalid",when:r}={}){return n=>{const c=n.aspect(s);return _({status:n.aspect(e),validity:n.aspect(t)}).do(A((({status:[{touched:s,hasFocus:e}],validity:[t]})=>{const n=t.has("incomplete")||t.has("missing");return!s||e&&n?R():c.specs(o({mark:a,when:r}))})))}}const J={};let K=class{constructor(s){this._context=s,this.errors=J,s.get(l).get(u).do(U((({control:s})=>s?s.aspect(t).read.do(D((s=>s.messages("api").reduce(((s,e)=>({...s,...e.api})),J)))):R(J))))((s=>this.errors=s))}render(){const{contentRoot:s}=this._context;let e;return()=>{e&&(e.remove(),e=void 0),e=this._context.get(E)(this.errors),e&&s.append(e)}}};B([k()],K.prototype,"errors",void 0),B([w()],K.prototype,"render",null),K=B([C(["api-errors",G])],K);let L=class{};L=B([C(["in-error",G],x("code"),f((({control:{control:e},aspects:t,context:o})=>y(o,"code").read.do(D((s=>s?s.trim().split(/\s+/):[]))).do(I((n=>e.convert(a.to(o.element),t).setup(s,(s=>{s.add(r()),s.add(H({when:n}))}))))))))],L);let N=class{};function O({emptyModel:e={},form:t={makeForm({node:t,aspects:o}){const a=c(e).setup(s,(s=>s.add(r()))).setup(i,(s=>s.derive(p()))),n=d(t.element,{form:a,aspects:o}).setup(s,(e=>e.add(a.aspect(s))));return[a,n]}},button:o}={}){return C(j(t),function({select:s="button",pick:e={deep:!0,all:!0}}={}){return C({define(t){t.whenComponent((t=>{const o=t.get(h),a=t.get(l);t.whenConnected((()=>{_({form:a.get(g),button:o.select(s,e).first,aspects:t.get(b)}).do(M(t),S((({form:[{control:s}],button:[e],aspects:[t]})=>s&&e&&n(e.element,{form:s,aspects:t}))))}))}))}})}(o))}function P(e){return v({...e,makeControl:t=>t.context.get(l).get(g).do(U((({form:o})=>{const a=e.makeControl(t);return a?a instanceof m?R(n(a)):q(a).do(z(((s,e,t)=>e?(n(e),t?s(e,t):s(e)):s()))):R();function n(e){o&&e.aspect(i).derive(o.aspect(i));const t=e.aspect(s);return t.add(r()),t.add(H()),e}})))})}N=B([F({needs:[K,L]})],N);export{N as C,O as F,P as U};//# sourceMappingURL=input.475c0ace.js.map
