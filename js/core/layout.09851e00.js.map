{"version":3,"file":"layout.09851e00.js","sources":["../../../src/core/layout/main.component.ts","../../../src/core/layout/navbar.component.ts","../../../src/core/layout/container.component.ts","../../../src/core/layout/footer.component.ts","../../../src/core/layout/conduit-layout-support.feature.ts"],"sourcesContent":["import { IncludePage } from '@wesib/generic';\nimport { BootstrapWindow, Component } from '@wesib/wesib';\nimport { Conduit__NS } from '../conduit.ns';\nimport { LoaderComponent } from '../loader';\n\n@Component(\n    ['main', Conduit__NS],\n    {\n      feature: {\n        needs: LoaderComponent,\n      },\n    },\n    IncludePage({\n      onResponse({ context, response, range }) {\n        if (!response.ok) {\n          range.deleteContents();\n\n          const { document } = context.get(BootstrapWindow);\n          const loader = document.createElement('conduit-loader');\n\n          if (response.ok != null) {\n            loader.setAttribute('load-error', `Error. ${String(response.error)}`);\n          }\n\n          range.insertNode(loader);\n        }\n      },\n    }),\n)\nexport class MainComponent {}\n","import { DomEventDispatcher } from '@frontmeans/dom-events';\nimport { supplyAfter } from '@proc7ts/fun-events';\nimport { ActivateNavLink, HandleNavLinks } from '@wesib/generic';\nimport { BootstrapWindow, Component, ComponentContext, ElementRenderer, Render, StateProperty } from '@wesib/wesib';\nimport { AuthService, AuthUser, notAuthenticated, NotAuthenticated } from '../auth';\nimport { Conduit__NS } from '../conduit.ns';\n\n@Component(\n    ['navbar', Conduit__NS],\n    HandleNavLinks(),\n    ActivateNavLink({ active: 'active' }),\n)\nexport class NavbarComponent {\n\n  @StateProperty()\n  user: AuthUser | NotAuthenticated = notAuthenticated;\n\n  constructor(private readonly _context: ComponentContext) {\n\n    const authService = _context.get(AuthService);\n\n    authService.user.do(supplyAfter(_context))(\n        user => this.user = user,\n    ).whenOff(\n        () => this.user = notAuthenticated,\n    );\n  }\n\n  @Render()\n  render(): ElementRenderer {\n\n    const authService = this._context.get(AuthService);\n    const { document } = this._context.get(BootstrapWindow);\n    const { element }: { element: Element } = this._context;\n    const ul = element.querySelector('ul')!;\n    const range = document.createRange();\n\n    range.setStartAfter(ul.appendChild(document.createComment('[USER-NAV[')));\n    range.setEndBefore(ul.appendChild(document.createComment(']USER-NAV]')));\n\n    return () => {\n      range.deleteContents();\n\n      const { username } = this.user;\n\n      if (username) {\n\n        const logout = createItem('', 'ion-log-out', '');\n\n        new DomEventDispatcher(logout).on('click')(() => {\n          authService.logout();\n        });\n        range.insertNode(logout);\n        range.insertNode(createItem(username, 'ion-person', `profile/#/${encodeURIComponent(username)}`));\n      }\n    };\n\n    function createItem(label: string, icon: string, href: string): HTMLLIElement {\n\n      const item = document.createElement('li');\n\n      item.className = 'nav-item';\n\n      const a = item.appendChild(document.createElement('a'));\n\n      a.className = 'nav-link';\n      a.setAttribute('href', href);\n\n      const i = a.appendChild(document.createElement('i'));\n\n      i.className = icon;\n      a.append(' ', label);\n\n      return item;\n    }\n  }\n\n}\n","import { css__naming, QualifiedName } from '@frontmeans/namespace-aliaser';\nimport { supplyAfter } from '@proc7ts/fun-events';\nimport {\n  Component,\n  ComponentContext,\n  DefaultNamespaceAliaser,\n  ElementRenderer,\n  Render,\n  StateProperty,\n} from '@wesib/wesib';\nimport { Authentication, AuthService } from '../auth';\nimport { Conduit__NS } from '../conduit.ns';\nimport { MainComponent } from './main.component';\nimport { NavbarComponent } from './navbar.component';\n\nconst authenticatedClassQName: QualifiedName = ['authenticated', Conduit__NS];\nconst notAuthenticatedClassQName: QualifiedName = ['not-authenticated', Conduit__NS];\n\n@Component({\n  name: ['container', Conduit__NS],\n  feature: {\n    needs: [MainComponent, NavbarComponent],\n  },\n})\nexport class ContainerComponent {\n\n  @StateProperty()\n  auth: Authentication = {};\n\n  constructor(private readonly _context: ComponentContext) {\n    _context.get(AuthService).authentication.do(supplyAfter(_context))(\n        auth => this.auth = auth,\n    );\n  }\n\n  @Render()\n  render(): ElementRenderer {\n\n    const nsAlis = this._context.get(DefaultNamespaceAliaser);\n    const authenticatedClass = css__naming.name(authenticatedClassQName, nsAlis);\n    const notAuthenticatedClass = css__naming.name(notAuthenticatedClassQName, nsAlis);\n    const { classList }: Element = this._context.element;\n\n    return () => {\n      if (this.auth.token) {\n        classList.remove(notAuthenticatedClass);\n        classList.add(authenticatedClass);\n      } else {\n        classList.remove(authenticatedClass);\n        classList.add(notAuthenticatedClass);\n      }\n    };\n  }\n\n}\n","import { HandleNavLinks } from '@wesib/generic';\nimport { Component } from '@wesib/wesib';\nimport { Conduit__NS } from '../conduit.ns';\n\n@Component(\n    ['footer', Conduit__NS],\n    HandleNavLinks(),\n)\nexport class FooterComponent {\n}\n","import { Feature } from '@wesib/wesib';\nimport { ContainerComponent } from './container.component';\nimport { FooterComponent } from './footer.component';\n\n@Feature({\n  needs: [\n    ContainerComponent,\n    FooterComponent,\n  ],\n})\nexport class ConduitLayoutSupport {\n}\n"],"names":["MainComponent","Component","Conduit__NS","feature","needs","LoaderComponent","IncludePage","[object Object]","context","response","range","ok","deleteContents","document","get","BootstrapWindow","loader","createElement","setAttribute","String","error","insertNode","NavbarComponent","_context","this","notAuthenticated","AuthService","user","do","supplyAfter","authService","whenOff","element","ul","querySelector","createRange","setStartAfter","appendChild","createComment","setEndBefore","username","logout","createItem","DomEventDispatcher","on","encodeURIComponent","label","icon","href","item","className","a","append","__decorate","StateProperty","Render","HandleNavLinks","ActivateNavLink","active","authenticatedClassQName","notAuthenticatedClassQName","ContainerComponent","authentication","auth","nsAlis","DefaultNamespaceAliaser","authenticatedClass","css__naming","name","notAuthenticatedClass","classList","token","remove","add","FooterComponent","ConduitLayoutSupport","Feature"],"mappings":"0eA6BA,IAAaA,EAAb,QAAaA,KAxBZC,EACG,CAAC,OAAQC,GACT,CACEC,QAAS,CACPC,MAAOC,IAGXC,EAAY,CACVC,YAAWC,QAAEA,EAAOC,SAAEA,EAAQC,MAAEA,IAC9B,IAAKD,EAASE,GAAI,CAChBD,EAAME,iBAEN,MAAMC,SAAEA,GAAaL,EAAQM,IAAIC,GAC3BC,EAASH,EAASI,cAAc,kBAEnB,MAAfR,EAASE,IACXK,EAAOE,aAAa,aAAc,UAAUC,OAAOV,EAASW,UAG9DV,EAAMW,WAAWL,SAKdhB,GCjBb,IAAasB,EAAb,MAKEf,YAA6BgB,GAAAC,cAAAD,EAF7BC,UAAoCC,EAIdF,EAAST,IAAIY,GAErBC,KAAKC,GAAGC,EAAYN,GAAhCO,EACIH,GAAQH,KAAKG,KAAOA,IACtBI,SACE,IAAMP,KAAKG,KAAOF,IAKxBlB,SAEE,MAAMuB,EAAcN,KAAKD,SAAST,IAAIY,IAChCb,SAAEA,GAAaW,KAAKD,SAAST,IAAIC,IACjCiB,QAAEA,GAAkCR,KAAKD,SACzCU,EAAKD,EAAQE,cAAc,MAC3BxB,EAAQG,EAASsB,cAKvB,OAHAzB,EAAM0B,cAAcH,EAAGI,YAAYxB,EAASyB,cAAc,gBAC1D5B,EAAM6B,aAAaN,EAAGI,YAAYxB,EAASyB,cAAc,gBAElD,KACL5B,EAAME,iBAEN,MAAM4B,SAAEA,GAAahB,KAAKG,KAE1B,GAAIa,EAAU,CAEZ,MAAMC,EAASC,EAAW,GAAI,cAAe,IAE7C,IAAIC,EAAmBF,GAAQG,GAAG,QAAlC,EAA2C,KACzCd,EAAYW,YAEd/B,EAAMW,WAAWoB,GACjB/B,EAAMW,WAAWqB,EAAWF,EAAU,aAAc,aAAaK,mBAAmBL,SAIxF,SAASE,EAAWI,EAAeC,EAAcC,GAE/C,MAAMC,EAAOpC,EAASI,cAAc,MAEpCgC,EAAKC,UAAY,WAEjB,MAAMC,EAAIF,EAAKZ,YAAYxB,EAASI,cAAc,MAElDkC,EAAED,UAAY,WACdC,EAAEjC,aAAa,OAAQ8B,GAOvB,OALUG,EAAEd,YAAYxB,EAASI,cAAc,MAE7CiC,UAAYH,EACdI,EAAEC,OAAO,IAAKN,GAEPG,KA1DXI,GADCC,gCAeDD,GADCE,gCAhBUjC,KALZrB,EACG,CAAC,SAAUC,GACXsD,IACAC,EAAgB,CAAEC,OAAQ,aAEjBpC,GCGb,MAAMqC,EAAyC,CAAC,gBAAiBzD,GAC3D0D,EAA4C,CAAC,oBAAqB1D,GAQxE,IAAa2D,EAAb,MAKEtD,YAA6BgB,GAAAC,cAAAD,EAF7BC,UAAuB,GAGrBD,EAAST,IAAIY,GAAaoC,eAAelC,GAAGC,EAAYN,GAAxDA,EACIwC,GAAQvC,KAAKuC,KAAOA,IAK1BxD,SAEE,MAAMyD,EAASxC,KAAKD,SAAST,IAAImD,GAC3BC,EAAqBC,EAAYC,KAAKT,EAAyBK,GAC/DK,EAAwBF,EAAYC,KAAKR,EAA4BI,IACrEM,UAAEA,GAAuB9C,KAAKD,SAASS,QAE7C,MAAO,KACDR,KAAKuC,KAAKQ,OACZD,EAAUE,OAAOH,GACjBC,EAAUG,IAAIP,KAEdI,EAAUE,OAAON,GACjBI,EAAUG,IAAIJ,OAtBpBhB,GADCC,gCAUDD,GADCE,gCAXUM,KANZ5D,EAAU,CACTmE,KAAM,CAAC,YAAalE,GACpBC,QAAS,CACPC,MAAO,CAACJ,EAAesB,OAGduC,GChBb,IAAaa,EAAb,QAAaA,KAJZzE,EACG,CAAC,SAAUC,GACXsD,MAESkB,OCEAC,EAAb,QAAaA,KANZC,EAAQ,CACPxE,MAAO,CACLyD,EACAa,MAGSC"}