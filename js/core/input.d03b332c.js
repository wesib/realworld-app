import{b as e}from"../proc7ts/call-thru.7f76a0d9.js";import{g as t,e as s,a as r}from"../proc7ts/fun-events.c2220af5.js";import{S as o,R as a,C as n,l as c,t as p,F as i}from"../wesib/wesib.e7f21d38.js";import{_ as u}from"../helpers.e1623395.js";import{a as d,I as m,C as l,b as f,c as h,D as b,F as g,U as k}from"../wesib/generic.178f9189.js";import{a as v,b as j,c as _,i as w,d as C,e as x,f as T,g as y,h as F,j as R,k as U,l as A}from"../proc7ts/input-aspects.8d791286.js";import{C as D}from"../core.714cbb7b.js";import{A as I}from"./loader.ce41151b.js";function M({mark:r="is-invalid",when:o}={}){return a=>{const n=a.aspect(v);return t({status:a.aspect(j),validity:a.aspect(_)}).keepThru(({status:[{touched:t,hasFocus:a}],validity:[c]})=>{const p=c.has("incomplete")||c.has("missing");return!t||a&&p?e():s(n.specs(w({mark:r,when:o})))})}}const O={};let S=(()=>{let t=class{constructor(t){this._context=t,this.errors=O,t.get(d).get(m).thru_(({control:t})=>t?s(t.aspect(_).read().keepThru_(e=>e.messages("api").reduce((e,t)=>({...e,...t.api}),O))):e(O)).to(e=>this.errors=e)}render(){const{contentRoot:e}=this._context;let t;return()=>{t&&(t.remove(),t=void 0),t=this._context.get(I)(this.errors),t&&e.append(t)}}};return u([o()],t.prototype,"errors",void 0),u([a()],t.prototype,"render",null),t=u([n(["api-errors",D])],t),t})(),q=(()=>{let e=class{};return e=u([n(["in-error",D],c("code"),l(({control:{control:e},aspects:t,context:s})=>p(s,"code").read().keepThru_(e=>e?e.trim().split(/\s+/):[]).keepThru(r=>e.convert(C.to(s.element),t).setup(v,e=>{e.add(x()),e.add(M({when:r}))}))))],e),e})(),z=(()=>{let e=class{};return e=u([i({needs:[S,q]})],e),e})();function B({emptyModel:e={},form:s={makeForm({node:t,aspects:s}){const r=y(e).setup(v,e=>e.add(x())).setup(F,e=>e.derive(R())),o=U(t.element,{form:r,aspects:s}).setup(v,e=>e.add(r.aspect(v)));return[r,o]}},button:r}={}){return n(g(s),function({select:e="button",pick:s={deep:!0,all:!0}}={}){return n({define(r){r.whenComponent(r=>{const o=r.get(f),a=r.get(d);r.whenConnected(()=>{t({form:a.get(h),button:o.select(e,s).first(),aspects:r.get(b)}).tillOff(r).consume(({form:[{control:e}],button:[t],aspects:[s]})=>e&&t&&T(t.element,{form:e,aspects:s}))})})}})}(r))}function E(t){return k({...t,makeControl:o=>o.context.get(d).get(h).keepThru_(({form:a})=>{const n=t.makeControl(o);return n?n instanceof A?c(n):s(r(n).keepThru_((t,s)=>t?(c(t),s?e(t,s):e(t)):e())):e();function c(e){a&&e.aspect(F).derive(a.aspect(F));const t=e.aspect(v);return t.add(x()),t.add(M()),e}})})}export{z as C,B as F,E as U};//# sourceMappingURL=input.d03b332c.js.map
