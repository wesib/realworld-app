import{S as e,F as s}from"../proc7ts/context-values.cc32b8c5.js";import{m as t,d as r,a as o,r as n,b as a,o as i}from"../proc7ts/fun-events.8f536596.js";import{H as u}from"../wesib/generic.e05bd5a6.js";import{a as c}from"../wesib/wesib.289eabae.js";import{a as p}from"./auth.98c2c25d.js";import{I as f}from"../frontmeans/input-aspects.e72f213f.js";import"../proc7ts/workbench.31425b55.js";const m=new e("api-root-url",{byDefault:()=>new URL("https://conduit.productionready.io/api/")}),d=new s("api-fetch",{byDefault:c((function(e){const s=e.get(u),i=e.get(m);return u=>{const{path:c,init:f,auth:m}=u;return i.do(t((e=>new URL(c,e))),t((e=>function(e,s={}){const t=new Request(e.href,{mode:"cors",...s}),{headers:r}=t;return r.set("X-Requested-With","XMLHttpRequest"),t}(e,f))),r((s=>!1===m?a({request:s}):function(e,s,r){return e.get(p).token.do(t((({token:e,failure:t})=>e?(s.headers.set("Authorization",`Token ${e}`),{request:s}):r?(t||(t={ok:!1,errors:{authentication:["absent"]}}),{failure:t}):{request:s})))}(e,s,m))),r((e=>e.request?s(e.request).do(o((e=>({response:e})))):a({failure:e.failure})))).do(o(h),n,o((([e,s])=>function({respondAs:e},s,t){if(!s.response)return s.failure;const{response:r}=s;if(r.ok)return{ok:!0,response:r,body:"function"==typeof e?e(t):t[e]};return{ok:!1,response:r,errors:t.errors||l(r)}}(u,e,s))))}}))});function b(){return{authentication:["absent"]}}function h(e){return e.response?Promise.all([e,e.response.json()]).catch((s=>[{failure:{ok:!1,response:e.response,errors:e.response.ok?{api:[`Failed to parse response: ${s}`]}:l(e.response)}}])):[e]}function l(e){return{HTTP:[`ERROR ${e.status}${e.statusText?": "+e.statusText:""}`]}}function w(e){return new Promise(((s,t)=>{e.do(i)((e=>{e.ok?s(e.body):t(new f({submit:"api",api:e.errors}))})).whenOff((e=>{t(e instanceof f?e:new f({submit:"cancel",cancel:e}))}))}))}export{d as A,w as a,b as n};//# sourceMappingURL=api.48f5edea.js.map
