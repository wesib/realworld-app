import{S as e,F as s}from"../proc7ts/context-values.bb33d989.js";import{m as t,d as r,a as o,r as n,b as a,o as i}from"../proc7ts/fun-events.3d56e7e0.js";import"../proc7ts/workbench.76998d65.js";import{a as u}from"../wesib/wesib.342b4a6e.js";import{a as p}from"./auth.d699f70e.js";import{H as f}from"../wesib/generic.d6a04d49.js";import{I as c}from"../frontmeans/input-aspects.a0d328af.js";const d=new e("api-root-url",{byDefault:()=>new URL("https://conduit.productionready.io/api/")}),m=new s("api-fetch",{byDefault:u((function(e){const s=e.get(f),i=e.get(d);return u=>{const{path:f,init:c,auth:d}=u;return i.do(t((e=>new URL(f,e))),t((e=>function(e,s={}){const t=new Request(e.href,{mode:"cors",...s}),{headers:r}=t;return r.set("X-Requested-With","XMLHttpRequest"),t}(e,c))),r((s=>!1===d?a({request:s}):function(e,s,r){return e.get(p).token.do(t((({token:e,failure:t})=>e?(s.headers.set("Authorization",`Token ${e}`),{request:s}):r?(t||(t={ok:!1,errors:{authentication:["absent"]}}),{failure:t}):{request:s})))}(e,s,d))),r((e=>e.request?s(e.request).do(o((e=>({response:e})))):a({failure:e.failure})))).do(o(h),n,o((([e,s])=>function({respondAs:e},s,t){if(!s.response)return s.failure;const{response:r}=s;if(r.ok)return{ok:!0,response:r,body:"function"==typeof e?e(t):t[e]};return{ok:!1,response:r,errors:t.errors||l(r)}}(u,e,s))))}}))});function b(){return{authentication:["absent"]}}function h(e){return e.response?Promise.all([e,e.response.json()]).catch((s=>[{failure:{ok:!1,response:e.response,errors:e.response.ok?{api:[`Failed to parse response: ${s}`]}:l(e.response)}}])):[e]}function l(e){return{HTTP:[`ERROR ${e.status}${e.statusText?": "+e.statusText:""}`]}}function w(e){return new Promise(((s,t)=>{e.do(i)((e=>{e.ok?s(e.body):t(new c({submit:"api",api:e.errors}))})).whenOff((e=>{t(e instanceof c?e:new c({submit:"cancel",cancel:e}))}))}))}export{m as A,w as a,b as n};//# sourceMappingURL=api.de086b78.js.map
