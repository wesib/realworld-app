{"version":3,"file":"loader.cc6fc823.js","sources":["../../../src/core/loader/loader.component.ts","../../../src/reusable/api-error-generator.ts","../../../src/reusable/format-date.ts","../../../src/reusable/render-html.decorator.ts","../../../src/reusable/render-pager.decorator.ts","../../../src/reusable/multi-input.component.ts","../../../src/core/loader/render-loader.decorator.ts"],"sourcesContent":["import { Attribute, BootstrapWindow, Component, ComponentContext, ElementRenderer, Render } from '@wesib/wesib';\nimport { Conduit__NS } from '../index';\n\n@Component(['loader', Conduit__NS])\nexport class LoaderComponent {\n\n  @Attribute('load-error')\n  loadError?: string | null;\n\n  constructor(private readonly _context: ComponentContext) {\n  }\n\n  @Render()\n  render(): ElementRenderer {\n\n    const { document } = this._context.get(BootstrapWindow);\n    const range = document.createRange();\n\n    range.selectNodeContents(this._context.contentRoot);\n\n    return () => {\n      range.deleteContents();\n      if (this.loadError != null) {\n        range.insertNode(document.createTextNode(this.loadError));\n      }\n    };\n  }\n\n}\n","import { FnContextKey, FnContextRef } from '@proc7ts/context-values/updatable';\nimport { overEntries } from '@proc7ts/push-iterator';\nimport { bootstrapDefault, BootstrapWindow } from '@wesib/wesib';\nimport { ApiResponse } from '../core/api';\n\nexport type ApiErrorGenerator = (this: void, errors: ApiResponse.Errors) => Element | undefined;\n\nexport const ApiErrorGenerator: FnContextRef<[ApiResponse.Errors], Element | undefined> = (\n    /*#__PURE__*/ new FnContextKey<[ApiResponse.Errors], Element | undefined>(\n        'api-error-generator',\n        {\n          byDefault: bootstrapDefault(context => {\n\n            const document = context.get(BootstrapWindow).document;\n\n            return errors => {\n\n              let list: Element | undefined;\n\n              for (const [key, messages] of overEntries(errors)) {\n                if (!list) {\n                  list = document.createElement('ul');\n                  list.classList.add('error-messages');\n                }\n\n                const ul = list;\n\n                messages.forEach(message => {\n\n                  const li = document.createElement('li');\n\n                  li.innerText = `${key} ${message}`;\n                  ul.appendChild(li);\n                });\n              }\n\n              return list;\n            };\n          }),\n        },\n    )\n);\n","const thisYearDateFormat = new Intl.DateTimeFormat('en-US', { month: 'long', day: 'numeric' });\nconst otherYearFateFormat = new Intl.DateTimeFormat('en-US', { year: 'numeric', month: 'long', day: 'numeric' });\n\nexport function formatDate(date: Date): string {\n\n  const now = new Date();\n  const format = now.getFullYear() === date.getFullYear() ? thisYearDateFormat : otherYearFateFormat;\n\n  return format.format(date);\n}\n","import {\n  BootstrapWindow,\n  ComponentClass,\n  ComponentContext,\n  ComponentProperty,\n  ComponentPropertyDecorator,\n  ElementRenderer,\n  Render,\n  RenderDef,\n} from '@wesib/wesib';\n\nexport function RenderHTML<T extends ComponentClass>(\n    def: {\n      render?: RenderDef;\n      comment?: string;\n    } = {},\n): ComponentPropertyDecorator<() => string | Node | null | undefined, T> {\n  return ComponentProperty(({ get, key }) => {\n\n    const {\n      comment = String(key),\n      render,\n    } = def;\n\n    return {\n      componentDef: Render(render).As(renderHTML, key),\n    };\n\n    function renderHTML(this: InstanceType<T>): ElementRenderer {\n\n      const context = ComponentContext.of(this);\n      const { document } = context.get(BootstrapWindow);\n      const { contentRoot }: { contentRoot: Node } = context;\n      const start = contentRoot.appendChild(document.createComment(`[${comment}[`));\n      const end = contentRoot.appendChild(document.createComment(`]${comment}]`));\n      const range = document.createRange();\n\n      range.setStartAfter(start);\n      range.setEndBefore(end);\n\n      return () => {\n        range.deleteContents();\n\n        const html = get(this).call(this);\n\n        if (!html) {\n          return;\n        }\n        if (typeof html === 'string') {\n\n          const node = document.createElement('template');\n\n          node.innerHTML = html;\n          range.insertNode(node.content);\n        } else {\n          range.insertNode(html);\n        }\n      };\n    }\n  });\n}\n","import { StatePath } from '@proc7ts/fun-events';\nimport { HandleNavLinks } from '@wesib/generic';\nimport {\n  BootstrapWindow,\n  ComponentClass,\n  ComponentContext,\n  ComponentDef,\n  ComponentProperty,\n  ComponentPropertyDecorator,\n  RenderDef,\n  RenderPath__root,\n} from '@wesib/wesib';\nimport { RenderHTML } from './render-html.decorator';\n\nexport type PagingInfo =\n    | PagingInfo.Empty\n    | PagingInfo.WithPages;\n\nexport namespace PagingInfo {\n\n  export interface Empty {\n    readonly totalPages?: 0 | 1;\n    readonly visiblePages?: number;\n    readonly currentPage?: number;\n    pageHref?(page: number): string;\n  }\n\n  export interface WithPages {\n    readonly totalPages: number;\n    readonly visiblePages?: number;\n    readonly currentPage?: number;\n    pageHref(page: number): string;\n  }\n\n}\n\nconst PagingInfo__symbol = (/*#__PURE__*/ Symbol('paging-info'));\n\nexport function RenderPager<T extends ComponentClass>(\n    def: {\n      render?: RenderDef.Options;\n    } = {},\n): ComponentPropertyDecorator<PagingInfo, T> {\n\n  const { render: renderOptions } = def;\n\n  return ComponentProperty(({ get, set, key }) => {\n\n    const path: StatePath = [RenderPath__root, PagingInfo__symbol, key];\n    const render = RenderDef.fulfill({ on: path }, renderOptions);\n\n    return {\n      componentDef: ComponentDef.all(\n          RenderHTML({ render, comment: `PAGER(${String(key)})` }).As(pagerContent, key),\n          HandleNavLinks(),\n      ),\n      get,\n      set(component, value) {\n\n        const prev = get(component);\n\n        set(component, value);\n        ComponentContext.of(component).updateState(path, value, prev);\n      },\n    };\n\n    function pagerContent(this: InstanceType<T>): Node | undefined {\n\n      const context = ComponentContext.of(this);\n      const { document } = context.get(BootstrapWindow);\n      const pagingInfo = get(this);\n\n      if (!pagingInfo.totalPages || pagingInfo.totalPages <= 1) {\n        return;\n      }\n\n      const info = pagingInfo as PagingInfo.WithPages;\n      const { totalPages, visiblePages = 5, currentPage = 0 } = info;\n\n      const visible = Math.max(1, visiblePages);\n      const current = Math.max(0, currentPage);\n\n      const ul = document.createElement('ul');\n\n      ul.className = 'pagination';\n\n      let startPage = Math.max(0, current - (visible >> 1));\n      let endPage = startPage + visible;\n\n      if (endPage > totalPages) {\n        startPage = Math.max(0, startPage - (endPage - totalPages));\n        endPage = totalPages;\n      }\n\n      ul.appendChild(pageItem('<<', 0, current > 0));\n      ul.appendChild(pageItem('<', current - 1, current > 0));\n      for (let page = startPage; page < endPage; ++page) {\n        ul.appendChild(pageItem(String(page + 1), page, true, current === page));\n      }\n      ul.appendChild(pageItem('>', current + 1, current + 1 < totalPages));\n      ul.appendChild(pageItem('>>', totalPages - 1, current + 1 < totalPages));\n\n      return ul;\n\n      function pageItem(\n          text: string,\n          page: number,\n          enabled: boolean,\n          active = false,\n      ): HTMLLIElement {\n\n        const li = document.createElement('li');\n\n        li.className = 'page-item';\n\n        let link: HTMLElement;\n\n        if (enabled && !active) {\n          link = document.createElement('a');\n          link.setAttribute('href', info.pageHref(page));\n        } else {\n          li.classList.add(active ? 'active' : 'disabled');\n          link = document.createElement('span');\n        }\n        link.className = 'page-link';\n        link.innerHTML = text;\n        li.appendChild(link);\n\n        return li;\n      }\n    }\n\n  });\n}\n","import { DeltaSet } from '@proc7ts/delta-set';\nimport { AbstractInElement, InConverter, InElement } from '@proc7ts/input-aspects';\nimport { overArray } from '@proc7ts/push-iterator';\nimport {\n  AttachShadow,\n  AttributeChanged,\n  BootstrapWindow,\n  Component,\n  ComponentContext,\n  ContentRoot,\n  DomProperty,\n  domPropertyPathTo,\n  ElementRenderer,\n  Render,\n} from '@wesib/wesib';\nimport { Conduit__NS } from '../core';\n\nexport class MultiInputEvent extends CustomEvent<readonly string[]> {\n}\n\nconst trailingSpace = /\\s$/;\n\n/**\n * Tags input based on [multi-input](https://github.com/samdutton/multi-input) component by Sam Dutton.\n *\n * Does not allow duplicates. Does not limit a list of allowed values. Expects values to be space-separated.\n *\n * Raises [[MultiInputEvent]] on list update.\n */\n@Component(['multi-input', Conduit__NS])\n@AttachShadow()\nexport class MultiInputComponent {\n\n  private readonly _values = new DeltaSet<string>();\n  private _input?: HTMLInputElement;\n  private _datalist?: HTMLDataListElement;\n\n  constructor(private readonly _context: ComponentContext) {\n  }\n\n  get input(): HTMLInputElement {\n    // Initialize it lazily as it may be dynamically created.\n    if (this._input) {\n      return this._input;\n    }\n\n    const { element } = this._context as { element: Element };\n\n    this._input = element.querySelector('input')!;\n    this._input.onblur = this._input.onchange = this._handleBlur.bind(this);\n    this._input.oninput = this._handleInput.bind(this);\n    this._input.onkeydown = this._handleKeydown.bind(this);\n\n    return this._input;\n  }\n\n  get datalist(): HTMLDataListElement {\n    // Initialize it lazily as it may be dynamically created.\n    if (this._datalist) {\n      return this._datalist;\n    }\n\n    const { element } = this._context as { element: Element };\n\n    this._datalist = element.querySelector('datalist')!;\n\n    return this._datalist;\n  }\n\n  get values(): readonly string[] {\n    return Array.from(this._values);\n  }\n\n  @DomProperty()\n  set values(values: readonly string[]) {\n    this._values.clear();\n    this._values.delta(values || []);\n  }\n\n  get readonly(): boolean {\n    return this.input.disabled || this.input.readOnly;\n  }\n\n  @AttributeChanged('disabled')\n  setDisabled(value: string | null): void {\n    if (value != null) {\n      this.input.setAttribute('disabled', value);\n    } else {\n      this.input.removeAttribute('disabled');\n    }\n  }\n\n  @AttributeChanged('readonly')\n  setReadonly(value: string | null): void {\n    if (value != null) {\n      this.input.setAttribute('readonly', value);\n    } else {\n      this.input.removeAttribute('readonly');\n    }\n  }\n\n  @Render()\n  render(): ElementRenderer {\n\n    const { contentRoot, element } = this._context as { contentRoot: ContentRoot; element: Element };\n    const { document } = this._context.get(BootstrapWindow);\n\n    contentRoot.innerHTML = `<style>\n:host {\n  border: var(--multi-input-border, 1px solid #ddd);\n  display: block;\n  overflow: hidden;\n  padding: 5px;\n}\n/* NB use of pointer-events to only allow events from the × icon */\n::slotted(div.item) {\n  background-color: var(--multi-input-item-bg-color, #dedede);\n  border: var(--multi-input-item-border, 1px solid #ccc);\n  border-radius: 2px;\n  color: #222;\n  display: inline-block;\n  font-size: var(--multi-input-item-font-size, 14px);\n  margin: 5px;\n  padding: 2px 25px 2px 5px;\n  pointer-events: none;\n  position: relative;\n  top: -1px;\n}\n/* NB pointer-events: none above */\n::slotted(div.item:hover) {\n  background-color: #eee;\n  color: black;\n}\n::slotted(input) {\n  border: none;\n  font-size: var(--multi-input-input-font-size, 14px);\n  outline: none;\n  padding: 10px 10px 10px 5px;\n}\n</style>\n<slot></slot>`;\n\n    element.insertBefore(document.createComment('[ITEMS['), this.input);\n\n    const end = element.insertBefore(document.createComment(']ITEMS]'), this.input);\n    const valueOption = (value: string): HTMLOptionElement | undefined => {\n\n      const match = value + ' ';\n\n      for (const option of overArray(this.datalist.options)) {\n        if (option.value === match) {\n          return option;\n        }\n      }\n\n      return;\n    };\n    const valueItem = (value: string): Element | undefined => {\n      for (const item of overArray(element.querySelectorAll('.item'))) {\n        if (item.textContent === value) {\n          return item;\n        }\n      }\n      return;\n    };\n\n    return () => {\n      this._values.redelta({\n        add: value => {\n          if (!valueItem(value)) {\n\n            const item = document.createElement('div');\n\n            item.className = 'item';\n            item.textContent = value;\n            item.onclick = () => {\n              if (!this.readonly) {\n                this._delete(value);\n              }\n            };\n\n            element.insertBefore(item, end);\n          }\n\n          // Remove value from datalist options.\n          // Value is added back if an item is deleted (see _delete()).\n          valueOption(value)?.remove();\n        },\n        delete: value => {\n          // Remove item\n          valueItem(value)?.remove();\n\n          // Add datalist option unless there is one already\n          if (!valueOption(value)) {\n\n            const option = document.createElement('option');\n\n            // Append space to force adding value when option selected.\n            option.value = value + ' ';\n            this.datalist.appendChild(option);\n          }\n        },\n      }).undelta();\n    };\n  }\n\n  // Called by _handleKeydown() when the value of the input is an allowed value.\n  private _add(value: string, force = false): void {\n    if (!force && !trailingSpace.test(value)) {\n      return;\n    }\n    value = value.trim();\n    if (!value) {\n      return;\n    }\n\n    this._values.add(value);\n    this.input.value = '';\n    this._sendEvent();\n  }\n\n  // Called when the × icon is tapped/clicked or\n  // by _handleKeydown() when Backspace is entered.\n  private _delete(value: string): void {\n    this._values.delete(value);\n    this._sendEvent();\n  }\n\n  // Avoid stray text remaining in the input element that's not in a div.item.\n  private _handleBlur(): void {\n\n    const { value } = this.input;\n\n    this.input.value = '';\n    this._add(value, true);\n  }\n\n  // Called when input text changes,\n  // either by entering text or selecting a datalist option.\n  private _handleInput(): void {\n    // Add a div.item\n    this._add(this.input.value);\n  }\n\n  // Called when text is entered or keys pressed in the input element.\n  private _handleKeydown(event: KeyboardEvent): void {\n\n    const value = this.input.value;\n\n    // On Backspace, delete the div.item to the left of the input\n    if (!value && event.key === 'Backspace') {\n\n      const { values } = this;\n\n      if (values.length) {\n        this._delete(values[values.length - 1]);\n      }\n\n      return;\n    }\n\n    this._add(this.input.value);\n  }\n\n  private _sendEvent(): void {\n    this._context.updateState(domPropertyPathTo('values'), this.values, this.values);\n    this._context.dispatchEvent(new MultiInputEvent('conduit:input', { bubbles: true, detail: this.values }));\n  }\n\n}\n\nexport namespace MultiInputComponent {\n\n  export interface Element extends HTMLElement {\n    values: readonly string[];\n  }\n\n  export type Control = InElement<readonly string[], Element>;\n\n}\n\nclass MultiInputControl extends AbstractInElement<readonly string[], MultiInputComponent.Element> {\n\n  constructor(\n      element: MultiInputComponent.Element,\n      {\n        aspects,\n      }: {\n        readonly aspects?: InConverter.Aspect<readonly string[]> | readonly InConverter.Aspect<readonly string[]>[];\n      } = {},\n  ) {\n    super(\n        element,\n        {\n          aspects,\n          get: () => element.values,\n          set: (values: readonly string[]) => element.values = values,\n        },\n    );\n  }\n\n  protected listenForInput(\n      update: (input: InElement.Input<readonly string[]>) => void,\n  ): void {\n    this.events.on<MultiInputEvent>('conduit:input').to(event => {\n      update({ event, value: event.detail });\n    });\n  }\n\n}\n\nexport function inMultiInput(\n    element: MultiInputComponent.Element,\n    {\n      aspects,\n    }: {\n      readonly aspects?: InConverter.Aspect<readonly string[]> | readonly InConverter.Aspect<readonly string[]>[];\n    } = {},\n): MultiInputComponent.Control {\n  return new MultiInputControl(element, { aspects });\n}\n","import { css__naming, QualifiedName } from '@proc7ts/namespace-aliaser';\nimport { RenderExecution } from '@proc7ts/render-scheduler';\nimport {\n  ComponentClass,\n  ComponentContext,\n  ComponentDef,\n  ComponentProperty,\n  ComponentPropertyDecorator,\n  DefaultNamespaceAliaser,\n  ElementRenderer,\n  Render,\n  RenderDef,\n  RenderPath__root,\n} from '@wesib/wesib';\nimport { ApiErrorGenerator, RenderHTML } from '../../reusable';\nimport { ApiResponse } from '../api';\nimport { Conduit__NS } from '../conduit.ns';\nimport { LoaderComponent } from './loader.component';\n\nexport type LoadStatus =\n    | LoadStatus.Succeed\n    | LoadStatus.Failed;\n\nexport namespace LoadStatus {\n\n  export interface Succeed {\n    readonly ok: true;\n  }\n\n  export interface Failed {\n    readonly ok: false;\n    readonly errors: ApiResponse.Errors;\n  }\n\n}\n\nconst LoadStatus__symbol = (/*#__PURE__*/ Symbol('load-status'));\nconst defaultLoadedClass: QualifiedName = ['loaded', Conduit__NS];\n\nexport function RenderLoader<T extends ComponentClass>(\n    def: {\n      loaded?: QualifiedName;\n      render?: RenderDef.Spec;\n      comment?: string;\n    } = {},\n): ComponentPropertyDecorator<LoadStatus | undefined, T> {\n  return ComponentProperty(({ get, set: setValue, key }) => {\n\n    const {\n      render: renderSpec = {},\n      loaded = defaultLoadedClass,\n      comment = String(key),\n    } = def;\n    const path = [RenderPath__root, LoadStatus__symbol, key];\n    let loadedClassName: string;\n    const render = RenderDef.fulfill({ on: path }, renderSpec);\n\n    return {\n      componentDef: ComponentDef.all(\n          {\n            feature: {\n              needs: LoaderComponent,\n            },\n            define(defContext) {\n              loadedClassName = css__naming.name(loaded, defContext.get(DefaultNamespaceAliaser));\n              if (renderSpec.on) {\n                defContext.whenComponent(context => {\n                  RenderDef.trigger(context, renderSpec)\n                      .to(() => context.updateState(path, 'new', 'old'));\n                });\n              }\n            },\n          },\n          Render(render).As(updateClass, key),\n          RenderHTML({ render, comment: `LOADER(${comment})` }).As(renderLoader, key),\n          RenderHTML({ render, comment: `ERRORS(${comment})` }).As(renderErrors, key),\n      ),\n      get,\n      set(component, value) {\n\n        const prev = get(component);\n\n        setValue(component, value);\n        ComponentContext.of(component).updateState(path, value, prev);\n      },\n    };\n\n    function updateClass(this: InstanceType<T>): ElementRenderer {\n\n      const { element }: { element: Element } = ComponentContext.of(this);\n\n      return (execution: RenderExecution) => {\n\n        const status = get(this);\n\n        if (status && status.ok) {\n          // Make contents visible in the very end\n          execution.postpone(() => {\n            element.classList.add(loadedClassName);\n          });\n        } else {\n          element.classList.remove(loadedClassName);\n        }\n      };\n    }\n\n    function renderLoader(this: InstanceType<T>): Node | undefined {\n\n      const status = get(this);\n\n      return !status ? document.createElement('conduit-loader') : undefined;\n    }\n\n    function renderErrors(this: InstanceType<T>): Node | undefined {\n\n      const status = get(this);\n\n      return status && !status.ok\n          ? ComponentContext.of(this).get(ApiErrorGenerator)(status.errors)\n          : undefined;\n    }\n\n  });\n}\n"],"names":["LoaderComponent","[object Object]","_context","this","document","get","BootstrapWindow","range","createRange","selectNodeContents","contentRoot","deleteContents","loadError","insertNode","createTextNode","__decorate","Attribute","Render","Component","Conduit__NS","ApiErrorGenerator","FnContextKey","byDefault","bootstrapDefault","context","errors","list","key","messages","overEntries","createElement","classList","add","ul","forEach","message","li","innerText","appendChild","thisYearDateFormat","Intl","DateTimeFormat","month","day","otherYearFateFormat","year","formatDate","date","Date","getFullYear","format","RenderHTML","def","ComponentProperty","comment","String","render","componentDef","As","ComponentContext","of","start","createComment","end","setStartAfter","setEndBefore","html","call","node","innerHTML","content","PagingInfo__symbol","Symbol","RenderPager","renderOptions","set","path","RenderPath__root","RenderDef","fulfill","on","ComponentDef","all","pagingInfo","totalPages","info","visiblePages","currentPage","visible","Math","max","current","className","startPage","endPage","pageItem","page","text","enabled","active","link","setAttribute","pageHref","HandleNavLinks","component","value","prev","updateState","MultiInputEvent","CustomEvent","trailingSpace","MultiInputComponent","DeltaSet","input","_input","element","querySelector","onblur","onchange","_handleBlur","bind","oninput","_handleInput","onkeydown","_handleKeydown","datalist","_datalist","values","Array","from","_values","clear","delta","readonly","disabled","readOnly","removeAttribute","insertBefore","valueOption","match","option","overArray","options","valueItem","item","querySelectorAll","textContent","redelta","onclick","_delete","remove","delete","undelta","force","test","trim","_sendEvent","_add","event","length","domPropertyPathTo","dispatchEvent","bubbles","detail","DomProperty","AttributeChanged","AttachShadow","MultiInputControl","AbstractInElement","aspects","super","update","events","to","inMultiInput","LoadStatus__symbol","defaultLoadedClass","RenderLoader","setValue","renderSpec","loaded","loadedClassName","feature","needs","defContext","css__naming","name","DefaultNamespaceAliaser","whenComponent","trigger","execution","status","ok","postpone","undefined"],"mappings":"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"}