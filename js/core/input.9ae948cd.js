import{e}from"../lib/call-thru.00f7427a.js";import{A as t,j as s}from"../lib/a-iterable.a3fddd20.js";import{F as r}from"../lib/context-values.eef19512.js";import{e as a,n as o,d as n}from"../lib/fun-events.5ba1262f.js";import{b as c,B as i,p,R as l,C as u,r as m,t as d,F as f}from"../wesib/wesib.698f6f57.js";import{_ as h}from"../helpers.920c7f83.js";import{b,c as g,C as j,d as k,e as v,f as w,D as _,F as x,U as C}from"../wesib/generic.0655e5c8.js";import{e as y,f as F,g as O,h as E,j as D,k as R,l as U,m as $,n as A,o as B,p as L,a as M}from"../lib/input-aspects.3610fdda.js";import{C as T}from"../core.f6946162.js";function q({mark:t="is-invalid",when:s}={}){return r=>{const n=r.aspect(y);return a({status:r.aspect(F),validity:r.aspect(O)}).keep.thru(({status:[{touched:r,hasFocus:a}],validity:[c]})=>{const i=c.has("incomplete")||c.has("missing");return!r||a&&i?e():o(n.specs(E({mark:t,when:s})))})}}const z=new r("api-error-generator",{byDefault:c(e=>{const r=e.get(i).document;return e=>{let a;return t.from(s(e)).forEach(([e,t])=>{a||(a=r.createElement("ul"),a.classList.add("error-messages"));const s=a;t.forEach(t=>{const a=r.createElement("li");a.innerText=`${e} ${t}`,s.appendChild(a)})}),a}})}),G={};let H=class{constructor(t){this._context=t,this.errors=G,t.get(b).get(g).thru_(({control:t})=>t?o(t.aspect(O).read.keep.thru_(e=>e.messages("api").reduce((e,t)=>Object.assign(Object.assign({},e),t.api),G))):e(G))(e=>this.errors=e)}render(){const{contentRoot:e}=this._context;let t;return()=>{t&&(t.remove(),t=void 0),t=this._context.get(z)(this.errors),t&&e.append(t)}}};h([p()],H.prototype,"errors",void 0),h([l()],H.prototype,"render",null),H=h([u(["api-errors",T])],H);let I=class{};I=h([u(["in-error",T],m("code"),j(({control:{control:e},aspects:t,context:s})=>d(s,"code").read.keep.thru_(e=>e?e.trim().split(/\s+/):[]).keep.thru(r=>e.convert(D.to(s.element),t).setup(y,e=>{e.add(R()),e.add(q({when:r}))}))))],I);let J=class{};function K({emptyModel:e={},form:t={makeForm({node:t,aspects:s}){const r=$(e).setup(y,e=>e.add(R())).setup(A,e=>e.derive(B())),a=L(t.element,{form:r,aspects:s}).setup(y,e=>e.add(r.aspect(y)));return[r,a]}},button:s}={}){return u(x(t),function({select:e="button",pick:t={deep:!0,all:!0}}={}){return u({feature:{needs:k},define(s){s.whenComponent(s=>{const r=s.get(v),o=s.get(b);s.whenOn(n=>{a({form:o.get(w),button:r.select(e,t).first,aspects:s.get(_)}).tillOff(n).consume(({form:[{control:e}],button:[t],aspects:[s]})=>e&&t&&U(t.element,{form:e,aspects:s}))})})}})}(s))}function N(t){return C(Object.assign(Object.assign({},t),{makeControl:s=>s.context.get(b).get(w).keep.thru_(({form:r})=>{const a=t.makeControl(s);return a?a instanceof M?c(a):o(n(a).keep.thru_((t,s)=>t?(c(t),s?e(t,s):e(t)):e())):e();function c(e){r&&e.aspect(A).derive(r.aspect(A));const t=e.aspect(y);return t.add(R()),t.add(q()),e}})}))}J=h([f({needs:[H,I]})],J);export{J as C,K as F,N as U};//# sourceMappingURL=input.9ae948cd.js.map
