import{o as t,a as e}from"../proc7ts/push-iterator.a06e0e70.js";import{F as n}from"../proc7ts/context-values.be8ff8e3.js";import"../proc7ts/fun-events.b7373782.js";import{c as s}from"../proc7ts/namespace-aliaser.b34c0889.js";import{c as o,R as i,C as r,B as a,a as l,d,e as u,f as c,g as p,h,D as m,i as f,j as v,k as g,l as b}from"../wesib/wesib.8dbf8db7.js";import{_}from"../helpers.e1623395.js";import{d as x}from"../wesib/generic.ccc72a37.js";import{D as y}from"../proc7ts/delta-set.96431edd.js";import{A as E}from"../proc7ts/input-aspects.755a593b.js";import{C}from"../core.714cbb7b.js";let S=class{constructor(t){this._context=t}render(){const{document:t}=this._context.get(a),e=t.createRange();return e.selectNodeContents(this._context.contentRoot),()=>{e.deleteContents(),null!=this.loadError&&e.insertNode(t.createTextNode(this.loadError))}}};_([o("load-error")],S.prototype,"loadError",void 0),_([i()],S.prototype,"render",null),S=_([r(["loader",C])],S);const w=new n("api-error-generator",{byDefault:l((e=>{const n=e.get(a).document;return e=>{let s;for(const[o,i]of t(e)){s||(s=n.createElement("ul"),s.classList.add("error-messages"));const t=s;i.forEach((e=>{const s=n.createElement("li");s.innerText=`${o} ${e}`,t.appendChild(s)}))}return s}}))}),A=new Intl.DateTimeFormat("en-US",{month:"long",day:"numeric"}),k=new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"numeric"});function R(t){return((new Date).getFullYear()===t.getFullYear()?A:k).format(t)}function D(t={}){return d((({get:e,key:n})=>{const{comment:s=String(n),render:o}=t;return{componentDef:i(o).As((function(){const t=u.of(this),{document:n}=t.get(a),{contentRoot:o}=t,i=o.appendChild(n.createComment(`[${s}[`)),r=o.appendChild(n.createComment(`]${s}]`)),l=n.createRange();return l.setStartAfter(i),l.setEndBefore(r),()=>{l.deleteContents();const t=e(this).call(this);if(t)if("string"==typeof t){const e=n.createElement("template");e.innerHTML=t,l.insertNode(e.content)}else l.insertNode(t)}}),n)}}))}const j=Symbol("paging-info");function N(t={}){const{render:e}=t;return d((({get:t,set:n,key:s})=>{const o=[h,j,s],i=c.fulfill({on:o},e);return{componentDef:p.all(D({render:i,comment:`PAGER(${String(s)})`}).As((function(){const e=u.of(this),{document:n}=e.get(a),s=t(this);if(!s.totalPages||s.totalPages<=1)return;const o=s,{totalPages:i,visiblePages:r=5,currentPage:l=0}=o,d=Math.max(1,r),c=Math.max(0,l),p=n.createElement("ul");p.className="pagination";let h=Math.max(0,c-(d>>1)),m=h+d;m>i&&(h=Math.max(0,h-(m-i)),m=i);p.appendChild(f("<<",0,c>0)),p.appendChild(f("<",c-1,c>0));for(let t=h;t<m;++t)p.appendChild(f(String(t+1),t,!0,c===t));return p.appendChild(f(">",c+1,c+1<i)),p.appendChild(f(">>",i-1,c+1<i)),p;function f(t,e,s,i=!1){const r=n.createElement("li");let a;return r.className="page-item",s&&!i?(a=n.createElement("a"),a.setAttribute("href",o.pageHref(e))):(r.classList.add(i?"active":"disabled"),a=n.createElement("span")),a.className="page-link",a.innerHTML=t,r.appendChild(a),r}}),s),x()),get:t,set(e,s){const i=t(e);n(e,s),u.of(e).updateState(o,s,i)}}}))}class B extends CustomEvent{}const M=/\s$/;let L=class{constructor(t){this._context=t,this._values=new y}get input(){if(this._input)return this._input;const{element:t}=this._context;return this._input=t.querySelector("input"),this._input.onblur=this._input.onchange=this._handleBlur.bind(this),this._input.oninput=this._handleInput.bind(this),this._input.onkeydown=this._handleKeydown.bind(this),this._input}get datalist(){if(this._datalist)return this._datalist;const{element:t}=this._context;return this._datalist=t.querySelector("datalist"),this._datalist}get values(){return Array.from(this._values)}set values(t){this._values.clear(),this._values.delta(t||[])}get readonly(){return this.input.disabled||this.input.readOnly}setDisabled(t){null!=t?this.input.setAttribute("disabled",t):this.input.removeAttribute("disabled")}setReadonly(t){null!=t?this.input.setAttribute("readonly",t):this.input.removeAttribute("readonly")}render(){const{contentRoot:t,element:n}=this._context,{document:s}=this._context.get(a);t.innerHTML="<style>\n:host {\n  border: var(--multi-input-border, 1px solid #ddd);\n  display: block;\n  overflow: hidden;\n  padding: 5px;\n}\n/* NB use of pointer-events to only allow events from the \xd7 icon */\n::slotted(div.item) {\n  background-color: var(--multi-input-item-bg-color, #dedede);\n  border: var(--multi-input-item-border, 1px solid #ccc);\n  border-radius: 2px;\n  color: #222;\n  display: inline-block;\n  font-size: var(--multi-input-item-font-size, 14px);\n  margin: 5px;\n  padding: 2px 25px 2px 5px;\n  pointer-events: none;\n  position: relative;\n  top: -1px;\n}\n/* NB pointer-events: none above */\n::slotted(div.item:hover) {\n  background-color: #eee;\n  color: black;\n}\n::slotted(input) {\n  border: none;\n  font-size: var(--multi-input-input-font-size, 14px);\n  outline: none;\n  padding: 10px 10px 10px 5px;\n}\n</style>\n<slot></slot>",n.insertBefore(s.createComment("[ITEMS["),this.input);const o=n.insertBefore(s.createComment("]ITEMS]"),this.input),i=t=>{const n=t+" ";for(const t of e(this.datalist.options))if(t.value===n)return t},r=t=>{for(const s of e(n.querySelectorAll(".item")))if(s.textContent===t)return s};return()=>{this._values.redelta({add:t=>{var e;if(!r(t)){const e=s.createElement("div");e.className="item",e.textContent=t,e.onclick=()=>{this.readonly||this._delete(t)},n.insertBefore(e,o)}null===(e=i(t))||void 0===e||e.remove()},delete:t=>{var e;if(null===(e=r(t))||void 0===e||e.remove(),!i(t)){const e=s.createElement("option");e.value=t+" ",this.datalist.appendChild(e)}}}).undelta()}}_add(t,e=!1){(e||M.test(t))&&(t=t.trim())&&(this._values.add(t),this.input.value="",this._sendEvent())}_delete(t){this._values.delete(t),this._sendEvent()}_handleBlur(){const{value:t}=this.input;this.input.value="",this._add(t,!0)}_handleInput(){this._add(this.input.value)}_handleKeydown(t){if(this.input.value||"Backspace"!==t.key)this._add(this.input.value);else{const{values:t}=this;t.length&&this._delete(t[t.length-1])}}_sendEvent(){this._context.updateState(g("values"),this.values,this.values),this._context.dispatchEvent(new B("conduit:input",{bubbles:!0,detail:this.values}))}};_([m()],L.prototype,"values",null),_([f("disabled")],L.prototype,"setDisabled",null),_([f("readonly")],L.prototype,"setReadonly",null),_([i()],L.prototype,"render",null),L=_([r(["multi-input",C]),v()],L);class T extends E{constructor(t,{aspects:e}={}){super(t,{aspects:e,get:()=>t.values,set:e=>t.values=e})}listenForInput(t){this.events.on("conduit:input").to((e=>{t({event:e,value:e.detail})}))}}function $(t,{aspects:e}={}){return new T(t,{aspects:e})}const I=Symbol("load-status"),F=["loaded",C];function P(t={}){return d((({get:e,set:n,key:o})=>{const{render:r={},loaded:a=F,comment:l=String(o)}=t,d=[h,I,o];let m;const f=c.fulfill({on:d},r);return{componentDef:p.all({feature:{needs:S},define(t){m=s.name(a,t.get(b)),r.on&&t.whenComponent((t=>{c.trigger(t,r).to((()=>t.updateState(d,"new","old")))}))}},i(f).As((function(){const{element:t}=u.of(this);return n=>{const s=e(this);s&&s.ok?n.postpone((()=>{t.classList.add(m)})):t.classList.remove(m)}}),o),D({render:f,comment:`LOADER(${l})`}).As((function(){return e(this)?void 0:document.createElement("conduit-loader")}),o),D({render:f,comment:`ERRORS(${l})`}).As((function(){const t=e(this);return t&&!t.ok?u.of(this).get(w)(t.errors):void 0}),o)),get:e,set(t,s){const o=e(t);n(t,s),u.of(t).updateState(d,s,o)}}}))}export{w as A,S as L,L as M,D as R,P as a,N as b,R as f,$ as i};//# sourceMappingURL=loader.69b5ea90.js.map
