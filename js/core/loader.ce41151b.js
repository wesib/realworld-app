import{o as t,a as e}from"../proc7ts/a-iterable.3b78dc26.js";import{F as n}from"../proc7ts/context-values.7886ab40.js";import"../proc7ts/fun-events.c2220af5.js";import{c as s}from"../proc7ts/namespace-aliaser.b34c0889.js";import{A as o,R as i,C as r,B as a,a as l,c as d,d as u,D as c,e as p,f as h,g as m,h as v,i as f,j as _,k as b}from"../wesib/wesib.e7f21d38.js";import{_ as g}from"../helpers.e1623395.js";import{D as x}from"../proc7ts/delta-set.96431edd.js";import{A as y}from"../proc7ts/input-aspects.8d791286.js";import{C as E}from"../core.714cbb7b.js";let C=(()=>{let t=class{constructor(t){this._context=t}render(){const{document:t}=this._context.get(a),e=t.createRange();return e.selectNodeContents(this._context.contentRoot),()=>{e.deleteContents(),null!=this.loadError&&e.insertNode(t.createTextNode(this.loadError))}}};return g([o("load-error")],t.prototype,"loadError",void 0),g([i()],t.prototype,"render",null),t=g([r(["loader",E])],t),t})();const A=new n("api-error-generator",{byDefault:l(e=>{const n=e.get(a).document;return e=>{let s;for(const[o,i]of t(e)){s||(s=n.createElement("ul"),s.classList.add("error-messages"));const t=s;i.forEach(e=>{const s=n.createElement("li");s.innerText=`${o} ${e}`,t.appendChild(s)})}return s}})});function k(t={}){return d(({get:e,key:n})=>{const{comment:s=String(n),render:o}=t;return{componentDef:i(o).As((function(){const t=u.of(this),{document:n}=t.get(a),{contentRoot:o}=t,i=o.appendChild(n.createComment(`[${s}[`)),r=o.appendChild(n.createComment(`]${s}]`)),l=n.createRange();return l.setStartAfter(i),l.setEndBefore(r),()=>{l.deleteContents();const t=e(this).call(this);if(t)if("string"==typeof t){const e=n.createElement("template");e.innerHTML=t,l.insertNode(e.content)}else l.insertNode(t)}}),n)}})}class w extends CustomEvent{}const R=/\s$/;let S=(()=>{let t=class{constructor(t){this._context=t,this._values=new x}get input(){if(this._input)return this._input;const{element:t}=this._context;return this._input=t.querySelector("input"),this._input.onblur=this._input.onchange=this._handleBlur.bind(this),this._input.oninput=this._handleInput.bind(this),this._input.onkeydown=this._handleKeydown.bind(this),this._input}get datalist(){if(this._datalist)return this._datalist;const{element:t}=this._context;return this._datalist=t.querySelector("datalist"),this._datalist}get values(){return Array.from(this._values)}set values(t){this._values.clear(),this._values.delta(t||[])}get readonly(){return this.input.disabled||this.input.readOnly}setDisabled(t){null!=t?this.input.setAttribute("disabled",t):this.input.removeAttribute("disabled")}setReadonly(t){null!=t?this.input.setAttribute("readonly",t):this.input.removeAttribute("readonly")}render(){const{contentRoot:t,element:n}=this._context,{document:s}=this._context.get(a);t.innerHTML="<style>\n:host {\n  border: var(--multi-input-border, 1px solid #ddd);\n  display: block;\n  overflow: hidden;\n  padding: 5px;\n}\n/* NB use of pointer-events to only allow events from the \xd7 icon */\n::slotted(div.item) {\n  background-color: var(--multi-input-item-bg-color, #dedede);\n  border: var(--multi-input-item-border, 1px solid #ccc);\n  border-radius: 2px;\n  color: #222;\n  display: inline-block;\n  font-size: var(--multi-input-item-font-size, 14px);\n  margin: 5px;\n  padding: 2px 25px 2px 5px;\n  pointer-events: none;\n  position: relative;\n  top: -1px;\n}\n/* NB pointer-events: none above */\n::slotted(div.item:hover) {\n  background-color: #eee;\n  color: black;\n}\n::slotted(input) {\n  border: none;\n  font-size: var(--multi-input-input-font-size, 14px);\n  outline: none;\n  padding: 10px 10px 10px 5px;\n}\n</style>\n<slot></slot>",n.insertBefore(s.createComment("[ITEMS["),this.input);const o=n.insertBefore(s.createComment("]ITEMS]"),this.input),i=t=>{const n=t+" ";for(const t of e(this.datalist.options))if(t.value===n)return t},r=t=>{for(const s of e(n.querySelectorAll(".item")))if(s.textContent===t)return s};return()=>{this._values.redelta({add:t=>{var e;if(!r(t)){const e=s.createElement("div");e.className="item",e.textContent=t,e.onclick=()=>{this.readonly||this._delete(t)},n.insertBefore(e,o)}null===(e=i(t))||void 0===e||e.remove()},delete:t=>{var e;if(null===(e=r(t))||void 0===e||e.remove(),!i(t)){const e=s.createElement("option");e.value=t+" ",this.datalist.appendChild(e)}}}).undelta()}}_add(t,e=!1){(e||R.test(t))&&(t=t.trim())&&(this._values.add(t),this.input.value="",this._sendEvent())}_delete(t){this._values.delete(t),this._sendEvent()}_handleBlur(){const{value:t}=this.input;this.input.value="",this._add(t,!0)}_handleInput(){this._add(this.input.value)}_handleKeydown(t){if(this.input.value||"Backspace"!==t.key)this._add(this.input.value);else{const{values:t}=this;t.length&&this._delete(t[t.length-1])}}_sendEvent(){this._context.updateState(m("values"),this.values,this.values),this._context.dispatchEvent(new w("conduit:input",{bubbles:!0,detail:this.values}))}};return g([c()],t.prototype,"values",null),g([p("disabled")],t.prototype,"setDisabled",null),g([p("readonly")],t.prototype,"setReadonly",null),g([i()],t.prototype,"render",null),t=g([r(["multi-input",E]),h()],t),t})();class j extends y{constructor(t,{aspects:e}={}){super(t,{aspects:e,get:()=>t.values,set:e=>t.values=e})}listenForInput(t){this.events.on("conduit:input").to(e=>{t({event:e,value:e.detail})})}}function B(t,{aspects:e}={}){return new j(t,{aspects:e})}const D=Symbol("load-status"),N=["loaded",E];function L(t={}){return d(({get:e,set:n,key:o})=>{const{render:r={},loaded:a=N,comment:l=String(o)}=t,d=[b,D,o];let c;const p=v.fulfill({on:d},r);return{componentDef:f.all({feature:{needs:C},define(t){c=s.name(a,t.get(_)),r.on&&t.whenComponent(t=>{v.trigger(t,r).to(()=>t.updateState(d,"new","old"))})}},i(p).As((function(){const{element:t}=u.of(this);return n=>{const s=e(this);s&&s.ok?n.postpone(()=>{t.classList.add(c)}):t.classList.remove(c)}}),o),k({render:p,comment:`LOADER(${l})`}).As((function(){return e(this)?void 0:document.createElement("conduit-loader")}),o),k({render:p,comment:`ERRORS(${l})`}).As((function(){const t=e(this);return t&&!t.ok?u.of(this).get(A)(t.errors):void 0}),o)),get:e,set(t,s){const o=e(t);n(t,s),u.of(t).updateState(d,s,o)}}})}export{A,C as L,S as M,k as R,L as a,B as i};//# sourceMappingURL=loader.ce41151b.js.map
