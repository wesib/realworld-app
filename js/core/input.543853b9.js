import{n as e}from"../proc7ts/call-thru.3702f6af.js";import{g as t,b as s,f as r}from"../proc7ts/fun-events.fad06cca.js";import{S as o,R as a,C as n,A as c,t as p,F as i}from"../wesib/wesib.5f0eb508.js";import{_ as u}from"../helpers.e1623395.js";import{a as m,I as d,C as l,b as f,c as h,D as b,F as g,U as k}from"../wesib/generic.be8d84ee.js";import{a as v,b as j,c as _,i as w,d as C,e as x,f as T,g as y,h as F,j as A,k as R,l as U}from"../proc7ts/input-aspects.fc03f42a.js";import{C as D}from"../core.714cbb7b.js";import{A as I}from"./loader.2f3c1647.js";function M({mark:r="is-invalid",when:o}={}){return a=>{const n=a.aspect(v);return t({status:a.aspect(j),validity:a.aspect(_)}).keepThru((({status:[{touched:t,hasFocus:a}],validity:[c]})=>{const p=c.has("incomplete")||c.has("missing");return!t||a&&p?e():s(n.specs(w({mark:r,when:o})))}))}}const O={};let S=class{constructor(t){this._context=t,this.errors=O,t.get(m).get(d).thru_((({control:t})=>t?s(t.aspect(_).read().keepThru_((e=>e.messages("api").reduce(((e,t)=>({...e,...t.api})),O)))):e(O))).to((e=>this.errors=e))}render(){const{contentRoot:e}=this._context;let t;return()=>{t&&(t.remove(),t=void 0),t=this._context.get(I)(this.errors),t&&e.append(t)}}};u([o()],S.prototype,"errors",void 0),u([a()],S.prototype,"render",null),S=u([n(["api-errors",D])],S);let q=class{};q=u([n(["in-error",D],c("code"),l((({control:{control:e},aspects:t,context:s})=>p(s,"code").read().keepThru_((e=>e?e.trim().split(/\s+/):[])).keepThru((r=>e.convert(C.to(s.element),t).setup(v,(e=>{e.add(x()),e.add(M({when:r}))})))))))],q);let z=class{};function B({emptyModel:e={},form:s={makeForm({node:t,aspects:s}){const r=y(e).setup(v,(e=>e.add(x()))).setup(F,(e=>e.derive(A()))),o=R(t.element,{form:r,aspects:s}).setup(v,(e=>e.add(r.aspect(v))));return[r,o]}},button:r}={}){return n(g(s),function({select:e="button",pick:s={deep:!0,all:!0}}={}){return n({define(r){r.whenComponent((r=>{const o=r.get(f),a=r.get(m);r.whenConnected((()=>{t({form:a.get(h),button:o.select(e,s).first(),aspects:r.get(b)}).tillOff(r).consume((({form:[{control:e}],button:[t],aspects:[s]})=>e&&t&&T(t.element,{form:e,aspects:s})))}))}))}})}(r))}function E(t){return k({...t,makeControl:o=>o.context.get(m).get(h).keepThru_((({form:a})=>{const n=t.makeControl(o);return n?n instanceof U?c(n):s(r(n).keepThru_(((t,s)=>t?(c(t),s?e(t,s):e(t)):e()))):e();function c(e){a&&e.aspect(F).derive(a.aspect(F));const t=e.aspect(v);return t.add(x()),t.add(M()),e}}))})}z=u([i({needs:[S,q]})],z);export{z as C,B as F,E as U};//# sourceMappingURL=input.543853b9.js.map
