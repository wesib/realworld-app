import{A as t,o as e,a as n}from"../proc7ts/a-iterable.d8c0bd88.js";import{F as s}from"../proc7ts/context-values.4cd072ea.js";import"../proc7ts/fun-events.acc4e246.js";import{c as o}from"../proc7ts/namespace-aliaser.1d67b636.js";import{c as i,R as r,C as a,B as l,a as d,d as u,e as c,D as p,f as h,g as m,h as v,i as f,j as _}from"../wesib/wesib.3bdcccfe.js";import{_ as b}from"../helpers.920c7f83.js";import{D as x}from"../proc7ts/delta-set.d9ebb9ee.js";import{A as g}from"../proc7ts/input-aspects.9967e50d.js";import{C as y}from"../core.c852ba8c.js";let E=class{constructor(t){this._context=t}render(){const{document:t}=this._context.get(l),e=t.createRange();return e.selectNodeContents(this._context.contentRoot),()=>{e.deleteContents(),null!=this.loadError&&e.insertNode(t.createTextNode(this.loadError))}}};b([i("load-error")],E.prototype,"loadError",void 0),b([r()],E.prototype,"render",null),E=b([a(["loader",y])],E);const C=new s("api-error-generator",{byDefault:d(n=>{const s=n.get(l).document;return n=>{let o;return t.from(e(n)).forEach(([t,e])=>{o||(o=s.createElement("ul"),o.classList.add("error-messages"));const n=o;e.forEach(e=>{const o=s.createElement("li");o.innerText=`${t} ${e}`,n.appendChild(o)})}),o}})});function A(t={}){return u(({get:e,key:n})=>{const{comment:s=String(n),path:o}=t;return{componentDef:r({path:o}).As((function(){const t=c.of(this),{document:n}=t.get(l),{contentRoot:o}=t,i=o.appendChild(n.createComment(`[${s}[`)),r=o.appendChild(n.createComment(`]${s}]`)),a=n.createRange();return a.setStartAfter(i),a.setEndBefore(r),()=>{a.deleteContents();const t=e(this).call(this);if(t)if("string"==typeof t){const e=n.createElement("template");e.innerHTML=t,a.insertNode(e.content)}else a.insertNode(t)}}),n)}})}class k extends CustomEvent{}const R=/\s$/;let S=class{constructor(t){this._context=t,this._values=new x}get input(){if(this._input)return this._input;const{element:t}=this._context;return this._input=t.querySelector("input"),this._input.onblur=this._input.onchange=this._handleBlur.bind(this),this._input.oninput=this._handleInput.bind(this),this._input.onkeydown=this._handleKeydown.bind(this),this._input}get datalist(){if(this._datalist)return this._datalist;const{element:t}=this._context;return this._datalist=t.querySelector("datalist"),this._datalist}get values(){return Array.from(this._values)}set values(t){this._values.clear(),this._values.delta(t||[])}get readonly(){return this.input.disabled||this.input.readOnly}setDisabled(t){null!=t?this.input.setAttribute("disabled",t):this.input.removeAttribute("disabled")}setReadonly(t){null!=t?this.input.setAttribute("readonly",t):this.input.removeAttribute("readonly")}render(){const{contentRoot:t,element:e}=this._context,{document:s}=this._context.get(l);t.innerHTML="<style>\n:host {\n  border: var(--multi-input-border, 1px solid #ddd);\n  display: block;\n  overflow: hidden;\n  padding: 5px;\n}\n/* NB use of pointer-events to only allow events from the \xd7 icon */\n::slotted(div.item) {\n  background-color: var(--multi-input-item-bg-color, #dedede);\n  border: var(--multi-input-item-border, 1px solid #ccc);\n  border-radius: 2px;\n  color: #222;\n  display: inline-block;\n  font-size: var(--multi-input-item-font-size, 14px);\n  margin: 5px;\n  padding: 2px 25px 2px 5px;\n  pointer-events: none;\n  position: relative;\n  top: -1px;\n}\n/* NB pointer-events: none above */\n::slotted(div.item:hover) {\n  background-color: #eee;\n  color: black;\n}\n::slotted(input) {\n  border: none;\n  font-size: var(--multi-input-input-font-size, 14px);\n  outline: none;\n  padding: 10px 10px 10px 5px;\n}\n</style>\n<slot></slot>",e.insertBefore(s.createComment("[ITEMS["),this.input);const o=e.insertBefore(s.createComment("]ITEMS]"),this.input),i=t=>{const e=t+" ";for(const t of n(this.datalist.options))if(t.value===e)return t},r=t=>{for(const s of n(e.querySelectorAll(".item")))if(s.textContent===t)return s};return()=>{this._values.redelta({add:t=>{var n;if(!r(t)){const n=s.createElement("div");n.className="item",n.textContent=t,n.onclick=()=>{this.readonly||this._delete(t)},e.insertBefore(n,o)}null===(n=i(t))||void 0===n||n.remove()},delete:t=>{var e;if(null===(e=r(t))||void 0===e||e.remove(),!i(t)){const e=s.createElement("option");e.value=t+" ",this.datalist.appendChild(e)}}}).undelta()}}_add(t,e=!1){(e||R.test(t))&&(t=t.trim())&&(this._values.add(t),this.input.value="",this._sendEvent())}_delete(t){this._values.delete(t),this._sendEvent()}_handleBlur(){const{value:t}=this.input;this.input.value="",this._add(t,!0)}_handleInput(){this._add(this.input.value)}_handleKeydown(t){if(this.input.value||"Backspace"!==t.key)this._add(this.input.value);else{const{values:t}=this;t.length&&this._delete(t[t.length-1])}}_sendEvent(){this._context.updateState(v("values"),this.values,this.values),this._context.dispatchEvent(new k("conduit:input",{bubbles:!0,detail:this.values}))}};b([p()],S.prototype,"values",null),b([h("disabled")],S.prototype,"setDisabled",null),b([h("readonly")],S.prototype,"setReadonly",null),b([r()],S.prototype,"render",null),S=b([a(["multi-input",y]),m()],S);class w extends g{constructor(t,{aspects:e}={}){super(t,{aspects:e,get:()=>t.values,set:e=>t.values=e})}listenForInput(t){this.events.on("conduit:input").to(e=>{t({event:e,value:e.detail})})}}function j(t,{aspects:e}={}){return new w(t,{aspects:e})}const B=Symbol("load-status"),D=["loaded",y];function N(t={}){return u(({get:e,set:n,key:s})=>{const{path:i=[B,s],loaded:a=D,comment:l=String(s)}=t;let d;return{componentDef:f.all({feature:{needs:E},define(t){d=o.name(a,t.get(_))}},r({path:i}).As((function(){const{element:t}=c.of(this);return n=>{const s=e(this);s&&s.ok?n.postpone(()=>{t.classList.add(d)}):t.classList.remove(d)}}),s),A({path:i,comment:`LOADER(${l})`}).As((function(){return e(this)?void 0:document.createElement("conduit-loader")}),s),A({path:i,comment:`ERRORS(${l})`}).As((function(){const t=e(this);return t&&!t.ok?c.of(this).get(C)(t.errors):void 0}),s)),get:e,set(t,s){const o=e(t);n(t,s),c.of(t).updateState(i,s,o)}}})}export{E as L,S as M,A as R,N as a,j as i};//# sourceMappingURL=loader.200fc290.js.map
