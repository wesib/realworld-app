import{_ as t}from"../helpers.e1623395.js";import{F as s}from"../wesib/wesib.c496f508.js";import{a as e}from"../proc7ts/context-values.24d38e04.js";import{V as r,t as a,f as o,a as i,g as n,e as c,h as p,i as h}from"../proc7ts/fun-events.3257bf57.js";import{a as u}from"../proc7ts/primitives.38e5298b.js";import{A as l}from"./api.51544e65.js";import"../frontmeans/input-aspects.f8acf040.js";import"../proc7ts/workbench.31425b55.js";import{n as f}from"../proc7ts/call-thru.f4f68410.js";import{i as d,t as m}from"../proc7ts/push-iterator.c8328864.js";const g=["feed","tag","author","favorited","limit","offset"];function b(t,s){return g.every((e=>t[e]===s[e]))}function j(t){const s=new URLSearchParams;return d(m(g,(t=>"feed"!==t?t:f),(s=>{const e=t[s];return e?[s,String(e)]:f})),(([t,e])=>s.set(t,e))),s}const y={};class _ extends r{constructor(){super(...arguments),this._it=a(y)}get supply(){return this._it.supply}get it(){return this._it.it}set it(t){this._it.it=t}get on(){return this._it.on}set(t){this.it=this.cast(t)}byArticles(t){return this.by(o(t).do(i((t=>this.cast(t)))))}cast(t){return t.slug?{...t,update:t=>this.set(t)}:y}}const v={list:[],count:0,bySlug:t=>y},w=new e("feed-service"),A={"/personal-feed":{path:"articles/feed",auth:!0},"/global-feed":{path:"articles"}};class F{constructor(t){let s;this._apiFetch=t.get(l),this.tags=n((t=>{if(!s){const t={path:"tags",init:{method:"GET",headers:{Accept:"application/json"}},respondAs:"tags",auth:!1},e=this._apiFetch(t).do(i((t=>t.ok?t.body:(console.error("Failed to load tags",t.errors),[])))),r=c(p(e,(()=>[])));s=r.read.do(h(((t,s)=>s&&t(...s))))}s(t)}))}articles(t){const{path:s,auth:e}=A[t.feed||"/global-feed"],r={path:`${s}?${j(t)}`,init:{method:"GET",headers:{Accept:"application/json"}},auth:e,respondAs:u};return this._apiFetch(r).do(i((t=>{if(!t.ok)return t;const{articles:s,articlesCount:e}=t.body,r=new Map(s.map((t=>[t.slug,t])));return{ok:!0,response:t.response,body:{list:s,count:e,bySlug:t=>r.get(t)||y}}})))}}let k=class{};k=t([s({setup(t){t.provide({a:w,as:F})}})],k);export{_ as C,w as F,k as a,v as b,b as c,j as f,y as n};//# sourceMappingURL=feed.d56f0914.js.map
