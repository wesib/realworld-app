import{n as e}from"../proc7ts/call-thru.ea70618a.js";import{A as t,o as s}from"../proc7ts/a-iterable.4d42c117.js";import{F as r}from"../proc7ts/context-values.ec10addc.js";import{g as a,b as o,f as n}from"../proc7ts/fun-events.6f8cd792.js";import{a as c,B as i,S as p,R as u,C as d,A as m,t as l,F as f}from"../wesib/wesib.b26c9eb2.js";import{_ as h}from"../helpers.920c7f83.js";import{a as b,I as g,C as j,b as k,c as v,d as w,D as C,F as _,U as x}from"../wesib/generic.69ca2bbe.js";import{a as T,b as y,c as F,i as O,d as E,e as A,f as D,g as R,h as U,j as $,k as B,l as I}from"../proc7ts/input-aspects.5b6ecf1e.js";import{C as L}from"../core.c852ba8c.js";function M({mark:t="is-invalid",when:s}={}){return r=>{const n=r.aspect(T);return a({status:r.aspect(y),validity:r.aspect(F)}).keepThru(({status:[{touched:r,hasFocus:a}],validity:[c]})=>{const i=c.has("incomplete")||c.has("missing");return!r||a&&i?e():o(n.specs(O({mark:t,when:s})))})}}const S=new r("api-error-generator",{byDefault:c(e=>{const r=e.get(i).document;return e=>{let a;return t.from(s(e)).forEach(([e,t])=>{a||(a=r.createElement("ul"),a.classList.add("error-messages"));const s=a;t.forEach(t=>{const a=r.createElement("li");a.innerText=`${e} ${t}`,s.appendChild(a)})}),a}})}),q={};let z=class{constructor(t){this._context=t,this.errors=q,t.get(b).get(g).thru_(({control:t})=>t?o(t.aspect(F).read().keepThru_(e=>e.messages("api").reduce((e,t)=>Object.assign(Object.assign({},e),t.api),q))):e(q)).to(e=>this.errors=e)}render(){const{contentRoot:e}=this._context;let t;return()=>{t&&(t.remove(),t=void 0),t=this._context.get(S)(this.errors),t&&e.append(t)}}};h([p()],z.prototype,"errors",void 0),h([u()],z.prototype,"render",null),z=h([d(["api-errors",L])],z);let G=class{};G=h([d(["in-error",L],m("code"),j(({control:{control:e},aspects:t,context:s})=>l(s,"code").read().keepThru_(e=>e?e.trim().split(/\s+/):[]).keepThru(r=>e.convert(E.to(s.element),t).setup(T,e=>{e.add(A()),e.add(M({when:r}))}))))],G);let H=class{};function J({emptyModel:e={},form:t={makeForm({node:t,aspects:s}){const r=R(e).setup(T,e=>e.add(A())).setup(U,e=>e.derive($())),a=B(t.element,{form:r,aspects:s}).setup(T,e=>e.add(r.aspect(T)));return[r,a]}},button:s}={}){return d(_(t),function({select:e="button",pick:t={deep:!0,all:!0}}={}){return d({feature:{needs:k},define(s){s.whenComponent(s=>{const r=s.get(v),o=s.get(b);s.whenConnected(()=>{a({form:o.get(w),button:r.select(e,t).first(),aspects:s.get(C)}).tillOff(s).consume(({form:[{control:e}],button:[t],aspects:[s]})=>e&&t&&D(t.element,{form:e,aspects:s}))})})}})}(s))}function K(t){return x(Object.assign(Object.assign({},t),{makeControl:s=>s.context.get(b).get(w).keepThru_(({form:r})=>{const a=t.makeControl(s);return a?a instanceof I?c(a):o(n(a).keepThru_((t,s)=>t?(c(t),s?e(t,s):e(t)):e())):e();function c(e){r&&e.aspect(U).derive(r.aspect(U));const t=e.aspect(T);return t.add(A()),t.add(M()),e}})}))}H=h([f({needs:[z,G]})],H);export{H as C,J as F,K as U};//# sourceMappingURL=input.6d95c6c7.js.map
