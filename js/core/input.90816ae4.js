import{n as t}from"../proc7ts/call-thru.f6384421.js";import{o as e,a as s}from"../proc7ts/a-iterable.78b6d519.js";import{F as n}from"../proc7ts/context-values.3377d707.js";import{g as o,b as i,f as r}from"../proc7ts/fun-events.1cfe5573.js";import{a,B as l,D as u,A as d,R as c,C as p,c as h,d as m,S as v,e as f,t as b,F as _}from"../wesib/wesib.156124a1.js";import{_ as g}from"../helpers.920c7f83.js";import{a as x,I as y,C as k,b as w,c as j,d as C,D as E,F as T,U as A}from"../wesib/generic.b5c5f449.js";import{D as B}from"../proc7ts/delta-set.d9ebb9ee.js";import{A as F,a as S,b as D,c as I,i as O,d as M,e as R,f as z,g as q,h as N,j as $,k as K,l as L}from"../proc7ts/input-aspects.cfc99431.js";import{C as U}from"../core.c852ba8c.js";const H=new n("api-error-generator",{byDefault:a(t=>{const s=t.get(l).document;return t=>{let n;for(const[o,i]of e(t)){n||(n=s.createElement("ul"),n.classList.add("error-messages"));const t=n;i.forEach(e=>{const n=s.createElement("li");n.innerText=`${o} ${e}`,t.appendChild(n)})}return n}})});class G extends CustomEvent{}const J=/\s$/;let P=class{constructor(t){this._context=t,this._values=new B}get input(){if(this._input)return this._input;const{element:t}=this._context;return this._input=t.querySelector("input"),this._input.onblur=this._input.onchange=this._handleBlur.bind(this),this._input.oninput=this._handleInput.bind(this),this._input.onkeydown=this._handleKeydown.bind(this),this._input}get datalist(){if(this._datalist)return this._datalist;const{element:t}=this._context;return this._datalist=t.querySelector("datalist"),this._datalist}get values(){return Array.from(this._values)}set values(t){this._values.clear(),this._values.delta(t||[])}get readonly(){return this.input.disabled||this.input.readOnly}setDisabled(t){null!=t?this.input.setAttribute("disabled",t):this.input.removeAttribute("disabled")}setReadonly(t){null!=t?this.input.setAttribute("readonly",t):this.input.removeAttribute("readonly")}render(){const{contentRoot:t,element:e}=this._context,{document:n}=this._context.get(l);t.innerHTML="<style>\n:host {\n  border: var(--multi-input-border, 1px solid #ddd);\n  display: block;\n  overflow: hidden;\n  padding: 5px;\n}\n/* NB use of pointer-events to only allow events from the \xd7 icon */\n::slotted(div.item) {\n  background-color: var(--multi-input-item-bg-color, #dedede);\n  border: var(--multi-input-item-border, 1px solid #ccc);\n  border-radius: 2px;\n  color: #222;\n  display: inline-block;\n  font-size: var(--multi-input-item-font-size, 14px);\n  margin: 5px;\n  padding: 2px 25px 2px 5px;\n  pointer-events: none;\n  position: relative;\n  top: -1px;\n}\n/* NB pointer-events: none above */\n::slotted(div.item:hover) {\n  background-color: #eee;\n  color: black;\n}\n::slotted(input) {\n  border: none;\n  font-size: var(--multi-input-input-font-size, 14px);\n  outline: none;\n  padding: 10px 10px 10px 5px;\n}\n</style>\n<slot></slot>",e.insertBefore(n.createComment("[ITEMS["),this.input);const o=e.insertBefore(n.createComment("]ITEMS]"),this.input),i=t=>{const e=t+" ";for(const t of s(this.datalist.options))if(t.value===e)return t},r=t=>{for(const n of s(e.querySelectorAll(".item")))if(n.textContent===t)return n};return()=>{this._values.redelta({add:t=>{var s;if(!r(t)){const s=n.createElement("div");s.className="item",s.textContent=t,s.onclick=()=>{this.readonly||this._delete(t)},e.insertBefore(s,o)}null===(s=i(t))||void 0===s||s.remove()},delete:t=>{var e;if(null===(e=r(t))||void 0===e||e.remove(),!i(t)){const e=n.createElement("option");e.value=t+" ",this.datalist.appendChild(e)}}}).undelta()}}_add(t,e=!1){(e||J.test(t))&&(t=t.trim())&&(this._values.add(t),this.input.value="",this._sendEvent())}_delete(t){this._values.delete(t),this._sendEvent()}_handleBlur(){const{value:t}=this.input;this.input.value="",this._add(t,!0)}_handleInput(){this._add(this.input.value)}_handleKeydown(t){if(this.input.value||"Backspace"!==t.key)this._add(this.input.value);else{const{values:t}=this;t.length&&this._delete(t[t.length-1])}}_sendEvent(){this._context.updateState(m("values"),this.values,this.values),this._context.dispatchEvent(new G("conduit:input",{bubbles:!0,detail:this.values}))}};g([u()],P.prototype,"values",null),g([d("disabled")],P.prototype,"setDisabled",null),g([d("readonly")],P.prototype,"setReadonly",null),g([c()],P.prototype,"render",null),P=g([p(["multi-input",U]),h()],P);class Q extends F{constructor(t,{aspects:e}={}){super(t,{aspects:e,get:()=>t.values,set:e=>t.values=e})}listenForInput(t){this.events.on("conduit:input").to(e=>{t({event:e,value:e.detail})})}}function V(t,{aspects:e}={}){return new Q(t,{aspects:e})}function W({mark:e="is-invalid",when:s}={}){return n=>{const r=n.aspect(S);return o({status:n.aspect(D),validity:n.aspect(I)}).keepThru(({status:[{touched:n,hasFocus:o}],validity:[a]})=>{const l=a.has("incomplete")||a.has("missing");return!n||o&&l?t():i(r.specs(O({mark:e,when:s})))})}}const X={};let Y=class{constructor(e){this._context=e,this.errors=X,e.get(x).get(y).thru_(({control:e})=>e?i(e.aspect(I).read().keepThru_(t=>t.messages("api").reduce((t,e)=>Object.assign(Object.assign({},t),e.api),X))):t(X)).to(t=>this.errors=t)}render(){const{contentRoot:t}=this._context;let e;return()=>{e&&(e.remove(),e=void 0),e=this._context.get(H)(this.errors),e&&t.append(e)}}};g([v()],Y.prototype,"errors",void 0),g([c()],Y.prototype,"render",null),Y=g([p(["api-errors",U])],Y);let Z=class{};Z=g([p(["in-error",U],f("code"),k(({control:{control:t},aspects:e,context:s})=>b(s,"code").read().keepThru_(t=>t?t.trim().split(/\s+/):[]).keepThru(n=>t.convert(M.to(s.element),e).setup(S,t=>{t.add(R()),t.add(W({when:n}))}))))],Z);let tt=class{};function et({emptyModel:t={},form:e={makeForm({node:e,aspects:s}){const n=q(t).setup(S,t=>t.add(R())).setup(N,t=>t.derive($())),o=K(e.element,{form:n,aspects:s}).setup(S,t=>t.add(n.aspect(S)));return[n,o]}},button:s}={}){return p(T(e),function({select:t="button",pick:e={deep:!0,all:!0}}={}){return p({feature:{needs:w},define(s){s.whenComponent(s=>{const n=s.get(j),i=s.get(x);s.whenConnected(()=>{o({form:i.get(C),button:n.select(t,e).first(),aspects:s.get(E)}).tillOff(s).consume(({form:[{control:t}],button:[e],aspects:[s]})=>t&&e&&z(e.element,{form:t,aspects:s}))})})}})}(s))}function st(e){return A(Object.assign(Object.assign({},e),{makeControl:s=>s.context.get(x).get(C).keepThru_(({form:n})=>{const o=e.makeControl(s);return o?o instanceof L?a(o):i(r(o).keepThru_((e,s)=>e?(a(e),s?t(e,s):t(e)):t())):t();function a(t){n&&t.aspect(N).derive(n.aspect(N));const e=t.aspect(S);return e.add(R()),e.add(W()),t}})}))}tt=g([_({needs:[Y,Z]})],tt);export{H as A,tt as C,et as F,P as M,st as U,V as i};//# sourceMappingURL=input.90816ae4.js.map
