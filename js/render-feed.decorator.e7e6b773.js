import{n as e}from"./lib/call-thru.00f7427a.js";import{d as t,a as s,S as r}from"./lib/context-values.956fc686.js";import{t as n,e as a,k as i}from"./lib/fun-events.a21352be.js";import{r as o,R as c,C as l,p as f,B as p,l as u,o as d,d as h}from"./wesib/wesib.e063c4fa.js";import{_ as g}from"./helpers.920c7f83.js";import{P as m,c as v,a as b,b as w,N as _}from"./wesib/generic.2d4b9745.js";import{C as y}from"./core.f6946162.js";import{b as C,a as j}from"./core/loader.0815288f.js";import{e as P}from"./core/util.4298e8ae.js";import{A as q,C as O}from"./article-meta-components-support.feature.24e84606.js";import{f as R,F as x,a as D,b as E}from"./core/feed.dc3f6a2d.js";const k=new class extends m{create(e,t){const s=this.byDefault(e);return s.put(t),s}byDefault(e){return{get(){const{searchParams:t,pathname:s}=e.get(v);return{feed:"/personal-feed"===s?s:void 0,tag:t.get("tag")||void 0,limit:parseInt(t.get("limit")||"",10)||void 0,offset:parseInt(t.get("offset")||"",10)||void 0}},put(t){const{feed:s}=t,r=new URL(e.get(v).href);r.pathname="/personal-feed"===s?s:"";const n=R(t).toString();r.search=n?"?"+n:"",e.put(v,r)}}}};let A=class{constructor(e){this._context=e,this._article=n({});const t=e.get(w);e.whenOn(e=>{const s=t.provide({a:O,is:this._article.read});e.whenOff(s)})}get article(){return this._article.it}set article(e){this._article.it=e}render(){if(!this.article.slug)return;const e=this._context.contentRoot,t=`article/#/${encodeURIComponent(this.article.slug)}`;e.innerHTML=`\n<div class="post-meta">\n<conduit-article-author></conduit-article-author>\n<conduit-favorite-post></conduit-favorite-post>\n</div>\n<a href="${t}" class="preview-link">\n<h1>${P(this.article.title)}</h1>\n<p class="post-content">${P(this.article.description)}</p>\n<span>Read more...</span>\n</a>\n`}};g([o({propertyKey:"feedArticle"})],A.prototype,"article",null),g([c({offline:!0})],A.prototype,"render",null),A=g([l(["article-preview",y],{feature:{needs:[q]}},b({href(e){let t=e.target;for(;;){const e=t.getAttribute("href");if(null!=e)return e;const{parentNode:s}=t;if(!s)return;t=s}}}))],A);const S=new t("feed-article-list",{byDefault:()=>({articles:[],articlesCount:0})});let $=class{constructor(e){this._context=e,this.articles={articles:[],articlesCount:0};const t=e.get(w);e.whenOn(e=>{t.get(S).tillOff(e)(e=>this.articles=e)})}render(){const e=this._context.get(p).document,t=e.createRange();return t.selectNodeContents(this._context.contentRoot),()=>{if(t.deleteContents(),!this.articles.articlesCount)return;const s=e.createDocumentFragment();this.articles.articles.forEach(t=>{s.appendChild(e.createElement("conduit-article-preview")).feedArticle=t}),t.insertNode(s)}}};g([f()],$.prototype,"articles",void 0),g([c()],$.prototype,"render",null),$=g([l(["article-list",y],{feature:{needs:A}})],$);const N=new t("feed-request-page-param",{byDefault:()=>k});let F=class{constructor(e){this._feedPaging={};const t=e.get(w),s=e.get(_);e.whenOn(e=>{a({param:t.get(N),page:s,list:t.get(S)}).tillOff(e)(({param:[e],page:[t],list:[{articlesCount:r}]})=>{const n=t.get(e),{limit:a=20,offset:i=0}=n;this.feedPaging={totalPages:Math.ceil(r/a),currentPage:Math.floor(i/a),pageHref(t){var r;return(null===(r=s.with(e,Object.assign(Object.assign({},n),{offset:a*t})).pretend())||void 0===r?void 0:r.url.href)||""}}})})}get feedPaging(){return this._feedPaging}set feedPaging(e){this._feedPaging=e}};g([C()],F.prototype,"feedPaging",null),F=g([l(["feed-pager",y])],F);const I=new r("render-feed-state"),M=Symbol("render-feed-state");class B{constructor(e,t){this.response=n(),this._request=n({});const s=e.get(D);this.response.on((s,r)=>e.updateState(t,s,r)),e.get(w).provide({a:S,is:this.response.read.keep.thru_(e=>(null==e?void 0:e.ok)?e.body:{articles:[],articlesCount:0})}),e.whenOn(e=>{this._request.read.tillOff(e).thru_(e=>(this.response.it=void 0,i(s.articles(e))))(e=>this.response.it=e)})}static get[s](){return I}get request(){return this._request.it}set request(e){const t=this.request;E(e,t)||(this._request.it=e)}}function H({requestParam:t}={}){return u(({get:s,set:r,key:n})=>{const a=[M,n];return{componentDef:d.all({feature:{needs:[$,F,x]},define(e){e.perComponent({a:B,by:e=>new B(e,a)}),t&&e.whenComponent(e=>{e.get(w).provide({a:N,is:t})})}},j({path:a,offline:!0,comment:`FEED(${String(n)})`}).By((function(e){return h.of(e).get(B).response.it}),n),c({path:a,offline:!0}).As((function(){const t=h.of(this),{contentRoot:s}=t,r=t.get(p).document;return s.appendChild(r.createElement("conduit-article-list")),s.appendChild(r.createElement("conduit-feed-pager")),e}),n)),get:s,set(e,t){r(e,t),h.of(e).get(B).request=t}}})}export{k as P,H as R};//# sourceMappingURL=render-feed.decorator.e7e6b773.js.map
