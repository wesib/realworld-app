import{n as t,a as s,c as e,v as n,i,b as r}from"../proc7ts/primitives.7b24aae7.js";import{i as o,c as a,N as c,n as u}from"./namespace-aliaser.9467f14d.js";import{n as h}from"./render-scheduler.6f331202.js";import{n as p,F as l,A as d,O as _,g as f,i as y,k as m,e as g,E as v,Q as w,c as b,s as A,a as T,u as k,p as x,w as S,D as j,T as O,z as E,V as F,h as B,U as M,W as D}from"../proc7ts/fun-events.0c993baf.js";import{S as I,n as K}from"../proc7ts/supply.9762ee6d.js";import{i as z,o as R,l as C,f as N,n as P,p as q,P as L,a as Q,m as U,h as V,d as W,e as G,b as H,c as J,j as X,k as Y}from"../proc7ts/push-iterator.ccd51d52.js";import{D as Z}from"./dom-events.ba8d072f.js";import{D as $}from"../proc7ts/delta-set.d5d9e832.js";const tt={instance:null,convertTo:t};function st(){return tt}function et(t){return{instance:t,convertTo(t){return this}}}function nt(t,s,e=null){return rt(t,s,n(null),e)}function it(t,s,e){return rt(t,s,e)}function rt(t,s,e,n,i){return void 0===n&&(n=e(t,i)),{instance:n,convertTo:n=>rt(n,s,e,void 0,t),attachTo:n=>rt(n,s,e,t.aspect(s)||e(n))}}const ot=Symbol("in-aspect"),at=new c("https://surol.github.io/input-aspects/ns","inasp","input-aspects"),ct={applyTo:()=>et(u())},ut={get[ot](){return ct},to:t=>({applyAspect:s=>s===ct?et(t):void 0})},ht={applyTo:()=>et(h)},pt={get[ot](){return ht},to:t=>({applyAspect:s=>s===ht?et(t):void 0})},lt={applyTo:s=>({instance:new ft(s),convertTo:t})};class dt{static get[ot](){return lt}[d](){return this.read}}class _t{constructor(s){this.roles=s,this._activate=t,this.active={[Symbol.iterator]:()=>s.keys(),has:t=>s.has(t)}}static create(){const t=new _t(new Map);return t.add("default",!0),t}modify(){const t=new _t(this.roles);return t._defaultSupply=this._defaultSupply,t}add(t,s){const e=this.roles.get(t);if(e)return void++e.active;const n=new I;if(this.roles.set(t,{active:1,supply:n}),s)this._defaultSupply=n.whenOff((()=>{--this.roles.get(t).active||this.roles.delete(t)}));else{const t=this._defaultSupply;this.activateBy((()=>t.off()))}return n}remove(t,s){const e=this.roles.get(t);--e.active||(this.roles.delete(t),this.activateBy((()=>e.supply.off(s))))}activateBy(t){const s=this._activate;this._activate=()=>{s(),t()}}activate(){const s=this._activate;this._activate=t,s()}}class ft extends dt{constructor(t){super(),this._control=t,this._active=f(_t.create()),this._activators=new Map,this._active.on((t=>t.activate())),this._active.supply.needs(t),this.read=this._active.read.do(b((({active:t})=>t)))}add(t){const s=this._active.it.modify();return this._add(s,t),this._active.it=s,new I((s=>{const e=this._active.it.modify();e.remove(t,s),e.roles.size||this._add(e,"default",!0),this._active.it=e}))}when(t,s){let e=this._activators.get(t);e||(e=new Map,this._activators.set(t,e));const n=(new I).needs(this._control);e.set(n,((t,e,i)=>s(t,e,i).supply.needs(n))),n.whenOff((()=>{e.delete(n),e.size||this._activators.delete(t)}));const i=this._active.it.roles.get(t);return i&&i.supply.cuts(s(this._control,t,this._active.it.active)),n}_add(t,s,e=!1){const n=t.add(s,e);if(n){const t=this._activators.get(s);if(t)for(const e of t.values())n.cuts(e(this._control,s,this._active.it.active))}}}function yt(t){return ot in t}const mt={applyAspect(t){}};function gt(){return mt}function vt(s,...e){if(!s)return gt;const n=bt(s);if(!e.length)return n;const r=e.map(bt);return(s,e)=>{const o=n(s,e),a=C([o],N(r.map((t=>t(s,e))),i)),c=P(a,((t,s)=>s.applyAspect?e=>t(e)||s.applyAspect(e):t),t);return function(t){return!t.set}(o)?{applyAspect:c}:{set:o.set.bind(o),get:o.get.bind(o),applyAspect:c}}}function wt(t){return t?vt(...e(t)):vt()}function bt(t){return"function"==typeof t?t:n(t)}const At=Symbol("InBuilder.impl");class Tt{constructor(){this._aspectsByKey=new Map,this._commonAspects=void 0,this._setup=void 0}addAspect(t,s){const e=this._aspectsByKey.get(t);this._aspectsByKey.set(t,e?vt(e,s):vt(s))}addAspects(t){this._commonAspects=this._commonAspects?vt(this._commonAspects,...t):vt(...t)}setup(t){const s=this._setup;this._setup=s?e=>{s(e),t(e)}:t}build(t){const s=t({aspects:this._aspects()});return this._setup&&s.setup(this._setup),s}_aspects(){if(this._aspectsByKey.size){const t=function(t){return(s,e)=>({applyAspect(n){const i=t.get(n);return i&&i(s,e).applyAspect(n)}})}(this._aspectsByKey);return this._commonAspects?vt(t,this._commonAspects):t}return this._commonAspects}}var kt;class xt{constructor(){this[kt]=new Tt}addAspect(t,s){return this[At].addAspect(t[ot],s),this}addAspects(...t){return t.length&&this[At].addAspects(t),this}setup(t,s){return yt(t)?this[At].setup((e=>e.setup(t,s))):this[At].setup(t),this}build(t){return this[At].build(t)}}kt=At;const St=Symbol("InControl.aspects");class jt{constructor(t,s){this.control=t,this.aspects=s,this._byKey=new Map}aspect(t){const s=this._byKey.get(t);if(s)return s;const e=this.control._applyAspect(t)||t.applyTo(this.control);return this._byKey.set(t,e),e}}class Ot extends F{constructor({aspects:t}={}){super();const s=e(t);this[St]=new jt(this,s.length?wt(s)(new Et(this),this):mt)}aspect(t){return this[St].aspect(t[ot]).instance}setup(t,s){return yt(t)?s(this.aspect(t),this):t(this),this}convert(t,...s){return new Ft(this,vt(t,...s))}_applyAspect(t){return this[St].aspects.applyAspect(t)}}class Et extends Ot{constructor(t){super(),this._control=t}get supply(){return this._supply||(this._supply=new I(t).needs(this._control))}get it(){return this._control.it}set it(t){this._control.it=t}get on(){return this._control.on}}class Ft extends Ot{constructor(t,e){super(),this._on=new v,this.supply=(new I).needs(t);let n,i=0;const r=e(t,this);let o,a,c;!function(t){return!t.set}(r)?(o=r.set,a=r.get,c=s=>t[St].aspect(s).convertTo(this)):(o=s,a=s,c=s=>{const e=t[St].aspect(s);return e.attachTo?e.attachTo(this):e.convertTo(this)}),this._applyAspect=t=>{var s;return(null===(s=r.applyAspect)||void 0===s?void 0:s.call(r,t))||c(t)},this._it=f([o(t.it),0]),this._it.supply.needs(this.supply),this._it.on((([t],[s])=>{t!==s&&this._on.send(t,s)})).cuts(this._on),t.on((t=>{t!==n&&(this._it.it=[o(t),++i])})).cuts(this),this._it.on((([s,e])=>{if(e!==i){i=e,n=a(s);try{t.it=n}finally{n=void 0}}}))}get it(){return this._it.it[0]}set it(t){const[s,e]=this._it.it;t!==s&&(this._it.it=[t,e+1])}get on(){return this._on.on}}const Bt={applyTo:t=>nt(t,Mt)};class Mt extends Ot{static get[ot](){return Bt}_applyAspect(t){return t===Bt?nt(this,Mt,this):super._applyAspect(t)}}class Dt{[_](){return this.on}[d](){return this.read}}const It={applyTo:t=>et(new zt(t))};class Kt{static get[ot](){return It}[_](){return this.on}[d](){return this.read}}class zt extends Kt{constructor(t){super(),this._control=t,this._map=new Map,this._on=new v,this._on.supply.needs(this._control);const s=()=>({[Symbol.iterator]:()=>this._map.keys()});this.read=this.on.do(p(s,s))}add(t){const s=this._map.get(t);if(s)return s;const e=new I((()=>{this._map.delete(t),this._on.send([],[t])}));return this._map.set(t,e),this._on.send([t],[]),e.needs(this._control).needs(t.parent)}get on(){return this._on.on}}const Rt={applyTo:t=>nt(t,Ct)};class Ct extends Ot{static get[ot](){return Rt}_applyAspect(t){return t===Rt?nt(this,Ct,this):super._applyAspect(t)}}const Nt={applyTo:t=>it(t,Pt,(t=>new Qt(t)))};class Pt{static get[ot](){return Nt}[_](){return this.on}[d](){return this.read}static hasData(t){return"off"!==t&&"-"!==t[0]}done(t){return this.own.supply.off(t),this}}class qt extends F{constructor(t){super(),this._tracker=f(t?function(t){return null!=t.getAttribute("disabled")?"off":null!=t.getAttribute("readonly")?"ro":"on"}(t.element):"on")}get supply(){return this._tracker.supply}get it(){return this._tracker.it}set it(t){switch(t){case"off":case"ro":case"-on":case"-ro":break;default:t="on"}this._tracker.it=t}get on(){return this._tracker.on}}class Lt{constructor(){this._all=new Set,this._on=new v;const t=M(this._on.on.do(D((()=>this._all))),r(this._all));this.read=t.do(m((t=>k(...t))),p(Vt))}add(t){const s=new I((()=>{this._all.delete(t),this._on.send()}));return this._all.add(t),this._on.send(),s}}class Qt extends Pt{constructor(t){super(),this._control=t,this._derived=new Lt;const s=t.aspect(Ct);this.own=new qt(s),this.own.supply.needs(t),this.derive(t.aspect(Kt).read.do(B(Ut)));let e="on";this.read=y({derived:this._derived.read,own:this.own}).do(l(((t,{derived:[s],own:[n]})=>{let i;if("off"===n||"off"===s)i="off";else{let t=!1;"-"===n[0]&&(t=!0,n=n.substring(1)),"-"===s[0]&&(t=!0,s=s.substring(1)),i="ro"===s?"ro":n,t&&(i="-"+i)}e!==i&&t(e=i)}),r(e)));let n="on";this.on=this.read.do(w(((t,s)=>{const e=n;e!==s&&t(n=s,e)}))),s&&this.read((t=>function(t,s){switch(s){case"off":t.setAttribute("disabled","");break;case"ro":case"-ro":t.setAttribute("disabled",""),t.removeAttribute("disabled"),t.setAttribute("readonly","");break;default:t.setAttribute("disabled",""),t.removeAttribute("disabled"),t.setAttribute("readonly",""),t.removeAttribute("readonly")}}(s.element,t)))}derive(t){return this._derived.add(T(O(t)?t:t(this._control)).do(A(this._control))).needs(this._control)}}function Ut(t){const s=H(t);if(!s.length)return g("on");const e=s.map((({parent:t})=>t.aspect(Pt)));return k(...e).do(p(Vt))}function Vt(...t){return Wt(...C(...t))}function Wt(...t){let s=!1,e=!1;for(const n of t)switch(n){case"off":return"off";case"ro":s=!0;break;case"-on":e=!0;break;case"-ro":e=!0,s=!0}return e?s?"-ro":"-on":s?"ro":"on"}const Gt={applyTo:t=>it(t,Ht,(t=>y({value:t,mode:t.aspect(Pt)}).do(p((({value:[t],mode:[s]})=>Pt.hasData(s)?t:void 0)))))},Ht={get[ot](){return Gt}},Jt={applyTo:t=>nt(t,Xt)};class Xt extends Mt{static get[ot](){return Jt}_applyAspect(t){return t===Jt?nt(this,Xt,this):super._applyAspect(t)}}class Yt extends Dt{remove(t){this.set(t,void 0)}}const Zt={};class $t{constructor(t){this._map=t,this._it=U(X((()=>this._map.values())),(([t])=>t)),this._entriesIt=U(this._map,(([t,[s]])=>[t,s]))}get(t){const s=this._map.get(t);return s&&s[0]}[Symbol.iterator](){return this[L]()}[L](t){return this._it[L](t)}entries(){return Y(this._entriesIt)}}class ts{constructor(t){this._controls=t,this._supply=new I,this._map=new Map}set(t,s,e,n){const i=this._map.get(t);let r;if(s){r=new I;const o=this.newEntry(t,s,r);let a=!0;i&&(i[0]===s?a=!1:n.push([t,i])),a?(this.modify().set(t,o),e.push([t,o])):this._map.set(t,o)}else r=K(),i&&(n.push([t,i]),this.modify().delete(t));return i&&i[1].off(Zt),r}newEntry(t,s,e){return[s,new I((s=>{s!==Zt&&this._controls.remove(t)})).needs(this._supply).needs(e).whenOff((t=>e.off(t===Zt?void 0:t)))]}modify(){if(this._shot){const t=new Map;z(this._map.entries(),(([s,e])=>t.set(s,e))),this._shot=void 0,this._map=t}return this._map}snapshot(){return this._shot||(this._shot=new $t(this._map))}clear(){const t=[],s=[];return z(this._map.keys(),(e=>this.set(e,void 0,t,s))),s}}class ss extends Yt{constructor(t){super(),this._group=t,this._updates=new v;this._map=new ts(this),this.on=this._updates.on.do(w(((t,s,e)=>t(s.map(es),e.map(es)))));const s=this._map.snapshot.bind(this._map);this.read=this._updates.on.do(p(s,s)),this._map._supply.needs(t.read((t=>{this.read.do(x)((s=>{const e=new Set;z(R(t),(([t,n])=>{e.add(t);const i=s.get(t);i&&(i.it=n)})),z(s.entries(),(([t,s])=>{e.has(t)||(s.it=void 0)}))}))})))}set(t,s){const e=this._group,n=[],i=[];let r;return"object"==typeof t?(r=new I,z(R(t),(([t,s])=>{this._map.set(t,s,n,i).needs(r)}))):r=this._map.set(t,s,n,i),(n.length||i.length)&&(this._updates.send(n,i),n.length&&function(){let t;n.forEach((s=>{const[n,[i,r]]=s;i.aspect(Kt).add({parent:e}).as(r);const o=i.it;if(t)t[n]=o;else{const s=e.it;s[n]!==o&&(t={...s,[n]:o})}})),t&&(e.it=t);n.forEach((t=>{const[s,[n,i]]=t;n.read.do(A(i))((t=>{e.it[s]!==t&&(e.it={...e.it,[s]:t})})).cuts(i)}))}()),r}clear(){const t=this._map.clear();t.length&&this._updates.send([],t)}}function es([t,[s]]){return[t,s]}class ns extends Xt{constructor(t,s){super(s),this._model=f(t),this.controls=new ss(this),this.supply.whenOff((()=>this.controls.clear()))}get supply(){return this._model.supply}get it(){return this._model.it}set it(t){this._model.it=t}get on(){return this._model.on}_applyAspect(s){return s===Ht[ot]?{instance:(e=this,y({cs:e.controls,model:e,mode:e.aspect(Pt)}).do(m(is))),convertTo:t}:super._applyAspect(s);var e}}function is({cs:[t],model:[s],mode:[e]}){if(!Pt.hasData(e))return g();const n={};return z(t.entries(),(([t,s])=>{n[t]=s.aspect(Ht)})),y(n).do(p((t=>{const e={...s};return z(R(t),(t=>{const[s,[n]]=t;e[s]=n})),e})))}function rs(t,{aspects:s}={}){return new ns(t,{aspects:s})}const os=g();function as(){return os}const cs={};class us{constructor(s){const i=new v,o=new Map,a=new Map;let c=t,u=t;this._messages=S((s=>{const e=T(i,r())(s).whenOff((()=>{c=t,u=t}));u=(t,s)=>{const n=t(((...s)=>{if(s.length)a.set(t,s);else if(!a.delete(t))return;c()})).needs(s).whenOff((e=>{e!==cs&&s.off(e),a.delete(t)&&c()}));e.whenOff((()=>n.off(cs)))},z(o.entries(),(([t,s])=>u(t,s))),c=()=>{i.send(...J(a.values()))},a.size&&c()})).do(E,A(s)),this.from=t=>{const i=function(t){return O(t)?n(T(t)):"function"==typeof t?s=>T(t(s)):s=>s.read.do(l((n=>n(...e(t.validate(s))))))}(t)(s),r=new I((()=>{o.delete(i)}));return o.set(i,r),u(i,r),r.needs(s)}}[d](){return this._messages}}const hs={applyTo:t=>it(t,ps,((t,s)=>{const e=new fs(t);return s&&e.by(s.aspect(ps).read.do(l(((t,s)=>t(...s.messages()))))),e}))};class ps{static get[ot](){return hs}[d](){return this.read}}const ls={get ok(){return!0},messages:()=>[],has:()=>!1,hasBut:()=>!1,[Symbol.iterator]:()=>q(),[L]:t=>q()};class ds{constructor(t){this._byCode=new Map,this._all=[],this._it=Q(this._all),t.forEach((t=>{let s=!1;z(R(t),(([e,n])=>{if(n){s=!0;const n=this._byCode.get(e);n?n.push(t):this._byCode.set(e,[t])}})),s&&this._all.push(t)}))}get ok(){return!this._all.length}messages(t){return null==t?this._all:this._byCode.get(t)||[]}has(t){return null==t||this._byCode.has(t)}hasBut(...t){return this._all.some((s=>t.every((t=>!s[t]))))}[Symbol.iterator](){return this[L]()}[L](t){return this._it[L](t)}}function _s(...t){return t.length?new ds(t):ls}class fs extends ps{constructor(t){super(),this._messages=new us(t),this.read=T(this._messages).do(p(_s));const s=t.aspect(Mt);s&&this._messages.from(function(t){return t.controls.read.do(m((t=>k(...U(t,(t=>t.aspect(ps)))))),l(((t,...s)=>t(...V(s,(([t])=>t))))))}(s))}by(...t){return this._messages.from(function(...t){const s=t.length;return 1===s?t[0]:s?s=>{const e=new us(s);return t.forEach((t=>e.from(t))),e}:as}(...t))}}function ys(t){return t?t.read.do(l(((t,s)=>s?t():t({missing:"missing"})))):ys}const ms={applyTo:t=>it(t,ws,(t=>new bs(t)))};class gs extends Error{constructor(...t){super(),this.errors=_s(...t.map((t=>t.submit?t:{...t,submit:!0})))}}class vs extends gs{constructor(t){super({submit:"rejected",rejected:t,[t]:!0})}}class ws{static get[ot](){return ms}[d](){return this.read}}class bs extends ws{constructor(t){super(),this._control=t,this._flags=f({submitted:!1,busy:!1}),this._errors=f([]),this.read=y({flags:this._flags,data:this._control.aspect(Ht),messages:this._control.aspect(ps)}).do(A(this._control),p((({flags:[t],data:[s],messages:[e]})=>({ready:void 0!==s&&(e.ok||W(e,(t=>t.submit))),submitted:t.submitted,busy:t.busy}))));t.aspect(ps).by(this._errors.read.do(l(((t,s)=>t(...s)))))}async submit(t){if(this._control.supply.isOff)throw new vs("noInput");if(this._flags.it.busy)throw new vs("busy");const s=this,e=this._control;let n;this._flags.it={...this._flags.it,submitted:!0,busy:!0};try{return this._errors.it.length&&(this._errors.it=[]),await t(await async function(){const{data:[t],flags:[{ready:n}]}=await y({data:e.aspect(Ht),flags:s});return n?t:Promise.reject(new vs("notReady"))}(),e)}catch(t){throw n=function(t){if(t instanceof gs)return[...t.errors];return[{submit:t}]}(t),t}finally{this._flags.it={...this._flags.it,busy:!1},n&&(this._errors.it=n)}}reset(){const t=this._flags.it;t.submitted&&(this._flags.it={...t,submitted:!1}),this._errors.it.length&&(this._errors.it=[])}}function As(t,{notReady:s="on",invalid:e="on",busy:n="ro"}={}){return t.aspect(ws).read.do(p((t=>Wt(t.busy?n:"on",t.ready?"on":t.submitted?e:s))))}function Ts({invalid:t="-on",ignore:s="submit"}={}){return e=>e.aspect(ps).read.do(p((e=>e.hasBut(..."string"==typeof s?[s]:s)?t:"on")))}class ks extends Ct{constructor(t,{aspects:e,get:n,set:i}){super({aspects:e}),this.element=t,this._input=new v;const r=this;this._get=n,this._set=i,this._value=this.it;const o=this._update=(t,s)=>a({value:t},s);function a(t,s){for(;;){let e;r._value=t.value,r._update=(s,n)=>{e=[{...t,value:s},n]};try{r._input.send(t,s)}finally{r._update=o}if(!e)break;[t,s]=e}}this.events=new Z(t),this.events.supply.needs(this),this.listenForInput((t=>a(t,this._value))),this.on=this._input.on.do(w(((t,{value:s},e)=>s!==e&&t(s,e)))),this.input=this._input.on.do(p(s,(()=>({value:this.it}))))}get supply(){return this._input.supply}get it(){return this._get()}set it(t){const s=this.it;t!==s&&(this._set(t),this._update(this._get(),s))}listenForInput(t){const s=s=>t({value:this.it,event:s});this.events.on("input")(s),this.events.on("change")(s)}}function xs(t,{aspects:s}={}){return new ks(t,{get(){return this.element.value},set(t){this.element.value=t},aspects:s})}const Ss={applyTo:t=>it(t,js,(t=>{const s=t.aspect(Ct);return s&&new Os(s)}))};class js extends F{static get[ot](){return Ss}}class Os extends js{constructor(s){super();const{element:e,events:n}=s,i=e.getRootNode?e.getRootNode():e.ownerDocument;this._it=f(i.activeElement===e),this.supply.needs(s),n.on("focus")((()=>this._it.it=!0)),n.on("blur")((()=>this._it.it=!1)),this.on({receive(s,n){s.onRecurrent(t),n?e.focus():e.blur()}})}get supply(){return this._it.supply}get it(){return this._it.it}set it(t){this._it.it=t}get on(){return this._it.on}}const Es={applyTo:t=>it(t,Fs,(t=>{const s=t.aspect(Mt);return null!=s?new Ds(s):new Ms(t)}))};class Fs{static get[ot](){return Es}[d](){return this.read}}const Bs={hasFocus:!1,touched:!1,edited:!1};class Ms extends Fs{constructor(t){super(),this._flags=f(Bs),this._flags.supply.needs(t),this._flags.by(function(t,s){const e=s.aspect(Ct),n=s.aspect(js);return y({hasFocus:n||g(!1),edited:e?e.input.do(p((({event:t})=>!!t))):g(!1)}).do(p((({hasFocus:[s],edited:[e]})=>function(t,s,e){t=s?{...t,hasFocus:s,touched:!0}:{...t,hasFocus:s};e&&(t={...t,edited:e,touched:!0});return t}(t.it,s,e))))}(this._flags,t))}get read(){return this._flags.read}markTouched(t=!0){const s=this._flags.it;return t?s.touched||(this._flags.it={...s,touched:t}):s.touched&&(this._flags.it={...s,touched:s.hasFocus,edited:!1}),this}markEdited(t=!0){const s=this._flags.it;return t?s.edited||(this._flags.it={...s,touched:!0,edited:t}):s.edited&&(this._flags.it={...s,edited:t}),this}}class Ds extends Fs{constructor(t){var s;super(),this._container=t,this.read=(s=this._container).controls.read.do(A(s),m((t=>k(...function(t){return U(t,(t=>t.aspect(Fs)))}(t)))),p(Is))}markEdited(t){return this._container.controls.read.do(x)((s=>z(s,(s=>s.aspect(Fs).markEdited(t))))),this}markTouched(t){return this._container.controls.read.do(x)((s=>z(s,(s=>s.aspect(Fs).markTouched(t))))),this}}function Is(...t){const s={hasFocus:!1,touched:!1,edited:!1};return z(t,(([{hasFocus:t,touched:e,edited:n}])=>{e&&(s.touched=!0),t&&(s.hasFocus=s.touched=!0),n&&(s.edited=s.touched=!0)})),s}function Ks(s,e){const{form:n,aspects:i,modes:r}=e,o=new ks(s,{aspects:[wt(i)],get:t,set:t});return o.supply.needs(n),o.setup(Pt,(t=>t.derive(As(n,r))))}function zs(s,e){const{form:n,aspects:i,modes:{notReady:r="on",invalid:o="off",busy:a="off"}={}}=e,c=new ks(s,{aspects:[wt(i)],get:t,set:t});return c.supply.needs(n),c.setup(Pt,(t=>t.derive(As(n,{notReady:r,invalid:o,busy:a})))),c}const Rs={applyTo(t){const s=t.aspect(Ct);return s?et(s.element):st()}},Cs={get[ot](){return Rs},to:(t=null)=>({applyAspect:s=>s===Rs?et(t):void 0})},Ns={applyTo:s=>({instance:new Qs(s),convertTo:t})};class Ps{static get[ot](){return Ns}[d](){return this.read}}const qs=Symbol("reason");function Ls(t){return t&&"object"==typeof t&&qs in t}class Qs extends Ps{constructor(t){super(),this._control=t,this._sources=f([new Map]),t.supply.whenOff((t=>this.done(t))),this.read=this._sources.read.do(A(this._control),m((([t])=>k(...t.keys()))),b(((...t)=>{const s={};return t.forEach((([t])=>Us(t,s))),s}))),this.track=S((t=>{t.supply.needs(this._control);const s=new $,e=new j;let n=!1;return e.on(t),this.read((t=>{const i=new Set(s),r=[];z(G(R(t),(([,t])=>!!t)),(([t])=>{i.delete(t)||r.push(t)})),(!n||r.length||i.size)&&(s.delta(r,i),n=!0,s.redelta(((t,s)=>e.send(t,s))).undelta())}))}));const s=t.aspect(Cs);s&&this.applyTo(s,this.schedule)}get schedule(){return this._schedule||(this._schedule=Vs(this._control,this._control.aspect(Cs)))}specs(t){return T(O(t)?t:t(this._control))}resolve(t){const s=this._control.aspect(ut);return this.specs(t).do(p(((...t)=>{const e={};return t.forEach((t=>{o(t)?e[a.name(t,s)]=!0:Us(t,e)})),e})))}add(t){const s=this._control.supply;if(s.isOff)return s;const e=new I,n=S((s=>{const n=this.resolve(t)({receive(t,...e){s.receive(t,...e)}});s.supply.whenOff((t=>{e.off({[qs]:t})})),e.needs(n).whenOff((t=>{Ls(t)&&n.off(t[qs])}))})).do(E),[i]=this._sources.it;return i.set(n,e),e.whenOff((t=>{Ls(t)||(i.delete(n),this._sources.it=[i])})),this._sources.it=[i],e.needs(s)}applyTo(t,s=Vs(this._control,t)){const{classList:e}=t,n=new $,i=()=>{n.redelta(((t,s)=>{e.remove(...s),e.add(...t)})).undelta()};return this.track(((t,e)=>{n.delta(t,e),s(i)})).whenOff((()=>{n.size&&(n.clear(),s(i))}))}done(t){return z(this._sources.it[0].values(),(s=>s.off(t))),this._sources.supply.off(t),this}}function Us(t,s){z(R(t),(([t,e])=>{null!=e&&(s[t]=e)}))}function Vs(t,s){return t.aspect(pt)({node:s})}function Ws({mark:t,when:s}={}){let n;return n=s?Array.isArray(s)?s.length?t=>s.every((s=>t.has(s))):Gs:t=>t.has(s):Gs,s=>s.aspect(ps).read.do(l(((s,i)=>n(i)?s(...function(t){if(!t)return Hs;const s=e(t);return s.length?s:Hs}(t)):s())))}function Gs(t){return!t.ok}const Hs=[["has-error",at]];function Js({ns:t=at}={}){return s=>{const e=s=>[s,t];return y({md:s.aspect(Pt),vl:s.aspect(ps),st:s.aspect(Fs)}).do(l(((t,{md:[s],vl:[n],st:[{hasFocus:i,touched:r,edited:o}]})=>{const a=[];Pt.hasData(s)||a.push(e("disabled")),"ro"!==s&&"-ro"!==s||a.push(e("readonly")),n.ok||a.push(e("invalid")),n.has("missing")&&a.push(e("missing")),n.has("incomplete")&&a.push(e("incomplete")),i&&a.push(e("has-focus")),r&&a.push(e("touched")),o&&a.push(e("edited")),t(...a)})))}}export{ks as A,gs as I,Ps as a,Fs as b,ps as c,Cs as d,Js as e,dt as f,zs as g,Pt as h,Ws as i,Kt as j,Xt as k,xt as l,Ks as m,ot as n,nt as o,Ts as p,st as q,ut as r,et as s,pt as t,ws as u,rs as v,xs as w,ys as x};//# sourceMappingURL=input-aspects.552a677b.js.map
