import{S as e,n as t,s as n,v as s,a as r,i as o,c as i,m as a}from"../proc7ts/primitives.e781e476.js";import{m as c,i as u,a as l,j as h,f as d,n as p,g as f,h as g,p as m,P as w,e as _,k as y,l as b}from"../proc7ts/push-iterator.f6f3343e.js";import{b as v,C as x,a as k,c as S,F as C,d as R,e as U,S as O,f as D}from"../proc7ts/context-values.69c73302.js";import{c as L,h as A}from"../frontmeans/namespace-aliaser.e08188c9.js";import{y as E,s as N,n as M,O as P,A as q,k as F,x as I,b as j,h as z,p as K,z as $,t as T,B,f as H,c as W,v as V,G as J,E as G,H as Q,a as X,e as Y,r as Z,d as ee,I as te,o as ne,l as se,q as re,V as oe,J as ie,F as ae,j as ce,m as ue}from"../proc7ts/fun-events.f7c44dc9.js";import{D as le,h as he}from"../core/auth.e0c9460a.js";import{C as de,B as pe,m as fe,e as ge,n as me,o as we,l as _e,p as ye,q as be,a as ve,W as xe,r as ke,s as Se,u as Ce,v as Re,k as Ue,d as Oe}from"./wesib.acbfb4f5.js";import{m as De,n as Le,o as Ae,p as Ee,l as Ne}from"../frontmeans/input-aspects.a58ff15b.js";function Me({$:e="raw",n:t,t:n,v:s,x:r=[],p:o={},pl:i=[]}){return t&&(o[t]={$:e,n:t,v:s,x:[],p:{},pl:[]}),{$:e,n:t,t:n,v:s,x:r,p:o,pl:i}}function Pe({p:e,pl:t},n){const s=n.n||n.v,r=e[s];(!r||!r.n&&n.n)&&(e[s]=n),t.push(n)}const qe=()=>!1,Fe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), \d\d (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) \d\d\d\d \d\d:\d\d:\d\d GMT/;function Ie({dateTime:e}){return e?je:qe}function je(e,t){return e.s=e.s.substring(e.i),e.i=0,!!Fe.test(e.s)&&(t(e.s.substring(e.i,e.i+=29)),!0)}function ze({delimiterOf:e}){return t=>{const n=t.s[t.i];return t.d=e(n),n}}function Ke(e,{named:t=!0,tagged:n=!0,extra:s=!0,next:r=ze(e)}={}){const o=function({delimiterOf:e}){return(t,n)=>{if(!(262144&e(t.s[t.i])))return!1;let s="";for(++t.i;t.i<t.s.length;){const n=t.s[t.i++];if(524288&e(n))break;s+=n}return n(s),!0}}(e),i=Ie(e),a=function({delimiterOf:e}){return(t,n)=>{let s="";for(++t.i;t.i<t.s.length;++t.i){const r=t.s[t.i];if("\\"===r){s+=t.s[++t.i]||r}else{if(65536&e(r))return++t.i,void n(s);s+=r}}n(s)}}(e),c=s?Ke(e,{next:r,tagged:!1,named:!1,extra:!1}):qe;return(e,s)=>{let u,l,h,d="",p="raw";for(;e.i<e.s.length;){const s=r(e);if(e.d){if(12&e.d)break;if(null==l){if(16&e.d){l=d?"":s,++e.i;continue}if(65536&e.d){!n&&d||a(e,(e=>{d?(p="tagged-string",u=d):p="quoted-string",d="",l=e}));break}if(!d&&o(e,(e=>{p="angle-bracketed-string",l=e})))break;l=d,d=""}else{if(65536&e.d){!n&&l||a(e,(e=>{l?(p="tagged-string",u=l):p="quoted-string",l=e}));break}if(!l&&o(e,(e=>{p="angle-bracketed-string",l=e})))break}}if(null==l){if(!d&&i(e,(e=>l=e))){p="date-time";break}t?d+=s:l=s}else{if(!l&&i(e,(e=>l=e))){p="date-time";break}l+=s}++e.i}if(null==l){if(!d)return!1;h=Me({$:p,v:d})}else h=Me({$:p,n:d||void 0,t:u,v:l});for(;c(e,(e=>h.x.push(e))););return s(h),!0}}function $e({delimiterOf:e}){return t=>{let n=t.s[t.i];return"\\"!==n?(t.d=e(n),n):(++t.i,t.i<t.s.length?(n=t.s[t.i],t.d=e(n)?1:0):t.d=1,n)}}function Te({delimiterOf:e}){return t=>{const n=t.i;do{const n=t.s[t.i];if(!(2&e(n)))break;t.i++}while(t.i<t.s.length);return t.i!==n}}function Be(e,t={}){const{delimiterOf:n}=e,s=Te(e),r=Ke(e,{...t,tagged:!1});return(e,t)=>!!(8&n(e.s[e.i]))&&(++e.i,s(e),r(e,t))}const He={" ":7,"\t":7,",":5,";":9,'"':65569,"\\":33,"<":262145,">":524289,"=":17,"(":1,")":1,"/":1,":":1,"?":1,"@":1,"[":1,"]":1,"{":1,"}":1};function We({delimit:e,dateTime:t}={}){const n=e?{...He,...e}:He;return{dateTime:t,delimiterOf:e=>n[e]||(e>="\0"&&e<=" "||"\x7f"===e?1:0)}}const Ve=We(),Je=We({delimit:{":":17,"(":131105,")":37," ":3,"\t":3,"=":1,",":1}});function Ge(e){const t=e?We(e):Ve,n=function(e){const{delimiterOf:t}=e,n=Te(e);return e=>!!(4&t(e.s[e.i]))&&(e.i++,n(e),!0)}(t),s=Be(t),r=Ke(t),o=(null==e?void 0:e.comments)?function(e){const{delimiterOf:t}=e,n=Te(e),s={next:$e(e)},r=Ke(e,s),o=Be(e,s);return(e,s)=>{if(!(131072&t(e.s[e.i])))return!1;let i;for(++e.i;n(e)||o(e,(e=>{i||(i=Me({$:"raw",v:""})),Pe(i,e)}))||r(e,(e=>i=e)););return++e.i,s(i||Me({$:"raw",v:""})),!0}}(Je):qe;return e=>{const t=[],i={i:0,s:e};for(;i.i<i.s.length&&(n(i)||s(i,(e=>{t.length||t.push(Me({$:"raw",v:""})),Pe(t[t.length-1],e)}))||o(i,(e=>t.push(e)))||r(i,(e=>t.push(e)))););return t}}const Qe=Ge();function Xe(e){if(!e)return'""';const{delimiterOf:t}=Ve;let n,s=!1;for(let r=0;r<e.length;++r){const o=e[r],i=t(o);i?(32&i&&(n||(n=e.substring(0,r)),n+="\\"+o),s=!0):n&&(n+=o)}return s?`"${n||e}"`:e}class Ye extends R{constructor(e){super(e),this.upKey=this.createUpKey((e=>e.insert(e.seed.do(H(((...t)=>t.length?j(function(e){return(t,n)=>{const s=(n,r)=>{const o=e[n];return o?te(o(((e=r)=>s(n+1,e)),r)):t(r)};return s(0,n)}}(t)):e.hasFallback&&e.or?e.or:j(Ze)))))))}grow(e){let t;e.context.get(this.upKey,e.hasFallback?{or:null!=e.or?j(e.or):e.or}:void 0)((e=>t=e)).whenOff((e=>t=U(e))),e.insert(((e,n)=>t(e,n)))}}function Ze(e,t){return e(t)}const et=new Ye("http-fetch-agent"),tt={};const nt=new C("http-fetch",{byDefault:ve((function(t){const n=t.get(pe),s=t.get(et);return(e,t)=>s(r,new Request(e,t));function r(t){return W((s=>{const r=new G;let o;if("AbortController"in n){const i=new n.AbortController,{signal:a}=i;o=new e((e=>{e===tt&&i.abort()})),s.supply.whenOff((()=>o.off(tt))).needs(o),r.on({supply:o,receive(e,t){s.receive(e,t)}});const c=t.signal;c&&(new le(c).on("abort").do(ne)((()=>i.abort())),c.aborted&&i.abort()),t=new Request(t,{signal:a})}else o=r.on(s);n.fetch(t).then((e=>{r.send(e),o.off()})).catch((e=>o.off(e)))}))}}))});const st=new k("hierarchy-root",{byDefault:e=>{const t=e.get(ke);return new le(t).on("wesib:component")((({context:e})=>e.get(ot).issue())),T()}}),rt=new k("hierarchy-updates",{byDefault:e=>new ot(e.get(ge))});class ot{constructor(e){const t=new G,n=e.get(me).get(st);this.on=t.on,this.send=()=>t.send(e),this.issue=()=>{const t=it(e);t?t[0].get(ot).send():n.it=e}}static get[x](){return rt}}function it(e){const t=e.get(me).get(ke);let{element:n}=e,s=!0;if(n!==t)for(;;){const e=n.parentNode;if(!e)return;const r=e[ye];if(r)return[r,s];if(e===t)return;s=!1,n=e}}const at=new k("hierarchy-context",{byDefault:e=>new ut(e.get(ge))});class ct extends v{static get[x](){return at}get supply(){return this.context.supply}}class ut extends ct{constructor(n){super(),this.context=n,this.up=$((t=>{const{supply:n}=t;n.needs(this);const s=T();s.by(this._parent),n.cuts(s);const r=(new e).needs(n),o=(new e).needs(n),i=()=>{const e=it(this.context);if(e){const[t,n]=e;s.it=t.get(ct),r.off(),n&&o.off()}else s.it=void 0};this.context.get(me).get(st).read({supply:r,receive:()=>this.context.connected&&i()}),s.read.do(N(o),M((e=>e&&e.context.get(ot).on(i)))),s.read(t),this.context.whenConnected({supply:(new e).needs(n),receive:i})})).do(B);const s=this._parent=T();n.whenConnected(t).cuts(s);const r=this._registry=(o=this.up,new S((e=>function(e){return"upKey"in e}(e)?o.do(H((t=>t?t.get(e):j()))):void 0)));var o;this.get=r.newValues().get}provide(e){return this._registry.provide(e).needs(this)}inside(e){return this._parent.it=e&&e.get(ct),this}}class lt{[P](){return this.onUpdate}[q](){return this.read}}const ht={subtree:!0};function dt(e,t,n,r,{deep:i,all:a}){const p=new G,f=i?ht:void 0;let _,v=new Set;const x=i?pt:l;"string"==typeof n?_=n:e.whenDefined(n).then((({elementDef:{name:t}})=>{if(t&&(_=A.name(t,e.get(_e)),p.size)){const e=C();if(e.size){const t=h(g(c(e,(e=>r(e))),o));t.length&&p.send(t,[])}}})).catch(console.error),a||t.addEventListener("wesib:component",(e=>{const t=e.target;if(v.has(t)){const e=r(t);p.send([e],[])}}));const k=g(c(y((function(){return b(p.size?v:C())})),(e=>r(e))),o);class S extends lt{constructor(){super();const n=e.get(Se)(R);this.onUpdate=W((e=>{const s=!p.size,r=p.on(e);s&&(C(),n.observe(t,f)),r.whenOff((()=>{p.size||(n.disconnect(),v.clear())})).needs(e.supply)}));const r=s(this);this.read=this.onUpdate.do(se(r,r)),this.track=$((e=>{const t=new G;t.on(e),t.send(h(this),[]),this.onUpdate(e)})),this.first=z(this.read).do(re(((e,t)=>e(m(t)))))}[Symbol.iterator](){return this[w]()}[w](e){return k[w](e)}}return new S;function C(){const e=function(){const e=_;if(!e)return new Set;if(i)return new Set(l(t.querySelectorAll(e)));return new Set(d(t.children,(t=>t.matches(e))))}();return p.size&&(v=e),e}function R(e){const t=[],n=[];e.forEach((e=>{u(g(c(x(e.removedNodes),O),o),(e=>n.push(e))),u(g(c(x(e.addedNodes),U),o),(e=>t.push(e)))})),(t.length||n.length)&&p.send(t,n)}function U(e){if(Ce(e))return _&&e.matches(_)&&!v.has(e)?(v.add(e),r(e)):void 0}function O(e){if(Ce(e)&&v.delete(e))return r(e,!0)}}function pt(e){return _(e,(e=>l([e,...pt(e.childNodes)])))}class ft{constructor(e,t){this._bs=e,this.element=t,this._emitters=new Map}get observer(){if(this._observer)return this._observer;const e=this._bs.get(pe).MutationObserver;return this._observer=new e((e=>this._update(e)))}observe(t,n){const s=this,r=this.observer,o=this._emitter(t),i=Y(n),a=o.on({supply:new e((()=>{this._emitters.delete(t),r.disconnect(),this._emitters.size?c():this._observer=void 0})).needs(i.supply),receive:(e,t,n)=>i.receive(e,t,n)});return r.disconnect(),c(),a;function c(){s._update(r.takeRecords()),r.observe(s.element,{attributes:!0,attributeOldValue:!0,attributeFilter:[...s._emitters.keys()]})}}_update(e){e.forEach((e=>{const t=e.attributeName,n=this._emitters.get(t);n&&n.send(this.element.getAttribute(t),e.oldValue)}))}_emitter(e){const t=new G;return this._emitters.set(e,t),t}}class gt extends oe{constructor(e,t){super(),this._observer=e,this._name=t,this._updates=new G;let n=i();this.on=W((e=>{this._updates.size||(n=this._observer.observe(this._name,((e,t)=>this._updates.send(e,t)))),e.supply.needs(n),this._updates.on(e).whenOff((e=>{this._updates.size||n.off(e)}))}))}get supply(){return this._updates.supply}get it(){return this._observer.element.getAttribute(this._name)}set it(e){null!=e?this._observer.element.setAttribute(this._name,e):this._observer.element.removeAttribute(this._name)}}class mt{constructor(e,t){this._attrs=new Map,this._observer=new ft(e,t)}get(e){const t=this._attrs.get(e);if(t)return t;const n=new gt(this._observer,e);return this._attrs.set(e,n),n}}class wt extends oe{constructor(e,t){super(),this._element=e,this._updates=new G,this._key=t}get supply(){return this._updates.supply}get it(){return this._element[this._key]}set it(e){this._element[this._key]=e}get on(){return this._updates.on}bind(e){e.get(Re).track(Ue(this._key)).onUpdate({supply:this.supply,receive:(e,t,n,s)=>this._updates.send(n,s)})}}class _t{constructor(e){this._element=e,this._props=new Map}bind(e){this._context=e,this._props.forEach((t=>t.bind(e)))}get(e){const t=this._props.get(e);if(t)return t;const n=new wt(this._element,e);return this._context&&n.bind(this._context),this._props.set(e,n),n}}const yt=Symbol("element-node");class bt{constructor(e,t){this._bs=e,this.element=t,this._attrs=new mt(e,t),this._props=new _t(t),t[yt]=this;const n=t[ye];n?this._bind(n):t.addEventListener("wesib:component",(e=>this._bind(e.context)))}get context(){return this.element[ye]}get parent(){const e=this.element.parentNode;return e&&vt(this._bs,e)}select(e,t){return function(e,t,n,s={}){if(s.all)return dt(e,t,n,((t,n)=>vt(e,t,n)),s);const r=e.get(be);return dt(e,t,n,((t,n)=>r(t)&&vt(e,t,n)),s)}(this._bs,this.element,e,t)}attribute(e){return this._attrs.get(e)}property(e){return this._props.get(e)}_bind(e){this._props.bind(e)}}function vt(e,t,n){const s=t[yt];return s||n?s:new bt(e,t)}const xt=new k("component-node",{byDefault:e=>vt(e.get(me),e.get(ge).element)});function kt(e){return new URL(e.hash.substring(1),e.origin)}function St(e,t){if(t.origin!==e.origin||t.username)return new URL(`#${t}`,e);const{pathname:n,search:s,hash:r}=t,o=new URL("",e);return o.hash=s||r||n.length>1?n+s+r:s+r,o}const Ct=Symbol("page-param");class Rt{get[Ct](){return this}byDefault(e,t){}}class Ut extends Rt{create(e,t){let n;const s={get:()=>n,put(t){n="string"==typeof t?new URL(t,e.url.origin):t}};return s.put(t),s}}const Ot=new Ut;class Dt extends Rt{create(e,t){const n={get:()=>e.get(Ot)||kt(e.url),put(t){e.put(Ot,t)}};return n.put(t),n}byDefault(e){return this.create(e,null)}}const Lt=new Dt;class At extends R{constructor(e){super(e),this.upKey=this.createUpKey((e=>{const{document:t}=e.context.get(pe);e.insert(e.seed.do(H(((...n)=>n.length?j((function(e,s,r,o){return i(0,o);function i(o,a){const c=n[o];if(!c)return e(a);c((({url:e=a.url,title:n=a.title,data:s=a.data}=a)=>i(o+1,{url:new URL(String(e),t.baseURI),title:n,data:s,get visited(){return a.visited},get current(){return a.current},get:e=>a.get(e),put(e,t){a.put(e,t)}})),s,r,a)}})):e.hasFallback&&e.or?e.or:j(Et)))))}))}grow(e){let t;e.context.get(this.upKey,e.hasFallback?{or:null!=e.or?j(e.or):e.or}:void 0)((e=>t=e)).whenOff((e=>t=U(e))),e.insert(((e,n,s,r)=>t(e,n,s,r)))}}function Et(e,t,n,s){e(s)}const Nt=new At("navigation-agent"),Mt={setup(e){e.provide({a:Nt,is:qt})}};class Pt{static get[we](){return Mt}}function qt(e,t,n,s){const r=s.get(Ot);r?e({url:St(s.url,r)}):e()}class Ft extends v{}const It=new k("nav-history",{byDefault:ve((e=>new zt(e)))});function jt(e){return null==e||"object"!=typeof e?{data:e}:e["wesib:navigation:data"]}class zt{constructor(e){this._context=e,this._entries=new Map,this._lastId=0;const t=e.get(pe);this._document=t.document,this._location=t.location,this._history=t.history,this._uid=btoa(String(Math.random()))}static get[x](){return It}init(){const{data:e}=jt(this._history.state),t=this.newEntry({url:new URL(this._location.href),data:e,title:this._document.title});return this._entries.set(t.id,t),t.schedule((()=>{t.enter("init"),this._history.replaceState(this._historyState(t),"")})),t}newEntry(e){return new Kt(this._context,++this._lastId,e)}open(e,t){const{page:{title:n="",url:s}}=e;this._history.pushState(this._historyState(e),n,s.href),this._enter("open",e,t)}_enter(e,t,n){const s=n.it;this._entries.set(t.id,t);try{for(let e=s.next;e;e=e.next)this._forget(e)}finally{t.prev=s,s.next=t,t.schedule((()=>{try{s.leave()}finally{t.enter(e)}})),n.it=t}}replace(e,t){const n=t.it,{page:{title:s="",url:r}}=e;this._history.replaceState(this._historyState(e),s,r.href),this._entries.set(e.id,e);const o=n.prev;o&&(e.prev=o,o.next=e),e.schedule((()=>{try{n.leave()}finally{try{this._forget(n)}finally{e.enter("replace")}}})),t.it=e}popState(e,t){const{state:n}=e;if(null==n)return null==this._history.state?this._changeHash(t):void 0;const s=t.it,{uid:r,data:o,id:i}=jt(n);let a;const c=r===this._uid&&null!=i?this._entries.get(i):void 0;return c?a=c:(a=this.newEntry({url:new URL(this._location.href),data:o,title:this._document.title}),s.transfer(a,"return"),this._entries.set(a.id,a),this._history.replaceState(this._historyState(a),"")),a.schedule((()=>{try{s.leave()}finally{a.enter("return")}})),t.it=a,a}hashChange(e){if(null==this._history.state)return this._changeHash(e)}update(e,t){const n=e.it,s=new Kt(this._context,++this._lastId,{...n.page,url:t},n);return this._entries.set(s.id,s),this._history.replaceState(this._historyState(s),"",t.href),this._entries.delete(n.id),e.it=s}_changeHash(e){const t=e.it,n=this.newEntry({url:new URL(this._location.href),data:null,title:this._document.title});try{t.transfer(n,"enter")}finally{this._history.replaceState(this._historyState(n),""),this._enter("enter",n,e)}return n}_forget(e){this._entries.delete(e.id),e.forget()}_historyState({id:e,page:{data:t}}){return{"wesib:navigation:data":{uid:this._uid,id:e,data:t}}}}class Kt{constructor(e,n,s,r){this._bsContext=e,this.id=n,this._status=0,this._update=t,this._params=r?r._params:new Map;const o=this;this.page={get url(){return s.url},get title(){return s.title},get data(){return s.data},get visited(){return!!o._status},get current(){return 2===o._status},get:e=>o.get(e),put(e,t){o.put(e,t)}}}get(e){const t=e[Ct],n=this._params.get(t);if(n)return n.get();const s=t.byDefault(this.page,this._newContext());return s&&this._init(t,s)}put(e,t){const n=e[Ct],s=this._params.get(n);return s?(s.put(t),s.get()):this._init(n,n.create(this.page,t,this._newContext()))}_newContext(){const e=new S(this._bsContext);return new class extends Ft{constructor(){super(...arguments),this.get=e.newValues().get}}}_init(e,t){return this._params.set(e,t),this.page.current&&t.enter&&t.enter(this.page,"init"),t.get()}transfer(e,t){u(this._params.entries(),(([n,s])=>{if(s.transfer){const r=s.transfer(e.page,t);r&&e._params.set(n,r)}}))}stay(e){u(this._params.values(),(t=>t.stay&&t.stay(e)))}enter(e){this._status=2,u(this._params.values(),(t=>t.enter&&t.enter(this.page,e)))}leave(){this._status=1,u(this._params.values(),(e=>e.leave&&e.leave()))}forget(){u(this._params.values(),(e=>e.forget&&e.forget())),this._params.clear()}schedule(e){this._update=e}apply(){const e=this._update;this._update=t,e()}}class $t extends Event{constructor(e,t){super(e,{...t,cancelable:!1}),this.when=t.when,this.to=t.to}}class Tt extends Event{constructor(e,t){super(e,{...t,cancelable:!0}),this.when=t.when,this.from=t.from,this.to=t.to}}class Bt extends Event{constructor(e,t){super(e,{...t,cancelable:!0}),this.from=t.from,this.to=t.to,this.reason=t.reason}get when(){return"stay"}}const Ht=new k("navigation",{byDefault:ve((function(e){const n=e.get(pe),{document:s,history:r}=n,o=new le(n),i=e.get(zt),c=e.get(Nt),u=T(i.init());u.read((e=>e.apply()));let l=Promise.resolve();o.on("popstate")((e=>{const t=i.popState(e,u);t&&o.dispatch(new $t("wesib:enterPage",{when:null!=e.state?"return":"enter",to:t.page}))})),o.on("hashchange")((()=>{const e=i.hashChange(u);e&&o.dispatch(new $t("wesib:enterPage",{when:"enter",to:e.page}))}));return new class extends Wt{constructor(){super(),this.onEnter=o.on("wesib:enterPage"),this.onLeave=o.on("wesib:leavePage"),this.onStay=o.on("wesib:stayOnPage"),this.on=ie(te(this.onEnter),te(this.onLeave),te(this.onStay)),this.read=u.read.do(se((({page:e})=>e)))}get page(){return u.it.page}get length(){return r.length}go(e){r.go(e)}open(e){return f("pre-open","open",e)}replace(e){return f("pre-replace","replace",e)}update(e){return i.update(u,d(e)).page}with(e,t){return h((n=>n.put(e,t)))}};function h(e){return{with:(t,n)=>h(a(e,(e=>e.put(t,n)))),open:t=>f("pre-open","open",t,e),replace:t=>f("pre-replace","replace",t,e),pretend(t,n=((e,t)=>t)){let s;"function"==typeof t?(n=t,s=void 0):s=t;const r=p(s),o=u.it,i=g("pretend",o,r,e);try{return m("pretend",o,r,i)?n(o.page,i.page):void 0}finally{i.stay(u.it.page)}}}}function d(e){return"string"==typeof e?new URL(e,s.baseURI):e||u.it.page.url}function p(e){return null==e||"string"==typeof e||e instanceof URL?{url:d(e)}:e.url instanceof URL?e:{...e,url:d(e.url)}}function f(e,n,s,r=t){const a=p(s),c=l=l.then(h,h);return c;function h(){let t;try{const s=function(){if(l!==c)return d();const t=u.it,n=g(e,t,a,r),s=new Tt("wesib:leavePage",{when:e,from:t.page,to:n.page});if(!o.dispatch(s)||l!==c||!m(e,t,a,n))return d(n);return n}();return s?(t=s,i[n](t,u),o.dispatch(new $t("wesib:enterPage",{when:n,to:t.page})),t.page):s}catch(e){throw d(t,e),e}}function d(e,t){return e&&e.stay(u.it.page),o.dispatch(new Bt("wesib:stayOnPage",{from:u.it.page,to:a,reason:t})),null}}function g(e,t,n,s){const r=i.newEntry(n);try{t.transfer(r,e),s(r.page)}catch(e){throw r.stay(u.it.page),e}return r}function m(e,t,n,s){let r=!1;return c((({url:e,data:t,title:s})=>{r=!0,n.url=e,n.data=t,n.title=s}),e,t.page,s.page),r}}))});class Wt{static get[x](){return Ht}[P](){return this.on}[q](){return this.read}back(){this.go(-1)}forward(){this.go(1)}reload(){this.go()}}function Vt(n={}){const{select:s="a",pick:r={all:!0,deep:!0}}=n;return de({define(o){o.whenComponent((o=>{const i=function(n,s){const r=n.get(fe),{render:o,active:i=Zt}=s,a=L.name(i,n.get(_e)),c=s.activate?s.activate.bind(s):t,u=(e,{node:t})=>{const{element:n}=t,{classList:s}=n;e?s.add(a):s.remove(a)};return t=>{const{element:n}=t.node,s=n[Yt]||(n[Yt]=r(o)),i=e=>{s((()=>u(e,t))),c(e,t)};let a;return i(!0),{supply(){const t=a=new e((()=>{a===t&&i(!1)}));return t}}}}(o,n),a=function(t){if(!t.weigh)return Jt;return n=>{const s=t.weigh(n);if("number"==typeof s)return j(n.node,s);let r=z(s).do(K(((e,t)=>e(n.node,t))));return $((t=>{r({supply:(new e).needs(t.supply).whenOff((()=>{r=j(n.node,0),r(t)})),receive:t.receive.bind(t)})}))}}(n),u=o.get(Wt),l=o.get(xt);o.whenConnected((()=>{let t=new Map;u.read.do(N(o),M((n=>l.select(s,r).read.do(F((e=>I(...c(e,(e=>a({node:e,context:o,page:n})))))),M(((...s)=>{const r=function(e){let t=0,n=[];return e.forEach((([e,s])=>{s>t?(t=s,n=[e]):s===t&&n.push(e)})),n}(s),a=new Map,c=new e;return r.forEach((e=>{let s;const r=t.get(e);r?(a.set(e,r),s=r):(s=i({node:e,context:o,page:n}),a.set(e,s)),s.supply().needs(c)})),t=a,c}))))))}))}))}})}function Jt({node:e,page:t}){const{element:n}=e,s=n.getAttribute("href");if(null==s)return j(e,-1);const r=new URL(s,n.ownerDocument.baseURI);return j(e,Gt(r,t.url))}function Gt(e,t){if(e.origin!==t.origin)return-1;const n=Qt(e),s=Qt(t);if(e.hash){if(n!==s)return-1;const r=Xt(e,t);return r<0||Xt(t,e)<0?-1:e.pathname.length+r+Gt(kt(e),kt(t))}const r=Xt(e,t);return r?r<0||n!==s?-1:e.pathname.length+r:s.startsWith(n)?e.pathname.length:-1}function Qt(e){const t=e.pathname;return t.endsWith("/")?t:t+"/"}function Xt({searchParams:e},{searchParams:t}){let n=0;return e.forEach(((e,s)=>{(function(e){return e.startsWith("__")&&e.endsWith("__")})(s)||n>=0&&(t.getAll(s).includes(e)?n+=1:n=-1)})),n}const Yt=Symbol("nav-link-render-schedule"),Zt=["active",xe];function en(e={}){const t=e.handle?e.handle.bind(e):function(e){const t=e.href?e.href.bind(e):tn;return({event:e,page:n,navigation:s})=>{const r=t(e);if(null==r)return;const o=e.target,i=n.url,a=new URL(r,o.ownerDocument.baseURI);a.origin===i.origin&&(e.preventDefault(),i.href!==a.href&&s.open(r).catch(console.error))}}(e),s=n(e.event||"click");return de({define(e){e.whenComponent((e=>{e.whenConnected((()=>{const n=e.get(Wt);for(const r of s)e.on(r)((s=>{n.read.do(E)((r=>t({event:s,page:r,context:e,navigation:n})))}))}))}))}})}function tn(e){return e.target.getAttribute("href")}function nn(e,t,n,s=sn){let r;"function"==typeof n?(s=n,r=null):r=n||null;const o=t.ownerDocument;if(Ce(e)){const n=o.createElement(e.tagName.toLowerCase());return e.getAttributeNames().forEach((t=>n.setAttribute(t,e.getAttribute(t)))),s(e,n),t.insertBefore(n,r),n}const i=o.importNode(e,!1);return t.insertBefore(i,r),i}function sn(e,t){u(l(e.childNodes),(e=>nn(e,t)))}function rn(t){let n;return s=>{const o=function(e){return new URL("",e.url).href}(s);if(n){if(n.url===o)return n.on;n.sup.off()}let i;const a=new e((()=>{n=void 0,i=void 0})),c=W((e=>{if(!i){const e=t(s),n=T(),o=e((e=>{n.it=e})).whenOff((e=>{null!=e&&a.off(e)}));a.cuts(o).cuts(n),i={on:n.read.do(V(r)),num:0}}const n=i;return++n.num,n.on.do(J(a))(e).whenOff((e=>{--n.num||Promise.resolve().then((()=>{n.num||n!==i||a.off(e)})).catch(console.error)}))}));return n={url:o,on:c,sup:a},c}}class on extends Error{}const an=new class extends Rt{create(e,n){return{get:()=>n,put:t}}};class cn{constructor(e,t){this._navigation=e,this._loader=t,this._map=new Map,this._requests=p(y((()=>this._map.values())))}get fragments(){const e=[];return f(this._requests,(t=>!!t.fragment&&(e.push(t.fragment),!0)))?e:[]}handle(){const t=this,n=new e;let s=i();return{get(){},put(e){t._add(e)},transfer(e,n){if("pretend"===n)return;const s=t._transfer();return e.put(an,s),s.handle()},enter(r,o){if("init"===o)return;s=(new e).needs(n);const i=W((e=>{const n=new G,o=n.on(e);return t._loader(r).do(J(s))((e=>n.send(e))).whenOff((e=>{void 0===e||e instanceof on||n.send({ok:!1,page:r,error:e})})),o})).do(Q);u(t._requests,(({fragment:t,receiver:n})=>function(e,t){return t?e.do(X((e=>e.ok?{...e,fragment:(null!=t.tag?e.document.getElementsByTagName(t.tag)[0]:e.document.getElementById(t.id))||void 0}:e))):e}(i,t)({supply:(new e).needs(n.supply),receive(e,t){n.receive(e,t)}})))},leave(){s.off(new on("page left"))},stay(){n.off(new on("navigation cancelled"))},forget(){n.off(new on("page forgotten"))}}}_add(e){const t={...e,receiver:Y(e.receiver)},{supply:n}=t.receiver,s=this._map.get(n);s?s.push(t):(this._map.set(n,[t]),n.whenOff((()=>this._map.delete(n))))}_transfer(){const e=new cn(this._navigation,this._loader);for(const[t,n]of this._map.entries())e._map.set(t,n.slice());return e}}const un=new Ye("page-load-agent"),ln=new C("page-load-url",{byDefault:s(t)}),hn=new k("page-loader",{byDefault:ve((function(e){const t=e.get(pe),n=e.get(nt),s=e.get(ln),r=e.get(un),o=new t.DOMParser;return e=>{const t=new URL(e.url.href);s(t);const i=new Request(t.href,{mode:"same-origin",credentials:"same-origin",headers:new Headers({Accept:"text/html"})});return W((e=>r(a,i)(e)));function a(s){return function(e,t){var n;const s=null===(n=e.get(an))||void 0===n?void 0:n.fragments;s&&s.length&&t.headers.set("Accept-Fragment",s.reduce(((e,t)=>(e?e+", ":"")+(null!=t.tag?"tag="+Xe(t.tag):"id="+Xe(t.id))),""))}(e,s),W((r=>{const i=new ae;i.on(r),i.send({page:e}),n(s).do(X((e=>Promise.all([e,e.text()]))),Z,ee(((...e)=>j(...e))),X((([n,s])=>{if(!n.ok)return{ok:!1,page:e,response:n,error:n.status};try{return{ok:!0,page:e,response:n,document:dn(o,t,n,s)}}catch(t){return{ok:!1,page:e,response:n,error:t}}})))(r)}))}}}))});function dn(e,t,n,s){const r=e.parseFromString(s,Qe(n.headers.get("Content-Type")||"text/html")[0].v);if(r.head){const e=r.head.querySelector("base");if(e)e.href=new URL(e.getAttribute("href"),t).href;else{const e=r.createElement("base");e.href=t.href,r.head.appendChild(e)}}return r}class pn extends Rt{create(e,t,n){const s=new cn(n.get(Wt),rn(n.get(hn))),r=s.handle();return e.put(an,s),r.put(t),r}}const fn=new pn,gn=new k("page-cache-buster",{byDefault:ve((e=>new mn(e)))});class mn{constructor(e){const t=wn(e.get(pe).document);if(t){const n=e.get(Wt);this.urlModifier=j((e=>e.searchParams.set("__wesib_app_rev__",t))),this.agent=j(((e,s)=>e(new Request(s.url,s)).do(X((e=>{if(e.ok){const s=wn(e.document);if(s&&s!==t){const t=new URL(e.page.url.href);t.searchParams.set("__wesib_app_rev__",s),n.update(t),n.reload()}}return e})))))}else this.urlModifier=j(),this.agent=j()}static get[x](){return gn}}function wn(e){var t;return null===(t=e.querySelector("meta[name=wesib-app-rev]"))||void 0===t?void 0:t.getAttribute("content")}function _n(e){const t=e.get(pe).document;return e=>e().do(X((e=>{if(e.ok){const n=new Set(c(yn(t,t.scripts),(([e])=>e)));u(g(yn(e.document,e.document.querySelectorAll("script")),(([e])=>!n.has(e))),(([e,s])=>{nn(s,t.head,((t,n)=>n.src=e)),n.add(e)}))}return e})))}function yn(e,t){return c(d(t,(({src:e})=>!!e)),(t=>[new URL(t.src,e.baseURI).href,t]))}function bn(e){const t=e.get(pe).document;return e=>e().do(X((e=>{if(!e.ok)return e;const n=e.document.querySelectorAll("link[rel=stylesheet]");if(!n.length)return e;let s=t.head,r=null;const o=t.querySelectorAll("link[rel=stylesheet]"),i=new Map,a=o.item(0);return a&&(s=a.parentNode,r=a,u(l(o),(e=>i.set(new URL(e.href,t.baseURI).href,e)))),u(l(n),(e=>{const n=new URL(e.href,t.baseURI).href,o=i.get(n);o?(m(i.keys())===n?(s=o.parentNode,r=o.nextSibling):s.insertBefore(o,r),i.delete(n)):nn(e,s,r,((e,t)=>t.href=n))})),u(i.values(),(e=>e.parentNode.removeChild(e))),e})))}function vn(e){const t=e.get(pe).document;return e=>e().do(X((e=>{if(e.ok){const n=e.document.getElementsByTagName("title").item(0);n&&n.textContent&&(t.title=n.textContent)}return e})))}const xn={setup(e){e.provide({a:ln,by:e=>e.urlModifier,with:[mn]}),e.provide({a:un,by:e=>e.agent,with:[mn]}),e.provide({a:un,by:_n}),e.provide({a:un,by:bn}),e.provide({a:un,by:vn})}};class kn{static get[we](){return xn}}function Sn(n={}){const r=n.onResponse?n.onResponse.bind(n):t,o=n.contentKey?n.contentKey.bind(n):Cn;return de({feature:{needs:[kn]},define(t){t.whenComponent((t=>{const{fragment:i,render:a}=n,c=t.get(pe).document,u=t.get(fe)(a),l=t.get(Wt);let h,d=o(l.page);h=i?s(i):()=>{const{element:{id:e,tagName:n}}=t;return e?{id:e}:{tag:n}},t.whenConnected((()=>{const n=c.createRange();n.selectNodeContents(t.contentRoot),l.read.do(E)((s=>{s.put(fn,{fragment:h(),receiver:{supply:(new e).needs(t),receive:(e,s)=>function(e){const s=o(e.page);if(s===d)return;if(!e.ok)return void u((()=>r({context:t,range:n,response:e})));d=s,u((()=>{n.deleteContents();const s=c.createDocumentFragment(),{fragment:o}=e;o&&(sn(o,s),n.insertNode(s)),r({context:t,range:n,response:e})}))}(s)}})}))}))}))}})}function Cn({url:e}){return new URL("",e).href}class Rn extends R{get upKey(){return this}constructor(){super("default-in-aspects")}grow(e){const t=e.context.get(_e),n=e.context.get(fe);e.insert(e.seed.do(se(((...e)=>De(...e,Le.to(n),Ae.to(t)))),N(e.context.get(D))))}}const Un=new Rn,On=new O("input-from-control",{byDefault:()=>({})});function Dn(e,t){return e.get(ct).provide({a:On,by:()=>({root:e,control:t})}).needs(e).needs(t)}function Ln(e){return de({define(t){t.whenComponent((t=>{const{up:n}=t.get(ct);ce({parent:n.do(F((e=>e?e.get(On):j({})))),aspects:t.get(Un)}).do(F((({parent:[n],aspects:[s]})=>{if(n.control){const r=e({control:n,context:t,aspects:s});if(r)return r instanceof Ne?j(r):r}return j()})),M(((e,n)=>{if(!e)return;const s=Dn(t,e);return(n||e.supply).needs(s),s})))}))}})}const An=new O("input-to-form",{byDefault:()=>({})});function En(e){const{select:t="form",pick:n={deep:!0,all:!0}}=e;return de({define(s){s.whenComponent((s=>{const r=s.get(xt);s.whenConnected((()=>{ce({node:r.select(t,n).first,aspects:s.get(Un)}).do(H((({node:[t],aspects:[n]})=>{if(!t)return j();const r=e.makeForm({node:t,context:s,aspects:n});return r?Array.isArray(r)?j(...r):r:j()})),M(((e,t,n)=>{if(!e)return;const r=function(e,t,n){const s=e.get(ct),r=s.provide({a:An,by:()=>({root:e,control:t,form:n})});return s.provide({a:On,via:An}).needs(r),r.needs(e).needs(t).needs(n)}(s,e,t);return n?n.needs(r):r.cuts(t).cuts(e),r})))}))}))}})}function Nn(e={}){const{cancel:t=!0}=e;return Oe((({get:e})=>({componentDef:{define(n){n.whenComponent((n=>{n.whenConnected((()=>{const s=n.get(ct),{component:r}=n;s.get(An).do(M((s=>{if(!s.control)return;const o=new le(s.form.element);o.supply.needs(n);const i=o.on("submit");return(t?i.do(he(!1)):i)((t=>e(r).call(r,s,t)))})))}))}))}}})))}function Mn(e){const t="string"==typeof e?s(j(e)):t=>{const n=e(t);return"string"==typeof n?j(n):n};return de({define(e){e.whenComponent((e=>{const n=e.get(ct);ce({group:n.up.do(F((e=>e?e.get(On):j({}))),ue((({control:e})=>e&&e.aspect(Ee)))),control:n.get(On),name:t(e)}).do(M((({group:[e],control:[{control:t}],name:[n]})=>{if(null!=n&&e&&t&&e!==t)return e.controls.set(n,t)})))}))}})}function Pn(e){const{select:t="input",pick:n={deep:!0,all:!0}}=e;return de({define(s){s.whenComponent((s=>{const r=s.get(xt);s.whenConnected((()=>{ce({node:r.select(t,n).first,aspects:s.get(Un)}).do(H((({node:[t],aspects:[n]})=>{if(!t)return j();const r=e.makeControl({node:t,context:s,aspects:n});return r?r instanceof Ne?j(r):r:j()})),M(((e,t)=>{if(!e)return;const n=Dn(s,e);return(t||e.supply).needs(n),n})))}))}))}})}export{Vt as A,Ln as C,Un as D,En as F,nt as H,On as I,Wt as N,Nn as O,Lt as P,Mn as S,Pn as U,ct as a,xt as b,An as c,en as d,Sn as e,Rt as f,Pt as g,Dn as i};//# sourceMappingURL=generic.5b4ac940.js.map
