import{x as t,s as e,G as n,l as s,O as r,A as o,w as a,b as i,k as c,y as u,H as l,e as h,t as p,g as d,v as f,I as g,q as m,J as _,j as y,K as w,L as v,C as b,E as S,M as x,a as k,N as F,z as R,r as A,d as U,c as C,f as E,o as L,p as D,h as M,V as j,P,n as N}from"../proc7ts/fun-events.3257bf57.js";import{n as O,s as V,v as q,c as B,a as I,b as K,i as z,f as T,m as W,l as H}from"../proc7ts/primitives.38e5298b.js";import{h as $,j as G,k as J,l as Q,m as X,n as Y,o as Z,f as tt,a as et,i as nt,p as st,q as rt,e as ot,r as at,s as it,t as ct}from"../frontmeans/input-aspects.f8acf040.js";import{b as ut,a as lt,C as ht,i as pt,c as dt,d as ft,e as gt,F as mt,f as _t,g as yt,h as wt,j as vt,k as bt}from"../proc7ts/context-values.24d38e04.js";import{C as St,B as xt,E as kt,c as Ft,d as Rt,l as At,m as Ut,k as Ct,n as Et,o as Lt,a as Dt,W as Mt,p as jt,q as Pt,r as Nt,s as Ot,t as Vt,j as qt}from"./wesib.c496f508.js";import{D as Bt,h as It}from"../frontmeans/dom-events.1d1a7091.js";import{m as Kt,i as zt,a as Tt,j as Wt,f as Ht,k as $t,g as Gt,h as Jt,p as Qt,P as Xt,e as Yt,l as Zt,n as te}from"../proc7ts/push-iterator.c8328864.js";import{c as ee,h as ne}from"../frontmeans/namespace-aliaser.9467f14d.js";import{S as se,n as re}from"../proc7ts/supply.9762ee6d.js";import{h as oe,a as ae}from"../hatsy/http-header-value.851567fb.js";class ie extends _t{constructor(t){super(t),this.upKey=this.createUpKey((t=>t.insert(t.seed.do(C(((...e)=>e.length?i(function(t){return(e,n)=>{const s=(n,r)=>{const o=t[n];return o?E(o(((t=r)=>s(n+1,t)),r)):e(r)};return s(0,n)}}(e)):t.hasFallback&&t.or?t.or:i(ce)))))))}grow(t){let e;t.context.get(this.upKey,t.hasFallback?{or:null!=t.or?i(t.or):t.or}:void 0)((t=>e=t)).whenOff((t=>e=yt(t))),t.insert(((t,n)=>e(t,n)))}}function ce(t,e){return t(e)}const ue=new ie("http-fetch-agent"),le={};const he=new mt("http-fetch",{byDefault:Dt((function(t){const e=t.get(xt),n=t.get(ue);return(t,e)=>n(s,new Request(t,e));function s(t){return d((n=>{const s=new S;let r;if("AbortController"in e){const o=new e.AbortController,{signal:a}=o;r=new se((t=>{t===le&&o.abort()})),n.supply.whenOff((()=>r.off(le))).needs(r),s.on({supply:r,receive(t,e){n.receive(t,e)}});const i=t.signal;i&&(new Bt(i).on("abort").do(L)((()=>o.abort())),i.aborted&&o.abort()),t=new Request(t,{signal:a})}else r=s.on(n);e.fetch(t).then((t=>{s.send(t),r.off()})).catch((t=>r.off(t)))}))}}))});class pe{[r](){return this.onUpdate}[o](){return this.read}}const de={subtree:!0};function fe(t,e,n,s,{deep:r,all:o}){const a=new S,i=r?de:void 0;let c,l=new Set;const h=r?ge:Tt;"string"==typeof n?c=n:t.whenDefined(n).then((({elementDef:{name:e}})=>{if(e&&(c=ne.name(e,t.get(Ct)),a.size)){const t=g();if(t.size){const e=Wt(Jt(Kt(t,(t=>s(t))),z));e.length&&a.send(e,[])}}})).catch(console.error),o||e.addEventListener("wesib:component",(t=>{const e=t.target;if(l.has(e)){const t=s(e);a.send([t],[])}}));const p=Jt(Kt(Zt((function(){return te(a.size?l:g())})),(t=>s(t))),z);class f extends pe{constructor(){super();const n=t.get(Nt)(_);this.onUpdate=d((t=>{const s=!a.size,r=a.on(t);s&&(g(),n.observe(e,i)),r.whenOff((()=>{a.size||(n.disconnect(),l.clear())})).needs(t.supply)}));const s=q(this);this.read=this.onUpdate.do(D(s,s)),this.track=u((t=>{const e=new S;e.on(t),e.send(Wt(this),[]),this.onUpdate(t)})),this.first=M(this.read).do(m(((t,e)=>t(Qt(e)))))}[Symbol.iterator](){return this[Xt]()}[Xt](t){return p[Xt](t)}}return new f;function g(){const t=function(){const t=c;if(!t)return new Set;if(r)return new Set(Tt(e.querySelectorAll(t)));return new Set(Ht(e.children,(e=>e.matches(t))))}();return a.size&&(l=t),t}function _(t){const e=[],n=[];t.forEach((t=>{zt(Jt(Kt(h(t.removedNodes),w),z),(t=>n.push(t))),zt(Jt(Kt(h(t.addedNodes),y),z),(t=>e.push(t)))})),(e.length||n.length)&&a.send(e,n)}function y(t){if(Ot(t))return c&&t.matches(c)&&!l.has(t)?(l.add(t),s(t)):void 0}function w(t){if(Ot(t)&&l.delete(t))return s(t,!0)}}function ge(t){return Yt(t,(t=>Tt([t,...ge(t.childNodes)])))}class me{constructor(t,e){this._bs=t,this.element=e,this._emitters=new Map}get observer(){if(this._observer)return this._observer;const t=this._bs.get(xt).MutationObserver;return this._observer=new t((t=>this._update(t)))}observe(t,e){const n=this,s=this.observer,r=this._emitter(t),o=F(e),a=r.on({supply:new se((()=>{this._emitters.delete(t),s.disconnect(),this._emitters.size?i():this._observer=void 0})).needs(o.supply),receive:(t,e,n)=>o.receive(t,e,n)});return s.disconnect(),i(),a;function i(){n._update(s.takeRecords()),s.observe(n.element,{attributes:!0,attributeOldValue:!0,attributeFilter:[...n._emitters.keys()]})}}_update(t){t.forEach((t=>{const e=t.attributeName,n=this._emitters.get(e);n&&n.send(this.element.getAttribute(e),t.oldValue)}))}_emitter(t){const e=new S;return this._emitters.set(t,e),e}}class _e extends j{constructor(t,e){super(),this._observer=t,this._name=e,this._updates=new S;let n=re();this.on=d((t=>{this._updates.size||(n=this._observer.observe(this._name,((t,e)=>this._updates.send(t,e)))),t.supply.needs(n),this._updates.on(t).whenOff((t=>{this._updates.size||n.off(t)}))}))}get supply(){return this._updates.supply}get it(){return this._observer.element.getAttribute(this._name)}set it(t){null!=t?this._observer.element.setAttribute(this._name,t):this._observer.element.removeAttribute(this._name)}}class ye{constructor(t,e){this._attrs=new Map,this._observer=new me(t,e)}get(t){const e=this._attrs.get(t);if(e)return e;const n=new _e(this._observer,t);return this._attrs.set(t,n),n}}class we extends j{constructor(t,e){super(),this._element=t,this._updates=new S,this._key=e}get supply(){return this._updates.supply}get it(){return this._element[this._key]}set it(t){this._element[this._key]=t}get on(){return this._updates.on}bind(t){t.get(Vt).track(qt(this._key)).onUpdate({supply:this.supply,receive:(t,e,n,s)=>this._updates.send(n,s)})}}class ve{constructor(t){this._element=t,this._props=new Map}bind(t){this._context=t,this._props.forEach((e=>e.bind(t)))}get(t){const e=this._props.get(t);if(e)return e;const n=new we(this._element,t);return this._context&&n.bind(this._context),this._props.set(t,n),n}}const be=Symbol("element-node");class Se{constructor(t,e){this._bs=t,this.element=e,this._attrs=new ye(t,e),this._props=new ve(e),e[be]=this;const n=this.context;n?this._bind(n):e.addEventListener("wesib:component",(t=>this._bind(t.context)))}get context(){var t;return null===(t=this.element[Et])||void 0===t?void 0:t.context}get parent(){const t=this.element.parentNode;return t&&xe(this._bs,t)}select(t,e){return function(t,e,n,s={}){if(s.all)return fe(t,e,n,((e,n)=>xe(t,e,n)),s);const r=t.get(Lt);return fe(t,e,n,((e,n)=>r(e)&&xe(t,e,n)),s)}(this._bs,this.element,t,e)}attribute(t){return this._attrs.get(t)}property(t){return this._props.get(t)}_bind(t){this._props.bind(t)}}function xe(t,e,n){const s=e[be];return s||n?s:new Se(t,e)}const ke=new lt("component-node",{byDefault:t=>xe(t.get(At),t.get(Rt).element)});function Fe(t){return new URL(t.hash.substring(1),t.origin)}function Re(t,e){if(e.origin!==t.origin||e.username)return new URL(`#${e}`,t);const{pathname:n,search:s,hash:r}=e,o=new URL("",t);return o.hash=s||r||n.length>1?n+s+r:s+r,o}const Ae=Symbol("page-param");class Ue{get[Ae](){return this}byDefault(t,e){}}class Ce extends Ue{create(t,e){let n;const s={get:()=>n,put(e){n="string"==typeof e?new URL(e,t.url.origin):e}};return s.put(e),s}}const Ee=new Ce;class Le extends Ue{create(t,e){const n={get:()=>t.get(Ee)||Fe(t.url),put(e){t.put(Ee,e)}};return n.put(e),n}byDefault(t){return this.create(t,null)}}const De=new Le;class Me extends _t{constructor(t){super(t),this.upKey=this.createUpKey((t=>{const{document:e}=t.context.get(xt);t.insert(t.seed.do(C(((...n)=>n.length?i((function(t,s,r,o){return a(0,o);function a(o,i){const c=n[o];if(!c)return t(i);c((({url:t=i.url,title:n=i.title,data:s=i.data}=i)=>a(o+1,{url:new URL(String(t),e.baseURI),title:n,data:s,get visited(){return i.visited},get current(){return i.current},get:t=>i.get(t),put(t,e){i.put(t,e)}})),s,r,i)}})):t.hasFallback&&t.or?t.or:i(je)))))}))}grow(t){let e;t.context.get(this.upKey,t.hasFallback?{or:null!=t.or?i(t.or):t.or}:void 0)((t=>e=t)).whenOff((t=>e=yt(t))),t.insert(((t,n,s,r)=>e(t,n,s,r)))}}function je(t,e,n,s){t(s)}const Pe=new Me("navigation-agent"),Ne={setup(t){t.provide({a:Pe,is:Ve})}};class Oe{static get[Ut](){return Ne}}function Ve(t,e,n,s){const r=s.get(Ee);r?t({url:Re(s.url,r)}):t()}class qe extends vt{}const Be=new lt("nav-history",{byDefault:Dt((t=>new Ke(t)))});function Ie(t){return null==t||"object"!=typeof t?{data:t}:t["wesib:navigation:data"]}class Ke{constructor(t){this._context=t,this._entries=new Map,this._lastId=0;const e=t.get(xt);this._document=e.document,this._location=e.location,this._history=e.history,this._uid=btoa(String(Math.random()))}static get[ht](){return Be}init(){const{data:t}=Ie(this._history.state),e=this.newEntry({url:new URL(this._location.href),data:t,title:this._document.title});return this._entries.set(e.id,e),e.schedule((()=>{e.enter("init"),this._history.replaceState(this._historyState(e),"")})),e}newEntry(t){return new ze(this._context,++this._lastId,t)}open(t,e){const{page:{title:n="",url:s}}=t;this._history.pushState(this._historyState(t),n,s.href),this._enter("open",t,e)}_enter(t,e,n){const s=n.it;this._entries.set(e.id,e);try{for(let t=s.next;t;t=t.next)this._forget(t)}finally{e.prev=s,s.next=e,e.schedule((()=>{try{s.leave()}finally{e.enter(t)}})),n.it=e}}replace(t,e){const n=e.it,{page:{title:s="",url:r}}=t;this._history.replaceState(this._historyState(t),s,r.href),this._entries.set(t.id,t);const o=n.prev;o&&(t.prev=o,o.next=t),t.schedule((()=>{try{n.leave()}finally{try{this._forget(n)}finally{t.enter("replace")}}})),e.it=t}popState(t,e){const{state:n}=t;if(null==n)return null==this._history.state?this._changeHash(e):void 0;const s=e.it,{uid:r,data:o,id:a}=Ie(n);let i;const c=r===this._uid&&null!=a?this._entries.get(a):void 0;return c?i=c:(i=this.newEntry({url:new URL(this._location.href),data:o,title:this._document.title}),s.transfer(i,"return"),this._entries.set(i.id,i),this._history.replaceState(this._historyState(i),"")),i.schedule((()=>{try{s.leave()}finally{i.enter("return")}})),e.it=i,i}hashChange(t){if(null==this._history.state)return this._changeHash(t)}update(t,e){const n=t.it,s=new ze(this._context,++this._lastId,{...n.page,url:e},n);return this._entries.set(s.id,s),this._history.replaceState(this._historyState(s),"",e.href),this._entries.delete(n.id),t.it=s}_changeHash(t){const e=t.it,n=this.newEntry({url:new URL(this._location.href),data:null,title:this._document.title});try{e.transfer(n,"enter")}finally{this._history.replaceState(this._historyState(n),""),this._enter("enter",n,t)}return n}_forget(t){this._entries.delete(t.id),t.forget()}_historyState({id:t,page:{data:e}}){return{"wesib:navigation:data":{uid:this._uid,id:t,data:e}}}}class ze{constructor(t,e,n,s){this._bsContext=t,this.id=e,this._status=0,this._update=O,this._params=s?s._params:new Map;const r=this;this.page={get url(){return n.url},get title(){return n.title},get data(){return n.data},get visited(){return!!r._status},get current(){return 2===r._status},get:t=>r.get(t),put(t,e){r.put(t,e)}}}get(t){const e=t[Ae],n=this._params.get(e);if(n)return n.get();const s=e.byDefault(this.page,this._newContext());return s&&this._init(e,s)}put(t,e){const n=t[Ae],s=this._params.get(n);return s?(s.put(e),s.get()):this._init(n,n.create(this.page,e,this._newContext()))}_newContext(){const t=new wt(this._bsContext);return new class extends qe{constructor(){super(...arguments),this.get=t.newValues().get}}}_init(t,e){return this._params.set(t,e),this.page.current&&e.enter&&e.enter(this.page,"init"),e.get()}transfer(t,e){zt(this._params.entries(),(([n,s])=>{if(s.transfer){const r=s.transfer(t.page,e);r&&t._params.set(n,r)}}))}stay(t){zt(this._params.values(),(e=>e.stay&&e.stay(t)))}enter(t){this._status=2,zt(this._params.values(),(e=>e.enter&&e.enter(this.page,t)))}leave(){this._status=1,zt(this._params.values(),(t=>t.leave&&t.leave()))}forget(){zt(this._params.values(),(t=>t.forget&&t.forget())),this._params.clear()}schedule(t){this._update=t}apply(){const t=this._update;this._update=O,t()}}class Te extends Event{constructor(t,e){super(t,{...e,cancelable:!1}),this.when=e.when,this.to=e.to}}class We extends Event{constructor(t,e){super(t,{...e,cancelable:!0}),this.when=e.when,this.from=e.from,this.to=e.to}}class He extends Event{constructor(t,e){super(t,{...e,cancelable:!0}),this.from=e.from,this.to=e.to,this.reason=e.reason}get when(){return"stay"}}const $e=new lt("navigation",{byDefault:Dt((function(t){const e=t.get(xt),{document:n,history:s}=e,r=new Bt(e),o=t.get(Ke),a=t.get(Pe),i=p(o.init());i.read((t=>t.apply()));let c=Promise.resolve();r.on("popstate")((t=>{const e=o.popState(t,i);e&&r.dispatch(new Te("wesib:enterPage",{when:null!=t.state?"return":"enter",to:e.page}))})),r.on("hashchange")((()=>{const t=o.hashChange(i);t&&r.dispatch(new Te("wesib:enterPage",{when:"enter",to:t.page}))}));return new class extends Ge{constructor(){super(),this.onEnter=r.on("wesib:enterPage"),this.onLeave=r.on("wesib:leavePage"),this.onStay=r.on("wesib:stayOnPage"),this.on=P(E(this.onEnter),E(this.onLeave),E(this.onStay)),this.read=i.read.do(D((({page:t})=>t)))}get page(){return i.it.page}get length(){return s.length}go(t){s.go(t)}open(t){return d("pre-open","open",t)}replace(t){return d("pre-replace","replace",t)}update(t){return o.update(i,l(t)).page}with(t,e){return u((n=>n.put(t,e)))}};function u(t){return{with:(e,n)=>u(W(t,(t=>t.put(e,n)))),open:e=>d("pre-open","open",e,t),replace:e=>d("pre-replace","replace",e,t),pretend(e,n=((t,e)=>e)){let s;"function"==typeof e?(n=e,s=void 0):s=e;const r=h(s),o=i.it,a=f("pretend",o,r,t);try{return g("pretend",o,r,a)?n(o.page,a.page):void 0}finally{a.stay(i.it.page)}}}}function l(t){return"string"==typeof t?new URL(t,n.baseURI):t||i.it.page.url}function h(t){return null==t||"string"==typeof t||t instanceof URL?{url:l(t)}:t.url instanceof URL?t:{...t,url:l(t.url)}}function d(t,e,n,s=O){const a=h(n),u=c=c.then(l,l);return u;function l(){let n;try{const l=function(){if(c!==u)return p();const e=i.it,n=f(t,e,a,s),o=new We("wesib:leavePage",{when:t,from:e.page,to:n.page});if(!r.dispatch(o)||c!==u||!g(t,e,a,n))return p(n);return n}();return l?(n=l,o[e](n,i),r.dispatch(new Te("wesib:enterPage",{when:e,to:n.page})),n.page):l}catch(t){throw p(n,t),t}}function p(t,e){return t&&t.stay(i.it.page),r.dispatch(new He("wesib:stayOnPage",{from:i.it.page,to:a,reason:e})),null}}function f(t,e,n,s){const r=o.newEntry(n);try{e.transfer(r,t),s(r.page)}catch(t){throw r.stay(i.it.page),t}return r}function g(t,e,n,s){let r=!1;return a((({url:t,data:e,title:s})=>{r=!0,n.url=t,n.data=e,n.title=s}),t,e.page,s.page),r}}))});class Ge{static get[ht](){return $e}[r](){return this.on}[o](){return this.read}back(){this.go(-1)}forward(){this.go(1)}reload(){this.go()}}function Je(t={}){const{select:r="a",pick:l={all:!0,deep:!0}}=t;return St({define(h){h.whenComponent((h=>{const p=function(t,e){const n=t.get(kt),{render:s,active:r=en}=e,o=ee.name(r,t.get(Ct)),a=e.activate?e.activate.bind(e):O,i=(t,{node:e})=>{const{element:n}=e,{classList:s}=n;t?s.add(o):s.remove(o)};return t=>{const{element:e}=t.node,r=e[tn]||(e[tn]=n(s)),o=e=>{r((()=>i(e,t))),a(e,t)};let c;return o(!0),{supply(){const t=c=new se((()=>{c===t&&o(!1)}));return t}}}}(h,t),d=function(t){if(!t.weigh)return Qe;return e=>{const n=t.weigh(e);if("number"==typeof n)return i(e.node,n);let s=n[o]().do(c(((t,n)=>t(e.node,n))));return u((t=>{s({supply:(new se).needs(t.supply).whenOff((()=>{s=i(e.node,0),s(t)})),receive:t.receive})}))}}(t),f=h.get(Ge),g=h.get(ke);h.whenConnected((()=>{let t=new Map;f.read.do(e(h),n((e=>g.select(r,l).read.do(s((t=>a(...Kt(t,(t=>d({node:t,context:h,page:e})))))),n(((...n)=>{const s=function(t){let e=0,n=[];return t.forEach((([t,s])=>{s>e?(e=s,n=[t]):s===e&&n.push(t)})),n}(n),r=new Map,o=new se;return s.forEach((n=>{let s;const a=t.get(n);a?(r.set(n,a),s=a):(s=p({node:n,context:h,page:e}),r.set(n,s)),s.supply().needs(o)})),t=r,o}))))))}))}))}})}function Qe({node:t,page:e}){const{element:n}=t,s=n.getAttribute("href");if(null==s)return i(t,-1);const r=new URL(s,n.ownerDocument.baseURI);return i(t,Xe(r,e.url))}function Xe(t,e){if(t.origin!==e.origin)return-1;const n=Ye(t),s=Ye(e);if(t.hash){if(n!==s)return-1;const r=Ze(t,e);return r<0||Ze(e,t)<0?-1:t.pathname.length+r+Xe(Fe(t),Fe(e))}const r=Ze(t,e);return r?r<0||n!==s?-1:t.pathname.length+r:s.startsWith(n)?t.pathname.length:-1}function Ye(t){const e=t.pathname;return e.endsWith("/")?e:e+"/"}function Ze({searchParams:t},{searchParams:e}){let n=0;return t.forEach(((t,s)=>{(function(t){return t.startsWith("__")&&t.endsWith("__")})(s)||n>=0&&(e.getAll(s).includes(t)?n+=1:n=-1)})),n}const tn=Symbol("nav-link-render-schedule"),en=["active",Mt];function nn(e={}){const n=e.handle?e.handle.bind(e):function(t){const e=t.href?t.href.bind(t):sn;return({event:t,page:n,navigation:s})=>{const r=e(t);if(null==r)return;const o=t.target,a=n.url,i=new URL(r,o.ownerDocument.baseURI);i.origin===a.origin&&(t.preventDefault(),a.href!==i.href&&s.open(r).catch(console.error))}}(e),s=V(e.event||"click");return St({define(e){e.whenComponent((e=>{e.whenConnected((()=>{const r=e.get(Ge);for(const o of s)e.on(o)((s=>{r.read.do(t)((t=>n({event:s,page:t,context:e,navigation:r})))}))}))}))}})}function sn(t){return t.target.getAttribute("href")}function rn(t,e,n,s=on){let r;"function"==typeof n?(s=n,r=null):r=n||null;const o=e.ownerDocument;if(Ot(t)){const n=o.createElement(t.tagName.toLowerCase());return t.getAttributeNames().forEach((e=>n.setAttribute(e,t.getAttribute(e)))),s(t,n),e.insertBefore(n,r),n}const a=o.importNode(t,!1);return e.insertBefore(a,r),a}function on(t,e){zt(Tt(t.childNodes),(t=>rn(t,e)))}function an(t){let e;return n=>{const s=function(t){return new URL("",t.url).href}(n);if(e){if(e.url===s)return e.on;e.sup.off()}let r;const o=new se((()=>{e=void 0,r=void 0})),a=d((e=>{if(!r){const e=t(n),s=p(),a=e((t=>{s.it=t})).whenOff((t=>{null!=t&&o.off(t)}));o.cuts(a).cuts(s),r={on:s.read.do(f(I)),num:0}}const s=r;return++s.num,s.on.do(g(o))(e).whenOff((t=>{--s.num||Promise.resolve().then((()=>{s.num||s!==r||o.off(t)})).catch(console.error)}))}));return e={url:s,on:a,sup:o},a}}class cn extends Error{}const un=new class extends Ue{create(t,e){return{get:()=>e,put:O}}};class ln{constructor(t,e){this._navigation=t,this._loader=e,this._map=new Map,this._requests=$t(Zt((()=>this._map.values())))}get fragments(){const t=[];return Gt(this._requests,(e=>!!e.fragment&&(t.push(e.fragment),!0)))?t:[]}handle(){const t=this,e=new se(O);let n=re();return{get(){},put(e){t._add(e)},transfer(e,n){if("pretend"===n)return;const s=t._transfer();return e.put(un,s),s.handle()},enter(s,r){if("init"===r)return;n=new se(O).needs(e);const o=d((e=>{const r=new S,o=r.on(e);return t._loader(s).do(g(n))((t=>r.send(t))).whenOff((t=>{void 0===t||t instanceof cn||r.send({ok:!1,page:s,error:t})})),o})).do(x);zt(t._requests,(({fragment:t,receiver:e})=>function(t,e){return e?t.do(k((t=>t.ok?{...t,fragment:(null!=e.tag?t.document.getElementsByTagName(e.tag)[0]:t.document.getElementById(e.id))||void 0}:t))):t}(o,t)({supply:(new se).needs(e.supply),receive(t,n){e.receive(t,n)}})))},leave(){n.off(new cn("page left"))},stay(){e.off(new cn("navigation cancelled"))},forget(){e.off(new cn("page forgotten"))}}}_add(t){const e={...t,receiver:F(t.receiver)},{supply:n}=e.receiver,s=this._map.get(n);s?s.push(e):(this._map.set(n,[e]),n.whenOff((()=>this._map.delete(n))))}_transfer(){const t=new ln(this._navigation,this._loader);for(const[e,n]of this._map.entries())t._map.set(e,n.slice());return t}}const hn=new ie("page-load-agent"),pn=new mt("page-load-url",{byDefault:q(O)}),dn=new lt("page-loader",{byDefault:Dt((function(t){const e=t.get(xt),n=t.get(he),s=t.get(pn),r=t.get(hn),o=new e.DOMParser;return t=>{const e=new URL(t.url.href);s(e);const a=new Request(e.href,{mode:"same-origin",credentials:"same-origin",headers:new Headers({Accept:"text/html"})});return d((t=>r(c,a)(t)));function c(s){return function(t,e){var n;const s=null===(n=t.get(un))||void 0===n?void 0:n.fragments;s&&s.length&&e.headers.set("Accept-Fragment",s.reduce(((t,e)=>(t?t+", ":"")+(null!=e.tag?"tag="+oe(e.tag):"id="+oe(e.id))),""))}(t,s),d((r=>{const a=new R;a.on(r),a.send({page:t}),n(s).do(k((t=>Promise.all([t,t.text()]))),A,U(((...t)=>i(...t))),k((([n,s])=>{if(!n.ok)return{ok:!1,page:t,response:n,error:n.status};try{return{ok:!0,page:t,response:n,document:fn(o,e,n,s)}}catch(e){return{ok:!1,page:t,response:n,error:e}}})))(r)}))}}}))});function fn(t,e,n,s){const r=t.parseFromString(s,ae(n.headers.get("Content-Type")||"text/html")[0].v);if(r.head){const t=r.head.querySelector("base");if(t)t.href=new URL(t.getAttribute("href"),e).href;else{const t=r.createElement("base");t.href=e.href,r.head.appendChild(t)}}return r}class gn extends Ue{create(t,e,n){const s=new ln(n.get(Ge),an(n.get(dn))),r=s.handle();return t.put(un,s),r.put(e),r}}const mn=new gn,_n=new lt("page-cache-buster",{byDefault:Dt((t=>new yn(t)))});class yn{constructor(t){const e=wn(t.get(xt).document);if(e){const n=t.get(Ge);this.urlModifier=i((t=>t.searchParams.set("__wesib_app_rev__",e))),this.agent=i(((t,s)=>t(new Request(s.url,s)).do(k((t=>{if(t.ok){const s=wn(t.document);if(s&&s!==e){const e=new URL(t.page.url.href);e.searchParams.set("__wesib_app_rev__",s),n.update(e),n.reload()}}return t})))))}else this.urlModifier=i(),this.agent=i()}static get[ht](){return _n}}function wn(t){var e;return null===(e=t.querySelector("meta[name=wesib-app-rev]"))||void 0===e?void 0:e.getAttribute("content")}function vn(t){const e=t.get(xt).document;return t=>t().do(k((t=>{if(t.ok){const n=new Set(Kt(bn(e,e.scripts),(([t])=>t)));zt(Jt(bn(t.document,t.document.querySelectorAll("script")),(([t])=>!n.has(t))),(([t,s])=>{rn(s,e.head,((e,n)=>n.src=t)),n.add(t)}))}return t})))}function bn(t,e){return Kt(Ht(e,(({src:t})=>!!t)),(e=>[new URL(e.src,t.baseURI).href,e]))}function Sn(t){const e=t.get(xt).document;return t=>t().do(k((t=>{if(!t.ok)return t;const n=t.document.querySelectorAll("link[rel=stylesheet]");if(!n.length)return t;let s=e.head,r=null;const o=e.querySelectorAll("link[rel=stylesheet]"),a=new Map,i=o.item(0);return i&&(s=i.parentNode,r=i,zt(Tt(o),(t=>a.set(new URL(t.href,e.baseURI).href,t)))),zt(Tt(n),(t=>{const n=new URL(t.href,e.baseURI).href,o=a.get(n);o?(Qt(a.keys())===n?(s=o.parentNode,r=o.nextSibling):s.insertBefore(o,r),a.delete(n)):rn(t,s,r,((t,e)=>e.href=n))})),zt(a.values(),(t=>t.parentNode.removeChild(t))),t})))}function xn(t){const e=t.get(xt).document;return t=>t().do(k((t=>{if(t.ok){const n=t.document.getElementsByTagName("title").item(0);n&&n.textContent&&(e.title=n.textContent)}return t})))}const kn={setup(t){t.provide({a:pn,by:t=>t.urlModifier,with:[yn]}),t.provide({a:hn,by:t=>t.agent,with:[yn]}),t.provide({a:hn,by:vn}),t.provide({a:hn,by:Sn}),t.provide({a:hn,by:xn})}};class Fn{static get[Ut](){return kn}}function Rn(e={}){const n=e.onResponse?e.onResponse.bind(e):O,s=e.contentKey?e.contentKey.bind(e):An;return St({feature:{needs:[Fn]},define(r){r.whenComponent((r=>{const{fragment:o,render:a}=e,i=r.get(xt).document,c=r.get(kt)(a),u=r.get(Ge);let l,h=s(u.page);l=o?q(o):()=>{const{element:{id:t,tagName:e}}=r;return t?{id:t}:{tag:e}},r.whenConnected((()=>{const e=i.createRange();e.selectNodeContents(r.contentRoot),u.read.do(t)((t=>{t.put(mn,{fragment:l(),receiver:{supply:(new se).needs(r),receive:(t,o)=>function(t){const o=s(t.page);if(o===h)return;if(!t.ok)return void c((()=>n({context:r,range:e,response:t})));h=o,c((()=>{e.deleteContents();const s=i.createDocumentFragment(),{fragment:o}=t;o&&(on(o,s),e.insertNode(s)),n({context:r,range:e,response:t})}))}(o)}})}))}))}))}})}function An({url:t}){return new URL("",t).href}const Un=Symbol("Share");function Cn(t){return!(!t||"object"!=typeof t&&"function"!=typeof t||!t[Un])}const En=new lt("share-registry",{byDefault:Dt((t=>new Ln(t.get(Ct))))});class Ln{constructor(t){this.nsAlias=t,this._sharers=new Map}static get[ht](){return En}addSharer(t,e,n,s){let r=this._sharers.get(t);r?(jn(r,e,s),Mn(r,n,s),r.it={...r.it}):(r=Dn(),this._sharers.set(t,r),jn(r,e,s),Mn(r,n,s))}sharers(t){let e=this._sharers.get(t);return e||(e=Dn(),this._sharers.set(t,e)),e}}function Dn(){return p({names:new Map,sharers:new Map})}function Mn(t,e,n){if(!e)return;const s=t.it,r=s.names.get(e)||0;s.names.set(e,r+1),n.whenOff((()=>{const n=s.names.get(e)-1;n>0?s.names.set(e,n):s.names.delete(e),t.it={...s}}))}function jn(t,e,n){const s=t.it,r=s.sharers.get(e)||0;s.sharers.set(e,r+1),n.whenOff((()=>{const n=s.sharers.get(e)-1;n>0?s.sharers.set(e,n):s.sharers.delete(e),t.it={...s}}))}class Pn extends _t{constructor(t,e){super(`${t}:share`),this._share=e}get upKey(){return this}grow(t){t.insert(t.seed.do(C(((...t)=>this._share.selectValue(...t)))))}}const Nn=Symbol("Share.impl");class On{constructor(t,e,n){this._share=t,this.name=e,this.key=new Pn(e,t),this._aliases=K(n.as).map((t=>t[Un]))}addSharer(t,e={}){const{local:n,name:s=t.elementDef.name}=e,r=t.get(At).get(Ln),o=new se,{componentType:a}=t,i=n?void 0:s&&ne.name(s,r.nsAlias).toLowerCase();r.addSharer(this._share,a,i,o);for(const t of this._aliases)r.addSharer(t,a,i,o);return o}shareValue(t){t.shareAs(this._share);const e=t.priority+1;this._aliases.forEach(((n,s)=>{n.shareValue(t.withPriority(e+s))}))}}const Vn=Symbol("SharedValue"),qn={hasDetails:t=>!!t&&"object"==typeof t&&"object"==typeof t[Vn]};function Bn(t,e){return In(t,function(t){const e=t.priority?Math.max(0,t.priority):0,{supply:n=new se}=t;return{priority:e,supply:n,provide:e=>{const n=t.provide(e);return l(n)?n.do(ft(e)):gt(n)(e)}}}(e))}function In(t,e){const{priority:n,supply:s,provide:r}=e;return{priority:n,supply:s,shareAs:(e,o=n)=>{o=Math.max(0,o),t.provide({a:e[Un],by:o?zn(r,o):Kn(r)}).as(s)},withPriority:n=>In(t,{...e,priority:Math.max(0,n)})}}function Kn(t){return e=>{const n=t(e);return l(n)?n.do(m(((t,e)=>void 0!==e?t(e):t()))):n}}function zn(t,e){return n=>({[Vn]:{priority:e,get:()=>t(n)}})}class Tn{constructor(t,e={}){this[Nn]=new On(this,t,e)}get[Un](){return this}get name(){return this[Nn].name}get[ht](){return this[Nn].key}addSharer(t,e){return this[Nn].addSharer(t,e)}shareValue(t){this[Nn].shareValue(t)}createRegistrar(t,e){return Bn(t,e)}valueFor(t,e={}){const{local:n}=e,r=t.get(At).get(Ln).sharers(this),o=t.readStatus.do(_(((t,e)=>t===e),Wn));return y({sharers:r,status:o}).do(s((({sharers:[e]})=>{if(n){if(e.sharers.has(t.componentType))return Hn(this,t);if(!0===n)return i()}let r=jt(t.element);for(;r;){if(e.names.has(r.tagName.toLowerCase()))return Pt.of(r).read.do(s((t=>t?Hn(this,t):i())));r=jt(r)}return i()})),w())}selectValue(...t){let e;for(let n=t.length-1;n>=0;--n){const s=t[n];if(!qn.hasDetails(s))return i(s);const r=s[Vn];(!e||e.priority>r.priority)&&(e=r)}return e?u((t=>{const n=e.get();l(n)?n(t):v(t)(n)})).do(b):i()}}function Wn([{settled:t,connected:e}]){return e?2:t?1:0}function Hn(t,e){return e.get(t).do(c(((t,n)=>n?t(n,e):t())))}function $n(t,e={}){if(Cn(t)){const n=t[Un];return(t,s={})=>{const{local:r=e.local}=s;return n.valueFor(t,{local:r})}}if("function"==typeof t){const{local:n=!1,share:s}=e;return(e,r={})=>{const{share:o=s,local:a=n}=r;return t(e,{share:o,local:a})}}const{share:n=e.share,local:s=e.local}=t||{},r=n[Un];return(t,e={})=>{const{local:n=s}=e;return r.valueFor(t,{local:n})}}const Gn=Symbol("Shareable.internals");class Jn{constructor(t){this[Gn]=new Qn(this,t)}static provider(t){const e=T(t);return t=>N(e(t))}get sharer(){return this[Gn].sharer()}get read(){return this[Gn].get().read}[dt](t){return this[Gn].bind(t),this}[o](){return this.read}get body(){return this[Gn].get().it}}class Qn{constructor(t,e){this._source=t,this._get=Jn.provider(e)}sharer(){this._notBound()}get(){this._notBound()}bind(t){this.bind=O,this.sharer=q(t),this.get=()=>{const e=h(this._get(t));return this.get=q(e),e}}_notBound(){throw new TypeError(`${String(this._source)} is not properly shared yet`)}}class Xn{constructor(t,e){this._get=t.get.bind(void 0,e),this._set=t.writable?t.set.bind(void 0,e):O,this._ctx=Rt.of(e);const n=this._get();let s=!1;l(n)?(s=!0,this.val=h(n)):this.val=p(n),this.val.supply.needs(this._ctx),this.val.read((t=>pt(t)&&t[dt](this._ctx))),s?this._syncDyn():this._syncVal()}get(){return this._valSupply?this.val.it:this.val.read}set(t){l(t)?(this.val.by(t),this._syncDyn()):(this.val.it=t,this._syncVal())}_syncVal(){this._valSupply||(this._valSupply=this.val.read((t=>this._set(t))))}_syncDyn(){this._valSupply&&(this._valSupply.off(),this._valSupply=void 0,this._set(this.val.read))}}function Yn(t,...e){const{share:{[Un]:n},local:r}=Cn(o=t)?{share:o}:o;var o;return Ft((t=>{const e=Symbol(`${String(t.key)}:shared`),o=n=>n[e]||(n[e]=new Xn(t,n));return{get:t=>o(t).get(),set:t.writable?(t,e)=>o(t).set(e):void 0,componentDef:{setup(t){t.perComponent(function(t,e){return{[ut]:n=>{const s=t.createRegistrar(n,e);return t.shareValue(s),s.supply}}}(n,{provide:t=>t.onceReady.do(s((({component:t})=>o(t).val),B()))}))},define(t){n.addSharer(t,{local:r})}}}}),...e.map((t=>e=>t({...e,share:n}))))}const Zn={setupField({sharer:t,control:e}){ts(t,e)},setupForm({sharer:t,control:e,element:n}){ts(t,e),ts(t,n)}};function ts(t,e){const n=t.get(Ct),s=t.get(kt);e.addAspect(at,{applyAspect:t=>it(n)}).addAspect(ct,{applyAspect:t=>it(s)})}class es extends _t{constructor(){super("form-preset")}get upKey(){return this}grow(t){t.insert(new rs(t.seed.do(D(((...t)=>rs.combine(...t,Zn))),e(t.context.get(bt)))))}}const ns=new es,ss=Symbol("FormPreset.rules");class rs{constructor(t){this.rules=t,t((t=>{this[ss]=t}))}static get[ht](){return ns}static combine(...t){return{setupField:os(t),setupForm:is(t)}}[o](){return this.rules}setupField(t){this[ss].setupField(t)}setupForm(t){this[ss].setupForm(t)}}function os(t){return t.reduce(((t,e)=>e.setupField?n=>{t(n),e.setupField(n)}:t),as)}function as(t){}function is(t){return t.reduce(((t,e)=>e.setupForm?n=>{t(n),e.setupForm(n)}:t),cs)}function cs(t){}class us extends Jn{constructor(t){super(t)}get control(){var t;return null===(t=this.body)||void 0===t?void 0:t.control}[dt](t){return super[dt](t),this.read(O).needs(t),this}}class ls extends us{static by(t){return new this(this.providerBy(t))}static providerBy(t){return e=>({control:e.control.build(t)})}constructor(t){var e,n;super((e=()=>this,n=T(t),t=>t.get(rs).rules.do(s((s=>{const r={sharer:t,field:e(),control:new Q};return s.setupField(r),N(n(r))})),_(hs,(([t])=>t)),D((t=>t&&{field:e(),control:t.control})))))}toString(){return"Field"}}function hs(t,e){return(null==t?void 0:t.control)===(null==e?void 0:e.control)||(null==t||t.control.supply.off(),!1)}const ps=new WeakMap;class ds extends Tn{static get[Un](){let t=ps.get(this);return t||(t=new this("field"),ps.set(this,t)),t}static get[ht](){return this[Un][ht]}}const fs=new WeakMap;class gs extends Tn{static get[Un](){let t=fs.get(this);return t||(t=new this("form"),fs.set(this,t)),t}static get[ht](){return this[Un][ht]}}function ms(t,e){return new ls((n=T(t),s=$n(e,{local:"too"}),t=>s(t.sharer).do(C(((e,s)=>e?e.read.do(C((s=>s?N(n({...t,adjacentTo:e,adjusted:s})):i()))):i())))));var n,s}function _s(t,e=ds){return ms(t,e)}function ys(t,e=gs){return ms(t,e)}function ws(t){return"string"==typeof t?t:null}function vs(t={}){return function(t={}){return({key:e,share:r,locateForm:o,name:a})=>{const{name:i=a}=t;let c;if(i)c=i;else{if(null!=i)return;{const t=ws(e);if(!t)return;c=t}}const u=$n(t.form||o,{share:gs});return{componentDef:{setup(t){t.whenComponent((t=>{y({unit:t.get(r).do(s(I,B())),form:u(t).do(s(((t,e)=>t),B()))}).do(n((({unit:[t],form:[e]})=>{if(!e||!t)return;const n=e.control.aspect(J);return n?n.controls.set(c,t.control):void 0})))}))}}}}}(t)}const bs={applyTo:t=>rt()};class Ss extends us{static forElement(t,e,n){return{control:t,element:X(e,{...n,form:t})}}static by(t,e){return new this(this.providerBy(t,e))}static providerBy(t,e){return n=>{let s=()=>n.control.build((e=>(s=H((()=>t(e))))())),r=()=>n.element.build((t=>(r=H((()=>e({form:s(),...t}))))()));return{get control(){return s()},get element(){return r()}}}}static get[Y](){return bs}constructor(t){super(function(t,e){const n=e=>({applyAspect:n=>Z(e,Ss,t())});return r=>r.get(rs).rules.do(s((s=>{const o={sharer:r,form:t(),control:(new Q).addAspect(Ss,n),element:(new Q).addAspect(Ss,n)};return s.setupForm(o),N(e(o))})),_(xs,(([t])=>t)),D((e=>e&&{get form(){return t()},get control(){return e.control},get element(){return e.element}})))}((()=>this),T(t)))}get element(){var t;return null===(t=this.body)||void 0===t?void 0:t.element}toString(){return"Form"}}function xs(t,e){let n=!0;return(null==t?void 0:t.control)!==(null==e?void 0:e.control)&&(null==t||t.control.supply.off(),n=!1),(null==t?void 0:t.element)!==(null==e?void 0:e.element)&&(null==t||t.element.supply.off(),n=!1),n}const ks={createSetup(t,e,n="default"){if(!1===t)return t=>re();if(!0===t)return t=>e(t).supply;let s=K(t);return s.length||(s=[n]),1===s.length?t=>t.aspect(tt).when(s[0],(()=>e(t))):t=>s.reduce(((n,s)=>t.aspect(tt).when(s,(()=>e(t))).as(n)),new se)}},Fs=new WeakMap;class Rs{static get[Ut](){const t=Fs.get(this);if(t)return t;const e=new this,n={setup:t=>{t.provide(e)}};return Fs.set(this,n),n}[ut](t){return t.provide({a:rs,is:this})}setupField(t){}setupForm(t){}}const As={createSetup(t,e,n){let s,r;if(Array.isArray(t)){const[e,...n]=t;Us(e)?(s=n.length>1?n:n[0],r=e):s=t}else Us(t)?r=t:s=t;return ks.createSetup(s,e(r),n)}};function Us(t){return null!=t&&"string"!=typeof t&&"boolean"!=typeof t}class Cs extends Rs{constructor(t={}){super(),this._info=As.createSetup(t.info,(t=>{const e=ot(t);return t=>t.aspect(et).add(e)})),this._error=As.createSetup(t.error,(t=>{const e=nt(t);return t=>t.aspect(et).add(e)}))}setupField(t){t.control.setup(this._info).setup(this._error)}setupForm(t){t.control.setup(this._info),t.element.setup(et,((t,e)=>t.add(e.aspect(Ss).control.aspect(et))))}}class Es extends Rs{constructor(t={}){super(),this._byValidity=As.createSetup(t.byValidity,(t=>{const e=st(t);return t=>t.aspect($).derive(e)})),this._byForm=ks.createSetup(t.byForm,(t=>t.aspect(G).read.do(n((e=>{const n=new se;return zt(e,(({parent:e})=>{const s=e.aspect(Ss);s&&t.aspect($).derive(s.element.aspect($)).as(n)})),n})))))}setupField(t){t.control.setup(this._byForm)}setupForm(t){t.control.setup(this._byValidity)}}function Ls(t={}){const{form:e=gs,cancel:s=!0}=t,r=$n(e,{share:gs,local:"too"});return Ft((({get:t})=>({componentDef:{define(e){e.whenComponent((e=>{e.whenConnected((()=>{const{component:o}=e;r(e).do(n(((e,n)=>{const r=null==e?void 0:e.body;if(!r)return;let a=r.element.events.on("submit");return s&&(a=a.do(It(!1))),a((e=>t(o).call(o,r,e)))}))).needs(e)}))}))}}})))}function Ds(t,...e){return Yn(t,...e)}function Ms(t={},...e){let n,s,r;"function"==typeof t?(n={},r=[vs(),t,...e]):(n=t,s=t.name,r=[vs({name:s}),...e]);const{share:o=ds,form:a}=n,i=$n(a,{share:gs});return Ds(o,...r.map((t=>e=>{return t({...e,locateForm:i,name:(n=e.key,r=s,""===r?null:r||ws(n))});var n,r})))}function js(t={},...e){if("function"==typeof t)return Ds(gs,t,...e);const{share:n=gs}=t;return Ds(n,...e)}export{Je as A,ke as C,ds as F,he as H,Rn as I,Ge as N,Ls as O,De as P,Ms as S,_s as a,Cs as b,gs as c,Un as d,Es as e,ys as f,nn as g,js as h,Ss as i,ls as j,Yn as k,Tn as l,Ue as m,Oe as n};//# sourceMappingURL=generic.daf122de.js.map
