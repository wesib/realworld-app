import{p as t,s as e,q as n,k as s,O as r,A as o,u as i,e as a,j as c,w as u,x as l,t as h,g as p,o as d,v as f,y as g,z as m,h as y,E as _,B as w,m as v,C as b,D as x,r as S,d as k,F,G as R,i as A,H as C,I as U,J as D,f as E,n as L,a as M,V as j,K as P,l as N}from"../proc7ts/fun-events.0c993baf.js";import{n as O,s as V,v as q,b as B,a as I,i as K,c as z,d as T,m as W,l as H}from"../proc7ts/primitives.7b24aae7.js";import{h as $,j as G,k as J,l as Q,m as X,n as Y,o as Z,f as tt,a as et,i as nt,p as st,q as rt,e as ot,r as it,s as at,t as ct}from"../frontmeans/input-aspects.552a677b.js";import{b as ut,S as lt,C as ht,i as pt,c as dt,d as ft,F as gt,e as mt,f as yt,g as _t,h as wt,j as vt,k as bt}from"../proc7ts/context-values.5140e67e.js";import{C as xt,B as St,m as kt,c as Ft,d as Rt,n as At,o as Ct,k as Ut,p as Dt,q as Et,a as Lt,W as Mt,r as jt,l as Pt,s as Nt,t as Ot,u as Vt,v as qt,j as Bt}from"./wesib.1ebc214d.js";import{D as It,h as Kt}from"../frontmeans/dom-events.ba8d072f.js";import{m as zt,i as Tt,a as Wt,b as Ht,f as $t,c as Gt,d as Jt,e as Qt,g as Xt,P as Yt,h as Zt,j as te,k as ee}from"../proc7ts/push-iterator.ccd51d52.js";import{c as ne,h as se}from"../frontmeans/namespace-aliaser.9467f14d.js";import{S as re,n as oe}from"../proc7ts/supply.9762ee6d.js";import{h as ie,a as ae}from"../hatsy/http-header-value.851567fb.js";class ce extends wt{constructor(t){super(t),this.upKey=this.createUpKey((t=>t.insert(t.seed.do(y(((...e)=>e.length?a(function(t){return(e,n)=>{const s=(n,r)=>{const o=t[n];return o?D(o(((t=r)=>s(n+1,t)),r)):e(r)};return s(0,n)}}(e)):t.hasFallback&&t.or?t.or:a(ue)))))))}grow(t){let e;t.context.get(this.upKey,t.hasFallback?{or:null!=t.or?a(t.or):t.or}:void 0)((t=>e=t)).whenOff((t=>e=vt(t))),t.insert(((t,n)=>e(t,n)))}}function ue(t,e){return t(e)}const le=new ce("http-fetch-agent"),he={};const pe=new gt("http-fetch",{byDefault:Lt((function(t){const e=t.get(St),n=t.get(le);return(t,e)=>n(s,new Request(t,e));function s(t){return d((n=>{const s=new _;let r;if("AbortController"in e){const o=new e.AbortController,{signal:i}=o;r=new re((t=>{t===he&&o.abort()})),n.supply.whenOff((()=>r.off(he))).needs(r),s.on({supply:r,receive(t,e){n.receive(t,e)}});const a=t.signal;a&&(new It(a).on("abort").do(E)((()=>o.abort())),a.aborted&&o.abort()),t=new Request(t,{signal:i})}else r=s.on(n);e.fetch(t).then((t=>{s.send(t),r.off()})).catch((t=>r.off(t)))}))}}))});const de=new lt("hierarchy-root",{byDefault:t=>{const e=t.get(Nt);return new It(e).on("wesib:component")((({context:t})=>t.get(ge).issue())),p()}}),fe=new lt("hierarchy-updates",{byDefault:t=>new ge(t.get(Rt))});class ge{constructor(t){const e=new _,n=t.get(At).get(de);this.on=e.on,this.send=()=>e.send(t),this.issue=()=>{const e=me(t);e?e[0].get(ge).send():n.it=t}}static get[ht](){return fe}}function me(t){var e;const n=t.get(At).get(Nt);let{element:s}=t,r=!0;if(s!==n)for(;;){const t=jt(s);if(!t)return;const o=null===(e=t[Dt])||void 0===e?void 0:e.context;if(o)return[o,r];if(t===n)return;r=!1,s=t}}const ye=new lt("hierarchy-context",{byDefault:t=>new we(t.get(Rt))});class _e extends ft{static get[ht](){return ye}get supply(){return this.context.supply}}class we extends _e{constructor(t){super(),this.context=t,this.up=u((t=>{const{supply:s}=t;s.needs(this);const r=p();r.by(this._parent),s.cuts(r);const o=(new re).needs(s),i=(new re).needs(s),a=()=>{const t=me(this.context);if(t){const[e,n]=t;r.it=e.get(_e),o.off(),n&&i.off()}else r.it=void 0};this.context.get(At).get(de).read({supply:o,receive:()=>this.context.connected&&a()}),r.read.do(e(i),n((t=>t&&t.context.get(ge).on(a)))),r.read(t),this.context.whenConnected({supply:(new re).needs(s),receive:a})})).do(m);const s=this._parent=p();t.whenConnected(O).cuts(s);const r=this._registry=(o=this.up,new mt((t=>function(t){return"upKey"in t}(t)?o.do(y((e=>e?e.get(t):a()))):void 0)));var o;this.get=r.newValues().get}provide(t){return this._registry.provide(t).needs(this)}inside(t){return this._parent.it=t&&t.get(_e),this}}class ve{[r](){return this.onUpdate}[o](){return this.read}}const be={subtree:!0};function xe(t,e,n,s,{deep:r,all:o}){const i=new _,a=r?be:void 0;let c,l=new Set;const h=r?Se:Wt;"string"==typeof n?c=n:t.whenDefined(n).then((({elementDef:{name:e}})=>{if(e&&(c=se.name(e,t.get(Ut)),i.size)){const t=g();if(t.size){const e=Ht(Qt(zt(t,(t=>s(t))),K));e.length&&i.send(e,[])}}})).catch(console.error),o||e.addEventListener("wesib:component",(t=>{const e=t.target;if(l.has(e)){const t=s(e);i.send([t],[])}}));const p=Qt(zt(te((function(){return ee(i.size?l:g())})),(t=>s(t))),K);class f extends ve{constructor(){super();const n=t.get(Ot)(m);this.onUpdate=d((t=>{const s=!i.size,r=i.on(t);s&&(g(),n.observe(e,a)),r.whenOff((()=>{i.size||(n.disconnect(),l.clear())})).needs(t.supply)}));const s=q(this);this.read=this.onUpdate.do(L(s,s)),this.track=u((t=>{const e=new _;e.on(t),e.send(Ht(this),[]),this.onUpdate(t)})),this.first=M(this.read).do(F(((t,e)=>t(Xt(e)))))}[Symbol.iterator](){return this[Yt]()}[Yt](t){return p[Yt](t)}}return new f;function g(){const t=function(){const t=c;if(!t)return new Set;if(r)return new Set(Wt(e.querySelectorAll(t)));return new Set($t(e.children,(e=>e.matches(t))))}();return i.size&&(l=t),t}function m(t){const e=[],n=[];t.forEach((t=>{Tt(Qt(zt(h(t.removedNodes),w),K),(t=>n.push(t))),Tt(Qt(zt(h(t.addedNodes),y),K),(t=>e.push(t)))})),(e.length||n.length)&&i.send(e,n)}function y(t){if(Vt(t))return c&&t.matches(c)&&!l.has(t)?(l.add(t),s(t)):void 0}function w(t){if(Vt(t)&&l.delete(t))return s(t,!0)}}function Se(t){return Zt(t,(t=>Wt([t,...Se(t.childNodes)])))}class ke{constructor(t,e){this._bs=t,this.element=e,this._emitters=new Map}get observer(){if(this._observer)return this._observer;const t=this._bs.get(St).MutationObserver;return this._observer=new t((t=>this._update(t)))}observe(t,e){const n=this,s=this.observer,r=this._emitter(t),o=b(e),i=r.on({supply:new re((()=>{this._emitters.delete(t),s.disconnect(),this._emitters.size?a():this._observer=void 0})).needs(o.supply),receive:(t,e,n)=>o.receive(t,e,n)});return s.disconnect(),a(),i;function a(){n._update(s.takeRecords()),s.observe(n.element,{attributes:!0,attributeOldValue:!0,attributeFilter:[...n._emitters.keys()]})}}_update(t){t.forEach((t=>{const e=t.attributeName,n=this._emitters.get(e);n&&n.send(this.element.getAttribute(e),t.oldValue)}))}_emitter(t){const e=new _;return this._emitters.set(t,e),e}}class Fe extends j{constructor(t,e){super(),this._observer=t,this._name=e,this._updates=new _;let n=oe();this.on=d((t=>{this._updates.size||(n=this._observer.observe(this._name,((t,e)=>this._updates.send(t,e)))),t.supply.needs(n),this._updates.on(t).whenOff((t=>{this._updates.size||n.off(t)}))}))}get supply(){return this._updates.supply}get it(){return this._observer.element.getAttribute(this._name)}set it(t){null!=t?this._observer.element.setAttribute(this._name,t):this._observer.element.removeAttribute(this._name)}}class Re{constructor(t,e){this._attrs=new Map,this._observer=new ke(t,e)}get(t){const e=this._attrs.get(t);if(e)return e;const n=new Fe(this._observer,t);return this._attrs.set(t,n),n}}class Ae extends j{constructor(t,e){super(),this._element=t,this._updates=new _,this._key=e}get supply(){return this._updates.supply}get it(){return this._element[this._key]}set it(t){this._element[this._key]=t}get on(){return this._updates.on}bind(t){t.get(qt).track(Bt(this._key)).onUpdate({supply:this.supply,receive:(t,e,n,s)=>this._updates.send(n,s)})}}class Ce{constructor(t){this._element=t,this._props=new Map}bind(t){this._context=t,this._props.forEach((e=>e.bind(t)))}get(t){const e=this._props.get(t);if(e)return e;const n=new Ae(this._element,t);return this._context&&n.bind(this._context),this._props.set(t,n),n}}const Ue=Symbol("element-node");class De{constructor(t,e){this._bs=t,this.element=e,this._attrs=new Re(t,e),this._props=new Ce(e),e[Ue]=this;const n=this.context;n?this._bind(n):e.addEventListener("wesib:component",(t=>this._bind(t.context)))}get context(){var t;return null===(t=this.element[Dt])||void 0===t?void 0:t.context}get parent(){const t=this.element.parentNode;return t&&Ee(this._bs,t)}select(t,e){return function(t,e,n,s={}){if(s.all)return xe(t,e,n,((e,n)=>Ee(t,e,n)),s);const r=t.get(Et);return xe(t,e,n,((e,n)=>r(e)&&Ee(t,e,n)),s)}(this._bs,this.element,t,e)}attribute(t){return this._attrs.get(t)}property(t){return this._props.get(t)}_bind(t){this._props.bind(t)}}function Ee(t,e,n){const s=e[Ue];return s||n?s:new De(t,e)}const Le=new lt("component-node",{byDefault:t=>Ee(t.get(At),t.get(Rt).element)});function Me(t){return new URL(t.hash.substring(1),t.origin)}function je(t,e){if(e.origin!==t.origin||e.username)return new URL(`#${e}`,t);const{pathname:n,search:s,hash:r}=e,o=new URL("",t);return o.hash=s||r||n.length>1?n+s+r:s+r,o}const Pe=Symbol("page-param");class Ne{get[Pe](){return this}byDefault(t,e){}}class Oe extends Ne{create(t,e){let n;const s={get:()=>n,put(e){n="string"==typeof e?new URL(e,t.url.origin):e}};return s.put(e),s}}const Ve=new Oe;class qe extends Ne{create(t,e){const n={get:()=>t.get(Ve)||Me(t.url),put(e){t.put(Ve,e)}};return n.put(e),n}byDefault(t){return this.create(t,null)}}const Be=new qe;class Ie extends wt{constructor(t){super(t),this.upKey=this.createUpKey((t=>{const{document:e}=t.context.get(St);t.insert(t.seed.do(y(((...n)=>n.length?a((function(t,s,r,o){return i(0,o);function i(o,a){const c=n[o];if(!c)return t(a);c((({url:t=a.url,title:n=a.title,data:s=a.data}=a)=>i(o+1,{url:new URL(String(t),e.baseURI),title:n,data:s,get visited(){return a.visited},get current(){return a.current},get:t=>a.get(t),put(t,e){a.put(t,e)}})),s,r,a)}})):t.hasFallback&&t.or?t.or:a(Ke)))))}))}grow(t){let e;t.context.get(this.upKey,t.hasFallback?{or:null!=t.or?a(t.or):t.or}:void 0)((t=>e=t)).whenOff((t=>e=vt(t))),t.insert(((t,n,s,r)=>e(t,n,s,r)))}}function Ke(t,e,n,s){t(s)}const ze=new Ie("navigation-agent"),Te={setup(t){t.provide({a:ze,is:He})}};class We{static get[Ct](){return Te}}function He(t,e,n,s){const r=s.get(Ve);r?t({url:je(s.url,r)}):t()}class $e extends ft{}const Ge=new lt("nav-history",{byDefault:Lt((t=>new Qe(t)))});function Je(t){return null==t||"object"!=typeof t?{data:t}:t["wesib:navigation:data"]}class Qe{constructor(t){this._context=t,this._entries=new Map,this._lastId=0;const e=t.get(St);this._document=e.document,this._location=e.location,this._history=e.history,this._uid=btoa(String(Math.random()))}static get[ht](){return Ge}init(){const{data:t}=Je(this._history.state),e=this.newEntry({url:new URL(this._location.href),data:t,title:this._document.title});return this._entries.set(e.id,e),e.schedule((()=>{e.enter("init"),this._history.replaceState(this._historyState(e),"")})),e}newEntry(t){return new Xe(this._context,++this._lastId,t)}open(t,e){const{page:{title:n="",url:s}}=t;this._history.pushState(this._historyState(t),n,s.href),this._enter("open",t,e)}_enter(t,e,n){const s=n.it;this._entries.set(e.id,e);try{for(let t=s.next;t;t=t.next)this._forget(t)}finally{e.prev=s,s.next=e,e.schedule((()=>{try{s.leave()}finally{e.enter(t)}})),n.it=e}}replace(t,e){const n=e.it,{page:{title:s="",url:r}}=t;this._history.replaceState(this._historyState(t),s,r.href),this._entries.set(t.id,t);const o=n.prev;o&&(t.prev=o,o.next=t),t.schedule((()=>{try{n.leave()}finally{try{this._forget(n)}finally{t.enter("replace")}}})),e.it=t}popState(t,e){const{state:n}=t;if(null==n)return null==this._history.state?this._changeHash(e):void 0;const s=e.it,{uid:r,data:o,id:i}=Je(n);let a;const c=r===this._uid&&null!=i?this._entries.get(i):void 0;return c?a=c:(a=this.newEntry({url:new URL(this._location.href),data:o,title:this._document.title}),s.transfer(a,"return"),this._entries.set(a.id,a),this._history.replaceState(this._historyState(a),"")),a.schedule((()=>{try{s.leave()}finally{a.enter("return")}})),e.it=a,a}hashChange(t){if(null==this._history.state)return this._changeHash(t)}update(t,e){const n=t.it,s=new Xe(this._context,++this._lastId,{...n.page,url:e},n);return this._entries.set(s.id,s),this._history.replaceState(this._historyState(s),"",e.href),this._entries.delete(n.id),t.it=s}_changeHash(t){const e=t.it,n=this.newEntry({url:new URL(this._location.href),data:null,title:this._document.title});try{e.transfer(n,"enter")}finally{this._history.replaceState(this._historyState(n),""),this._enter("enter",n,t)}return n}_forget(t){this._entries.delete(t.id),t.forget()}_historyState({id:t,page:{data:e}}){return{"wesib:navigation:data":{uid:this._uid,id:t,data:e}}}}class Xe{constructor(t,e,n,s){this._bsContext=t,this.id=e,this._status=0,this._update=O,this._params=s?s._params:new Map;const r=this;this.page={get url(){return n.url},get title(){return n.title},get data(){return n.data},get visited(){return!!r._status},get current(){return 2===r._status},get:t=>r.get(t),put(t,e){r.put(t,e)}}}get(t){const e=t[Pe],n=this._params.get(e);if(n)return n.get();const s=e.byDefault(this.page,this._newContext());return s&&this._init(e,s)}put(t,e){const n=t[Pe],s=this._params.get(n);return s?(s.put(e),s.get()):this._init(n,n.create(this.page,e,this._newContext()))}_newContext(){const t=new mt(this._bsContext);return new class extends $e{constructor(){super(...arguments),this.get=t.newValues().get}}}_init(t,e){return this._params.set(t,e),this.page.current&&e.enter&&e.enter(this.page,"init"),e.get()}transfer(t,e){Tt(this._params.entries(),(([n,s])=>{if(s.transfer){const r=s.transfer(t.page,e);r&&t._params.set(n,r)}}))}stay(t){Tt(this._params.values(),(e=>e.stay&&e.stay(t)))}enter(t){this._status=2,Tt(this._params.values(),(e=>e.enter&&e.enter(this.page,t)))}leave(){this._status=1,Tt(this._params.values(),(t=>t.leave&&t.leave()))}forget(){Tt(this._params.values(),(t=>t.forget&&t.forget())),this._params.clear()}schedule(t){this._update=t}apply(){const t=this._update;this._update=O,t()}}class Ye extends Event{constructor(t,e){super(t,{...e,cancelable:!1}),this.when=e.when,this.to=e.to}}class Ze extends Event{constructor(t,e){super(t,{...e,cancelable:!0}),this.when=e.when,this.from=e.from,this.to=e.to}}class tn extends Event{constructor(t,e){super(t,{...e,cancelable:!0}),this.from=e.from,this.to=e.to,this.reason=e.reason}get when(){return"stay"}}const en=new lt("navigation",{byDefault:Lt((function(t){const e=t.get(St),{document:n,history:s}=e,r=new It(e),o=t.get(Qe),i=t.get(ze),a=p(o.init());a.read((t=>t.apply()));let c=Promise.resolve();r.on("popstate")((t=>{const e=o.popState(t,a);e&&r.dispatch(new Ye("wesib:enterPage",{when:null!=t.state?"return":"enter",to:e.page}))})),r.on("hashchange")((()=>{const t=o.hashChange(a);t&&r.dispatch(new Ye("wesib:enterPage",{when:"enter",to:t.page}))}));return new class extends nn{constructor(){super(),this.onEnter=r.on("wesib:enterPage"),this.onLeave=r.on("wesib:leavePage"),this.onStay=r.on("wesib:stayOnPage"),this.on=P(D(this.onEnter),D(this.onLeave),D(this.onStay)),this.read=a.read.do(L((({page:t})=>t)))}get page(){return a.it.page}get length(){return s.length}go(t){s.go(t)}open(t){return d("pre-open","open",t)}replace(t){return d("pre-replace","replace",t)}update(t){return o.update(a,l(t)).page}with(t,e){return u((n=>n.put(t,e)))}};function u(t){return{with:(e,n)=>u(W(t,(t=>t.put(e,n)))),open:e=>d("pre-open","open",e,t),replace:e=>d("pre-replace","replace",e,t),pretend(e,n=((t,e)=>e)){let s;"function"==typeof e?(n=e,s=void 0):s=e;const r=h(s),o=a.it,i=f("pretend",o,r,t);try{return g("pretend",o,r,i)?n(o.page,i.page):void 0}finally{i.stay(a.it.page)}}}}function l(t){return"string"==typeof t?new URL(t,n.baseURI):t||a.it.page.url}function h(t){return null==t||"string"==typeof t||t instanceof URL?{url:l(t)}:t.url instanceof URL?t:{...t,url:l(t.url)}}function d(t,e,n,s=O){const i=h(n),u=c=c.then(l,l);return u;function l(){let n;try{const l=function(){if(c!==u)return p();const e=a.it,n=f(t,e,i,s),o=new Ze("wesib:leavePage",{when:t,from:e.page,to:n.page});if(!r.dispatch(o)||c!==u||!g(t,e,i,n))return p(n);return n}();return l?(n=l,o[e](n,a),r.dispatch(new Ye("wesib:enterPage",{when:e,to:n.page})),n.page):l}catch(t){throw p(n,t),t}}function p(t,e){return t&&t.stay(a.it.page),r.dispatch(new tn("wesib:stayOnPage",{from:a.it.page,to:i,reason:e})),null}}function f(t,e,n,s){const r=o.newEntry(n);try{e.transfer(r,t),s(r.page)}catch(t){throw r.stay(a.it.page),t}return r}function g(t,e,n,s){let r=!1;return i((({url:t,data:e,title:s})=>{r=!0,n.url=t,n.data=e,n.title=s}),t,e.page,s.page),r}}))});class nn{static get[ht](){return en}[r](){return this.on}[o](){return this.read}back(){this.go(-1)}forward(){this.go(1)}reload(){this.go()}}function sn(t={}){const{select:r="a",pick:l={all:!0,deep:!0}}=t;return xt({define(h){h.whenComponent((h=>{const p=function(t,e){const n=t.get(kt),{render:s,active:r=ln}=e,o=ne.name(r,t.get(Ut)),i=e.activate?e.activate.bind(e):O,a=(t,{node:e})=>{const{element:n}=e,{classList:s}=n;t?s.add(o):s.remove(o)};return t=>{const{element:e}=t.node,r=e[un]||(e[un]=n(s)),o=e=>{r((()=>a(e,t))),i(e,t)};let c;return o(!0),{supply(){const t=c=new re((()=>{c===t&&o(!1)}));return t}}}}(h,t),d=function(t){if(!t.weigh)return rn;return e=>{const n=t.weigh(e);if("number"==typeof n)return a(e.node,n);let s=n[o]().do(c(((t,n)=>t(e.node,n))));return u((t=>{s({supply:(new re).needs(t.supply).whenOff((()=>{s=a(e.node,0),s(t)})),receive:t.receive})}))}}(t),f=h.get(nn),g=h.get(Le);h.whenConnected((()=>{let t=new Map;f.read.do(e(h),n((e=>g.select(r,l).read.do(s((t=>i(...zt(t,(t=>d({node:t,context:h,page:e})))))),n(((...n)=>{const s=function(t){let e=0,n=[];return t.forEach((([t,s])=>{s>e?(e=s,n=[t]):s===e&&n.push(t)})),n}(n),r=new Map,o=new re;return s.forEach((n=>{let s;const i=t.get(n);i?(r.set(n,i),s=i):(s=p({node:n,context:h,page:e}),r.set(n,s)),s.supply().needs(o)})),t=r,o}))))))}))}))}})}function rn({node:t,page:e}){const{element:n}=t,s=n.getAttribute("href");if(null==s)return a(t,-1);const r=new URL(s,n.ownerDocument.baseURI);return a(t,on(r,e.url))}function on(t,e){if(t.origin!==e.origin)return-1;const n=an(t),s=an(e);if(t.hash){if(n!==s)return-1;const r=cn(t,e);return r<0||cn(e,t)<0?-1:t.pathname.length+r+on(Me(t),Me(e))}const r=cn(t,e);return r?r<0||n!==s?-1:t.pathname.length+r:s.startsWith(n)?t.pathname.length:-1}function an(t){const e=t.pathname;return e.endsWith("/")?e:e+"/"}function cn({searchParams:t},{searchParams:e}){let n=0;return t.forEach(((t,s)=>{(function(t){return t.startsWith("__")&&t.endsWith("__")})(s)||n>=0&&(e.getAll(s).includes(t)?n+=1:n=-1)})),n}const un=Symbol("nav-link-render-schedule"),ln=["active",Mt];function hn(e={}){const n=e.handle?e.handle.bind(e):function(t){const e=t.href?t.href.bind(t):pn;return({event:t,page:n,navigation:s})=>{const r=e(t);if(null==r)return;const o=t.target,i=n.url,a=new URL(r,o.ownerDocument.baseURI);a.origin===i.origin&&(t.preventDefault(),i.href!==a.href&&s.open(r).catch(console.error))}}(e),s=V(e.event||"click");return xt({define(e){e.whenComponent((e=>{e.whenConnected((()=>{const r=e.get(nn);for(const o of s)e.on(o)((s=>{r.read.do(t)((t=>n({event:s,page:t,context:e,navigation:r})))}))}))}))}})}function pn(t){return t.target.getAttribute("href")}function dn(t,e,n,s=fn){let r;"function"==typeof n?(s=n,r=null):r=n||null;const o=e.ownerDocument;if(Vt(t)){const n=o.createElement(t.tagName.toLowerCase());return t.getAttributeNames().forEach((e=>n.setAttribute(e,t.getAttribute(e)))),s(t,n),e.insertBefore(n,r),n}const i=o.importNode(t,!1);return e.insertBefore(i,r),i}function fn(t,e){Tt(Wt(t.childNodes),(t=>dn(t,e)))}function gn(t){let e;return n=>{const s=function(t){return new URL("",t.url).href}(n);if(e){if(e.url===s)return e.on;e.sup.off()}let r;const o=new re((()=>{e=void 0,r=void 0})),i=d((e=>{if(!r){const e=t(n),s=p(),i=e((t=>{s.it=t})).whenOff((t=>{null!=t&&o.off(t)}));o.cuts(i).cuts(s),r={on:s.read.do(f(I)),num:0}}const s=r;return++s.num,s.on.do(g(o))(e).whenOff((t=>{--s.num||Promise.resolve().then((()=>{s.num||s!==r||o.off(t)})).catch(console.error)}))}));return e={url:s,on:i,sup:o},i}}class mn extends Error{}const yn=new class extends Ne{create(t,e){return{get:()=>e,put:O}}};class _n{constructor(t,e){this._navigation=t,this._loader=e,this._map=new Map,this._requests=Gt(te((()=>this._map.values())))}get fragments(){const t=[];return Jt(this._requests,(e=>!!e.fragment&&(t.push(e.fragment),!0)))?t:[]}handle(){const t=this,e=new re(O);let n=oe();return{get(){},put(e){t._add(e)},transfer(e,n){if("pretend"===n)return;const s=t._transfer();return e.put(yn,s),s.handle()},enter(s,r){if("init"===r)return;n=new re(O).needs(e);const o=d((e=>{const r=new _,o=r.on(e);return t._loader(s).do(g(n))((t=>r.send(t))).whenOff((t=>{void 0===t||t instanceof mn||r.send({ok:!1,page:s,error:t})})),o})).do(w);Tt(t._requests,(({fragment:t,receiver:e})=>function(t,e){return e?t.do(v((t=>t.ok?{...t,fragment:(null!=e.tag?t.document.getElementsByTagName(e.tag)[0]:t.document.getElementById(e.id))||void 0}:t))):t}(o,t)({supply:(new re).needs(e.supply),receive(t,n){e.receive(t,n)}})))},leave(){n.off(new mn("page left"))},stay(){e.off(new mn("navigation cancelled"))},forget(){e.off(new mn("page forgotten"))}}}_add(t){const e={...t,receiver:b(t.receiver)},{supply:n}=e.receiver,s=this._map.get(n);s?s.push(e):(this._map.set(n,[e]),n.whenOff((()=>this._map.delete(n))))}_transfer(){const t=new _n(this._navigation,this._loader);for(const[e,n]of this._map.entries())t._map.set(e,n.slice());return t}}const wn=new ce("page-load-agent"),vn=new gt("page-load-url",{byDefault:q(O)}),bn=new lt("page-loader",{byDefault:Lt((function(t){const e=t.get(St),n=t.get(pe),s=t.get(vn),r=t.get(wn),o=new e.DOMParser;return t=>{const e=new URL(t.url.href);s(e);const i=new Request(e.href,{mode:"same-origin",credentials:"same-origin",headers:new Headers({Accept:"text/html"})});return d((t=>r(c,i)(t)));function c(s){return function(t,e){var n;const s=null===(n=t.get(yn))||void 0===n?void 0:n.fragments;s&&s.length&&e.headers.set("Accept-Fragment",s.reduce(((t,e)=>(t?t+", ":"")+(null!=e.tag?"tag="+ie(e.tag):"id="+ie(e.id))),""))}(t,s),d((r=>{const i=new x;i.on(r),i.send({page:t}),n(s).do(v((t=>Promise.all([t,t.text()]))),S,k(((...t)=>a(...t))),v((([n,s])=>{if(!n.ok)return{ok:!1,page:t,response:n,error:n.status};try{return{ok:!0,page:t,response:n,document:xn(o,e,n,s)}}catch(e){return{ok:!1,page:t,response:n,error:e}}})))(r)}))}}}))});function xn(t,e,n,s){const r=t.parseFromString(s,ae(n.headers.get("Content-Type")||"text/html")[0].v);if(r.head){const t=r.head.querySelector("base");if(t)t.href=new URL(t.getAttribute("href"),e).href;else{const t=r.createElement("base");t.href=e.href,r.head.appendChild(t)}}return r}class Sn extends Ne{create(t,e,n){const s=new _n(n.get(nn),gn(n.get(bn))),r=s.handle();return t.put(yn,s),r.put(e),r}}const kn=new Sn,Fn=new lt("page-cache-buster",{byDefault:Lt((t=>new Rn(t)))});class Rn{constructor(t){const e=An(t.get(St).document);if(e){const n=t.get(nn);this.urlModifier=a((t=>t.searchParams.set("__wesib_app_rev__",e))),this.agent=a(((t,s)=>t(new Request(s.url,s)).do(v((t=>{if(t.ok){const s=An(t.document);if(s&&s!==e){const e=new URL(t.page.url.href);e.searchParams.set("__wesib_app_rev__",s),n.update(e),n.reload()}}return t})))))}else this.urlModifier=a(),this.agent=a()}static get[ht](){return Fn}}function An(t){var e;return null===(e=t.querySelector("meta[name=wesib-app-rev]"))||void 0===e?void 0:e.getAttribute("content")}function Cn(t){const e=t.get(St).document;return t=>t().do(v((t=>{if(t.ok){const n=new Set(zt(Un(e,e.scripts),(([t])=>t)));Tt(Qt(Un(t.document,t.document.querySelectorAll("script")),(([t])=>!n.has(t))),(([t,s])=>{dn(s,e.head,((e,n)=>n.src=t)),n.add(t)}))}return t})))}function Un(t,e){return zt($t(e,(({src:t})=>!!t)),(e=>[new URL(e.src,t.baseURI).href,e]))}function Dn(t){const e=t.get(St).document;return t=>t().do(v((t=>{if(!t.ok)return t;const n=t.document.querySelectorAll("link[rel=stylesheet]");if(!n.length)return t;let s=e.head,r=null;const o=e.querySelectorAll("link[rel=stylesheet]"),i=new Map,a=o.item(0);return a&&(s=a.parentNode,r=a,Tt(Wt(o),(t=>i.set(new URL(t.href,e.baseURI).href,t)))),Tt(Wt(n),(t=>{const n=new URL(t.href,e.baseURI).href,o=i.get(n);o?(Xt(i.keys())===n?(s=o.parentNode,r=o.nextSibling):s.insertBefore(o,r),i.delete(n)):dn(t,s,r,((t,e)=>e.href=n))})),Tt(i.values(),(t=>t.parentNode.removeChild(t))),t})))}function En(t){const e=t.get(St).document;return t=>t().do(v((t=>{if(t.ok){const n=t.document.getElementsByTagName("title").item(0);n&&n.textContent&&(e.title=n.textContent)}return t})))}const Ln={setup(t){t.provide({a:vn,by:t=>t.urlModifier,with:[Rn]}),t.provide({a:wn,by:t=>t.agent,with:[Rn]}),t.provide({a:wn,by:Cn}),t.provide({a:wn,by:Dn}),t.provide({a:wn,by:En})}};class Mn{static get[Ct](){return Ln}}function jn(e={}){const n=e.onResponse?e.onResponse.bind(e):O,s=e.contentKey?e.contentKey.bind(e):Pn;return xt({feature:{needs:[Mn]},define(r){r.whenComponent((r=>{const{fragment:o,render:i}=e,a=r.get(St).document,c=r.get(kt)(i),u=r.get(nn);let l,h=s(u.page);l=o?q(o):()=>{const{element:{id:t,tagName:e}}=r;return t?{id:t}:{tag:e}},r.whenConnected((()=>{const e=a.createRange();e.selectNodeContents(r.contentRoot),u.read.do(t)((t=>{t.put(kn,{fragment:l(),receiver:{supply:(new re).needs(r),receive:(t,o)=>function(t){const o=s(t.page);if(o===h)return;if(!t.ok)return void c((()=>n({context:r,range:e,response:t})));h=o,c((()=>{e.deleteContents();const s=a.createDocumentFragment(),{fragment:o}=t;o&&(fn(o,s),e.insertNode(s)),n({context:r,range:e,response:t})}))}(o)}})}))}))}))}})}function Pn({url:t}){return new URL("",t).href}const Nn=Symbol("Share");function On(t){return!(!t||"object"!=typeof t&&"function"!=typeof t||!t[Nn])}const Vn=new lt("share-registry",{byDefault:Lt((t=>new qn(t.get(Ut))))});class qn{constructor(t){this.nsAlias=t,this._sharers=new Map}static get[ht](){return Vn}addSharer(t,e,n,s){let r=this._sharers.get(t);r?(Kn(r,e,s),In(r,n,s),r.it={...r.it}):(r=Bn(),this._sharers.set(t,r),Kn(r,e,s),In(r,n,s))}sharers(t){let e=this._sharers.get(t);return e||(e=Bn(),this._sharers.set(t,e)),e}}function Bn(){return p({names:new Map,sharers:new Map})}function In(t,e,n){if(!e)return;const s=t.it,r=s.names.get(e)||0;s.names.set(e,r+1),n.whenOff((()=>{const n=s.names.get(e)-1;n>0?s.names.set(e,n):s.names.delete(e),t.it={...s}}))}function Kn(t,e,n){const s=t.it,r=s.sharers.get(e)||0;s.sharers.set(e,r+1),n.whenOff((()=>{const n=s.sharers.get(e)-1;n>0?s.sharers.set(e,n):s.sharers.delete(e),t.it={...s}}))}class zn extends wt{constructor(t,e){super(`${t}:share`),this._share=e}get upKey(){return this}grow(t){t.insert(t.seed.do(y(((...t)=>this._share.selectValue(...t)))))}}const Tn=Symbol("Share.impl");class Wn{constructor(t,e,n){this._share=t,this.name=e,this.key=new zn(e,t),this._aliases=z(n.as).map((t=>t[Nn]))}addSharer(t,e={}){const{local:n,name:s=t.elementDef.name}=e,r=t.get(At).get(qn),o=new re,{componentType:i}=t,a=n?void 0:s&&se.name(s,r.nsAlias).toLowerCase();r.addSharer(this._share,i,a,o);for(const t of this._aliases)r.addSharer(t,i,a,o);return o}shareValue(t){t.shareAs(this._share);const e=t.priority+1;this._aliases.forEach(((n,s)=>{n.shareValue(t.withPriority(e+s))}))}}const Hn=Symbol("SharedValue"),$n={hasDetails:t=>!!t&&"object"==typeof t&&"object"==typeof t[Hn]};function Gn(t,e){return Jn(t,function(t){const e=t.priority?Math.max(0,t.priority):0,{supply:n=new re}=t;return{priority:e,supply:n,provide:e=>{const n=t.provide(e);return l(n)?n.do(yt(e)):_t(n)(e)}}}(e))}function Jn(t,e){const{priority:n,supply:s,provide:r}=e;return{priority:n,supply:s,shareAs:(e,o=n)=>{o=Math.max(0,o),t.provide({a:e[Nn],by:o?Xn(r,o):Qn(r)}).as(s)},withPriority:n=>Jn(t,{...e,priority:Math.max(0,n)})}}function Qn(t){return e=>{const n=t(e);return l(n)?n.do(F(((t,e)=>void 0!==e?t(e):t()))):n}}function Xn(t,e){return n=>({[Hn]:{priority:e,get:()=>t(n)}})}class Yn{constructor(t,e={}){this[Tn]=new Wn(this,t,e)}get[Nn](){return this}get name(){return this[Tn].name}get[ht](){return this[Tn].key}addSharer(t,e){return this[Tn].addSharer(t,e)}shareValue(t){this[Tn].shareValue(t)}createRegistrar(t,e){return Gn(t,e)}valueFor(t,e={}){const{local:n}=e,r=t.get(At).get(qn).sharers(this),o=t.readStatus.do(R(((t,e)=>t===e),Zn));return A({sharers:r,status:o}).do(s((({sharers:[e]})=>{if(n){if(e.sharers.has(t.componentType))return ts(this,t);if(!0===n)return a()}let r=jt(t.element);for(;r;){if(e.names.has(r.tagName.toLowerCase()))return Pt.of(r).read.do(s((t=>t?ts(this,t):a())));r=jt(r)}return a()})),C())}selectValue(...t){let e;for(let n=t.length-1;n>=0;--n){const s=t[n];if(!$n.hasDetails(s))return a(s);const r=s[Hn];(!e||e.priority>r.priority)&&(e=r)}return e?u((t=>{const n=e.get();l(n)?n(t):U(t)(n)})).do(m):a()}}function Zn([{settled:t,connected:e}]){return e?2:t?1:0}function ts(t,e){return e.get(t).do(c(((t,n)=>n?t(n,e):t())))}function es(t,e={}){if(On(t)){const n=t[Nn];return(t,s={})=>{const{local:r=e.local}=s;return n.valueFor(t,{local:r})}}if("function"==typeof t){const{local:n=!1,share:s}=e;return(e,r={})=>{const{share:o=s,local:i=n}=r;return t(e,{share:o,local:i})}}const{share:n=e.share,local:s=e.local}=t||{},r=n[Nn];return(t,e={})=>{const{local:n=s}=e;return r.valueFor(t,{local:n})}}const ns=Symbol("Shareable.internals");class ss{constructor(t){this[ns]=new rs(this,t)}static provider(t){const e=T(t);return t=>N(e(t))}get sharer(){return this[ns].sharer()}get read(){return this[ns].get().read}[dt](t){return this[ns].bind(t),this}[o](){return this.read}get body(){return this[ns].get().it}}class rs{constructor(t,e){this._source=t,this._get=ss.provider(e)}sharer(){this._notBound()}get(){this._notBound()}bind(t){this.bind=O,this.sharer=q(t),this.get=()=>{const e=h(this._get(t));return this.get=q(e),e}}_notBound(){throw new TypeError(`${String(this._source)} is not properly shared yet`)}}class os{constructor(t,e){this._get=t.get.bind(void 0,e),this._set=t.writable?t.set.bind(void 0,e):O,this._ctx=Rt.of(e);const n=this._get();let s=!1;l(n)?(s=!0,this.val=h(n)):this.val=p(n),this.val.supply.needs(this._ctx),this.val.read((t=>pt(t)&&t[dt](this._ctx))),s?this._syncDyn():this._syncVal()}get(){return this._valSupply?this.val.it:this.val.read}set(t){l(t)?(this.val.by(t),this._syncDyn()):(this.val.it=t,this._syncVal())}_syncVal(){this._valSupply||(this._valSupply=this.val.read((t=>this._set(t))))}_syncDyn(){this._valSupply&&(this._valSupply.off(),this._valSupply=void 0,this._set(this.val.read))}}function is(t,...e){const{share:{[Nn]:n},local:r}=On(o=t)?{share:o}:o;var o;return Ft((t=>{const e=Symbol(`${String(t.key)}:shared`),o=n=>n[e]||(n[e]=new os(t,n));return{get:t=>o(t).get(),set:t.writable?(t,e)=>o(t).set(e):void 0,componentDef:{setup(t){t.perComponent(function(t,e){return{[ut]:n=>{const s=t.createRegistrar(n,e);return t.shareValue(s),s.supply}}}(n,{provide:t=>t.onceReady.do(s((({component:t})=>o(t).val),B()))}))},define(t){n.addSharer(t,{local:r})}}}}),...e.map((t=>e=>t({...e,share:n}))))}const as={setupField({sharer:t,control:e}){cs(t,e)},setupForm({sharer:t,control:e,element:n}){cs(t,e),cs(t,n)}};function cs(t,e){const n=t.get(Ut),s=t.get(kt);e.addAspect(it,{applyAspect:t=>at(n)}).addAspect(ct,{applyAspect:t=>at(s)})}class us extends wt{constructor(){super("form-preset")}get upKey(){return this}grow(t){t.insert(new ps(t.seed.do(L(((...t)=>ps.combine(...t,as))),e(t.context.get(bt)))))}}const ls=new us,hs=Symbol("FormPreset.rules");class ps{constructor(t){this.rules=t,t((t=>{this[hs]=t}))}static get[ht](){return ls}static combine(...t){return{setupField:ds(t),setupForm:gs(t)}}[o](){return this.rules}setupField(t){this[hs].setupField(t)}setupForm(t){this[hs].setupForm(t)}}function ds(t){return t.reduce(((t,e)=>e.setupField?n=>{t(n),e.setupField(n)}:t),fs)}function fs(t){}function gs(t){return t.reduce(((t,e)=>e.setupForm?n=>{t(n),e.setupForm(n)}:t),ms)}function ms(t){}class ys extends ss{constructor(t){super(t)}get control(){var t;return null===(t=this.body)||void 0===t?void 0:t.control}[dt](t){return super[dt](t),this.read(O).needs(t),this}}class _s extends ys{static by(t){return new this(this.providerBy(t))}static providerBy(t){return e=>({control:e.control.build(t)})}constructor(t){var e,n;super((e=()=>this,n=T(t),t=>t.get(ps).rules.do(s((s=>{const r={sharer:t,field:e(),control:new Q};return s.setupField(r),N(n(r))})),R(ws,(([t])=>t)),L((t=>t&&{field:e(),control:t.control})))))}toString(){return"Field"}}function ws(t,e){return(null==t?void 0:t.control)===(null==e?void 0:e.control)||(null==t||t.control.supply.off(),!1)}const vs=new WeakMap;class bs extends Yn{static get[Nn](){let t=vs.get(this);return t||(t=new this("field"),vs.set(this,t)),t}static get[ht](){return this[Nn][ht]}}const xs=new WeakMap;class Ss extends Yn{static get[Nn](){let t=xs.get(this);return t||(t=new this("form"),xs.set(this,t)),t}static get[ht](){return this[Nn][ht]}}function ks(t,e){return new _s((n=T(t),s=es(e,{local:"too"}),t=>s(t.sharer).do(y(((e,s)=>e?e.read.do(y((s=>s?N(n({...t,adjacentTo:e,adjusted:s})):a()))):a())))));var n,s}function Fs(t,e=bs){return ks(t,e)}function Rs(t,e=Ss){return ks(t,e)}function As(t){return"string"==typeof t?t:null}function Cs(t={}){return function(t={}){return({key:e,share:r,locateForm:o,name:i})=>{const{name:a=i}=t;let c;if(a)c=a;else{if(null!=a)return;{const t=As(e);if(!t)return;c=t}}const u=es(t.form||o,{share:Ss});return{componentDef:{setup(t){t.whenComponent((t=>{A({unit:t.get(r).do(s(I,B())),form:u(t).do(s(((t,e)=>t),B()))}).do(n((({unit:[t],form:[e]})=>{if(!e||!t)return;const n=e.control.aspect(J);return n?n.controls.set(c,t.control):void 0})))}))}}}}}(t)}const Us={applyTo:t=>rt()};class Ds extends ys{static forElement(t,e,n){return{control:t,element:X(e,{...n,form:t})}}static by(t,e){return new this(this.providerBy(t,e))}static providerBy(t,e){return n=>{let s=()=>n.control.build((e=>(s=H((()=>t(e))))())),r=()=>n.element.build((t=>(r=H((()=>e({form:s(),...t}))))()));return{get control(){return s()},get element(){return r()}}}}static get[Y](){return Us}constructor(t){super(function(t,e){const n=e=>({applyAspect:n=>Z(e,Ds,t())});return r=>r.get(ps).rules.do(s((s=>{const o={sharer:r,form:t(),control:(new Q).addAspect(Ds,n),element:(new Q).addAspect(Ds,n)};return s.setupForm(o),N(e(o))})),R(Es,(([t])=>t)),L((e=>e&&{get form(){return t()},get control(){return e.control},get element(){return e.element}})))}((()=>this),T(t)))}get element(){var t;return null===(t=this.body)||void 0===t?void 0:t.element}toString(){return"Form"}}function Es(t,e){let n=!0;return(null==t?void 0:t.control)!==(null==e?void 0:e.control)&&(null==t||t.control.supply.off(),n=!1),(null==t?void 0:t.element)!==(null==e?void 0:e.element)&&(null==t||t.element.supply.off(),n=!1),n}const Ls={createSetup(t,e,n="default"){if(!1===t)return t=>oe();if(!0===t)return t=>e(t).supply;let s=z(t);return s.length||(s=[n]),1===s.length?t=>t.aspect(tt).when(s[0],(()=>e(t))):t=>s.reduce(((n,s)=>t.aspect(tt).when(s,(()=>e(t))).as(n)),new re)}},Ms=new WeakMap;class js{static get[Ct](){const t=Ms.get(this);if(t)return t;const e=new this,n={setup:t=>{t.provide(e)}};return Ms.set(this,n),n}[ut](t){return t.provide({a:ps,is:this})}setupField(t){}setupForm(t){}}const Ps={createSetup(t,e,n){let s,r;if(Array.isArray(t)){const[e,...n]=t;Ns(e)?(s=n.length>1?n:n[0],r=e):s=t}else Ns(t)?r=t:s=t;return Ls.createSetup(s,e(r),n)}};function Ns(t){return null!=t&&"string"!=typeof t&&"boolean"!=typeof t}class Os extends js{constructor(t={}){super(),this._info=Ps.createSetup(t.info,(t=>{const e=ot(t);return t=>t.aspect(et).add(e)})),this._error=Ps.createSetup(t.error,(t=>{const e=nt(t);return t=>t.aspect(et).add(e)}))}setupField(t){t.control.setup(this._info).setup(this._error)}setupForm(t){t.control.setup(this._info),t.element.setup(et,((t,e)=>t.add(e.aspect(Ds).control.aspect(et))))}}class Vs extends js{constructor(t={}){super(),this._byValidity=Ps.createSetup(t.byValidity,(t=>{const e=st(t);return t=>t.aspect($).derive(e)})),this._byForm=Ls.createSetup(t.byForm,(t=>t.aspect(G).read.do(n((e=>{const n=new re;return Tt(e,(({parent:e})=>{const s=e.aspect(Ds);s&&t.aspect($).derive(s.element.aspect($)).as(n)})),n})))))}setupField(t){t.control.setup(this._byForm)}setupForm(t){t.control.setup(this._byValidity)}}function qs(t={}){const{form:e=Ss,cancel:s=!0}=t,r=es(e,{share:Ss,local:"too"});return Ft((({get:t})=>({componentDef:{define(e){e.whenComponent((e=>{e.whenConnected((()=>{const{component:o}=e;r(e).do(n(((e,n)=>{const r=null==e?void 0:e.body;if(!r)return;let i=r.element.events.on("submit");return s&&(i=i.do(Kt(!1))),i((e=>t(o).call(o,r,e)))}))).needs(e)}))}))}}})))}function Bs(t,...e){return is(t,...e)}function Is(t={},...e){let n,s,r;"function"==typeof t?(n={},r=[Cs(),t,...e]):(n=t,s=t.name,r=[Cs({name:s}),...e]);const{share:o=bs,form:i}=n,a=es(i,{share:Ss});return Bs(o,...r.map((t=>e=>{return t({...e,locateForm:a,name:(n=e.key,r=s,""===r?null:r||As(n))});var n,r})))}function Ks(t={},...e){if("function"==typeof t)return Bs(Ss,t,...e);const{share:n=Ss}=t;return Bs(n,...e)}export{sn as A,Le as C,bs as F,hn as H,jn as I,nn as N,qs as O,Be as P,Is as S,pe as a,Fs as b,Os as c,Ss as d,Nn as e,Vs as f,Rs as g,_e as h,Ks as i,Ds as j,_s as k,Ne as l,We as m};//# sourceMappingURL=generic.36801613.js.map
