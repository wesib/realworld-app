import{n as e,m as t,v as n,f as o,t as s,g as r,h as i,j as c,s as a,k as u,S as d,a as h,l}from"../proc7ts/primitives.ada6e792.js";import{i as p,a as f,f as m}from"../proc7ts/push-iterator.b943ed6f.js";import{a as y,b as g,C as w,c as b,F as _,g as x,d as v,e as C,h as D}from"../proc7ts/context-values.bb33d989.js";import{n as k,N as S,i as E,h as R}from"../frontmeans/namespace-aliaser.e08188c9.js";import{v as T,o as O,t as A,K as j,A as P,L as N,I as B,F,h as K,M as $,S as M,c as V,b as I,N as L,f as U,V as q,q as W,E as z,J as H,a as J,m as Z}from"../proc7ts/fun-events.3d56e7e0.js";import{W as G,a as Q}from"../proc7ts/workbench.76998d65.js";import{D as X}from"../frontmeans/dom-events.455a522c.js";import{i as Y,n as ee}from"../frontmeans/render-scheduler.78bb570f.js";const te=new y("bootstrap-context");class ne extends g{static get[w](){return te}}function oe(e){return(t,n)=>{const o=t.get(ne);return t===o?e(o,n):o.get(n)}}function se(e){return e.nodeType===Node.ELEMENT_NODE}class re{constructor(e){this.symbol=e}own(e){return e.hasOwnProperty(this.symbol)?e[this.symbol]:void 0}of(e){const t=this.own(e),n=u(e),o=n&&this.of(n);return t?o?this.merge([o,t]):t:o}define(e,t){const n=this.own(e),o=t.map((t=>this.meta(t,e))),s=this.merge(n?[n,...o]:o);return Object.defineProperty(e,this.symbol,{configurable:!0,value:s}),e}}const ie=Symbol("feature-def");class ce extends re{constructor(){super(ie)}merge(e){return e.reduce(((e,n)=>({needs:i(c(a(e.needs),n.needs)),has:i(c(a(e.has),n.has)),setup:t(e.setup,n.setup),init:t(e.init,n.init)})),{})}meta(e,t){const n=e[ie];return null==n?e:this.meta("function"==typeof n?e[ie](t):n,t)}}const ae=new ce,ue={[ie]:()=>({})},de={of:e=>ae.of(e)||{},for:(e,t)=>ae.meta(t,e),merge:(...e)=>ae.merge(e),all:(...e)=>e.reduce(((e,t)=>({[ie]:n=>de.merge(de.for(n,e),de.for(n,t))})),ue),define:(e,...t)=>ae.define(e,t)};function he(...e){return t=>de.define(t,...e)}const le=new y("feature-context");class pe extends ne{static get[w](){return le}whenDefined(e){return this.get(ne).whenDefined(e)}load(e,t){return this.get(ne).load(e,t?(new d).needs(this).needs(t):this)}}const fe=new y("bootstrap-workbench",{byDefault:oe((()=>new G))}),me=new Q("feature setup"),ye=new Q("feature init",{after:me}),ge=new Q("component definition",{after:ye}),we=Symbol("component-def");class be extends re{constructor(){super(we)}merge(e){return e.reduce(((e,n)=>({...e,...n,setup:t(e.setup,n.setup),define:t(e.define,n.define),feature:e.feature?n.feature?de.merge(e.feature,n.feature):e.feature:n.feature})),{})}meta(e,t){const n=e[we];return null!=n?this.meta("function"==typeof n?e[we](t):n,t):null!=e[ie]?{feature:de.for(t,e)}:E(e)?{name:e}:e}}const _e=new be,xe={[we]:()=>({})},ve={of:e=>_e.of(e)||{},for:(e,t)=>_e.meta(t,e),merge:(...e)=>_e.merge(e),all:(...e)=>e.reduce(((e,t)=>({[we]:n=>ve.merge(ve.for(n,e),ve.for(n,t))})),xe),define:(e,...t)=>_e.define(e,t)};function Ce(...e){const t=t=>ve.define(t,...e);return t[we]=()=>ve.all(...e),t}const De=new y("component-context"),ke=new y("component-event-dispatcher",{byDefault(e){const t=e.get(De),n=new X(t.element);return n.supply.needs(t),{dispatch:e=>n.dispatch(e),on:e=>n.on(e)}}}),Se=new y("content-root",{byDefault:e=>e.get(De).element});class Ee extends v{constructor(){super("state-updater"),this.upKey=this.createUpKey((n=>n.insert(n.seed.do(V(((...o)=>{if(o.length){const n=o.reduce(((e,n)=>t(n,e)),e);return I(((e,t,o)=>n(L(e),t,o)))}return n.hasFallback&&n.or?n.or:I(e)}))))))}grow(t){let n;t.context.get(this.upKey,t.hasFallback?{or:null!=t.or?I(t.or):t.or}:void 0)((e=>n=e)).whenOff((()=>n=e)),t.insert(((e,t,o)=>n(e,t,o)))}}const Re=new Ee,Te=Symbol("component-context");class Oe extends g{constructor(){super(),this.updateState=(e,t,n)=>{this.get(Re)(e,t,n)}}static get[w](){return De}static of(e){const t=Oe.findIn(e);if(!t)throw new TypeError(`No component context found in ${String(e)}`);return t}static findIn(e){return"function"==typeof e[Te]?e[Te]():void 0}get contentRoot(){return this.get(Se)}on(e){return this.get(ke).on(e)}dispatchEvent(e){this.get(ke).dispatch(e)}}class Ae extends Event{get context(){return Oe.of(this.target)}}const je=Symbol("anonymous-component-property");function Pe(e){const t=({get:t,set:n},o=je,s)=>Ce({[we](r){const i=e({type:r,key:o,readable:!0,writable:s,enumerable:!1,configurable:!1,get:e=>t(e,o),set:(e,t)=>n(e,t,o)});return i&&i.componentDef||{}}}),o=(e,n)=>t({get:(t,n)=>e(t,n)},n,!1),i=(t,n,o)=>function(e,t,n,o){const i=!n,c=o(n?s(n):r(e,t));if(!i||!c)return c;Object.defineProperty(e,t,c)}(t,n,o,(o=>{const{get:s,set:r}=o,i=t.constructor,{get:c,set:a,configurable:u,enumerable:d,componentDef:h={}}=e({type:i,key:n,readable:!!o.get,writable:!!o.set,enumerable:!!o.enumerable,configurable:!!o.configurable,get:s?e=>s.call(e):Ne(n),set:r?(e,t)=>r.call(e,t):Be(n)})||{};ve.define(i,h);const l={...o,configurable:null!=u?u:o.configurable,enumerable:null!=d?d:o.enumerable};return(c||a)&&(l.get=c&&function(){return c(this,n)},l.set=a&&function(e){a(this,e,n)}),l}));return i.With=(e,n)=>t(e,n,!0),i.By=o,i.As=(e,t)=>o(n(e),t),i.Bind=(e,n=je)=>{const o=Symbol(`${String(n)}:accessor`),s=t=>{const s=t[o];if(s)return s;const r=e(t,n);return t[o]={get:r.get?r.get.bind(r):Ne(n),set:r.set?r.set.bind(r):Be(n)}};return t({get:e=>s(e).get(),set:(e,t)=>s(e).set(t)},n,!0)},i}function Ne(e){return()=>{throw new TypeError(`"${String(e)}" is not readable`)}}function Be(e){return()=>{throw new TypeError(`"${String(e)}" is not writable`)}}const Fe=new y("bootstrap-context-registry");class Ke extends b{constructor(){super(),this.provide({a:Ke,is:this}),this.values=this.newValues()}static get[w](){return Fe}static create(){return new Ke}}const $e=new y("per-component-registry",{byDefault:oe((()=>new Me))});class Me extends b{}const Ve=new y("per-definition-registry",{byDefault:oe((e=>new Ie(e)))});class Ie extends b{}const Le=Symbol("post-def-setup");function Ue(e){if(e.hasOwnProperty(Le))return e[Le];const t=A(),n=new z,o=t.read.do(j(h)),s=H(o,n),r=u(e,(e=>we in e));if(r){const e=Ue(r);s((t=>e.send(t)))}const i={on:s,send(e){n.send(e)},setup(e){t.it=e}};return Object.defineProperty(e,Le,{value:i}),i}const qe=new y("window",{byDefault:()=>window}),We=new y("bootstrap-root",{byDefault:e=>e.get(qe).document.body}),ze=new y("default-namespace-aliaser");class He extends v{constructor(){super("default-render-scheduler"),this.upKey=this.createUpKey((e=>e.insert(e.seed.do(V(((...t)=>t.length?I(Je(e.context,t[t.length-1])):e.hasFallback&&e.or?e.or:I(Je(e.context,ee))))))))}grow(e){let t;e.context.get(this.upKey,e.hasFallback?{or:null!=e.or?I(e.or):e.or}:void 0)((n=>t=Je(e.context,n))).whenOff((e=>t=C(e))),e.insert(((...e)=>t(...e)))}}function Je(e,t){return(n={})=>t({...n,window:n.window||e.get(qe)})}const Ze=new He;class Ge extends v{constructor(){super("element-adapter"),this.upKey=this.createUpKey((e=>e.insert(e.seed.do(V(((...t)=>{const n=t.reduce(((e,t)=>n=>e(n)||t(n)),Qe);return n!==Qe?I(n):e.hasFallback&&e.or?e.or:I(Qe)}))))))}grow(e){let t;e.context.get(this.upKey,e.hasFallback?{or:null!=e.or?I(e.or):e.or}:void 0)((e=>t=e)).whenOff((e=>t=C(e))),e.insert((e=>t(e)))}}function Qe(e){return Oe.findIn(e)}const Xe=new Ge,Ye=new _("element-observer",{byDefault:oe((e=>{const t=e.get(Xe);class n extends MutationObserver{constructor(e){super((n=>{n.forEach((e=>{p(f(e.removedNodes),(e=>{var t;return null===(t=function(e){var t;return null===(t=Oe.findIn(e))||void 0===t?void 0:t.mount}(e))||void 0===t?void 0:t.checkConnected()})),p(m(e.addedNodes,se),(e=>{var n,o;return null===(o=null===(n=t(e))||void 0===n?void 0:n.mount)||void 0===o?void 0:o.checkConnected()}))})),e(n,this)}))}observe(e,t){super.observe(e,{...t,childList:!0})}}return e=>new n(e)}))});const et=Symbol("definition-context");function tt(e){if(!e.hasOwnProperty(et))throw new TypeError(`Component is not defined: ${e}`);return e[et]}const nt=new y("custom-elements",{byDefault:oe((function(e){const t=e.get(qe).customElements,n=e.get(ze);return new class extends ot{define(e,o){if(E(e))return void t.define(R.name(e,n),o);const s=tt(e),{name:r,extend:i}=s.elementDef;r?i&&i.name?t.define(R.name(r,n),o,{extends:i.name}):t.define(R.name(r,n),o):rt(e).resolve(void 0)}whenDefined(e){if(E(e))return t.whenDefined(R.name(e,n));const o=tt(e),{name:s}=o.elementDef;return s?t.whenDefined(R.name(s,n)):rt(e).promise()}}}))});class ot{static get[w](){return nt}}const st=Symbol("component-resolver");function rt(e){return e.hasOwnProperty(st)?e[st]:e[st]=l()}const it=new y("definition-context"),ct=new y("element-def",{byDefault(e){const t=e.get(it).componentType,{name:n,extend:o}=ve.of(t),s={get type(){return o&&o.type||e.get(qe).HTMLElement},get name(){return o&&o.name}};return{get name(){return n},get extend(){return s}}}});class at extends g{static get[w](){return it}get elementDef(){return this.get(ct)}connectTo(e){const t=this.mountTo(e);return t.connect(),t}}const ut=Symbol("newComponent");function dt(e){const t=e.componentType;return t[ut]||(t[ut]=function(e){const t=Symbol("component-context");let n;return e.prototype[Te]=function(){return this[t]||(this[t]=n)},function(e){const o=n;n=e;try{const s=new this(e);return s[t]=e,s}finally{n=o}}}(t)),t[ut](e)}class ht extends Oe{constructor(e,t){super(),this._definitionContext=e,this.element=t,this._status=A(0),this.whenReady=this._status.read.do(T((e=>!!e&&this)),O),this.whenSettled=this._status.read.do(T((e=>e>=3&&this)),O),this.whenConnected=this._status.read.do(T((e=>e>=4&&this)),O);const n=e._newComponentRegistry();n.provide({a:Oe,is:this}),this.get=n.newValues().get}get componentType(){return this._definitionContext.componentType}get component(){return this._component()}get settled(){return this._status.it>=3&&!this.supply.isOff}get connected(){return this._status.it>=4&&!this.supply.isOff}get supply(){return this._status.supply}_component(){throw new TypeError("Component is not constructed yet. Consider to use a `whenReady()` callback")}settle(){2===this._status.it&&(this._status.it=3)}destroy(e){try{this._status.supply.off(e)}finally{delete this.component[Te],delete this.element[Te],this._component=lt,function(e){const{parentNode:t}=e;t&&t.removeChild(e)}(this.element)}}_createComponent(){const e=this._definitionContext._whenComponent;let t=0;this.element[Te]=n(this),e.readNotifier.do(O)((e=>t=e(this,t))),this.whenConnected((()=>{e.readNotifier({supply:(new d).needs(this),receive:(e,n)=>{t=n(this,t)}})})),this._definitionContext._elementBuilder.components.send(this);const o=dt(this);return this._component=n(o),this._status.it=1,this}_connect(){this._status.it=4}_created(){this._status.it<2&&(this._status.it=2),this.whenConnected((()=>this.dispatchEvent(new Ae("wesib:component",{bubbles:!0}))))}}function lt(){throw new TypeError("Component destroyed already")}class pt extends class{get component(){return this.context.component}get element(){return this.context.element}}{constructor(e){super(),this.context=e}get connected(){return this.context.connected}connect(){this.context._connect()}checkConnected(){const e=this.context.element,t=e.ownerDocument,n=null!=t&&t.contains(e);return n!==this.connected&&(n?this.connect():this.context.destroy()),n}}class ft extends ht{constructor(e,t){super(e,t),this.mount=this.mount=new pt(this)}}class mt extends ht{get mount(){}}class yt{constructor(){const e=A(0),t=new z;this.onCreated=U((n=>{const o=e.it+1;t.on({supply:n.supply,receive:(e,t,s)=>{s<o&&n.receive({onRecurrent(t){e.onRecurrent((e=>t(e)))}},t)}}),++e.it})),this.readNotifier=e.read.do(Z((e=>(n,o)=>(t.send(n,o),e))))}}class gt extends at{constructor(e,t,o){var s,r;super(),this._bsContext=e,this._elementBuilder=t,this.componentType=o,this._whenComponent=new yt,this._ready=A(!1),this._whenReady=this._ready.read.do(W(((e,t)=>t&&e()))),this._def=ve.of(o);const i=new Ie(e.get(Ve).seeds());i.provide({a:at,is:this}),this.get=i.newValues().get;const c=e.get($e).append((e=>this.get(e)));this._perComponentRegistry=new Me(c.seeds()),this.whenReady=this._whenReady.do(J(n(this)),O);const a={get componentType(){return o},whenReady:this.whenReady,whenComponent:this.whenComponent,perDefinition:e=>i.provide(e),perComponent:e=>this._perComponentRegistry.provide(e)};null===(r=(s=this._def).setup)||void 0===r||r.call(s,a),Ue(o).setup(a)}get elementType(){return this._elementType()}get whenComponent(){return this._whenComponent.onCreated}mountTo(e){if(e[Te])throw new Error(`Element ${String(e)} already bound to component`);const t=new ft(this,e);t._createComponent();const{mount:n}=t;return n.checkConnected(),t._created(),t.settle(),n}perComponent(e){return this._perComponentRegistry.provide(e)}_newComponentRegistry(){return new Me(this._perComponentRegistry.seeds())}_elementType(){throw new Error("Custom element class is not constructed yet. Consider to use a `whenReady()` callback")}_define(){var e,t;null===(t=(e=this._def).define)||void 0===t||t.call(e,this),this._elementBuilder.definitions.send(this),this._elementType=n(function(e){const t=e.get(ct);class n extends t.extend.type{constructor(){super();const t=new mt(e,this);t._createComponent(),t._created()}connectedCallback(){var e;null===(e=super.connectedCallback)||void 0===e||e.call(this),this[Te]()._connect()}disconnectedCallback(){var e;this[Te]().destroy(),null===(e=super.disconnectedCallback)||void 0===e||e.call(this)}}return n}(this)),this.componentType[et]=this,this._ready.it=!0}}const wt=new y("element-builder",{byDefault:oe((function(e){return{definitions:new z,components:new z,buildElement(t){const n=new gt(e,this,t);return n._define(),n}}}))});class bt{constructor(e){this._setup=e,this._components=void 0}define(e){this._components?this._components.push(e):(this._components=[e],this._defineAll(this._components))}_defineAll(e){const t=this._setup.get(fe).work(ge).run((()=>{const t=this._setup.get(ot),n=this._setup.get(wt);e.forEach((e=>{const o=n.buildElement(e);t.define(e,o.elementType)})),this._components=void 0}));this._setup.initBy(n(t))}}class _t extends pe{constructor(e,t){super(),this.feature=e,this._setup=t,this._bsContext=t.get(ne);const n=t.get(t.module),o=new b(this._bsContext);o.provide({a:pe,is:this}),this.get=o.newValues().get,this.whenReady=n.read.do(T((({ready:e})=>e&&this)),O),this._componentRegistry=new bt(this._setup)}get supply(){return this._setup.supply}get onDefinition(){return this._onDefinition||(this._onDefinition=this._setup.get(wt).definitions.on.do(F(this)))}get onComponent(){return this._onComponent||(this._onComponent=this._setup.get(wt).components.on.do(F(this)))}provide(e){return this._bsContext.get(Ke).provide(e).needs(this)}perDefinition(e){return this._bsContext.get(Ve).provide(e).needs(this)}perComponent(e){return this._bsContext.get($e).provide(e).needs(this)}setupDefinition(e){return function(e,t){const{on:n}=Ue(e);return U((e=>{n({supply:e.supply.needs(t),receive(n,o){const s=o.whenReady.do(F(t)),r=o.whenComponent.do(F(t));e.receive(n,{get componentType(){return o.componentType},get whenReady(){return s},get whenComponent(){return r},perDefinition:e=>o.perDefinition(e).needs(t),perComponent:e=>o.perComponent(e).needs(t)})}})}))}(e,this.supply)}define(e){this._componentRegistry.define(e)}}const xt=Symbol("feature-module");class vt extends x{constructor(e){super(e.name,function(e){const t=function(e){let t=de.of(e);if(we in e){t=de.merge(t,{init(t){t.define(e)}});const{feature:n}=ve.of(e);n&&(t=de.merge(t,n))}return t}(e),o=[],s=[];for(const e of a(t.has))o.push(vt.of(e));for(const e of a(t.needs))s.push(vt.of(e));return{needs:s,has:o,setup(o){var s;const r=o.get(fe),i=new _t(e,o);if(t.init){const e=r.work(ye).run((()=>{t.init(i)}));o.initBy(n(e))}null===(s=t.setup)||void 0===s||s.call(t,i)}}}(e)),this.feature=e}static of(e){return Object.prototype.hasOwnProperty.call(e,xt)?e[xt]:e[xt]=new vt(e)}async setup(e){const t=e.get(fe);await t.work(me).run((()=>super.setup(e)))}}const Ct=Symbol("when-defined");function Dt(...e){const t=Ke.create(),{bootstrapContext:o,complete:s}=function(e){const t=A(0),o=e.values;class s extends ne{constructor(){super(),this.get=o.get,this.whenReady=t.read.do(j((e=>!!e&&this)),O),e.provide({a:ze,by:k}),e.provide({a:ne,is:this})}whenDefined(e){return function(e,t){if(t.hasOwnProperty(Ct))return t[Ct];const n=$(Promise.resolve(e.whenReady).then((()=>e.get(ot).whenDefined(t))).then((()=>tt(t))));return t[Ct]=n}(this,e)}load(t,o){const s=vt.of(t),r=e.provide(s);o?r.needs(o):o=r;const i=function(e,t){const n=A({feature:e,ready:!1});return t.read((({module:e,ready:t})=>{const o=e.feature,s=n.it;s&&s.feature===o&&s.ready===t||(n.it={feature:o,ready:t})})).needs(t),n.supply.needs(t),n.read}(t,this.get(s).use(o));return{read:i,whenReady:i.do(T((e=>e.ready&&e)),O),[P]:n(i),supply:r}}}return{bootstrapContext:new s,complete(){t.it=1}}}(t),r=1===e.length?e[0]:(i=e,de.define(class{},{needs:i}));var i;return o.load(r).read.do(T((({ready:e})=>e)),O).then(s).catch(console.error),o}const kt=Symbol("attribute");function St(e){return[kt,e]}function Et(t,n=!0){if(!1===n)return e;if(!0===n||"function"==typeof n){const e=St(t),o=!0===n?Rt:n;return(t,n,s)=>o(t,e,n,s)}return(e,t,o)=>Rt(e,n,t,o)}function Rt(e,t,n,o){Oe.of(e).updateState(t,n,o)}function Tt(e){let t;for(let n=0;n<e.length;++n){const o=e[n];o<="Z"&&o>="A"?(t||(t=e.substring(0,n)),t+="-"+o.toLowerCase()):t&&(t+=o)}return t||e}function Ot(e,t,n){let o,s;if("string"==typeof n)o=Tt(n),s=Et(o);else{if(n&&n.name)o=Tt(n.name);else{if("string"!=typeof t)throw new TypeError(`Attribute name is required as property key is not a string: ${e.constructor.name}.prototype.${String(t)}`);o=Tt(t)}s=Et(o,n&&n.updateState)}return{name:o,change:s}}const At=new y("attribute-registry",{byDefault:e=>new jt(e.get(at))});class jt{constructor(e){this._context=e,this.attrs=new Map,e.whenReady((({elementType:e})=>this.define(e))),e.whenComponent((({mount:e})=>{e&&this.mount(e)}))}declareAttribute({name:e,change:n}){this.attrs.set(e,t(this.attrs.get(e),n))}define(e){const{attrs:t}=this;t.size&&(Object.defineProperty(e,"observedAttributes",{configurable:!0,enumerable:!0,value:Pt(e,[...t.keys()])}),Object.defineProperty(e.prototype,"attributeChangedCallback",{configurable:!0,enumerable:!0,value:Nt(e,t)}))}mount(e){const{element:t}=e,{attrs:n}=this,o=[...n.keys()];if(!o.length)return;new(0,this._context.get(qe).MutationObserver)((e=>e.forEach((e=>{const o=e.attributeName;return n.get(o)(Oe.of(t).component,t.getAttribute(o),e.oldValue)})))).observe(t,{attributes:!0,attributeFilter:o,attributeOldValue:!0})}}function Pt(e,t){const n=e.observedAttributes;if(Array.isArray(n)){const e=new Set(n);t.forEach((t=>e.add(t))),t=[...e]}return t}function Nt(e,t){const n=e.prototype.attributeChangedCallback;return n?function(e,o,s){const r=t.get(e);r?r(Oe.of(this).component,s,o):n.call(this,e,o,s)}:function(e,n,o){t.get(e)(Oe.of(this).component,o,n)}}function Bt(e){return Pe((({type:t,key:n})=>{const o=Ot(t.prototype,n,e),{name:s}=o;return{componentDef:{define(e){e.get(At).declareAttribute(o)}},get:e=>Oe.of(e).element.getAttribute(s),set(e,t){const{element:n}=Oe.of(e);null!=t?n.setAttribute(s,t):n.removeAttribute(s)}}}))}function Ft(e){return Pe((({type:t,get:n,key:o})=>{const{name:s,change:r}=Ot(t.prototype,o,e);return{componentDef:{define(e){e.get(At).declareAttribute({name:s,change(e,t,o){n(e).call(e,t,o),r(e,t,o)}})}}}}))}function Kt(...e){return Ce({define(t){const n=t.get(At);for(const t of e)if("string"==typeof t){const e=Tt(t);n.declareAttribute({name:e,change:Et(e)})}else for(const[e,o]of Object.entries(t)){const t=Tt(e);n.declareAttribute({name:t,change:Et(t,o)})}}})}class $t extends D{constructor(){super("component-state")}grow(e){const t=e.seed();let n;if(null!=t)n=t,e.insert(n);else{if(e.hasFallback)return;n=new Vt,e.context.get(Oe).supply.whenOff((e=>n.done(e))),e.insert(n)}e.setup((({registry:e})=>{e.provide({a:Re,is:n.update})}))}}const Mt=new $t;class Vt extends M{static get[w](){return Mt}}const It=Symbol("state-property");function Lt(e){return[It,e]}function Ut(e,t,n,o){n!==o&&Oe.of(e).updateState(t,n,o)}function qt({updateState:e}={}){return Pe((({get:t,set:n,key:o})=>{if(!1!==e){const s=n,r=function(e,t=!0){if(!0===t||"function"==typeof t){const n=Lt(e),o=!0===t?Ut:t;return(e,t,s)=>o(e,n,t,s)}return(e,n,o)=>{n!==o&&Oe.of(e).updateState(t,n,o)}}(o,e);n=(e,n)=>{const o=t(e);s(e,n),r(e,n,o)}}return{get:t,set:n}}))}class Wt extends q{constructor(e,t,n){super(),this._context=e,this._name=t,this.supply=new d,this.on=this._context.get(Vt).track(n).onUpdate.do(W(((e,t,n,o)=>e(n,o))),F(this))}get it(){return this._context.element.getAttribute(this._name)}set it(e){this.supply.isOff||(null==e?this._context.element.removeAttribute(this._name):this._context.element.setAttribute(this._name,e))}}function zt(e,t,n=St(t)){return new Wt(e,t,n)}const Ht=new y("dom-property-registry",{byDefault:e=>new Jt(e.get(at))});class Jt{constructor(e){this.props=new Map,e.whenReady((({elementType:e})=>this.define(e))),e.whenComponent((({mount:e})=>{e&&this.mount(e)}))}declareDomProperty({key:e,descriptor:t}){this.props.set(e,t)}define(e){const t=e.prototype;this.props.forEach(((e,n)=>{Object.defineProperty(t,n,e)}))}mount({element:e}){this.props.forEach(((t,n)=>{Object.defineProperty(e,n,t)}))}}const Zt=Symbol("dom-property");function Gt(e){return[Zt,e]}function Qt(e,t,n,o){n!==o&&Oe.of(e).updateState(t,n,o)}function Xt(e={}){return Pe((t=>{const{key:n,get:o}=t;let{set:s}=t;const r=function(e,{propertyKey:t=e.key,configurable:n=e.configurable,enumerable:o=e.enumerable,writable:s=e.writable}){const r=e.key;return{key:t,descriptor:{configurable:n,enumerable:o,get:function(){return Oe.of(this).component[r]},set:s?function(e){Oe.of(this).component[r]=e}:void 0}}}(t,e);if(!1!==e.updateState){const t=function(e,t=!0){if(!0===t||"function"==typeof t){const n=Gt(e),o=!0===t?Qt:t;return(e,t,s)=>o(e,n,t,s)}return(e,n,o)=>{n!==o&&Oe.of(e).updateState(t,n,o)}}(n,e.updateState),r=s;s=(e,n)=>{const s=o(e);r(e,n),t(e,n,s)}}return{componentDef:{define(e){e.get(Ht).declareDomProperty(r)}},get:o,set:s}}))}const Yt=Symbol("render"),en={spec:(e,t)=>o(t,e),fulfill(e,t={}){const{on:n=t.on,error:o}=e;return{on:n,error:o?o.bind(e):t.error&&t.error.bind(t)}},trigger(e,t={}){const{on:n=[]}=t;if(("object"==typeof n||"function"==typeof n)&&N(n))return B(n).do(F(e));const o=e.get(Vt).track(n).onUpdate.do(F(e));return Array.isArray(n)&&!n.length?o.do(K(((e,t)=>t[0]!==Yt&&e()))):o}};class tn{constructor(e){this._context=e,this._renders=new Set}renderBy(t,n={}){const o=en.spec(this._context,n),s=en.trigger(this._context,o),r=this._context.get(Ze)({...en.fulfill(o),node:this._context.element}),i="connected"===o.when;let c=1;const a=s(i?()=>this._context.connected&&d():()=>this._context.settled&&d()).needs(this._context).whenOff((function(){2===c&&r(e);c=-1}));(i?this._context.whenConnected:this._context.whenSettled)((()=>c&&d()));const u=Y();return this._renders.add(h),a.whenOff((()=>this._renders.delete(h)));function d(){c=2,r(l)}function h(){u(l)}function l(e){if(c>0)for(c=0;;){const n=t(e);if(n===t||"function"!=typeof n)break;t=n}}}renderNow(){this._renders.forEach((e=>e()))}}const nn=new y("element-render-ctl",{byDefault:e=>new tn(e.get(Oe))});const on=new y("element-render-scheduler",{byDefault:function(t){const n=t.get(nn);return(t={})=>{const o=A(e);return n.renderBy((e=>{o.it(e)}),en.fulfill({on:o.on},t)),e=>{o.it=t=>e(t)}}}});function sn(e){return Pe((({get:t})=>({componentDef:{define(n){n.whenComponent((n=>{n.whenReady((()=>{const{component:o}=n,s=t(o).bind(o);n.get(nn).renderBy(s,e)}))}))}}})))}const rn=new y("shadow-content-root");class cn extends Event{get shadowRoot(){return this.target.shadowRoot}}const an=new _("shadow-root-builder",{byDefault:()=>un});function un(e,t){const o=function(e,t){const n=e.shadowRoot;if(n)return n;if("attachShadow"in e)return e.attachShadow(t);return}(e.element,t);return o&&(o[Te]=n(e),e.whenConnected((()=>e.dispatchEvent(new cn("wesib:shadowAttached",{bubbles:!0}))))),o}const dn={mode:"open"};function hn(e=dn){return Ce({setup(t){t.perComponent({a:rn,by:t=>t.get(an)(t,e)}),t.perComponent({a:Se,by:e=>e.get(rn,{or:null})})}})}const ln=new S("https://wesib.github.io/ns","b","wesib");export{Kt as A,qe as B,Ce as C,Xt as D,nn as E,he as F,sn as R,qt as S,ln as W,oe as a,Dt as b,Bt as c,Pe as d,Oe as e,en as f,ve as g,Yt as h,Ft as i,hn as j,Gt as k,ze as l,on as m,ne as n,ie as o,Xe as p,We as q,Ye as r,se as s,zt as t,Vt as u,Lt as v};//# sourceMappingURL=wesib.4285371a.js.map
