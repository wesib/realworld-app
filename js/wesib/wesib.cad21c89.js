import{b as e,e as t,g as n,n as r,c as s}from"../lib/call-thru.00f7427a.js";import{c as o,A as i,m as u,d as a,e as c,a as f,f as l}from"../lib/a-iterable.a3fddd20.js";import{S as d,F as p,C as h,a as m,b as g,c as y,M as w}from"../lib/context-values.956fc686.js";import{t as b,b as v,a as x,e as _,n as D,c as O,o as k,f as C,V as S,E,D as j,g as T,h as P,j as R,S as q,A}from"../lib/fun-events.a21352be.js";import{n as $,i as M,N,h as B}from"../lib/namespace-aliaser.535f16ce.js";import{n as V}from"../lib/render-scheduler.8e498d62.js";const K=new d("bootstrap-context");class z extends h{static get[m](){return K}}function Q(e){return(t,n)=>{const r=t.get(z);return t===r?e(r,n):r.get(n)}}const F=new d("component-factory");class L{static get[m](){return F}connectTo(e){const t=this.mountTo(e);return t.connected=!0,t}}const U=new d("window",{byDefault:()=>window}),I=new d("bootstrap-root",{byDefault:e=>e.get(U).document.body}),W=new d("default-namespace-aliaser"),H=new p("default-render-scheduler",{byDefault:Q(e=>(t={})=>V(Object.assign(Object.assign({},t),{window:t.window||e.get(U)})))});function G(e){return Array.isArray(e)}class J extends i{constructor(e){super(),this.items=null==e?new Set:G(e)?new Set(e):new Set([e])}get value(){switch(this.items.size){case 0:return;case 1:return this.items[Symbol.iterator]().next().value;default:return[...this.items]}}[Symbol.iterator](){return this.items[Symbol.iterator]()}add(...e){return e.forEach(e=>this.items.add(e)),this}get size(){return this.items.size}merge(e){return null==e?this:G(e)?this.add(...e):this.add(e)}}function X(e,t=(()=>!0)){const n=Object.getPrototypeOf(e.prototype);if(null==n)return;const r=n.constructor;return t(r)?r:X(r,t)}function Y(e,t,n,r){const s=!n,o=r(n?function(e){if(function(e){return void 0===e.value&&void 0===e.writable}(e))return e;const t=Symbol("value"),n=e.value,r=Object.assign(Object.assign({},e),{writable:void 0,value:void 0,get(){return t in this?this[t]:n}});return e.writable&&(r.set=function(e){this[t]=e}),delete r.writable,delete r.value,r}(n):function(e,t){const n=Symbol(`${String(t)}:value`),r=e[t];return{configurable:!0,enumerable:!0,get(){return n in this?this[n]:r},set(e){this[n]=e}}}(e,t));if(!s||!o)return o;Object.defineProperty(e,t,o)}function Z(e,t,n=((e,t)=>t)){return e?t?function(...r){return n(e.apply(this,r),t.apply(this,r))}:e:t}function ee(e){return e.nodeType===Node.ELEMENT_NODE}class te{constructor(e){this.symbol=e}own(e){return e.hasOwnProperty(this.symbol)?e[this.symbol]:void 0}of(e){const t=this.own(e),n=X(e),r=n&&this.of(n);return t?r?this.merge([r,t]):t:r}define(e,t){const n=this.own(e),r=u(t,t=>this.meta(t,e)),s=this.merge(n?l([[n],r]):r);return Object.defineProperty(e,this.symbol,{configurable:!0,value:s}),e}}class ne{constructor(){this.promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}resolve(e){this._resolve(e)}reject(e){this._reject(e)}}const re=Symbol("feature-def");class se extends te{constructor(){super(re)}merge(e){return o(e,(e,t)=>({needs:new J(e.needs).merge(t.needs).value,has:new J(e.has).merge(t.has).value,setup:Z(e.setup,t.setup),init:Z(e.init,t.init)}),{})}meta(e,t){const n=e[re];return null==n?e:this.meta("function"==typeof n?e[re](t):n,t)}}const oe=new se,ie={[re]:()=>({})},ue={of:e=>oe.of(e)||{},for:(e,t)=>oe.meta(t,e),merge:(...e)=>oe.merge(e),all:(...e)=>o(e,(e,t)=>({[re]:n=>ue.merge(ue.for(n,e),ue.for(n,t))}),ie),define:(e,...t)=>oe.define(e,t)};function ae(...e){return t=>ue.define(t,...e)}const ce=new d("feature-context");class fe extends z{static get[m](){return ce}whenDefined(e){return this.get(z).whenDefined(e)}load(e){return this.get(z).load(e)}}class le extends Error{constructor(e){super("Circular feature needs: "+e.reduce((e,[t,n,r])=>(e||t.name)+` ${n} ${r.name}`,"")),this.needs=e}}const de=Symbol("component-def");class pe extends te{constructor(){super(de)}merge(e){return o(e,(e,t)=>Object.assign(Object.assign(Object.assign({},e),t),{setup:Z(e.setup,t.setup),define:Z(e.define,t.define),feature:e.feature?t.feature?ue.merge(e.feature,t.feature):e.feature:t.feature}),{})}meta(e,t){const n=e[de];return null!=n?this.meta("function"==typeof n?e[de](t):n,t):null!=e[re]?{feature:ue.for(t,e)}:M(e)?{name:e}:e}}const he=new pe,me={[de]:()=>({})},ge={of:e=>he.of(e)||{},for:(e,t)=>he.meta(t,e),merge:(...e)=>he.merge(e),all:(...e)=>o(e,(e,t)=>({[de]:n=>ge.merge(ge.for(n,e),ge.for(n,t))}),me),define:(e,...t)=>he.define(e,t)};function ye(...e){const t=t=>ge.define(t,...e);return t[de]=()=>ge.all(...e),t}const we=new d("component-context"),be=new d("component-event-dispatcher",{byDefault(e){const t=e.get(we),n=new j(t.element);return T(n).needs(t),{dispatch:e=>n.dispatch(e),on:e=>n.on(e)}}}),ve=new d("content-root",{byDefault:e=>e.get(we).element}),xe=new p("state-updater",{byDefault:e(r)}),_e=Symbol("component-context");class De extends h{constructor(){super(...arguments),this.updateState=Oe.bind(this)}static get[m](){return we}static of(e){const t=e[_e];if(!t)throw TypeError(`No component context found in ${e}`);return t}get contentRoot(){return this.get(ve)}on(e){return this.get(be).on(e)}dispatchEvent(e){this.get(be).dispatch(e)}}function Oe(e,t,n){this.get(xe)(e,t,n)}class ke extends Event{get context(){return De.of(this.target)}}const Ce=Symbol("anonymous-component-property");function Se(t){const n=({get:e,set:n},r=Ce,s)=>ye({[de](o){const i=t({type:o,key:r,readable:!0,writable:s,enumerable:!1,configurable:!1,get:t=>e(t,r),set:(e,t)=>n(e,t,r)});return i&&i.componentDef||{}}}),r=(e,t)=>n({get:(t,n)=>e(t,n)},t,!1),s=(e,n,r)=>Y(e,n,r,r=>{const{get:s,set:o}=r,i=e.constructor,{get:u,set:a,configurable:c,enumerable:f,componentDef:l={}}=t({type:i,key:n,readable:!!r.get,writable:!!r.set,enumerable:!!r.enumerable,configurable:!!r.configurable,get:s?e=>s.call(e):Ee(n),set:o?(e,t)=>o.call(e,t):je(n)})||{};ge.define(i,l);const d=Object.assign(Object.assign({},r),{configurable:null!=c?c:r.configurable,enumerable:null!=f?f:r.enumerable});return(u||a)&&(d.get=u&&function(){return u(this,n)},d.set=a&&function(e){a(this,e,n)}),d});return s.With=(e,t)=>n(e,t,!0),s.By=r,s.As=(t,n)=>r(e(t),n),s.Bind=(e,t=Ce)=>{const r=Symbol(`${String(t)}:accessor`),s=n=>{const s=n[r];if(s)return s;const o=e(n,t);return n[r]={get:o.get?o.get.bind(o):Ee(t),set:o.set?o.set.bind(o):je(t)}};return n({get:e=>s(e).get(),set:(e,t)=>s(e).set(t)},t,!0)},s}function Ee(e){return()=>{throw new TypeError(`"${String(e)}" is not readable`)}}function je(e){return()=>{throw new TypeError(`"${String(e)}" is not writable`)}}class Te extends y{constructor(){super("element-adapter"),this.upKey=this.createUpKey(e=>e.seed.keep.thru((...t)=>{const n=t.reduce((e,t)=>n=>e(n)||t(n),Pe),r=()=>x(Pe);return n!==Pe?n:D(e.byDefault(r)||r())}))}grow(e){let t;return e.context.get(this.upKey,"or"in e?{or:null!=e.or?x(e.or):e.or}:void 0)(e=>t=e),e=>t(e)}}function Pe(e){return e[_e]}const Re=new Te,qe=new p("element-observer",{byDefault:Q(e=>{const t=e.get(Re);class n extends MutationObserver{constructor(e){super(n=>{n.forEach(e=>{c(f(e.removedNodes),e=>{var t;return null===(t=function(e){var t;return null===(t=e[_e])||void 0===t?void 0:t.mount}(e))||void 0===t?void 0:t.checkConnected()}),c(a(f(e.addedNodes),ee),e=>{var n,r;return null===(r=null===(n=t(e))||void 0===n?void 0:n.mount)||void 0===r?void 0:r.checkConnected()})}),e(n,this)})}observe(e,t){super.observe(e,Object.assign(Object.assign({},t),{childList:!0}))}}return e=>new n(e)})});const Ae=Symbol("component-factory");function $e(e){const t=e[Ae];if(!t)throw new TypeError(`Component is not defined: ${e}`);return t}const Me=new d("custom-elements",{byDefault:function(e){const t=e.get(U).customElements,n=e.get(W);return new class extends Ne{define(e,r){if(M(e))return void t.define(B.name(e,n),r);const s=$e(e),{name:o,extend:i}=s.elementDef;o?i&&i.name?t.define(B.name(o,n),r,{extends:i.name}):t.define(B.name(o,n),r):Ve(e).resolve(void 0)}whenDefined(e){if(M(e))return t.whenDefined(B.name(e,n));const r=$e(e),{name:s}=r.elementDef;return s?t.whenDefined(B.name(s,n)):Ve(e).promise}}}});class Ne{static get[m](){return Me}}const Be=Symbol("component-resolver");function Ve(e){return e[Be]||(e[Be]=new ne)}const Ke=new d("definition-context"),ze=new d("element-def",{byDefault(e){const t=e.get(Ke).componentType,{name:n,extend:r}=ge.of(t),s={get type(){return r&&r.type||e.get(U).HTMLElement},get name(){return r&&r.name}};return{get name(){return n},get extend(){return s}}}});class Qe extends h{static get[m](){return Ke}get elementDef(){return this.get(ze)}}const Fe=new d("bootstrap-context-registry");class Le extends g{constructor(){super(),this.provide({a:Le,is:this}),this.values=this.newValues()}static get[m](){return Fe}static create(){return new Le}}const Ue=new d("component-context-registry",{byDefault:Q(()=>new Ie)});class Ie extends g{static get[m](){return Ue}}const We=new d("definition-context-registry",{byDefault:Q(e=>new He(e))});class He extends g{static get[m](){return We}}const Ge=Symbol("post-def-setup");function Je(e){if(e.hasOwnProperty(Ge))return e[Ge];const r=b(),s=new P,o=r.read.thru(e=>e?t(e):n()),i=R(o,s),u=X(e,e=>de in e);if(u){const e=Je(u);i(t=>e.send(t))}const a={on:i,send(e){s.send(e)},setup(e){r.it=e}};return Object.defineProperty(e,Ge,{value:a}),a}class Xe{constructor(){const e=b(0),t=new P;this.onCreated=k(n=>{const r=e.it+1;t.on({supply:n.supply,receive:(e,t,s)=>{s<r&&n.receive({onRecurrent(t){e.onRecurrent(e=>t(e))}},t)}}),++e.it}),this.readNotifier=e.read.keep.thru_(e=>(n,r)=>(t.send(n,r),e))}}const Ye=new d("element-builder",{byDefault:Q((function(s){const o=s.get(He),i=s.get(Ie),u=new P,a=new P;return{definitions:u,components:a,buildElement(s){var a;const f=ge.of(s),l=new Xe;let d;const p=b(!1),h=p.read.thru(e=>e?t():n());let m;function g(){return i.append(d)}const y=new class extends L{get componentType(){return m.componentType}get elementType(){return m.elementType}get elementDef(){return m.elementDef}mountTo(e){if(e[_e])throw new Error(`Element ${e} already bound to component`);const t=c({definitionContext:m,whenComponent:l,registry:g(),element:e,elementSuper:t=>e[t],createMount:t=>new class extends class{get component(){return this.context.component}get element(){return this.context.element}}{get context(){return t}get connected(){return 3===et(e).it}set connected(t){et(e).it=t?3:2}checkConnected(){const t=e,n=t.ownerDocument;return this.connected=null!=n&&n.contains(t)}}}).mount;return t.checkConnected(),tt(t.context),t}};m=new class extends Qe{constructor(){var t;super();const n=this;this.whenReady=h.thru_(e(this)).once;const r=new He(o.seedIn(this));r.provide({a:Qe,is:this}),r.provide({a:L,is:y}),this.get=r.newValues().get,d=new Ie(r.seedIn(this));const i={get componentType(){return s},get whenReady(){return n.whenReady},get whenComponent(){return n.whenComponent},perDefinition:e=>r.provide(e),perComponent:e=>d.provide(e)};null===(t=f.setup)||void 0===t||t.call(f,i),Je(s).setup(i)}get componentType(){return s}get whenComponent(){return l.onCreated}get elementType(){throw new Error("Custom element class is not constructed yet. Consider to use a `whenReady()` callback")}perComponent(e){return d.provide(e)}},null===(a=f.define)||void 0===a||a.call(f,m),u.send(m);const w=function(e,t,n){const s=e.get(ze);class o extends s.extend.type{constructor(){super(),tt(c({definitionContext:e,whenComponent:t,registry:n(),element:this,createMount:r,elementSuper:e=>super[e]}))}connectedCallback(){et(this).it=3}disconnectedCallback(){et(this).it=2}}return o}(m,l,g);return Object.defineProperty(m,"elementType",{configurable:!0,enumerable:!0,value:w}),p.it=!0,y}};function c({definitionContext:e,whenComponent:s,registry:o,element:i,createMount:u,elementSuper:c}){const f=b(0),l=b();f.on(r).whenOff(e=>l.it=[e]);const d=l.read.thru(e=>e?t(e[0]):n()).once,p=f.read.thru_(e=>2===e?t():n()),h=f.read.thru_(e=>{if(3!==e)return n();const r=C();return p.once(()=>r.off()),t(r)});let m;const g=o.newValues();const y=new class extends De{constructor(){super(),this.get=g.get,this.elementSuper=c;const e=f.read.thru(e=>e?t(this):n());this.whenReady=e.once}get componentType(){return e.componentType}get element(){return i}get component(){throw new Error("The component is not constructed yet. Consider to use a `whenReady()` callback")}get mount(){return m||(m=u(this))}get connected(){return 3===f.it}get[E](){return T(f)}get whenOn(){return h}get whenOff(){return p}get whenDestroyed(){return d}destroy(e){f.done(e)}};let w=0;y.whenDestroyed(()=>function(e){const{element:t,mount:n}=e;n&&(n.connected=!1);const r=t.parentElement;r&&r.removeChild(t)}(y)),o.provide({a:De,is:y}),Object.defineProperty(i,_e,{value:y}),Object.defineProperty(i,Ze,{writable:!0,value:f}),s.readNotifier.once(e=>w=e(y,w)),y.whenOn(e=>{s.readNotifier({supply:e,receive(e,t){w=t(y,w)}})}),a.send(y);const v=function(e,t){const n=e.prototype,r=n[_e];n[_e]=t;try{const s=new e(t);return Object.defineProperty(s,_e,{value:t}),s}finally{n[_e]=r}}(e.componentType,y);return Object.defineProperty(y,"component",{configurable:!0,enumerable:!0,value:v}),f.it=1,y}}))}),Ze=Symbol("component-status");function et(e){return e[Ze]}function tt(e){e.whenOn.once(()=>e.dispatchEvent(new ke("wesib:component",{bubbles:!0})))}const nt=e(r);class rt{constructor(e){this._context=e,this._definitionQueue=[],e.whenReady(()=>{this._definitionQueue.forEach(e=>e()),delete this._definitionQueue})}get customElements(){return this._context.get(Ne)}define(e){this._definitionQueue.push(()=>{const t=this._context.get(Ye).buildElement(e);e[Ae]=t,this.customElements.define(e,t.elementType)})}}const st=Symbol("feature-key");class ot extends y{static of(e){return e.hasOwnProperty(st)?e[st]:e[st]=new ot(e)}get upKey(){return this}constructor(e){super(`feature:${e.name}`)}grow(e){return r=e.context.get(z),s=e.seed.keep.thru(it),v(e=>{let n,o=x(),i=Promise.resolve("idle");return _({clause:s,deps:ut(r,s)}).keep.thru_(({clause:[e],deps:s})=>{if(!e)return t();const[u,,a]=e;if(u.feature===n)return D(o);if(n=u.feature,a!==n)return D(o=r.get(ot.of(n)).keep.thru_(e=>(e.to(i),i=e.stage,e)));const c=new ct(r,u,s).to(i),f=x(c);return D(o=v(e=>f(e).whenOff(()=>{i=c.unload()})).share())})(e)}).keep.thru(function(){let e=null;return r=>e===r?n():(e=r,r?t(r):t())}());var r,s}}function it(...e){let t,n=!1;for(const r of e)switch(r[1]){case"is":n=!0,t||(t=r);break;case"has":t=r;break;case"needs":n=!0}return n?t:void 0}function ut(e,n){return n.keep.thru_(n=>{if(!n)return t();const[{def:r}]=n,s=new J(r.needs);return s.size?D(O(...u(s,t=>e.get(ot.of(t)))).keep.thru_(at)):t()})}function at(...e){return t(...a(u(e,e=>e[0]),s))}class ct{constructor(e,t,n){this.bsContext=e,this.request=t,this.deps=n,this.state=b(!1),this.down=new Promise(e=>this._down=e),this._stage=Promise.resolve(new lt(this))}get stage(){return this._stage.then(e=>e.after)}get ready(){return this.state.it}to(e){const t=this._stage;return this._stage=e.then(e=>t.then(t=>t[e]())),this}async setup(){await(this._stage=this._stage.then(e=>e.setup()))}async init(){await(this._stage=this._stage.then(e=>e.init()))}async unload(){const e=this._stage;delete this._stage;const t=await e,n=await t.stop();return this._down(),n}}class ft{constructor(e,t=(()=>Promise.resolve())){this.loader=e,this._stop=t}idle(){return Promise.resolve(this)}stop(){return this._stop().then(()=>this.after)}perDep(e){const{deps:t}=this.loader;return Promise.all(t.map(t=>e(t)))}}class lt extends ft{get after(){return"idle"}async setup(){var e;await this.perDep(e=>e.setup());const{bsContext:r,request:{def:s}}=this.loader,[o,i]=function(e,r){const s=function(){const e=[];let t=t=>{const n=t();return e.push(n),n};return{supply:C(()=>{t=nt,c(f(e).reverse(),e=>e()),e.length=0}),add:e=>t(e)}}();let o;const i=e.get(He),u=e.get(Ie),a=new g(e),l=e.get(Ye),d=l.definitions.on.tillOff(s.supply),p=l.components.on.tillOff(s.supply);return[new class extends fe{constructor(){super(),this.get=a.newValues().get;const s=_({st:r.state,bs:b().by(e.whenReady)}).thru(({st:[e],bs:[r]})=>r&&e?t(this):n());this.whenReady=s.once,a.provide({a:fe,is:this}),o=new rt(this)}get feature(){return r.request.feature}get onDefinition(){return d}get onComponent(){return p}provide(t){return s.add(()=>e.get(Le).provide(t))}perDefinition(e){return s.add(()=>i.provide(e))}perComponent(e){return s.add(()=>u.provide(e))}setupDefinition(e){return function(e,t){const{on:n}=Je(e);return k(e=>{n({supply:e.supply.needs(t.supply),receive(n,r){const s=r.whenReady.tillOff(t.supply),o=r.whenComponent.tillOff(t.supply);e.receive(n,{get componentType(){return r.componentType},get whenReady(){return s},get whenComponent(){return o},perDefinition:e=>t.add(()=>r.perDefinition(e)),perComponent:e=>t.add(()=>r.perComponent(e))})}})})}(e,s)}define(e){o.define(e)}},s.supply]}(r,this.loader);return null===(e=s.setup)||void 0===e||e.call(s,o),new dt(this.loader,o,()=>Promise.resolve(i.off()))}init(){return this.setup().then(e=>e.init())}}class dt extends ft{constructor(e,t,n){super(e,n),this._context=t}get after(){return"setup"}setup(){return Promise.resolve(this)}async init(){var e;await this.perDep(e=>e.init());const{request:{def:t}}=this.loader;return null===(e=t.init)||void 0===e||e.call(t,this._context),new pt(this)}}class pt extends ft{get after(){return"init"}constructor(e){super(e.loader,()=>e.stop()),e.loader.state.it=!0}setup(){return Promise.resolve(this)}init(){return Promise.resolve(this)}}class ht{constructor(e,t,n){this._requester=e,this.feature=t,this._revoke=n,this._uses=0,this.def=function(e){let t=ue.of(e);if(de in e){t=ue.merge(t,{init(t){t.define(e)}});const{feature:n}=ge.of(e);n&&(t=ue.merge(t,n))}return t}(t)}request(e){const t=this._requester,{registry:n}=t,r=[this,"is",this.feature];return this._revokeBy(n.provide({a:ot.of(this.feature),is:r})),new J(this.def.has).forEach(r=>{const s=[this,"has",r];this._revokeBy(n.provide({a:ot.of(r),is:s}));const o=t.request(r,[...e,s]);this._revokeBy(()=>o.unuse())}),new J(this.def.needs).forEach(r=>{const s=[this,"needs",r],o=t.request(r,[...e,s]);this._revokeBy(()=>o.unuse()),this._revokeBy(n.provide({a:ot.of(r),is:s}))}),this._uses=1,this}reuse(e){if(!this._uses)throw new le(e.map(([{feature:e},t,n])=>[e,t,n]));return++this._uses,this}unuse(){--this._uses||this._revoke()}_revokeBy(e){this._revoke=Z(e,this._revoke)}}const mt=new d("feature-requester",{byDefault:Q(e=>new gt(e))});class gt{constructor(e){this._map=new Map,this.registry=e.get(Le)}static get[m](){return mt}request(e,t=[]){const n=this._map.get(e);if(n)return n.reuse(t);const r=new ht(this,e,()=>this._map.delete(e));return this._map.set(e,r),r.request(t)}}function yt(...e){const r=Le.create(),{bootstrapContext:s,complete:o}=function(e){const r=b(0),s=e.values;const o=new class extends z{constructor(){super(),this.get=s.get;const o=r.read.thru(e=>e?t(this):n());this.whenReady=o.once,e.provide({a:W,by:$}),e.provide({a:z,is:this})}async whenDefined(e){return await new Promise(this.whenReady),await this.get(Ne).whenDefined(e),$e(e)}load(e){const t=v(t=>{const n=o.get(gt).request(e),r=b({status:{feature:e,ready:!1}});this.get(ot.of(e))({supply:t.supply,receive(e,t){const n=t;r.it={status:{feature:n.request.feature,ready:n.ready},down:n.down},n.ready||n.init().then(()=>{r.it={status:{feature:n.request.feature,ready:!0},down:n.down}})}}).whenOff(()=>{n.unuse()}),r.read(t)}).share();let n;const r=t(({down:e})=>{n=e}),s=t.keep.thru(e=>e.status).tillOff(r);return new class extends class{get[A](){return this.read}}{get read(){return s}get down(){return n}dismiss(e){return r.off(e),n}}}};return{bootstrapContext:o,complete(){r.it=1}}}(r),i=1===e.length?e[0]:(u=e,ue.define(class{},{needs:u}));var u;return s.get(gt).request(i),s.get(ot.of(i))(e=>{e.init().then(o)}),s}const wt=new w("attribute-descriptor"),bt=Symbol("attribute");function vt(e){return[bt,e]}function xt(e,t=!0){if(!1===t)return r;if(!0===t||"function"==typeof t){const n=vt(e),r=!0===t?_t:t;return(e,t,s)=>r(e,n,t,s)}return(e,n,r)=>_t(e,t,n,r)}function _t(e,t,n,r){De.of(e).updateState(t,n,r)}const Dt=new d("attribute-registry");class Ot{constructor(e){this._context=e}static get[m](){return Dt}get attrs(){if(this._attrs)return this._attrs;const e=new Map;return this._context.get(wt).forEach(t=>{const{name:n,change:r}=t;e.set(n,Z(e.get(n),r))}),this._attrs=e}define(e){const t=this.attrs,n=Array.from(t.keys());n.length&&(Object.defineProperty(e,"observedAttributes",{configurable:!0,enumerable:!0,value:n}),Object.defineProperty(e.prototype,"attributeChangedCallback",{configurable:!0,enumerable:!0,value:function(e,n,r){t.get(e)(De.of(this).component,r,n)}}))}mount(e){const t=e.element,n=this.attrs,r=Array.from(n.keys());r.length&&new(0,this._context.get(U).MutationObserver)(e=>e.forEach(e=>{const r=e.attributeName;return n.get(r)(De.of(t).component,t.getAttribute(r),e.oldValue)})).observe(t,{attributes:!0,attributeFilter:r,attributeOldValue:!0})}}const kt={setup(e){e.perDefinition({as:Ot}),e.onDefinition(e=>{e.whenReady(({elementType:t})=>e.get(Ot).define(t))}),e.onComponent(e=>{const t=e.mount;t&&e.get(Ot).mount(t)})}};class Ct{static get[re](){return kt}}function St(e){return Se(({type:t,key:n})=>{const r=function(e,t,n){let r,s;if("string"==typeof n)r=n,s=xt(r);else{if(n&&n.name)r=n.name;else{if("string"!=typeof t)throw new TypeError("Attribute name is required as property key is not a string: "+`${e.constructor.name}.prototype.${String(t)}`);r=t}s=xt(r,n&&n.updateState)}return{name:r,change:s}}(t.prototype,n,e),{name:s}=r;return{componentDef:{feature:{needs:Ct},setup(e){e.perDefinition({a:wt,is:r})}},get:e=>De.of(e).element.getAttribute(s),set(e,t){De.of(e).element.setAttribute(s,t)}}})}function Et(e){return ye({feature:{needs:Ct},setup(t){const n=e=>{"string"==typeof e?t.perDefinition({a:wt,is:{name:e,change:xt(e)}}):Object.keys(e).forEach(n=>{t.perDefinition({a:wt,is:{name:n,change:xt(n,e[n])}})})};G(e)?e.forEach(n):n(e)}})}const jt=new d("component-state");class Tt extends q{static get[m](){return jt}}const Pt=Symbol("state-property");function Rt(e){return[Pt,e]}function qt(e,t,n,r){n!==r&&De.of(e).updateState(t,n,r)}const At={setup(e){e.perComponent({a:Tt,by(e){const t=new Tt;return e.whenDestroyed(e=>t.done(e)),t}}),e.perComponent({a:xe,by:e=>e.update,with:[Tt]})}};class $t{static get[re](){return At}}function Mt({updateState:e}={}){return Se(({get:t,set:n,key:r})=>{if(!1!==e){const s=n,o=function(e,t=!0){if(!0===t||"function"==typeof t){const n=Rt(e),r=!0===t?qt:t;return(e,t,s)=>r(e,n,t,s)}return(e,n,r)=>{n!==r&&De.of(e).updateState(t,n,r)}}(r,e);n=(e,n)=>{const r=t(e);s(e,n),o(e,n,r)}}return{componentDef:{feature:{needs:$t}},get:t,set:n}})}function Nt(e,n,r=vt(n)){const{element:s}=e,o=e.get(Tt).track(r),i=C(),u=o.onUpdate.thru((e,n,r)=>t(n,r)).tillOff(i);return new class extends S{get on(){return u}get[E](){return i}get it(){return s.getAttribute(n)}set it(e){i.isOff||(null==e?s.removeAttribute(n):s.setAttribute(n,e))}}}const Bt=new w("dom-property-descriptor"),Vt=new d("dom-property-registry");class Kt{constructor(e){this._context=e}static get[m](){return Vt}get props(){return this._props?this._props:this._props=new Map(this._context.get(Bt).map(({key:e,descriptor:t})=>[e,t]))}define(e){const t=e.prototype;this.props.forEach((e,n)=>{Object.defineProperty(t,n,e)})}mount(e){const t=e.element;this.props.forEach((e,n)=>{Object.defineProperty(t,n,e)})}}const zt={setup(e){e.perDefinition({as:Kt}),e.onDefinition(e=>{e.whenReady(({elementType:t})=>e.get(Kt).define(t))}),e.onComponent(e=>{const t=e.mount;t&&e.get(Kt).mount(t)})}};class Qt{static get[re](){return zt}}const Ft=Symbol("dom-property");function Lt(e){return[Ft,e]}function Ut(e,t,n,r){n!==r&&De.of(e).updateState(t,n,r)}function It(e={}){return Se(t=>{const{key:n,get:r}=t;let{set:s}=t;const o=function(e,{propertyKey:t=e.key,configurable:n=e.configurable,enumerable:r=e.enumerable,writable:s=e.writable}){const o=e.key;return{key:t,descriptor:{configurable:n,enumerable:r,get:function(){return De.of(this).component[o]},set:s?function(e){De.of(this).component[o]=e}:void 0}}}(t,e);if(!1!==e.updateState){const t=function(e,t=!0){if(!0===t||"function"==typeof t){const n=Lt(e),r=!0===t?Ut:t;return(e,t,s)=>r(e,n,t,s)}return(e,n,r)=>{n!==r&&De.of(e).updateState(t,n,r)}}(n,e.updateState),o=s;s=(e,n)=>{const s=r(e);o(e,n),t(e,n,s)}}return{componentDef:{feature:{needs:Qt},setup(e){e.perDefinition({a:Bt,is:o})}},get:r,set:s}})}const Wt={render(e,t,n={}){const{offline:s,path:o=[]}=n,i=e.get(Tt).track(o),u=e.get(H)();let a=0;const c=i.onUpdate(()=>{s||e.connected?f():a=0});function f(){a=1,u(d)}function l(){1===a&&(u(r),a=-1)}function d(){if(!(a<0))for(a=2;;){const e=t();if(e===t||"function"!=typeof e)break;t=e}}s?f():e.whenOn(e=>{e.whenOff(l),a<=0&&f()}).whenOff(e=>{l(),c.off(e)})}};function Ht(e){return Se(({get:t})=>({componentDef:{feature:{needs:$t},define(n){n.whenComponent(n=>{n.whenReady(()=>{const{component:r}=n;Wt.render(n,t(r).bind(r),e)})})}}}))}const Gt=new N("https://wesib.github.io/ns","b","wesib");export{J as A,U as B,ye as C,H as D,Re as E,ae as F,Ht as R,$t as S,Gt as W,re as a,Q as b,W as c,De as d,z as e,I as f,_e as g,qe as h,ee as i,Tt as j,Lt as k,Se as l,Z as m,St as n,ge as o,Mt as p,yt as q,It as r,Rt as s,Et as t,Nt as u};//# sourceMappingURL=wesib.cad21c89.js.map
