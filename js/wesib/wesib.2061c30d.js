import{n as e,m as t,v as n,s,i as r,c as o,t as i,f as a,e as c,d as u,g as h}from"../proc7ts/primitives.e0fbf82a.js";import{n as d,a as l,b as f}from"../proc7ts/call-thru.3702f6af.js";import{b as p,i as m,m as y,c as g,f as w,a as b}from"../proc7ts/a-iterable.1b85914f.js";import{a as _,b as v,C as x,c as C,d as k,F as D,e as T,f as S}from"../proc7ts/context-values.019377b8.js";import{t as O,m as R,a as E,g as P,b as A,l as F,V as j,h as q,i as B,j as N,r as K,s as M,D as V,e as $,u as U,S as L,A as Q,v as z,w as I,E as W}from"../proc7ts/fun-events.b7373782.js";import{n as H,N as Z,i as G,h as J}from"../proc7ts/namespace-aliaser.b34c0889.js";import{i as X,n as Y}from"../proc7ts/render-scheduler.f464fdbf.js";const ee=new _("bootstrap-context");class te extends v{static get[x](){return ee}}function ne(e){return(t,n)=>{const s=t.get(te);return t===s?e(s,n):s.get(n)}}function se(e){return e.nodeType===Node.ELEMENT_NODE}class re{constructor(e){this.symbol=e}own(e){return e.hasOwnProperty(this.symbol)?e[this.symbol]:void 0}of(e){const t=this.own(e),n=h(e),s=n&&this.of(n);return t?s?this.merge([s,t]):t:s}define(e,t){const n=this.own(e),s=y(t,t=>this.meta(t,e)),r=this.merge(n?w([[n],s]):s);return Object.defineProperty(e,this.symbol,{configurable:!0,value:r}),e}}class oe{constructor(){this.promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}resolve(e){this._resolve(e)}reject(e){this._reject(e)}}const ie=Symbol("feature-def");class ae extends re{constructor(){super(ie)}merge(e){return p(e,(e,n)=>({needs:c(u(s(e.needs),n.needs)),has:c(u(s(e.has),n.has)),setup:t(e.setup,n.setup),init:t(e.init,n.init)}),{})}meta(e,t){const n=e[ie];return null==n?e:this.meta("function"==typeof n?e[ie](t):n,t)}}const ce=new ae,ue={[ie]:()=>({})},he={of:e=>ce.of(e)||{},for:(e,t)=>ce.meta(t,e),merge:(...e)=>ce.merge(e),all:(...e)=>p(e,(e,t)=>({[ie]:n=>he.merge(he.for(n,e),he.for(n,t))}),ue),define:(e,...t)=>ce.define(e,t)};function de(...e){return t=>he.define(t,...e)}const le=new _("feature-context");class fe extends te{static get[x](){return le}whenDefined(e){return this.get(te).whenDefined(e)}load(e){return this.get(te).load(e)}}class pe extends Error{constructor(e){super("Circular feature needs: "+e.reduce((e,[t,n,s])=>(e||t.name)+` ${n} ${s.name}`,"")),this.needs=e}}class me{[Q](){return this.read()}}const ye=Symbol("component-def");class ge extends re{constructor(){super(ye)}merge(e){return p(e,(e,n)=>({...e,...n,setup:t(e.setup,n.setup),define:t(e.define,n.define),feature:e.feature?n.feature?he.merge(e.feature,n.feature):e.feature:n.feature}),{})}meta(e,t){const n=e[ye];return null!=n?this.meta("function"==typeof n?e[ye](t):n,t):null!=e[ie]?{feature:he.for(t,e)}:G(e)?{name:e}:e}}const we=new ge,be={[ye]:()=>({})},_e={of:e=>we.of(e)||{},for:(e,t)=>we.meta(t,e),merge:(...e)=>we.merge(e),all:(...e)=>p(e,(e,t)=>({[ye]:n=>_e.merge(_e.for(n,e),_e.for(n,t))}),be),define:(e,...t)=>we.define(e,t)};function ve(...e){const t=t=>_e.define(t,...e);return t[ye]=()=>_e.all(...e),t}const xe=new _("component-context"),Ce=new _("component-event-dispatcher",{byDefault(e){const t=e.get(xe),n=new V(t.element);return B(n).needs(t),{dispatch:e=>n.dispatch(e),on:e=>n.on(e)}}}),ke=new _("content-root",{byDefault:e=>e.get(xe).element});class De extends k{constructor(){super("state-updater"),this.upKey=this.createUpKey(n=>n.insert(n.seed.keepThru((...s)=>{if(s.length){const n=s.reduce((e,n)=>t(n,e),e);return(e,t,s)=>n(z(e),t,s)}return n.hasFallback&&n.or?A(n.or):e})))}grow(t){let n;t.context.get(this.upKey,t.hasFallback?{or:null!=t.or?E(t.or):t.or}:void 0).to(e=>n=e).whenOff(()=>n=e),t.insert((e,t,s)=>n(e,t,s))}}const Te=new De,Se=Symbol("component-context");class Oe extends v{constructor(){super(),this.updateState=(e,t,n)=>{this.get(Te)(e,t,n)}}static get[x](){return xe}static of(e){const t=e[Se];if(!t)throw TypeError("No component context found in "+e);return t}get contentRoot(){return this.get(ke)}on(e){return this.get(Ce).on(e)}dispatchEvent(e){this.get(Ce).dispatch(e)}}class Re extends Event{get context(){return Oe.of(this.target)}}const Ee=Symbol("anonymous-component-property");function Pe(e){const t=({get:t,set:n},s=Ee,r)=>ve({[ye](o){const i=e({type:o,key:s,readable:!0,writable:r,enumerable:!1,configurable:!1,get:e=>t(e,s),set:(e,t)=>n(e,t,s)});return i&&i.componentDef||{}}}),s=(e,n)=>t({get:(t,n)=>e(t,n)},n,!1),r=(t,n,s)=>function(e,t,n,s){const r=!n,o=s(n?i(n):a(e,t));if(!r||!o)return o;Object.defineProperty(e,t,o)}(t,n,s,s=>{const{get:r,set:o}=s,i=t.constructor,{get:a,set:c,configurable:u,enumerable:h,componentDef:d={}}=e({type:i,key:n,readable:!!s.get,writable:!!s.set,enumerable:!!s.enumerable,configurable:!!s.configurable,get:r?e=>r.call(e):Ae(n),set:o?(e,t)=>o.call(e,t):Fe(n)})||{};_e.define(i,d);const l={...s,configurable:null!=u?u:s.configurable,enumerable:null!=h?h:s.enumerable};return(a||c)&&(l.get=a&&function(){return a(this,n)},l.set=c&&function(e){c(this,e,n)}),l});return r.With=(e,n)=>t(e,n,!0),r.By=s,r.As=(e,t)=>s(n(e),t),r.Bind=(e,n=Ee)=>{const s=Symbol(String(n)+":accessor"),r=t=>{const r=t[s];if(r)return r;const o=e(t,n);return t[s]={get:o.get?o.get.bind(o):Ae(n),set:o.set?o.set.bind(o):Fe(n)}};return t({get:e=>r(e).get(),set:(e,t)=>r(e).set(t)},n,!0)},r}function Ae(e){return()=>{throw new TypeError(`"${String(e)}" is not readable`)}}function Fe(e){return()=>{throw new TypeError(`"${String(e)}" is not writable`)}}const je=new _("bootstrap-context-registry");class qe extends C{constructor(){super(),this.provide({a:qe,is:this}),this.values=this.newValues()}static get[x](){return je}static create(){return new qe}}const Be=new _("component-context-registry",{byDefault:ne(()=>new Ne)});class Ne extends C{static get[x](){return Be}}const Ke=new _("definition-context-registry",{byDefault:ne(e=>new Me(e))});class Me extends C{static get[x](){return Ke}}const Ve=Symbol("post-def-setup");function $e(e){if(e.hasOwnProperty(Ve))return e[Ve];const t=O(),n=new W,s=t.read().thru(e=>e?d(e):l()),r=I(s,n),o=h(e,e=>ye in e);if(o){const e=$e(o);r.to(t=>e.send(t))}const i={on:r,send(e){n.send(e)},setup(e){t.it=e}};return Object.defineProperty(e,Ve,{value:i}),i}const Ue=new _("window",{byDefault:()=>window}),Le=new _("bootstrap-root",{byDefault:e=>e.get(Ue).document.body}),Qe=new _("default-namespace-aliaser");class ze extends k{constructor(){super("default-render-scheduler"),this.upKey=this.createUpKey(e=>e.insert(e.seed.keepThru((...t)=>t.length?Ie(e.context,t[t.length-1]):e.hasFallback&&e.or?A(e.or):Ie(e.context,Y))))}grow(e){let t;e.context.get(this.upKey,e.hasFallback?{or:null!=e.or?E(e.or):e.or}:void 0).to(n=>t=Ie(e.context,n)).whenOff(e=>t=T(e)),e.insert((...e)=>t(...e))}}function Ie(e,t){return(n={})=>t({...n,window:n.window||e.get(Ue)})}const We=new ze;class He extends k{constructor(){super("element-adapter"),this.upKey=this.createUpKey(e=>e.insert(e.seed.keepThru((...t)=>{const n=t.reduce((e,t)=>n=>e(n)||t(n),Ze);return n!==Ze?n:e.hasFallback&&e.or?A(e.or):Ze})))}grow(e){let t;e.context.get(this.upKey,e.hasFallback?{or:null!=e.or?E(e.or):e.or}:void 0).to(e=>t=e).whenOff(e=>t=T(e)),e.insert(e=>t(e))}}function Ze(e){return e[Se]}const Ge=new He,Je=new D("element-observer",{byDefault:ne(e=>{const t=e.get(Ge);class n extends MutationObserver{constructor(e){super(n=>{n.forEach(e=>{m(b(e.removedNodes),e=>{var t;return null===(t=function(e){var t;return null===(t=e[Se])||void 0===t?void 0:t.mount}(e))||void 0===t?void 0:t.checkConnected()}),m(g(b(e.addedNodes),se),e=>{var n,s;return null===(s=null===(n=t(e))||void 0===n?void 0:n.mount)||void 0===s?void 0:s.checkConnected()})}),e(n,this)})}observe(e,t){super.observe(e,{...t,childList:!0})}}return e=>new n(e)})});const Xe=Symbol("definition-context");function Ye(e){if(!e.hasOwnProperty(Xe))throw new TypeError("Component is not defined: "+e);return e[Xe]}const et=new _("custom-elements",{byDefault:ne((function(e){const t=e.get(Ue).customElements,n=e.get(Qe);return new class extends tt{define(e,s){if(G(e))return void t.define(J.name(e,n),s);const r=Ye(e),{name:o,extend:i}=r.elementDef;o?i&&i.name?t.define(J.name(o,n),s,{extends:i.name}):t.define(J.name(o,n),s):st(e).resolve(void 0)}whenDefined(e){if(G(e))return t.whenDefined(J.name(e,n));const s=Ye(e),{name:r}=s.elementDef;return r?t.whenDefined(J.name(r,n)):st(e).promise}}}))});class tt{static get[x](){return et}}const nt=Symbol("component-resolver");function st(e){return e.hasOwnProperty(nt)?e[nt]:e[nt]=new oe}const rt=new _("definition-context"),ot=new _("element-def",{byDefault(e){const t=e.get(rt).componentType,{name:n,extend:s}=_e.of(t),r={get type(){return s&&s.type||e.get(Ue).HTMLElement},get name(){return s&&s.name}};return{get name(){return n},get extend(){return r}}}});class it extends v{static get[x](){return rt}get elementDef(){return this.get(ot)}connectTo(e){const t=this.mountTo(e);return t.connect(),t}}class at extends Oe{constructor(e,t){super(),this._definitionContext=e,this.element=t,this._status=O(0);const n=e._newComponentRegistry();n.provide({a:Oe,is:this}),this.get=n.newValues().get}get componentType(){return this._definitionContext.componentType}get component(){return this._component()}get settled(){return this._status.it>=3&&!B(this).isOff}get connected(){return this._status.it>=4&&!B(this).isOff}get[N](){return B(this._status)}_component(){throw new TypeError("Component is not constructed yet. Consider to use a `whenReady()` callback")}whenReady(e){return(this.whenReady=this._status.read().thru_(e=>e?d(this):l()).once().F)(e)}settle(){2===this._status.it&&(this._status.it=3)}whenSettled(e){return(this.whenSettled=this._status.read().thru_(e=>e>=3?f(this):l()).once().F)(e)}whenConnected(e){return(this.whenConnected=this._status.read().thru_(e=>e>=4?f(this):l()).once().F)(e)}destroy(e){try{this._status.done(e)}finally{delete this.component[Se],delete this.element[Se],this._component=ct,function(e){const{parentNode:t}=e;t&&t.removeChild(e)}(this.element)}}_createComponent(){const e=this._definitionContext._whenComponent;let t=0;this.element[Se]=this,e.readNotifier.once(e=>t=e(this,t)),this.whenConnected(()=>{e.readNotifier.to({supply:q().needs(this),receive:(e,n)=>{t=n(this,t)}})}),this._definitionContext._elementBuilder.components.send(this);const s=function(e){const t=e.componentType,n=t.prototype,s=n[Se];n[Se]=e;try{const r=new t(e);return r[Se]=e,r}finally{n[Se]=s}}(this);return this._component=n(s),this._status.it=1,this}_connect(){this._status.it=4}_created(){this._status.it<2&&(this._status.it=2),this.whenConnected(()=>this.dispatchEvent(new Re("wesib:component",{bubbles:!0})))}}function ct(){throw new TypeError("Component destroyed already")}class ut extends class{get component(){return this.context.component}get element(){return this.context.element}}{constructor(e){super(),this.context=e}get connected(){return this.context.connected}connect(){this.context._connect()}checkConnected(){const e=this.context.element,t=e.ownerDocument,n=null!=t&&t.contains(e);return n!==this.connected&&(n?this.connect():this.context.destroy()),n}}class ht extends at{constructor(e,t){super(e,t),this.mount=this.mount=new ut(this)}}class dt extends at{get mount(){}}class lt{constructor(){const e=O(0),t=new W;this.onCreated=$(n=>{const s=e.it+1;t.on({supply:n.supply,receive:(e,t,r)=>{r<s&&n.receive({onRecurrent(t){e.onRecurrent(e=>t(e))}},t)}}),++e.it}),this.readNotifier=e.read().keepThru_(e=>(n,s)=>(t.send(n,s),e))}}class ft extends it{constructor(e,t,n){var s,r;super(),this._bsContext=e,this._elementBuilder=t,this.componentType=n,this._whenComponent=new lt,this._ready=O(!1),this._whenReady=this._ready.read().thru(e=>e?d():l()),this._def=_e.of(n);const o=new Me(e.get(Me).seedIn(this));o.provide({a:it,is:this}),this.get=o.newValues().get,this._perTypeRegistry=new Ne(o.seedIn(this));const i=this.whenReady().F,a=this.whenComponent().F,c={get componentType(){return n},get whenReady(){return i},get whenComponent(){return a},perDefinition:e=>o.provide(e),perComponent:e=>this._perTypeRegistry.provide(e)};null===(r=(s=this._def).setup)||void 0===r||r.call(s,c),$e(n).setup(c)}get elementType(){return this._elementType()}whenReady(e){return(this.whenReady=this._whenReady.thru_(n(this)).once().F)(e)}mountTo(e){if(e[Se])throw new Error(`Element ${String(e)} already bound to component`);const t=new ht(this,e);t._createComponent();const{mount:n}=t;return n.checkConnected(),t._created(),t.settle(),n}whenComponent(e){return(this.whenComponent=this._whenComponent.onCreated.F)(e)}perComponent(e){return this._perTypeRegistry.provide(e)}_newComponentRegistry(){return this._bsContext.get(Ne).append(this._perTypeRegistry)}_elementType(){throw new Error("Custom element class is not constructed yet. Consider to use a `whenReady()` callback")}_define(){var e,t;null===(t=(e=this._def).define)||void 0===t||t.call(e,this),this._elementBuilder.definitions.send(this),this._elementType=n(function(e){const t=e.get(ot);class n extends t.extend.type{constructor(){super();const t=new dt(e,this);t._createComponent(),t._created()}connectedCallback(){var e;null===(e=super.connectedCallback)||void 0===e||e.call(this),this[Se]._connect()}disconnectedCallback(){var e;this[Se].destroy(),null===(e=super.disconnectedCallback)||void 0===e||e.call(this)}}return n}(this)),this.componentType[Xe]=this,this._ready.it=!0}}const pt=new _("element-builder",{byDefault:ne((function(e){return{definitions:new W,components:new W,buildElement(t){const n=new ft(e,this,t);return n._define(),n}}}))});const mt=n(e);class yt{constructor(e){this._context=e,this._definitionQueue=[],e.whenReady(()=>{this._definitionQueue.forEach(e=>e()),delete this._definitionQueue})}get customElements(){return this._context.get(tt)}define(e){this._definitionQueue.push(()=>{const t=this._context.get(pt).buildElement(e);this.customElements.define(e,t.elementType)})}}class gt extends fe{constructor(e,t){super(),this._bsContext=e,this._loader=t,this._unloader=function(){const e=[];let t=t=>{const n=t();return e.push(n),n};return{supply:q(()=>{t=mt,m(b(e).reverse(),e=>e()),e.length=0}),add:e=>t(e)}}();const n=new C(e);n.provide({a:fe,is:this}),this.get=n.newValues().get,this._componentRegistry=new yt(this)}get feature(){return this._loader.request.feature}whenReady(e){return(this.whenReady=P({st:this._loader.state,bs:O().by(this._bsContext.whenReady())}).thru(({st:[e],bs:[t]})=>t&&e?f(this):l()).once().F)(e)}onDefinition(e){return(this.onDefinition=this._bsContext.get(pt).definitions.on().tillOff(this._unloader.supply).F)(e)}onComponent(e){return(this.onComponent=this._bsContext.get(pt).components.on().tillOff(this._unloader.supply).F)(e)}provide(e){return this._unloader.add(()=>this._bsContext.get(qe).provide(e))}perDefinition(e){return this._unloader.add(()=>this._bsContext.get(Me).provide(e))}perComponent(e){return this._unloader.add(()=>this._bsContext.get(Ne).provide(e))}setupDefinition(e){return function(e,t){const{on:n}=$e(e);return $(e=>{n.to({supply:e.supply.needs(t.supply),receive(n,s){const r=s.whenReady().tillOff(t.supply).F,o=s.whenComponent().tillOff(t.supply).F;e.receive(n,{get componentType(){return s.componentType},get whenReady(){return r},get whenComponent(){return o},perDefinition:e=>t.add(()=>s.perDefinition(e)),perComponent:e=>t.add(()=>s.perComponent(e))})}})})}(e,this._unloader)}define(e){this._componentRegistry.define(e)}}const wt=Symbol("feature-key");class bt extends k{static of(e){return e.hasOwnProperty(wt)?e[wt]:e[wt]=new bt(e)}get upKey(){return this}constructor(e){super("feature:"+e.name)}grow(e){var t,n;e.insert((t=e.context.get(te),n=e.seed.keepThru(_t),R(e=>{let s,r=E(),o=Promise.resolve("idle");return P({clause:n,deps:vt(t,n)}).keepThru_(({clause:[e],deps:n})=>{if(!e)return d();const[i,,a]=e;if(i.feature===s)return A(r);if(s=i.feature,a!==s)return A(r=t.get(bt.of(s)).keepThru_(e=>(e.to(o),o=e.stage,e)));const c=new Ct(t,i,n).to(o),u=E(c);return A(r=R(e=>u.to(e).whenOff(()=>{o=c.unload()})).share())}).to(e)}).keepThru(function(){let e=null;return t=>e===t?l():(e=t,t?d(t):d())}())))}}function _t(...e){let t,n=!1;for(const s of e)switch(s[1]){case"is":n=!0,t||(t=s);break;case"has":t=s;break;case"needs":n=!0}return n?t:void 0}function vt(e,t){return t.keepThru_(t=>{if(!t)return d();const[{def:n}]=t,r=s(n.needs);return r.size?A(F(...y(r,t=>e.get(bt.of(t)))).keepThru_(xt)):d()})}function xt(...e){return d(...g(y(e,e=>e[0]),r))}class Ct{constructor(e,t,n){this.bsContext=e,this.request=t,this.deps=n,this.state=O(!1),this.down=new Promise(e=>this._down=e),this._stage=Promise.resolve(new Dt(this))}get stage(){return this._stage.then(e=>e.after)}get ready(){return this.state.it}to(e){const t=this._stage;return this._stage=e.then(e=>t.then(t=>t[e]())),this}async setup(){await(this._stage=this._stage.then(e=>e.setup()))}async init(){await(this._stage=this._stage.then(e=>e.init()))}async unload(){const e=this._stage;delete this._stage;const t=await e,n=await t.stop();return this._down(),n}}class kt{constructor(e,t=(()=>Promise.resolve())){this.loader=e,this._stop=t}idle(){return Promise.resolve(this)}stop(){return this._stop().then(()=>this.after)}perDep(e){const{deps:t}=this.loader;return Promise.all(t.map(t=>e(t)))}}class Dt extends kt{get after(){return"idle"}async setup(){var e;await this.perDep(e=>e.setup());const{bsContext:t,request:{def:n}}=this.loader,s=new gt(t,this.loader),r=s._unloader.supply;return null===(e=n.setup)||void 0===e||e.call(n,s),new Tt(this.loader,s,()=>Promise.resolve(r.off()))}init(){return this.setup().then(e=>e.init())}}class Tt extends kt{constructor(e,t,n){super(e,n),this._context=t}get after(){return"setup"}setup(){return Promise.resolve(this)}async init(){var e;await this.perDep(e=>e.init());const{request:{def:t}}=this.loader;return null===(e=t.init)||void 0===e||e.call(t,this._context),new St(this)}}class St extends kt{get after(){return"init"}constructor(e){super(e.loader,()=>e.stop()),e.loader.state.it=!0}setup(){return Promise.resolve(this)}init(){return Promise.resolve(this)}}class Ot{constructor(e,t,n){this._requester=e,this.feature=t,this._revoke=n,this._uses=0,this.def=function(e){let t=he.of(e);if(ye in e){t=he.merge(t,{init(t){t.define(e)}});const{feature:n}=_e.of(e);n&&(t=he.merge(t,n))}return t}(t)}request(e){const t=this._requester,{registry:n}=t,r=[this,"is",this.feature];this._revokeBy(n.provide({a:bt.of(this.feature),is:r}));for(const r of s(this.def.has)){const s=[this,"has",r];this._revokeBy(n.provide({a:bt.of(r),is:s}));const o=t.request(r,[...e,s]);this._revokeBy(()=>o.unuse())}for(const r of s(this.def.needs)){const s=[this,"needs",r],o=t.request(r,[...e,s]);this._revokeBy(()=>o.unuse()),this._revokeBy(n.provide({a:bt.of(r),is:s}))}return this._uses=1,this}reuse(e){if(!this._uses)throw new pe(e.map(([{feature:e},t,n])=>[e,t,n]));return++this._uses,this}unuse(){--this._uses||this._revoke()}_revokeBy(e){this._revoke=t(e,this._revoke)}}const Rt=new _("feature-requester",{byDefault:ne(e=>new Et(e))});class Et{constructor(e){this._map=new Map,this.registry=e.get(qe)}static get[x](){return Rt}request(e,t=[]){const n=this._map.get(e);if(n)return n.reuse(t);const s=new Ot(this,e,()=>this._map.delete(e));return this._map.set(e,s),s.request(t)}}const Pt=Symbol("when-defined");function At(...e){const t=qe.create(),{bootstrapContext:n,complete:s}=function(e){const t=O(0),n=e.values;class s extends te{constructor(){super(),this.get=n.get,e.provide({a:Qe,by:H}),e.provide({a:te,is:this})}whenDefined(e){return function(e,t){if(t.hasOwnProperty(Pt))return t[Pt];const n=U(Promise.resolve(e.whenReady()).then(()=>e.get(tt).whenDefined(t)).then(()=>Ye(t)));return t[Pt]=n}(this,e)}whenReady(e){return(this.whenReady=t.read().thru(e=>e?d(this):l()).once().F)(e)}load(e){const t=R(t=>{const n=r.get(Et).request(e),s=O({status:{feature:e,ready:!1}});this.get(bt.of(e)).to({supply:t.supply,receive(e,t){const n=t;s.it={status:{feature:n.request.feature,ready:n.ready},down:n.down},n.ready||n.init().then(()=>{s.it={status:{feature:n.request.feature,ready:!0},down:n.down}}).catch(console.error)}}).whenOff(()=>{n.unuse()}),s.read(t)}).share();let n;const s=t.to(({down:e})=>{n=e});class o extends me{get down(){return n}read(e){return(this.read=t.tillOff(s).keepThru(e=>e.status).F)(e)}dismiss(e){return s.off(e),n}}return new o}}const r=new s;return{bootstrapContext:r,complete(){t.it=1}}}(t),r=1===e.length?e[0]:(o=e,he.define(class{},{needs:o}));var o;return n.get(Et).request(r),n.get(bt.of(r)).to(e=>{e.init().then(s).catch(console.error)}),n}const Ft=Symbol("attribute");function jt(e){return[Ft,e]}function qt(t,n=!0){if(!1===n)return e;if(!0===n||"function"==typeof n){const e=jt(t),s=!0===n?Bt:n;return(t,n,r)=>s(t,e,n,r)}return(e,t,s)=>Bt(e,n,t,s)}function Bt(e,t,n,s){Oe.of(e).updateState(t,n,s)}function Nt(e){let t;for(let n=0;n<e.length;++n){const s=e[n];s<="Z"&&s>="A"?(t||(t=e.substring(0,n)),t+="-"+s.toLowerCase()):t&&(t+=s)}return t||e}function Kt(e,t,n){let s,r;if("string"==typeof n)s=Nt(n),r=qt(s);else{if(n&&n.name)s=Nt(n.name);else{if("string"!=typeof t)throw new TypeError(`Attribute name is required as property key is not a string: ${e.constructor.name}.prototype.${String(t)}`);s=Nt(t)}r=qt(s,n&&n.updateState)}return{name:s,change:r}}const Mt=new _("attribute-registry",{byDefault:e=>new Vt(e.get(it))});class Vt{constructor(e){this._context=e,this.attrs=new Map,e.whenReady(({elementType:e})=>this.define(e)),e.whenComponent(({mount:e})=>{e&&this.mount(e)})}declareAttribute({name:e,change:n}){this.attrs.set(e,t(this.attrs.get(e),n))}define(e){const{attrs:t}=this;t.size&&(Object.defineProperty(e,"observedAttributes",{configurable:!0,enumerable:!0,value:$t(e,t.keys())}),Object.defineProperty(e.prototype,"attributeChangedCallback",{configurable:!0,enumerable:!0,value:Ut(e,t)}))}mount(e){const{element:t}=e,{attrs:n}=this,s=Array.from(n.keys());if(!s.length)return;new(0,this._context.get(Ue).MutationObserver)(e=>e.forEach(e=>{const s=e.attributeName;return n.get(s)(Oe.of(t).component,t.getAttribute(s),e.oldValue)})).observe(t,{attributes:!0,attributeFilter:s,attributeOldValue:!0})}}function $t(e,t){const n=e.observedAttributes;if(Array.isArray(n)){const e=new Set(n);m(t,t=>e.add(t)),t=e}return Array.from(t)}function Ut(e,t){const n=e.prototype.attributeChangedCallback;return n?function(e,s,r){const o=t.get(e);o?o(Oe.of(this).component,r,s):n.call(this,e,s,r)}:function(e,n,s){t.get(e)(Oe.of(this).component,s,n)}}function Lt(e){return Pe(({type:t,key:n})=>{const s=Kt(t.prototype,n,e),{name:r}=s;return{componentDef:{define(e){e.get(Mt).declareAttribute(s)}},get:e=>Oe.of(e).element.getAttribute(r),set(e,t){const{element:n}=Oe.of(e);null!=t?n.setAttribute(r,t):n.removeAttribute(r)}}})}function Qt(e){return Pe(({type:t,get:n,key:s})=>{const{name:r,change:o}=Kt(t.prototype,s,e);return{componentDef:{define(e){e.get(Mt).declareAttribute({name:r,change(e,t,s){n(e).call(e,t,s),o(e,t,s)}})}}}})}function zt(...e){return ve({define(t){const n=t.get(Mt);for(const t of e)if("string"==typeof t){const e=Nt(t);n.declareAttribute({name:e,change:qt(e)})}else for(const[e,s]of Object.entries(t)){const t=Nt(e);n.declareAttribute({name:t,change:qt(t,s)})}}})}class It extends S{constructor(){super("component-state")}grow(e){const t=e.seed();let n;if(null!=t)n=t,e.insert(n);else{if(e.hasFallback)return;n=new Ht,B(e.context.get(Oe)).whenOff(e=>n.done(e)),e.insert(n)}e.setup(({registry:e})=>{e.provide({a:Te,is:n.update})})}}const Wt=new It;class Ht extends L{static get[x](){return Wt}}const Zt=Symbol("state-property");function Gt(e){return[Zt,e]}function Jt(e,t,n,s){n!==s&&Oe.of(e).updateState(t,n,s)}function Xt({updateState:e}={}){return Pe(({get:t,set:n,key:s})=>{if(!1!==e){const r=n,o=function(e,t=!0){if(!0===t||"function"==typeof t){const n=Gt(e),s=!0===t?Jt:t;return(e,t,r)=>s(e,n,t,r)}return(e,n,s)=>{n!==s&&Oe.of(e).updateState(t,n,s)}}(s,e);n=(e,n)=>{const s=t(e);r(e,n),o(e,n,s)}}return{get:t,set:n}})}var Yt;class en extends j{constructor(e,t,n){super(),this._context=e,this._name=t,this._path=n,this[Yt]=q()}get it(){return this._context.element.getAttribute(this._name)}set it(e){B(this).isOff||(null==e?this._context.element.removeAttribute(this._name):this._context.element.setAttribute(this._name,e))}on(e){return(this.on=this._context.get(Ht).track(this._path).onUpdate().thru((e,t,n)=>d(t,n)).tillOff(this).F)(e)}}function tn(e,t,n=jt(t)){return new en(e,t,n)}Yt=N;const nn=new _("dom-property-registry",{byDefault:e=>new sn(e.get(it))});class sn{constructor(e){this.props=new Map,e.whenReady(({elementType:e})=>this.define(e)),e.whenComponent(({mount:e})=>{e&&this.mount(e)})}declareDomProperty({key:e,descriptor:t}){this.props.set(e,t)}define(e){const t=e.prototype;this.props.forEach((e,n)=>{Object.defineProperty(t,n,e)})}mount({element:e}){this.props.forEach((t,n)=>{Object.defineProperty(e,n,t)})}}const rn=Symbol("dom-property");function on(e){return[rn,e]}function an(e,t,n,s){n!==s&&Oe.of(e).updateState(t,n,s)}function cn(e={}){return Pe(t=>{const{key:n,get:s}=t;let{set:r}=t;const o=function(e,{propertyKey:t=e.key,configurable:n=e.configurable,enumerable:s=e.enumerable,writable:r=e.writable}){const o=e.key;return{key:t,descriptor:{configurable:n,enumerable:s,get:function(){return Oe.of(this).component[o]},set:r?function(e){Oe.of(this).component[o]=e}:void 0}}}(t,e);if(!1!==e.updateState){const t=function(e,t=!0){if(!0===t||"function"==typeof t){const n=on(e),s=!0===t?an:t;return(e,t,r)=>s(e,n,t,r)}return(e,n,s)=>{n!==s&&Oe.of(e).updateState(t,n,s)}}(n,e.updateState),o=r;r=(e,n)=>{const r=s(e);o(e,n),t(e,n,r)}}return{componentDef:{define(e){e.get(nn).declareDomProperty(o)}},get:s,set:r}})}const un=Symbol("render"),hn={spec:(e,t)=>o(t,e),fulfill(e,t={}){const{on:n=t.on,error:s}=e;return{on:n,error:s?s.bind(e):t.error&&t.error.bind(t)}},trigger(e,t={}){const{on:n=[]}=t;if("object"==typeof n&&K(n))return M(n).tillOff(e);const s=e.get(Ht).track(n).onUpdate().tillOff(e);return Array.isArray(n)&&!n.length?s.thru_(e=>e[0]===un?l:d()):s}};class dn{constructor(e){this._context=e,this._renders=new Set}renderBy(t,n={}){const s=hn.spec(this._context,n),r=hn.trigger(this._context,s),o=this._context.get(We)({...hn.fulfill(s),node:this._context.element}),i="connected"===s.when;let a=1;const c=i?()=>this._context.connected&&d():()=>this._context.settled&&d(),u=r.to(c).needs(this._context).whenOff((function(){2===a&&o(e);a=-1}));(i?this._context.whenConnected():this._context.whenSettled()).to(()=>a&&d());const h=X();return this._renders.add(l),u.whenOff(()=>this._renders.delete(l));function d(){a=2,o(f)}function l(){h(f)}function f(e){if(a>0)for(a=0;;){const n=t(e);if(n===t||"function"!=typeof n)break;t=n}}}renderNow(){this._renders.forEach(e=>e())}}const ln=new _("element-render-ctl",{byDefault:e=>new dn(e.get(Oe))});const fn=new _("element-render-scheduler",{byDefault:function(t){const n=t.get(ln);return(t={})=>{const s=O(e);return n.renderBy(e=>{s.it(e)},hn.fulfill({on:s.on()},t)),e=>{s.it=t=>e(t)}}}});function pn(e){return Pe(({get:t})=>({componentDef:{define(n){n.whenComponent(n=>{n.whenReady(()=>{const{component:s}=n,r=t(s).bind(s);n.get(ln).renderBy(r,e)})})}}}))}const mn=new _("shadow-content-root");class yn extends Event{get shadowRoot(){return this.target.shadowRoot}}const gn=new D("shadow-root-builder",{byDefault:()=>wn});function wn(e,t){const n=function(e,t){const n=e.shadowRoot;if(n)return n;if("attachShadow"in e)return e.attachShadow(t);return}(e.element,t);return n&&(n[Se]=e,e.whenConnected(()=>e.dispatchEvent(new yn("wesib:shadowAttached",{bubbles:!0})))),n}const bn={mode:"open"};function _n(e=bn){return ve({setup(t){t.perComponent({a:mn,by:t=>t.get(gn)(t,e)}),t.perComponent({a:ke,by:e=>e.get(mn,{or:null})})}})}const vn=new Z("https://wesib.github.io/ns","b","wesib");export{zt as A,Ue as B,ve as C,cn as D,ln as E,de as F,pn as R,Xt as S,vn as W,ne as a,At as b,Lt as c,Pe as d,Oe as e,hn as f,_e as g,un as h,Qt as i,_n as j,on as k,Qe as l,fn as m,te as n,ie as o,Se as p,Ge as q,Le as r,se as s,tn as t,Je as u,Ht as v,Gt as w};//# sourceMappingURL=wesib.2061c30d.js.map
