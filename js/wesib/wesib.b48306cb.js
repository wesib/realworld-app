import{b as e,e as t,g as n,n as r,c as s}from"../lib/call-thru.00f7427a.js";import{c as o,A as i,m as u,d as a,e as c,a as l,f}from"../lib/a-iterable.a3fddd20.js";import{S as d,C as p,a as h,b as m,c as g,M as y,F as w}from"../lib/context-values.956fc686.js";import{t as b,b as v,a as x,e as _,n as D,c as O,o as k,f as C,V as S,E,D as j,g as T,h as P,j as R,S as q,A}from"../lib/fun-events.a21352be.js";import{n as $,i as M,N,h as B}from"../lib/namespace-aliaser.535f16ce.js";import{n as K}from"../lib/render-scheduler.8e498d62.js";const V=new d("bootstrap-context");class z extends p{static get[h](){return V}}function Q(e){return(t,n)=>{const r=t.get(z);return t===r?e(r,n):r.get(n)}}const U=new d("component-factory");class F{static get[h](){return U}connectTo(e){const t=this.mountTo(e);return t.connected=!0,t}}const L=new d("window",{byDefault:()=>window}),I=new d("bootstrap-root",{byDefault:e=>e.get(L).document.body}),W=new d("default-namespace-aliaser");class H extends g{constructor(){super("default-render-scheduler"),this.upKey=this.createUpKey(e=>e.seed.keep.thru((...t)=>{if(t.length)return G(e.context,t[t.length-1]);const n=()=>x(G(e.context,K));return D(e.byDefault(n)||n())}))}grow(e){let t;return e.context.get(this.upKey,"or"in e?{or:null!=e.or?x(e.or):e.or}:void 0)(n=>t=G(e.context,n)),(...e)=>t(...e)}}function G(e,t){return(n={})=>t(Object.assign(Object.assign({},n),{window:n.window||e.get(L)}))}const J=new H;function X(e){return Array.isArray(e)}class Y extends i{constructor(e){super(),this.items=null==e?new Set:X(e)?new Set(e):new Set([e])}get value(){switch(this.items.size){case 0:return;case 1:return this.items[Symbol.iterator]().next().value;default:return[...this.items]}}[Symbol.iterator](){return this.items[Symbol.iterator]()}add(...e){return e.forEach(e=>this.items.add(e)),this}get size(){return this.items.size}merge(e){return null==e?this:X(e)?this.add(...e):this.add(e)}}function Z(e,t=(()=>!0)){const n=Object.getPrototypeOf(e.prototype);if(null==n)return;const r=n.constructor;return t(r)?r:Z(r,t)}function ee(e,t,n,r){const s=!n,o=r(n?function(e){if(function(e){return void 0===e.value&&void 0===e.writable}(e))return e;const t=Symbol("value"),n=e.value,r=Object.assign(Object.assign({},e),{writable:void 0,value:void 0,get(){return t in this?this[t]:n}});return e.writable&&(r.set=function(e){this[t]=e}),delete r.writable,delete r.value,r}(n):function(e,t){const n=Symbol(`${String(t)}:value`),r=e[t];return{configurable:!0,enumerable:!0,get(){return n in this?this[n]:r},set(e){this[n]=e}}}(e,t));if(!s||!o)return o;Object.defineProperty(e,t,o)}function te(e,t,n=((e,t)=>t)){return e?t?function(...r){return n(e.apply(this,r),t.apply(this,r))}:e:t}function ne(e){return e.nodeType===Node.ELEMENT_NODE}class re{constructor(e){this.symbol=e}own(e){return e.hasOwnProperty(this.symbol)?e[this.symbol]:void 0}of(e){const t=this.own(e),n=Z(e),r=n&&this.of(n);return t?r?this.merge([r,t]):t:r}define(e,t){const n=this.own(e),r=u(t,t=>this.meta(t,e)),s=this.merge(n?f([[n],r]):r);return Object.defineProperty(e,this.symbol,{configurable:!0,value:s}),e}}class se{constructor(){this.promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}resolve(e){this._resolve(e)}reject(e){this._reject(e)}}const oe=Symbol("feature-def");class ie extends re{constructor(){super(oe)}merge(e){return o(e,(e,t)=>({needs:new Y(e.needs).merge(t.needs).value,has:new Y(e.has).merge(t.has).value,setup:te(e.setup,t.setup),init:te(e.init,t.init)}),{})}meta(e,t){const n=e[oe];return null==n?e:this.meta("function"==typeof n?e[oe](t):n,t)}}const ue=new ie,ae={[oe]:()=>({})},ce={of:e=>ue.of(e)||{},for:(e,t)=>ue.meta(t,e),merge:(...e)=>ue.merge(e),all:(...e)=>o(e,(e,t)=>({[oe]:n=>ce.merge(ce.for(n,e),ce.for(n,t))}),ae),define:(e,...t)=>ue.define(e,t)};function le(...e){return t=>ce.define(t,...e)}const fe=new d("feature-context");class de extends z{static get[h](){return fe}whenDefined(e){return this.get(z).whenDefined(e)}load(e){return this.get(z).load(e)}}class pe extends Error{constructor(e){super("Circular feature needs: "+e.reduce((e,[t,n,r])=>(e||t.name)+` ${n} ${r.name}`,"")),this.needs=e}}const he=Symbol("component-def");class me extends re{constructor(){super(he)}merge(e){return o(e,(e,t)=>Object.assign(Object.assign(Object.assign({},e),t),{setup:te(e.setup,t.setup),define:te(e.define,t.define),feature:e.feature?t.feature?ce.merge(e.feature,t.feature):e.feature:t.feature}),{})}meta(e,t){const n=e[he];return null!=n?this.meta("function"==typeof n?e[he](t):n,t):null!=e[oe]?{feature:ce.for(t,e)}:M(e)?{name:e}:e}}const ge=new me,ye={[he]:()=>({})},we={of:e=>ge.of(e)||{},for:(e,t)=>ge.meta(t,e),merge:(...e)=>ge.merge(e),all:(...e)=>o(e,(e,t)=>({[he]:n=>we.merge(we.for(n,e),we.for(n,t))}),ye),define:(e,...t)=>ge.define(e,t)};function be(...e){const t=t=>we.define(t,...e);return t[he]=()=>we.all(...e),t}const ve=new d("component-context"),xe=new d("component-event-dispatcher",{byDefault(e){const t=e.get(ve),n=new j(t.element);return T(n).needs(t),{dispatch:e=>n.dispatch(e),on:e=>n.on(e)}}}),_e=new d("content-root",{byDefault:e=>e.get(ve).element}),De=new w("state-updater",{byDefault:e(r)}),Oe=Symbol("component-context");class ke extends p{constructor(){super(...arguments),this.updateState=Ce.bind(this)}static get[h](){return ve}static of(e){const t=e[Oe];if(!t)throw TypeError(`No component context found in ${e}`);return t}get contentRoot(){return this.get(_e)}on(e){return this.get(xe).on(e)}dispatchEvent(e){this.get(xe).dispatch(e)}}function Ce(e,t,n){this.get(De)(e,t,n)}class Se extends Event{get context(){return ke.of(this.target)}}const Ee=Symbol("anonymous-component-property");function je(t){const n=({get:e,set:n},r=Ee,s)=>be({[he](o){const i=t({type:o,key:r,readable:!0,writable:s,enumerable:!1,configurable:!1,get:t=>e(t,r),set:(e,t)=>n(e,t,r)});return i&&i.componentDef||{}}}),r=(e,t)=>n({get:(t,n)=>e(t,n)},t,!1),s=(e,n,r)=>ee(e,n,r,r=>{const{get:s,set:o}=r,i=e.constructor,{get:u,set:a,configurable:c,enumerable:l,componentDef:f={}}=t({type:i,key:n,readable:!!r.get,writable:!!r.set,enumerable:!!r.enumerable,configurable:!!r.configurable,get:s?e=>s.call(e):Te(n),set:o?(e,t)=>o.call(e,t):Pe(n)})||{};we.define(i,f);const d=Object.assign(Object.assign({},r),{configurable:null!=c?c:r.configurable,enumerable:null!=l?l:r.enumerable});return(u||a)&&(d.get=u&&function(){return u(this,n)},d.set=a&&function(e){a(this,e,n)}),d});return s.With=(e,t)=>n(e,t,!0),s.By=r,s.As=(t,n)=>r(e(t),n),s.Bind=(e,t=Ee)=>{const r=Symbol(`${String(t)}:accessor`),s=n=>{const s=n[r];if(s)return s;const o=e(n,t);return n[r]={get:o.get?o.get.bind(o):Te(t),set:o.set?o.set.bind(o):Pe(t)}};return n({get:e=>s(e).get(),set:(e,t)=>s(e).set(t)},t,!0)},s}function Te(e){return()=>{throw new TypeError(`"${String(e)}" is not readable`)}}function Pe(e){return()=>{throw new TypeError(`"${String(e)}" is not writable`)}}class Re extends g{constructor(){super("element-adapter"),this.upKey=this.createUpKey(e=>e.seed.keep.thru((...t)=>{const n=t.reduce((e,t)=>n=>e(n)||t(n),qe),r=()=>x(qe);return n!==qe?n:D(e.byDefault(r)||r())}))}grow(e){let t;return e.context.get(this.upKey,"or"in e?{or:null!=e.or?x(e.or):e.or}:void 0)(e=>t=e),e=>t(e)}}function qe(e){return e[Oe]}const Ae=new Re,$e=new w("element-observer",{byDefault:Q(e=>{const t=e.get(Ae);class n extends MutationObserver{constructor(e){super(n=>{n.forEach(e=>{c(l(e.removedNodes),e=>{var t;return null===(t=function(e){var t;return null===(t=e[Oe])||void 0===t?void 0:t.mount}(e))||void 0===t?void 0:t.checkConnected()}),c(a(l(e.addedNodes),ne),e=>{var n,r;return null===(r=null===(n=t(e))||void 0===n?void 0:n.mount)||void 0===r?void 0:r.checkConnected()})}),e(n,this)})}observe(e,t){super.observe(e,Object.assign(Object.assign({},t),{childList:!0}))}}return e=>new n(e)})});const Me=Symbol("component-factory");function Ne(e){const t=e[Me];if(!t)throw new TypeError(`Component is not defined: ${e}`);return t}const Be=new d("custom-elements",{byDefault:function(e){const t=e.get(L).customElements,n=e.get(W);return new class extends Ke{define(e,r){if(M(e))return void t.define(B.name(e,n),r);const s=Ne(e),{name:o,extend:i}=s.elementDef;o?i&&i.name?t.define(B.name(o,n),r,{extends:i.name}):t.define(B.name(o,n),r):ze(e).resolve(void 0)}whenDefined(e){if(M(e))return t.whenDefined(B.name(e,n));const r=Ne(e),{name:s}=r.elementDef;return s?t.whenDefined(B.name(s,n)):ze(e).promise}}}});class Ke{static get[h](){return Be}}const Ve=Symbol("component-resolver");function ze(e){return e[Ve]||(e[Ve]=new se)}const Qe=new d("definition-context"),Ue=new d("element-def",{byDefault(e){const t=e.get(Qe).componentType,{name:n,extend:r}=we.of(t),s={get type(){return r&&r.type||e.get(L).HTMLElement},get name(){return r&&r.name}};return{get name(){return n},get extend(){return s}}}});class Fe extends p{static get[h](){return Qe}get elementDef(){return this.get(Ue)}}const Le=new d("bootstrap-context-registry");class Ie extends m{constructor(){super(),this.provide({a:Ie,is:this}),this.values=this.newValues()}static get[h](){return Le}static create(){return new Ie}}const We=new d("component-context-registry",{byDefault:Q(()=>new He)});class He extends m{static get[h](){return We}}const Ge=new d("definition-context-registry",{byDefault:Q(e=>new Je(e))});class Je extends m{static get[h](){return Ge}}const Xe=Symbol("post-def-setup");function Ye(e){if(e.hasOwnProperty(Xe))return e[Xe];const r=b(),s=new P,o=r.read.thru(e=>e?t(e):n()),i=R(o,s),u=Z(e,e=>he in e);if(u){const e=Ye(u);i(t=>e.send(t))}const a={on:i,send(e){s.send(e)},setup(e){r.it=e}};return Object.defineProperty(e,Xe,{value:a}),a}class Ze{constructor(){const e=b(0),t=new P;this.onCreated=k(n=>{const r=e.it+1;t.on({supply:n.supply,receive:(e,t,s)=>{s<r&&n.receive({onRecurrent(t){e.onRecurrent(e=>t(e))}},t)}}),++e.it}),this.readNotifier=e.read.keep.thru_(e=>(n,r)=>(t.send(n,r),e))}}const et=new d("element-builder",{byDefault:Q((function(s){const o=s.get(Je),i=s.get(He),u=new P,a=new P;return{definitions:u,components:a,buildElement(s){var a;const l=we.of(s),f=new Ze;let d;const p=b(!1),h=p.read.thru(e=>e?t():n());let m;function g(){return i.append(d)}const y=new class extends F{get componentType(){return m.componentType}get elementType(){return m.elementType}get elementDef(){return m.elementDef}mountTo(e){if(e[Oe])throw new Error(`Element ${e} already bound to component`);const t=c({definitionContext:m,whenComponent:f,registry:g(),element:e,elementSuper:t=>e[t],createMount:t=>new class extends class{get component(){return this.context.component}get element(){return this.context.element}}{get context(){return t}get connected(){return 3===nt(e).it}set connected(t){nt(e).it=t?3:2}checkConnected(){const t=e,n=t.ownerDocument;return this.connected=null!=n&&n.contains(t)}}}).mount;return t.checkConnected(),rt(t.context),t}};m=new class extends Fe{constructor(){var t;super();const n=this;this.whenReady=h.thru_(e(this)).once;const r=new Je(o.seedIn(this));r.provide({a:Fe,is:this}),r.provide({a:F,is:y}),this.get=r.newValues().get,d=new He(r.seedIn(this));const i={get componentType(){return s},get whenReady(){return n.whenReady},get whenComponent(){return n.whenComponent},perDefinition:e=>r.provide(e),perComponent:e=>d.provide(e)};null===(t=l.setup)||void 0===t||t.call(l,i),Ye(s).setup(i)}get componentType(){return s}get whenComponent(){return f.onCreated}get elementType(){throw new Error("Custom element class is not constructed yet. Consider to use a `whenReady()` callback")}perComponent(e){return d.provide(e)}},null===(a=l.define)||void 0===a||a.call(l,m),u.send(m);const w=function(e,t,n){const s=e.get(Ue);class o extends s.extend.type{constructor(){super(),rt(c({definitionContext:e,whenComponent:t,registry:n(),element:this,createMount:r,elementSuper:e=>super[e]}))}connectedCallback(){nt(this).it=3}disconnectedCallback(){nt(this).it=2}}return o}(m,f,g);return Object.defineProperty(m,"elementType",{configurable:!0,enumerable:!0,value:w}),p.it=!0,y}};function c({definitionContext:e,whenComponent:s,registry:o,element:i,createMount:u,elementSuper:c}){const l=b(0),f=b();l.on(r).whenOff(e=>f.it=[e]);const d=f.read.thru(e=>e?t(e[0]):n()).once,p=l.read.thru_(e=>2===e?t():n()),h=l.read.thru_(e=>{if(3!==e)return n();const r=C();return p.once(()=>r.off()),t(r)});let m;const g=o.newValues();const y=new class extends ke{constructor(){super(),this.get=g.get,this.elementSuper=c;const e=l.read.thru(e=>e?t(this):n());this.whenReady=e.once}get componentType(){return e.componentType}get element(){return i}get component(){throw new Error("The component is not constructed yet. Consider to use a `whenReady()` callback")}get mount(){return m||(m=u(this))}get connected(){return 3===l.it}get[E](){return T(l)}get whenOn(){return h}get whenOff(){return p}get whenDestroyed(){return d}destroy(e){l.done(e)}};let w=0;y.whenDestroyed(()=>function(e){const{element:t,mount:n}=e;n&&(n.connected=!1);const r=t.parentElement;r&&r.removeChild(t)}(y)),o.provide({a:ke,is:y}),Object.defineProperty(i,Oe,{value:y}),Object.defineProperty(i,tt,{writable:!0,value:l}),s.readNotifier.once(e=>w=e(y,w)),y.whenOn(e=>{s.readNotifier({supply:e,receive(e,t){w=t(y,w)}})}),a.send(y);const v=function(e,t){const n=e.prototype,r=n[Oe];n[Oe]=t;try{const s=new e(t);return Object.defineProperty(s,Oe,{value:t}),s}finally{n[Oe]=r}}(e.componentType,y);return Object.defineProperty(y,"component",{configurable:!0,enumerable:!0,value:v}),l.it=1,y}}))}),tt=Symbol("component-status");function nt(e){return e[tt]}function rt(e){e.whenOn.once(()=>e.dispatchEvent(new Se("wesib:component",{bubbles:!0})))}const st=e(r);class ot{constructor(e){this._context=e,this._definitionQueue=[],e.whenReady(()=>{this._definitionQueue.forEach(e=>e()),delete this._definitionQueue})}get customElements(){return this._context.get(Ke)}define(e){this._definitionQueue.push(()=>{const t=this._context.get(et).buildElement(e);e[Me]=t,this.customElements.define(e,t.elementType)})}}const it=Symbol("feature-key");class ut extends g{static of(e){return e.hasOwnProperty(it)?e[it]:e[it]=new ut(e)}get upKey(){return this}constructor(e){super(`feature:${e.name}`)}grow(e){return r=e.context.get(z),s=e.seed.keep.thru(at),v(e=>{let n,o=x(),i=Promise.resolve("idle");return _({clause:s,deps:ct(r,s)}).keep.thru_(({clause:[e],deps:s})=>{if(!e)return t();const[u,,a]=e;if(u.feature===n)return D(o);if(n=u.feature,a!==n)return D(o=r.get(ut.of(n)).keep.thru_(e=>(e.to(i),i=e.stage,e)));const c=new ft(r,u,s).to(i),l=x(c);return D(o=v(e=>l(e).whenOff(()=>{i=c.unload()})).share())})(e)}).keep.thru(function(){let e=null;return r=>e===r?n():(e=r,r?t(r):t())}());var r,s}}function at(...e){let t,n=!1;for(const r of e)switch(r[1]){case"is":n=!0,t||(t=r);break;case"has":t=r;break;case"needs":n=!0}return n?t:void 0}function ct(e,n){return n.keep.thru_(n=>{if(!n)return t();const[{def:r}]=n,s=new Y(r.needs);return s.size?D(O(...u(s,t=>e.get(ut.of(t)))).keep.thru_(lt)):t()})}function lt(...e){return t(...a(u(e,e=>e[0]),s))}class ft{constructor(e,t,n){this.bsContext=e,this.request=t,this.deps=n,this.state=b(!1),this.down=new Promise(e=>this._down=e),this._stage=Promise.resolve(new pt(this))}get stage(){return this._stage.then(e=>e.after)}get ready(){return this.state.it}to(e){const t=this._stage;return this._stage=e.then(e=>t.then(t=>t[e]())),this}async setup(){await(this._stage=this._stage.then(e=>e.setup()))}async init(){await(this._stage=this._stage.then(e=>e.init()))}async unload(){const e=this._stage;delete this._stage;const t=await e,n=await t.stop();return this._down(),n}}class dt{constructor(e,t=(()=>Promise.resolve())){this.loader=e,this._stop=t}idle(){return Promise.resolve(this)}stop(){return this._stop().then(()=>this.after)}perDep(e){const{deps:t}=this.loader;return Promise.all(t.map(t=>e(t)))}}class pt extends dt{get after(){return"idle"}async setup(){var e;await this.perDep(e=>e.setup());const{bsContext:r,request:{def:s}}=this.loader,[o,i]=function(e,r){const s=function(){const e=[];let t=t=>{const n=t();return e.push(n),n};return{supply:C(()=>{t=st,c(l(e).reverse(),e=>e()),e.length=0}),add:e=>t(e)}}();let o;const i=e.get(Je),u=e.get(He),a=new m(e),f=e.get(et),d=f.definitions.on.tillOff(s.supply),p=f.components.on.tillOff(s.supply);return[new class extends de{constructor(){super(),this.get=a.newValues().get;const s=_({st:r.state,bs:b().by(e.whenReady)}).thru(({st:[e],bs:[r]})=>r&&e?t(this):n());this.whenReady=s.once,a.provide({a:de,is:this}),o=new ot(this)}get feature(){return r.request.feature}get onDefinition(){return d}get onComponent(){return p}provide(t){return s.add(()=>e.get(Ie).provide(t))}perDefinition(e){return s.add(()=>i.provide(e))}perComponent(e){return s.add(()=>u.provide(e))}setupDefinition(e){return function(e,t){const{on:n}=Ye(e);return k(e=>{n({supply:e.supply.needs(t.supply),receive(n,r){const s=r.whenReady.tillOff(t.supply),o=r.whenComponent.tillOff(t.supply);e.receive(n,{get componentType(){return r.componentType},get whenReady(){return s},get whenComponent(){return o},perDefinition:e=>t.add(()=>r.perDefinition(e)),perComponent:e=>t.add(()=>r.perComponent(e))})}})})}(e,s)}define(e){o.define(e)}},s.supply]}(r,this.loader);return null===(e=s.setup)||void 0===e||e.call(s,o),new ht(this.loader,o,()=>Promise.resolve(i.off()))}init(){return this.setup().then(e=>e.init())}}class ht extends dt{constructor(e,t,n){super(e,n),this._context=t}get after(){return"setup"}setup(){return Promise.resolve(this)}async init(){var e;await this.perDep(e=>e.init());const{request:{def:t}}=this.loader;return null===(e=t.init)||void 0===e||e.call(t,this._context),new mt(this)}}class mt extends dt{get after(){return"init"}constructor(e){super(e.loader,()=>e.stop()),e.loader.state.it=!0}setup(){return Promise.resolve(this)}init(){return Promise.resolve(this)}}class gt{constructor(e,t,n){this._requester=e,this.feature=t,this._revoke=n,this._uses=0,this.def=function(e){let t=ce.of(e);if(he in e){t=ce.merge(t,{init(t){t.define(e)}});const{feature:n}=we.of(e);n&&(t=ce.merge(t,n))}return t}(t)}request(e){const t=this._requester,{registry:n}=t,r=[this,"is",this.feature];return this._revokeBy(n.provide({a:ut.of(this.feature),is:r})),new Y(this.def.has).forEach(r=>{const s=[this,"has",r];this._revokeBy(n.provide({a:ut.of(r),is:s}));const o=t.request(r,[...e,s]);this._revokeBy(()=>o.unuse())}),new Y(this.def.needs).forEach(r=>{const s=[this,"needs",r],o=t.request(r,[...e,s]);this._revokeBy(()=>o.unuse()),this._revokeBy(n.provide({a:ut.of(r),is:s}))}),this._uses=1,this}reuse(e){if(!this._uses)throw new pe(e.map(([{feature:e},t,n])=>[e,t,n]));return++this._uses,this}unuse(){--this._uses||this._revoke()}_revokeBy(e){this._revoke=te(e,this._revoke)}}const yt=new d("feature-requester",{byDefault:Q(e=>new wt(e))});class wt{constructor(e){this._map=new Map,this.registry=e.get(Ie)}static get[h](){return yt}request(e,t=[]){const n=this._map.get(e);if(n)return n.reuse(t);const r=new gt(this,e,()=>this._map.delete(e));return this._map.set(e,r),r.request(t)}}function bt(...e){const r=Ie.create(),{bootstrapContext:s,complete:o}=function(e){const r=b(0),s=e.values;const o=new class extends z{constructor(){super(),this.get=s.get;const o=r.read.thru(e=>e?t(this):n());this.whenReady=o.once,e.provide({a:W,by:$}),e.provide({a:z,is:this})}async whenDefined(e){return await new Promise(this.whenReady),await this.get(Ke).whenDefined(e),Ne(e)}load(e){const t=v(t=>{const n=o.get(wt).request(e),r=b({status:{feature:e,ready:!1}});this.get(ut.of(e))({supply:t.supply,receive(e,t){const n=t;r.it={status:{feature:n.request.feature,ready:n.ready},down:n.down},n.ready||n.init().then(()=>{r.it={status:{feature:n.request.feature,ready:!0},down:n.down}})}}).whenOff(()=>{n.unuse()}),r.read(t)}).share();let n;const r=t(({down:e})=>{n=e}),s=t.keep.thru(e=>e.status).tillOff(r);return new class extends class{get[A](){return this.read}}{get read(){return s}get down(){return n}dismiss(e){return r.off(e),n}}}};return{bootstrapContext:o,complete(){r.it=1}}}(r),i=1===e.length?e[0]:(u=e,ce.define(class{},{needs:u}));var u;return s.get(wt).request(i),s.get(ut.of(i))(e=>{e.init().then(o)}),s}const vt=new y("attribute-descriptor"),xt=Symbol("attribute");function _t(e){return[xt,e]}function Dt(e,t=!0){if(!1===t)return r;if(!0===t||"function"==typeof t){const n=_t(e),r=!0===t?Ot:t;return(e,t,s)=>r(e,n,t,s)}return(e,n,r)=>Ot(e,t,n,r)}function Ot(e,t,n,r){ke.of(e).updateState(t,n,r)}const kt=new d("attribute-registry");class Ct{constructor(e){this._context=e}static get[h](){return kt}get attrs(){if(this._attrs)return this._attrs;const e=new Map;return this._context.get(vt).forEach(t=>{const{name:n,change:r}=t;e.set(n,te(e.get(n),r))}),this._attrs=e}define(e){const t=this.attrs,n=Array.from(t.keys());n.length&&(Object.defineProperty(e,"observedAttributes",{configurable:!0,enumerable:!0,value:n}),Object.defineProperty(e.prototype,"attributeChangedCallback",{configurable:!0,enumerable:!0,value:function(e,n,r){t.get(e)(ke.of(this).component,r,n)}}))}mount(e){const t=e.element,n=this.attrs,r=Array.from(n.keys());r.length&&new(0,this._context.get(L).MutationObserver)(e=>e.forEach(e=>{const r=e.attributeName;return n.get(r)(ke.of(t).component,t.getAttribute(r),e.oldValue)})).observe(t,{attributes:!0,attributeFilter:r,attributeOldValue:!0})}}const St={setup(e){e.perDefinition({as:Ct}),e.onDefinition(e=>{e.whenReady(({elementType:t})=>e.get(Ct).define(t))}),e.onComponent(e=>{const t=e.mount;t&&e.get(Ct).mount(t)})}};class Et{static get[oe](){return St}}function jt(e){return je(({type:t,key:n})=>{const r=function(e,t,n){let r,s;if("string"==typeof n)r=n,s=Dt(r);else{if(n&&n.name)r=n.name;else{if("string"!=typeof t)throw new TypeError("Attribute name is required as property key is not a string: "+`${e.constructor.name}.prototype.${String(t)}`);r=t}s=Dt(r,n&&n.updateState)}return{name:r,change:s}}(t.prototype,n,e),{name:s}=r;return{componentDef:{feature:{needs:Et},setup(e){e.perDefinition({a:vt,is:r})}},get:e=>ke.of(e).element.getAttribute(s),set(e,t){ke.of(e).element.setAttribute(s,t)}}})}function Tt(e){return be({feature:{needs:Et},setup(t){const n=e=>{"string"==typeof e?t.perDefinition({a:vt,is:{name:e,change:Dt(e)}}):Object.keys(e).forEach(n=>{t.perDefinition({a:vt,is:{name:n,change:Dt(n,e[n])}})})};X(e)?e.forEach(n):n(e)}})}const Pt=new d("component-state");class Rt extends q{static get[h](){return Pt}}const qt=Symbol("state-property");function At(e){return[qt,e]}function $t(e,t,n,r){n!==r&&ke.of(e).updateState(t,n,r)}const Mt={setup(e){e.perComponent({a:Rt,by(e){const t=new Rt;return e.whenDestroyed(e=>t.done(e)),t}}),e.perComponent({a:De,by:e=>e.update,with:[Rt]})}};class Nt{static get[oe](){return Mt}}function Bt({updateState:e}={}){return je(({get:t,set:n,key:r})=>{if(!1!==e){const s=n,o=function(e,t=!0){if(!0===t||"function"==typeof t){const n=At(e),r=!0===t?$t:t;return(e,t,s)=>r(e,n,t,s)}return(e,n,r)=>{n!==r&&ke.of(e).updateState(t,n,r)}}(r,e);n=(e,n)=>{const r=t(e);s(e,n),o(e,n,r)}}return{componentDef:{feature:{needs:Nt}},get:t,set:n}})}function Kt(e,n,r=_t(n)){const{element:s}=e,o=e.get(Rt).track(r),i=C(),u=o.onUpdate.thru((e,n,r)=>t(n,r)).tillOff(i);return new class extends S{get on(){return u}get[E](){return i}get it(){return s.getAttribute(n)}set it(e){i.isOff||(null==e?s.removeAttribute(n):s.setAttribute(n,e))}}}const Vt=new y("dom-property-descriptor"),zt=new d("dom-property-registry");class Qt{constructor(e){this._context=e}static get[h](){return zt}get props(){return this._props?this._props:this._props=new Map(this._context.get(Vt).map(({key:e,descriptor:t})=>[e,t]))}define(e){const t=e.prototype;this.props.forEach((e,n)=>{Object.defineProperty(t,n,e)})}mount(e){const t=e.element;this.props.forEach((e,n)=>{Object.defineProperty(t,n,e)})}}const Ut={setup(e){e.perDefinition({as:Qt}),e.onDefinition(e=>{e.whenReady(({elementType:t})=>e.get(Qt).define(t))}),e.onComponent(e=>{const t=e.mount;t&&e.get(Qt).mount(t)})}};class Ft{static get[oe](){return Ut}}const Lt=Symbol("dom-property");function It(e){return[Lt,e]}function Wt(e,t,n,r){n!==r&&ke.of(e).updateState(t,n,r)}function Ht(e={}){return je(t=>{const{key:n,get:r}=t;let{set:s}=t;const o=function(e,{propertyKey:t=e.key,configurable:n=e.configurable,enumerable:r=e.enumerable,writable:s=e.writable}){const o=e.key;return{key:t,descriptor:{configurable:n,enumerable:r,get:function(){return ke.of(this).component[o]},set:s?function(e){ke.of(this).component[o]=e}:void 0}}}(t,e);if(!1!==e.updateState){const t=function(e,t=!0){if(!0===t||"function"==typeof t){const n=It(e),r=!0===t?Wt:t;return(e,t,s)=>r(e,n,t,s)}return(e,n,r)=>{n!==r&&ke.of(e).updateState(t,n,r)}}(n,e.updateState),o=s;s=(e,n)=>{const s=r(e);o(e,n),t(e,n,s)}}return{componentDef:{feature:{needs:Ft},setup(e){e.perDefinition({a:Vt,is:o})}},get:r,set:s}})}const Gt={render(e,t,n={}){const{offline:s,path:o=[]}=n,i=e.get(Rt).track(o),u=e.get(J)();let a=0;const c=i.onUpdate(()=>{s||e.connected?l():a=0});function l(){a=1,u(d)}function f(){1===a&&(u(r),a=-1)}function d(e){if(!(a<0))for(a=2;;){const n=t(e);if(n===t||"function"!=typeof n)break;t=n}}s?l():e.whenOn(e=>{e.whenOff(f),a<=0&&l()}).whenOff(e=>{f(),c.off(e)})}};function Jt(e){return je(({get:t})=>({componentDef:{feature:{needs:Nt},define(n){n.whenComponent(n=>{n.whenReady(()=>{const{component:r}=n;Gt.render(n,t(r).bind(r),e)})})}}}))}const Xt=new N("https://wesib.github.io/ns","b","wesib");export{Y as A,L as B,be as C,J as D,Ae as E,le as F,Jt as R,Nt as S,Xt as W,oe as a,Q as b,W as c,ke as d,z as e,I as f,Oe as g,$e as h,ne as i,Rt as j,It as k,je as l,te as m,jt as n,we as o,Bt as p,bt as q,Ht as r,At as s,Tt as t,Kt as u};//# sourceMappingURL=wesib.b48306cb.js.map
