import{n as e,m as t,v as n,e as s,t as r,f as o,g as i,h as c,s as a,i as u,S as d,j as h,a as l,k as f}from"../proc7ts/primitives.e781e476.js";import{i as p,a as m,f as g}from"../proc7ts/push-iterator.f6f3343e.js";import{a as y,b as w,C as b,c as _,d as x,F as v,e as C,g as D}from"../proc7ts/context-values.69c73302.js";import{n as k,N as S,i as E,h as R}from"../frontmeans/namespace-aliaser.e08188c9.js";import{t as O,l as T,z as P,b as A,j,k as q,q as N,K,o as $,B,L as F,I as M,G as V,i as L,m as U,x as Q,p as z,M as W,s as G,S as H,A as I,f as J,N as Z,c as X,V as Y,u as ee,E as te,J as ne,a as se,v as re}from"../proc7ts/fun-events.f7c44dc9.js";import{D as oe}from"../core/auth.e0c9460a.js";import{i as ie,n as ce}from"../frontmeans/render-scheduler.78bb570f.js";const ae=new y("bootstrap-context");class ue extends w{static get[b](){return ae}}function de(e){return(t,n)=>{const s=t.get(ue);return t===s?e(s,n):s.get(n)}}function he(e){return e.nodeType===Node.ELEMENT_NODE}class le{constructor(e){this.symbol=e}own(e){return e.hasOwnProperty(this.symbol)?e[this.symbol]:void 0}of(e){const t=this.own(e),n=h(e),s=n&&this.of(n);return t?s?this.merge([s,t]):t:s}define(e,t){const n=this.own(e),s=t.map((t=>this.meta(t,e))),r=this.merge(n?[n,...s]:s);return Object.defineProperty(e,this.symbol,{configurable:!0,value:r}),e}}const fe=Symbol("feature-def");class pe extends le{constructor(){super(fe)}merge(e){return e.reduce(((e,n)=>({needs:i(c(a(e.needs),n.needs)),has:i(c(a(e.has),n.has)),setup:t(e.setup,n.setup),init:t(e.init,n.init)})),{})}meta(e,t){const n=e[fe];return null==n?e:this.meta("function"==typeof n?e[fe](t):n,t)}}const me=new pe,ge={[fe]:()=>({})},ye={of:e=>me.of(e)||{},for:(e,t)=>me.meta(t,e),merge:(...e)=>me.merge(e),all:(...e)=>e.reduce(((e,t)=>({[fe]:n=>ye.merge(ye.for(n,e),ye.for(n,t))})),ge),define:(e,...t)=>me.define(e,t)};function we(...e){return t=>ye.define(t,...e)}const be=new y("feature-context");class _e extends ue{static get[b](){return be}whenDefined(e){return this.get(ue).whenDefined(e)}load(e){return this.get(ue).load(e)}}class xe extends Error{constructor(e){super("Circular feature needs: "+e.reduce(((e,[t,n,s])=>(e||t.name)+` ${n} ${s.name}`),"")),this.needs=e}}class ve{[I](){return this.read}}const Ce=Symbol("component-def");class De extends le{constructor(){super(Ce)}merge(e){return e.reduce(((e,n)=>({...e,...n,setup:t(e.setup,n.setup),define:t(e.define,n.define),feature:e.feature?n.feature?ye.merge(e.feature,n.feature):e.feature:n.feature})),{})}meta(e,t){const n=e[Ce];return null!=n?this.meta("function"==typeof n?e[Ce](t):n,t):null!=e[fe]?{feature:ye.for(t,e)}:E(e)?{name:e}:e}}const ke=new De,Se={[Ce]:()=>({})},Ee={of:e=>ke.of(e)||{},for:(e,t)=>ke.meta(t,e),merge:(...e)=>ke.merge(e),all:(...e)=>e.reduce(((e,t)=>({[Ce]:n=>Ee.merge(Ee.for(n,e),Ee.for(n,t))})),Se),define:(e,...t)=>ke.define(e,t)};function Re(...e){const t=t=>Ee.define(t,...e);return t[Ce]=()=>Ee.all(...e),t}const Oe=new y("component-context"),Te=new y("component-event-dispatcher",{byDefault(e){const t=e.get(Oe),n=new oe(t.element);return n.supply.needs(t),{dispatch:e=>n.dispatch(e),on:e=>n.on(e)}}}),Pe=new y("content-root",{byDefault:e=>e.get(Oe).element});class Ae extends x{constructor(){super("state-updater"),this.upKey=this.createUpKey((n=>n.insert(n.seed.do(J(((...s)=>{if(s.length){const n=s.reduce(((e,n)=>t(n,e)),e);return A(((e,t,s)=>n(Z(e),t,s)))}return n.hasFallback&&n.or?n.or:A(e)}))))))}grow(t){let n;t.context.get(this.upKey,t.hasFallback?{or:null!=t.or?A(t.or):t.or}:void 0)((e=>n=e)).whenOff((()=>n=e)),t.insert(((e,t,s)=>n(e,t,s)))}}const je=new Ae,qe=Symbol("component-context");class Ne extends w{constructor(){super(),this.updateState=(e,t,n)=>{this.get(je)(e,t,n)}}static get[b](){return Oe}static of(e){const t=e[qe];if(!t)throw TypeError(`No component context found in ${String(e)}`);return t}get contentRoot(){return this.get(Pe)}on(e){return this.get(Te).on(e)}dispatchEvent(e){this.get(Te).dispatch(e)}}class Ke extends Event{get context(){return Ne.of(this.target)}}const $e=Symbol("anonymous-component-property");function Be(e){const t=({get:t,set:n},s=$e,r)=>Re({[Ce](o){const i=e({type:o,key:s,readable:!0,writable:r,enumerable:!1,configurable:!1,get:e=>t(e,s),set:(e,t)=>n(e,t,s)});return i&&i.componentDef||{}}}),s=(e,n)=>t({get:(t,n)=>e(t,n)},n,!1),i=(t,n,s)=>function(e,t,n,s){const i=!n,c=s(n?r(n):o(e,t));if(!i||!c)return c;Object.defineProperty(e,t,c)}(t,n,s,(s=>{const{get:r,set:o}=s,i=t.constructor,{get:c,set:a,configurable:u,enumerable:d,componentDef:h={}}=e({type:i,key:n,readable:!!s.get,writable:!!s.set,enumerable:!!s.enumerable,configurable:!!s.configurable,get:r?e=>r.call(e):Fe(n),set:o?(e,t)=>o.call(e,t):Me(n)})||{};Ee.define(i,h);const l={...s,configurable:null!=u?u:s.configurable,enumerable:null!=d?d:s.enumerable};return(c||a)&&(l.get=c&&function(){return c(this,n)},l.set=a&&function(e){a(this,e,n)}),l}));return i.With=(e,n)=>t(e,n,!0),i.By=s,i.As=(e,t)=>s(n(e),t),i.Bind=(e,n=$e)=>{const s=Symbol(`${String(n)}:accessor`),r=t=>{const r=t[s];if(r)return r;const o=e(t,n);return t[s]={get:o.get?o.get.bind(o):Fe(n),set:o.set?o.set.bind(o):Me(n)}};return t({get:e=>r(e).get(),set:(e,t)=>r(e).set(t)},n,!0)},i}function Fe(e){return()=>{throw new TypeError(`"${String(e)}" is not readable`)}}function Me(e){return()=>{throw new TypeError(`"${String(e)}" is not writable`)}}const Ve=new y("bootstrap-context-registry");class Le extends _{constructor(){super(),this.provide({a:Le,is:this}),this.values=this.newValues()}static get[b](){return Ve}static create(){return new Le}}const Ue=new y("per-component-registry",{byDefault:de((()=>new Qe))});class Qe extends _{}const ze=new y("per-definition-registry",{byDefault:de((e=>new We(e)))});class We extends _{}const Ge=Symbol("post-def-setup");function He(e){if(e.hasOwnProperty(Ge))return e[Ge];const t=O(),n=new te,s=t.read.do(K(l)),r=ne(s,n),o=h(e,(e=>Ce in e));if(o){const e=He(o);r((t=>e.send(t)))}const i={on:r,send(e){n.send(e)},setup(e){t.it=e}};return Object.defineProperty(e,Ge,{value:i}),i}const Ie=new y("window",{byDefault:()=>window}),Je=new y("bootstrap-root",{byDefault:e=>e.get(Ie).document.body}),Ze=new y("default-namespace-aliaser");class Xe extends x{constructor(){super("default-render-scheduler"),this.upKey=this.createUpKey((e=>e.insert(e.seed.do(J(((...t)=>t.length?A(Ye(e.context,t[t.length-1])):e.hasFallback&&e.or?e.or:A(Ye(e.context,ce))))))))}grow(e){let t;e.context.get(this.upKey,e.hasFallback?{or:null!=e.or?A(e.or):e.or}:void 0)((n=>t=Ye(e.context,n))).whenOff((e=>t=C(e))),e.insert(((...e)=>t(...e)))}}function Ye(e,t){return(n={})=>t({...n,window:n.window||e.get(Ie)})}const et=new Xe;class tt extends x{constructor(){super("element-adapter"),this.upKey=this.createUpKey((e=>e.insert(e.seed.do(J(((...t)=>{const n=t.reduce(((e,t)=>n=>e(n)||t(n)),nt);return n!==nt?A(n):e.hasFallback&&e.or?e.or:A(nt)}))))))}grow(e){let t;e.context.get(this.upKey,e.hasFallback?{or:null!=e.or?A(e.or):e.or}:void 0)((e=>t=e)).whenOff((e=>t=C(e))),e.insert((e=>t(e)))}}function nt(e){return e[qe]}const st=new tt,rt=new v("element-observer",{byDefault:de((e=>{const t=e.get(st);class n extends MutationObserver{constructor(e){super((n=>{n.forEach((e=>{p(m(e.removedNodes),(e=>{var t;return null===(t=function(e){var t;return null===(t=e[qe])||void 0===t?void 0:t.mount}(e))||void 0===t?void 0:t.checkConnected()})),p(g(e.addedNodes,he),(e=>{var n,s;return null===(s=null===(n=t(e))||void 0===n?void 0:n.mount)||void 0===s?void 0:s.checkConnected()}))})),e(n,this)}))}observe(e,t){super.observe(e,{...t,childList:!0})}}return e=>new n(e)}))});const ot=Symbol("definition-context");function it(e){if(!e.hasOwnProperty(ot))throw new TypeError(`Component is not defined: ${e}`);return e[ot]}const ct=new y("custom-elements",{byDefault:de((function(e){const t=e.get(Ie).customElements,n=e.get(Ze);return new class extends at{define(e,s){if(E(e))return void t.define(R.name(e,n),s);const r=it(e),{name:o,extend:i}=r.elementDef;o?i&&i.name?t.define(R.name(o,n),s,{extends:i.name}):t.define(R.name(o,n),s):dt(e).resolve(void 0)}whenDefined(e){if(E(e))return t.whenDefined(R.name(e,n));const s=it(e),{name:r}=s.elementDef;return r?t.whenDefined(R.name(r,n)):dt(e).promise()}}}))});class at{static get[b](){return ct}}const ut=Symbol("component-resolver");function dt(e){return e.hasOwnProperty(ut)?e[ut]:e[ut]=f()}const ht=new y("definition-context"),lt=new y("element-def",{byDefault(e){const t=e.get(ht).componentType,{name:n,extend:s}=Ee.of(t),r={get type(){return s&&s.type||e.get(Ie).HTMLElement},get name(){return s&&s.name}};return{get name(){return n},get extend(){return r}}}});class ft extends w{static get[b](){return ht}get elementDef(){return this.get(lt)}connectTo(e){const t=this.mountTo(e);return t.connect(),t}}class pt extends Ne{constructor(e,t){super(),this._definitionContext=e,this.element=t,this._status=O(0),this.whenReady=this._status.read.do(re((e=>!!e&&this)),$),this.whenSettled=this._status.read.do(re((e=>e>=3&&this)),$),this.whenConnected=this._status.read.do(re((e=>e>=4&&this)),$);const n=e._newComponentRegistry();n.provide({a:Ne,is:this}),this.get=n.newValues().get}get componentType(){return this._definitionContext.componentType}get component(){return this._component()}get settled(){return this._status.it>=3&&!this.supply.isOff}get connected(){return this._status.it>=4&&!this.supply.isOff}get supply(){return this._status.supply}_component(){throw new TypeError("Component is not constructed yet. Consider to use a `whenReady()` callback")}settle(){2===this._status.it&&(this._status.it=3)}destroy(e){try{this._status.supply.off(e)}finally{delete this.component[qe],delete this.element[qe],this._component=mt,function(e){const{parentNode:t}=e;t&&t.removeChild(e)}(this.element)}}_createComponent(){const e=this._definitionContext._whenComponent;let t=0;this.element[qe]=this,e.readNotifier.do($)((e=>t=e(this,t))),this.whenConnected((()=>{e.readNotifier({supply:(new d).needs(this),receive:(e,n)=>{t=n(this,t)}})})),this._definitionContext._elementBuilder.components.send(this);const s=function(e){const t=e.componentType,n=t.prototype,s=n[qe];n[qe]=e;try{const r=new t(e);return r[qe]=e,r}finally{n[qe]=s}}(this);return this._component=n(s),this._status.it=1,this}_connect(){this._status.it=4}_created(){this._status.it<2&&(this._status.it=2),this.whenConnected((()=>this.dispatchEvent(new Ke("wesib:component",{bubbles:!0}))))}}function mt(){throw new TypeError("Component destroyed already")}class gt extends class{get component(){return this.context.component}get element(){return this.context.element}}{constructor(e){super(),this.context=e}get connected(){return this.context.connected}connect(){this.context._connect()}checkConnected(){const e=this.context.element,t=e.ownerDocument,n=null!=t&&t.contains(e);return n!==this.connected&&(n?this.connect():this.context.destroy()),n}}class yt extends pt{constructor(e,t){super(e,t),this.mount=this.mount=new gt(this)}}class wt extends pt{get mount(){}}class bt{constructor(){const e=O(0),t=new te;this.onCreated=X((n=>{const s=e.it+1;t.on({supply:n.supply,receive:(e,t,r)=>{r<s&&n.receive({onRecurrent(t){e.onRecurrent((e=>t(e)))}},t)}}),++e.it})),this.readNotifier=e.read.do(U((e=>(n,s)=>(t.send(n,s),e))))}}class _t extends ft{constructor(e,t,s){var r,o;super(),this._bsContext=e,this._elementBuilder=t,this.componentType=s,this._whenComponent=new bt,this._ready=O(!1),this._whenReady=this._ready.read.do(ee(((e,t)=>t&&e()))),this._def=Ee.of(s);const i=new We(e.get(ze).seeds());i.provide({a:ft,is:this}),this.get=i.newValues().get;const c=e.get(Ue).append((e=>this.get(e)));this._perComponentRegistry=new Qe(c.seeds()),this.whenReady=this._whenReady.do(se(n(this)),$);const a={get componentType(){return s},whenReady:this.whenReady,whenComponent:this.whenComponent,perDefinition:e=>i.provide(e),perComponent:e=>this._perComponentRegistry.provide(e)};null===(o=(r=this._def).setup)||void 0===o||o.call(r,a),He(s).setup(a)}get elementType(){return this._elementType()}get whenComponent(){return this._whenComponent.onCreated}mountTo(e){if(e[qe])throw new Error(`Element ${String(e)} already bound to component`);const t=new yt(this,e);t._createComponent();const{mount:n}=t;return n.checkConnected(),t._created(),t.settle(),n}perComponent(e){return this._perComponentRegistry.provide(e)}_newComponentRegistry(){return new Qe(this._perComponentRegistry.seeds())}_elementType(){throw new Error("Custom element class is not constructed yet. Consider to use a `whenReady()` callback")}_define(){var e,t;null===(t=(e=this._def).define)||void 0===t||t.call(e,this),this._elementBuilder.definitions.send(this),this._elementType=n(function(e){const t=e.get(lt);class n extends t.extend.type{constructor(){super();const t=new wt(e,this);t._createComponent(),t._created()}connectedCallback(){var e;null===(e=super.connectedCallback)||void 0===e||e.call(this),this[qe]._connect()}disconnectedCallback(){var e;this[qe].destroy(),null===(e=super.disconnectedCallback)||void 0===e||e.call(this)}}return n}(this)),this.componentType[ot]=this,this._ready.it=!0}}const xt=new y("element-builder",{byDefault:de((function(e){return{definitions:new te,components:new te,buildElement(t){const n=new _t(e,this,t);return n._define(),n}}}))});class vt{constructor(e){this._context=e,this._definitionQueue=[],e.whenReady((()=>{this._definitionQueue.forEach((e=>e())),delete this._definitionQueue}))}get customElements(){return this._context.get(at)}define(e){this._definitionQueue.push((()=>{const t=this._context.get(xt).buildElement(e);this.customElements.define(e,t.elementType)}))}}class Ct extends _e{constructor(e,t){super(),this._bsContext=e,this._loader=t,this.supply=new d;const n=new _(e);n.provide({a:_e,is:this}),this.get=n.newValues().get,this.whenReady=j({st:this._loader.state,bs:O().by(e.whenReady)}).do(K((({st:[e],bs:[t]})=>t&&e&&this)),$),this.onDefinition=e.get(xt).definitions.on.do(V(this)),this.onComponent=this._bsContext.get(xt).components.on.do(V(this)),this._componentRegistry=new vt(this)}get feature(){return this._loader.request.feature}provide(e){return this._bsContext.get(Le).provide(e).needs(this)}perDefinition(e){return this._bsContext.get(ze).provide(e).needs(this)}perComponent(e){return this._bsContext.get(Ue).provide(e).needs(this)}setupDefinition(e){return function(e,t){const{on:n}=He(e);return X((e=>{n({supply:e.supply.needs(t),receive(n,s){const r=s.whenReady.do(V(t)),o=s.whenComponent.do(V(t));e.receive(n,{get componentType(){return s.componentType},get whenReady(){return r},get whenComponent(){return o},perDefinition:e=>s.perDefinition(e).needs(t),perComponent:e=>s.perComponent(e).needs(t)})}})}))}(e,this.supply)}define(e){this._componentRegistry.define(e)}}const Dt=Symbol("feature-key");class kt extends x{static of(e){return e.hasOwnProperty(Dt)?e[Dt]:e[Dt]=new kt(e)}get upKey(){return this}constructor(e){super(`feature:${e.name}`)}grow(e){var t,n;e.insert((t=e.context.get(ue),n=e.seed.do(T(St)),P((e=>{let s,r=A(),o=Promise.resolve("idle");return j({clause:n,deps:Et(t,n)}).do(q((({clause:[e],deps:n})=>{if(!e)return A();const[i,,c]=e;if(i.feature===s)return r;if(s=i.feature,c!==s)return r=t.get(kt.of(s)).do(U((e=>(e&&(e.to(o),o=e.stage),e))));const a=new Ot(t,i,n).to(o),u=A(a);return r=P((e=>u(e).whenOff((()=>{o=a.unload()})))).do(B)})))(e)})).do(N(function(){let e=null;return(t,n)=>{e!==n&&(e=n,n?t(n):t())}}()))))}}function St(...e){let t,n=!1;for(const s of e)switch(s[1]){case"is":n=!0,t||(t=s);break;case"has":t=s;break;case"needs":n=!0}return n?t:void 0}function Et(e,t){return t.do(q((t=>{if(!t)return A();const[{def:n}]=t,s=a(n.needs);return s.size?Q(...[...s].map((t=>e.get(kt.of(t))))).do(z(Rt)):A()})))}function Rt(e,...t){return e(...t.map((([e])=>e)).filter(u))}class Ot{constructor(e,t,n){this.bsContext=e,this.request=t,this.deps=n,this.state=O(!1),this.down=new Promise((e=>this._down=e)),this._stage=Promise.resolve(new Pt(this))}get stage(){return this._stage.then((e=>e.after))}get ready(){return this.state.it}to(e){const t=this._stage;return this._stage=e.then((e=>t.then((t=>t[e]())))),this}async setup(){await(this._stage=this._stage.then((e=>e.setup())))}async init(){await(this._stage=this._stage.then((e=>e.init())))}async unload(){const e=this._stage;delete this._stage;const t=await e,n=await t.stop();return this._down(),n}}class Tt{constructor(e,t=(()=>Promise.resolve())){this.loader=e,this._stop=t}idle(){return Promise.resolve(this)}stop(){return this._stop().then((()=>this.after))}perDep(e){const{deps:t}=this.loader;return Promise.all(t.map((t=>e(t))))}}class Pt extends Tt{get after(){return"idle"}async setup(){var e;await this.perDep((e=>e.setup()));const{bsContext:t,request:{def:n}}=this.loader,s=new Ct(t,this.loader),r=s.supply;return null===(e=n.setup)||void 0===e||e.call(n,s),new At(this.loader,s,(()=>Promise.resolve(r.off())))}init(){return this.setup().then((e=>e.init()))}}class At extends Tt{constructor(e,t,n){super(e,n),this._context=t}get after(){return"setup"}setup(){return Promise.resolve(this)}async init(){var e;await this.perDep((e=>e.init()));const{request:{def:t}}=this.loader;return null===(e=t.init)||void 0===e||e.call(t,this._context),new jt(this)}}class jt extends Tt{get after(){return"init"}constructor(e){super(e.loader,(()=>e.stop())),e.loader.state.it=!0}setup(){return Promise.resolve(this)}init(){return Promise.resolve(this)}}class qt{constructor(e,t){this._requester=e,this.feature=t,this.supply=new d,this._uses=0,this.def=function(e){let t=ye.of(e);if(Ce in e){t=ye.merge(t,{init(t){t.define(e)}});const{feature:n}=Ee.of(e);n&&(t=ye.merge(t,n))}return t}(t)}request(e){const t=this._requester,{registry:n}=t,s=[this,"is",this.feature];n.provide({a:kt.of(this.feature),is:s}).needs(this);for(const s of a(this.def.has)){const r=[this,"has",s];n.provide({a:kt.of(s),is:r}).needs(this);const o=t.request(s,[...e,r]);this.supply.whenOff((()=>o.unuse()))}for(const s of a(this.def.needs)){const r=[this,"needs",s],o=t.request(s,[...e,r]);this.supply.whenOff((()=>o.unuse())),n.provide({a:kt.of(s),is:r}).needs(this)}return this._uses=1,this}reuse(e){if(!this._uses)throw new xe(e.map((([{feature:e},t,n])=>[e,t,n])));return++this._uses,this}unuse(){--this._uses||this.supply.off()}}const Nt=new y("feature-requester",{byDefault:de((e=>new Kt(e)))});class Kt{constructor(e){this._map=new Map,this.registry=e.get(Le)}static get[b](){return Nt}request(e,t=[]){const n=this._map.get(e);if(n)return n.reuse(t);const s=new qt(this,e);return this._map.set(e,s),s.supply.whenOff((()=>this._map.delete(e))),s.request(t)}}const $t=Symbol("when-defined");function Bt(...e){const t=Le.create(),{bootstrapContext:n,complete:s}=function(e){const t=O(0),n=e.values;class s extends ue{constructor(){super(),this.get=n.get,this.whenReady=t.read.do(K((e=>!!e&&this)),$),e.provide({a:Ze,by:k}),e.provide({a:ue,is:this})}whenDefined(e){return function(e,t){if(t.hasOwnProperty($t))return t[$t];const n=W(Promise.resolve(e.whenReady).then((()=>e.get(at).whenDefined(t))).then((()=>it(t))));return t[$t]=n}(this,e)}load(e){const t=P((t=>{const n=r.get(Kt).request(e),s=O({status:{feature:e,ready:!1}});this.get(kt.of(e))({supply:t.supply,receive(e,t){const n=t;s.it={status:{feature:n.request.feature,ready:n.ready},down:n.down},n.ready||n.init().then((()=>{s.it={status:{feature:n.request.feature,ready:!0},down:n.down}})).catch(console.error)}}).whenOff((()=>{n.unuse()})),s.read(t)})).do(B);let n;const s=t((({down:e})=>{n=e}));class o extends ve{constructor(){super(...arguments),this.read=t.do(G(s),T((({status:e})=>e)))}get down(){return n}dismiss(e){return s.off(e),n}}return new o}}const r=new s;return{bootstrapContext:r,complete(){t.it=1}}}(t),r=1===e.length?e[0]:(o=e,ye.define(class{},{needs:o}));var o;return n.get(Kt).request(r),n.get(kt.of(r))((e=>{e.init().then(s).catch(console.error)})),n}const Ft=Symbol("attribute");function Mt(e){return[Ft,e]}function Vt(t,n=!0){if(!1===n)return e;if(!0===n||"function"==typeof n){const e=Mt(t),s=!0===n?Lt:n;return(t,n,r)=>s(t,e,n,r)}return(e,t,s)=>Lt(e,n,t,s)}function Lt(e,t,n,s){Ne.of(e).updateState(t,n,s)}function Ut(e){let t;for(let n=0;n<e.length;++n){const s=e[n];s<="Z"&&s>="A"?(t||(t=e.substring(0,n)),t+="-"+s.toLowerCase()):t&&(t+=s)}return t||e}function Qt(e,t,n){let s,r;if("string"==typeof n)s=Ut(n),r=Vt(s);else{if(n&&n.name)s=Ut(n.name);else{if("string"!=typeof t)throw new TypeError(`Attribute name is required as property key is not a string: ${e.constructor.name}.prototype.${String(t)}`);s=Ut(t)}r=Vt(s,n&&n.updateState)}return{name:s,change:r}}const zt=new y("attribute-registry",{byDefault:e=>new Wt(e.get(ft))});class Wt{constructor(e){this._context=e,this.attrs=new Map,e.whenReady((({elementType:e})=>this.define(e))),e.whenComponent((({mount:e})=>{e&&this.mount(e)}))}declareAttribute({name:e,change:n}){this.attrs.set(e,t(this.attrs.get(e),n))}define(e){const{attrs:t}=this;t.size&&(Object.defineProperty(e,"observedAttributes",{configurable:!0,enumerable:!0,value:Gt(e,[...t.keys()])}),Object.defineProperty(e.prototype,"attributeChangedCallback",{configurable:!0,enumerable:!0,value:Ht(e,t)}))}mount(e){const{element:t}=e,{attrs:n}=this,s=[...n.keys()];if(!s.length)return;new(0,this._context.get(Ie).MutationObserver)((e=>e.forEach((e=>{const s=e.attributeName;return n.get(s)(Ne.of(t).component,t.getAttribute(s),e.oldValue)})))).observe(t,{attributes:!0,attributeFilter:s,attributeOldValue:!0})}}function Gt(e,t){const n=e.observedAttributes;if(Array.isArray(n)){const e=new Set(n);t.forEach((t=>e.add(t))),t=[...e]}return t}function Ht(e,t){const n=e.prototype.attributeChangedCallback;return n?function(e,s,r){const o=t.get(e);o?o(Ne.of(this).component,r,s):n.call(this,e,s,r)}:function(e,n,s){t.get(e)(Ne.of(this).component,s,n)}}function It(e){return Be((({type:t,key:n})=>{const s=Qt(t.prototype,n,e),{name:r}=s;return{componentDef:{define(e){e.get(zt).declareAttribute(s)}},get:e=>Ne.of(e).element.getAttribute(r),set(e,t){const{element:n}=Ne.of(e);null!=t?n.setAttribute(r,t):n.removeAttribute(r)}}}))}function Jt(e){return Be((({type:t,get:n,key:s})=>{const{name:r,change:o}=Qt(t.prototype,s,e);return{componentDef:{define(e){e.get(zt).declareAttribute({name:r,change(e,t,s){n(e).call(e,t,s),o(e,t,s)}})}}}}))}function Zt(...e){return Re({define(t){const n=t.get(zt);for(const t of e)if("string"==typeof t){const e=Ut(t);n.declareAttribute({name:e,change:Vt(e)})}else for(const[e,s]of Object.entries(t)){const t=Ut(e);n.declareAttribute({name:t,change:Vt(t,s)})}}})}class Xt extends D{constructor(){super("component-state")}grow(e){const t=e.seed();let n;if(null!=t)n=t,e.insert(n);else{if(e.hasFallback)return;n=new en,e.context.get(Ne).supply.whenOff((e=>n.done(e))),e.insert(n)}e.setup((({registry:e})=>{e.provide({a:je,is:n.update})}))}}const Yt=new Xt;class en extends H{static get[b](){return Yt}}const tn=Symbol("state-property");function nn(e){return[tn,e]}function sn(e,t,n,s){n!==s&&Ne.of(e).updateState(t,n,s)}function rn({updateState:e}={}){return Be((({get:t,set:n,key:s})=>{if(!1!==e){const r=n,o=function(e,t=!0){if(!0===t||"function"==typeof t){const n=nn(e),s=!0===t?sn:t;return(e,t,r)=>s(e,n,t,r)}return(e,n,s)=>{n!==s&&Ne.of(e).updateState(t,n,s)}}(s,e);n=(e,n)=>{const s=t(e);r(e,n),o(e,n,s)}}return{get:t,set:n}}))}class on extends Y{constructor(e,t,n){super(),this._context=e,this._name=t,this.supply=new d,this.on=this._context.get(en).track(n).onUpdate.do(ee(((e,t,n,s)=>e(n,s))),V(this))}get it(){return this._context.element.getAttribute(this._name)}set it(e){this.supply.isOff||(null==e?this._context.element.removeAttribute(this._name):this._context.element.setAttribute(this._name,e))}}function cn(e,t,n=Mt(t)){return new on(e,t,n)}const an=new y("dom-property-registry",{byDefault:e=>new un(e.get(ft))});class un{constructor(e){this.props=new Map,e.whenReady((({elementType:e})=>this.define(e))),e.whenComponent((({mount:e})=>{e&&this.mount(e)}))}declareDomProperty({key:e,descriptor:t}){this.props.set(e,t)}define(e){const t=e.prototype;this.props.forEach(((e,n)=>{Object.defineProperty(t,n,e)}))}mount({element:e}){this.props.forEach(((t,n)=>{Object.defineProperty(e,n,t)}))}}const dn=Symbol("dom-property");function hn(e){return[dn,e]}function ln(e,t,n,s){n!==s&&Ne.of(e).updateState(t,n,s)}function fn(e={}){return Be((t=>{const{key:n,get:s}=t;let{set:r}=t;const o=function(e,{propertyKey:t=e.key,configurable:n=e.configurable,enumerable:s=e.enumerable,writable:r=e.writable}){const o=e.key;return{key:t,descriptor:{configurable:n,enumerable:s,get:function(){return Ne.of(this).component[o]},set:r?function(e){Ne.of(this).component[o]=e}:void 0}}}(t,e);if(!1!==e.updateState){const t=function(e,t=!0){if(!0===t||"function"==typeof t){const n=hn(e),s=!0===t?ln:t;return(e,t,r)=>s(e,n,t,r)}return(e,n,s)=>{n!==s&&Ne.of(e).updateState(t,n,s)}}(n,e.updateState),o=r;r=(e,n)=>{const r=s(e);o(e,n),t(e,n,r)}}return{componentDef:{define(e){e.get(an).declareDomProperty(o)}},get:s,set:r}}))}const pn=Symbol("render"),mn={spec:(e,t)=>s(t,e),fulfill(e,t={}){const{on:n=t.on,error:s}=e;return{on:n,error:s?s.bind(e):t.error&&t.error.bind(t)}},trigger(e,t={}){const{on:n=[]}=t;if(("object"==typeof n||"function"==typeof n)&&F(n))return M(n).do(V(e));const s=e.get(en).track(n).onUpdate.do(V(e));return Array.isArray(n)&&!n.length?s.do(L(((e,t)=>t[0]!==pn&&e()))):s}};class gn{constructor(e){this._context=e,this._renders=new Set}renderBy(t,n={}){const s=mn.spec(this._context,n),r=mn.trigger(this._context,s),o=this._context.get(et)({...mn.fulfill(s),node:this._context.element}),i="connected"===s.when;let c=1;const a=r(i?()=>this._context.connected&&d():()=>this._context.settled&&d()).needs(this._context).whenOff((function(){2===c&&o(e);c=-1}));(i?this._context.whenConnected:this._context.whenSettled)((()=>c&&d()));const u=ie();return this._renders.add(h),a.whenOff((()=>this._renders.delete(h)));function d(){c=2,o(l)}function h(){u(l)}function l(e){if(c>0)for(c=0;;){const n=t(e);if(n===t||"function"!=typeof n)break;t=n}}}renderNow(){this._renders.forEach((e=>e()))}}const yn=new y("element-render-ctl",{byDefault:e=>new gn(e.get(Ne))});const wn=new y("element-render-scheduler",{byDefault:function(t){const n=t.get(yn);return(t={})=>{const s=O(e);return n.renderBy((e=>{s.it(e)}),mn.fulfill({on:s.on},t)),e=>{s.it=t=>e(t)}}}});function bn(e){return Be((({get:t})=>({componentDef:{define(n){n.whenComponent((n=>{n.whenReady((()=>{const{component:s}=n,r=t(s).bind(s);n.get(yn).renderBy(r,e)}))}))}}})))}const _n=new y("shadow-content-root");class xn extends Event{get shadowRoot(){return this.target.shadowRoot}}const vn=new v("shadow-root-builder",{byDefault:()=>Cn});function Cn(e,t){const n=function(e,t){const n=e.shadowRoot;if(n)return n;if("attachShadow"in e)return e.attachShadow(t);return}(e.element,t);return n&&(n[qe]=e,e.whenConnected((()=>e.dispatchEvent(new xn("wesib:shadowAttached",{bubbles:!0}))))),n}const Dn={mode:"open"};function kn(e=Dn){return Re({setup(t){t.perComponent({a:_n,by:t=>t.get(vn)(t,e)}),t.perComponent({a:Pe,by:e=>e.get(_n,{or:null})})}})}const Sn=new S("https://wesib.github.io/ns","b","wesib");export{Zt as A,Ie as B,Re as C,fn as D,yn as E,we as F,bn as R,rn as S,Sn as W,de as a,Bt as b,It as c,Be as d,Ne as e,mn as f,Ee as g,pn as h,Jt as i,kn as j,hn as k,Ze as l,wn as m,ue as n,fe as o,qe as p,st as q,Je as r,rt as s,cn as t,he as u,en as v,nn as w};//# sourceMappingURL=wesib.acbfb4f5.js.map
