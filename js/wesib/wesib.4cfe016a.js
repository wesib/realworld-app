import{v as e,n as t,b as n,c as r,d as s,g as o}from"../lib/call-thru.3be1c170.js";import{b as i,A as u,m as a,c,i as l,a as f,f as d}from"../lib/a-iterable.01fedd29.js";import{a as h,b as p,C as m,c as g,d as w,M as y,F as b}from"../lib/context-values.10677615.js";import{t as v,m as x,a as _,g as D,b as O,l as k,e as C,V as S,h as E,i as T,j,D as P,u as R,S as F,A as q,E as A}from"../lib/fun-events.f47c7338.js";import{n as $,i as M,N,h as B}from"../lib/namespace-aliaser.535f16ce.js";import{n as K}from"../lib/render-scheduler.8e498d62.js";const V=new h("bootstrap-context");class z extends p{static get[m](){return V}}function Q(e){return(t,n)=>{const r=t.get(z);return t===r?e(r,n):r.get(n)}}const U=new h("component-factory");class L{static get[m](){return U}connectTo(e){const t=this.mountTo(e);return t.connected=!0,t}}const I=new h("window",{byDefault:()=>window}),W=new h("bootstrap-root",{byDefault:e=>e.get(I).document.body}),H=new h("default-namespace-aliaser");class G extends w{constructor(){super("default-render-scheduler"),this.upKey=this.createUpKey(e=>e.seed.keepThru((...t)=>{if(t.length)return J(e.context,t[t.length-1]);const n=()=>_(J(e.context,K));return O(e.byDefault(n)||n())}))}grow(e){let t;return e.context.get(this.upKey,"or"in e?{or:null!=e.or?_(e.or):e.or}:void 0).to(n=>t=J(e.context,n)),(...e)=>t(...e)}}function J(e,t){return(n={})=>t(Object.assign(Object.assign({},n),{window:n.window||e.get(I)}))}const X=new G;function Y(e){return Array.isArray(e)}class Z extends u{constructor(e){super(),this.items=null==e?new Set:Y(e)?new Set(e):new Set([e])}get value(){switch(this.items.size){case 0:return;case 1:return this.items[Symbol.iterator]().next().value;default:return[...this.items]}}[Symbol.iterator](){return this.items[Symbol.iterator]()}add(...e){return e.forEach(e=>this.items.add(e)),this}get size(){return this.items.size}merge(e){return null==e?this:Y(e)?this.add(...e):this.add(e)}}function ee(e,t=(()=>!0)){const n=Object.getPrototypeOf(e.prototype);if(null==n)return;const r=n.constructor;return t(r)?r:ee(r,t)}function te(e,t,n,r){const s=!n,o=r(n?function(e){if(function(e){return void 0===e.value&&void 0===e.writable}(e))return e;const t=Symbol("value"),n=e.value,r=Object.assign(Object.assign({},e),{writable:void 0,value:void 0,get(){return t in this?this[t]:n}});return e.writable&&(r.set=function(e){this[t]=e}),delete r.writable,delete r.value,r}(n):function(e,t){const n=Symbol(`${String(t)}:value`),r=e[t];return{configurable:!0,enumerable:!0,get(){return n in this?this[n]:r},set(e){this[n]=e}}}(e,t));if(!s||!o)return o;Object.defineProperty(e,t,o)}function ne(e,t,n=((e,t)=>t)){return e?t?function(...r){return n(e.apply(this,r),t.apply(this,r))}:e:t}function re(e){return e.nodeType===Node.ELEMENT_NODE}class se{constructor(e){this.symbol=e}own(e){return e.hasOwnProperty(this.symbol)?e[this.symbol]:void 0}of(e){const t=this.own(e),n=ee(e),r=n&&this.of(n);return t?r?this.merge([r,t]):t:r}define(e,t){const n=this.own(e),r=a(t,t=>this.meta(t,e)),s=this.merge(n?d([[n],r]):r);return Object.defineProperty(e,this.symbol,{configurable:!0,value:s}),e}}class oe{constructor(){this.promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}resolve(e){this._resolve(e)}reject(e){this._reject(e)}}const ie=Symbol("feature-def");class ue extends se{constructor(){super(ie)}merge(e){return i(e,(e,t)=>({needs:new Z(e.needs).merge(t.needs).value,has:new Z(e.has).merge(t.has).value,setup:ne(e.setup,t.setup),init:ne(e.init,t.init)}),{})}meta(e,t){const n=e[ie];return null==n?e:this.meta("function"==typeof n?e[ie](t):n,t)}}const ae=new ue,ce={[ie]:()=>({})},le={of:e=>ae.of(e)||{},for:(e,t)=>ae.meta(t,e),merge:(...e)=>ae.merge(e),all:(...e)=>i(e,(e,t)=>({[ie]:n=>le.merge(le.for(n,e),le.for(n,t))}),ce),define:(e,...t)=>ae.define(e,t)};function fe(...e){return t=>le.define(t,...e)}const de=new h("feature-context");class he extends z{static get[m](){return de}whenDefined(e){return this.get(z).whenDefined(e)}load(e){return this.get(z).load(e)}}class pe extends Error{constructor(e){super("Circular feature needs: "+e.reduce((e,[t,n,r])=>(e||t.name)+` ${n} ${r.name}`,"")),this.needs=e}}const me=Symbol("component-def");class ge extends se{constructor(){super(me)}merge(e){return i(e,(e,t)=>Object.assign(Object.assign(Object.assign({},e),t),{setup:ne(e.setup,t.setup),define:ne(e.define,t.define),feature:e.feature?t.feature?le.merge(e.feature,t.feature):e.feature:t.feature}),{})}meta(e,t){const n=e[me];return null!=n?this.meta("function"==typeof n?e[me](t):n,t):null!=e[ie]?{feature:le.for(t,e)}:M(e)?{name:e}:e}}const we=new ge,ye={[me]:()=>({})},be={of:e=>we.of(e)||{},for:(e,t)=>we.meta(t,e),merge:(...e)=>we.merge(e),all:(...e)=>i(e,(e,t)=>({[me]:n=>be.merge(be.for(n,e),be.for(n,t))}),ye),define:(e,...t)=>we.define(e,t)};function ve(...e){const t=t=>be.define(t,...e);return t[me]=()=>be.all(...e),t}const xe=new h("component-context"),_e=new h("component-event-dispatcher",{byDefault(e){const t=e.get(xe),n=new P(t.element);return T(n).needs(t),{dispatch:e=>n.dispatch(e),on:e=>n.on(e)}}}),De=new h("content-root",{byDefault:e=>e.get(xe).element}),Oe=new b("state-updater",{byDefault:e(s)}),ke=Symbol("component-context");class Ce extends p{constructor(){super(...arguments),this.updateState=Se.bind(this)}static get[m](){return xe}static of(e){const t=e[ke];if(!t)throw TypeError(`No component context found in ${e}`);return t}get contentRoot(){return this.get(De)}on(e){return this.get(_e).on(e)}dispatchEvent(e){this.get(_e).dispatch(e)}}function Se(e,t,n){this.get(Oe)(e,t,n)}class Ee extends Event{get context(){return Ce.of(this.target)}}const Te=Symbol("anonymous-component-property");function je(t){const n=({get:e,set:n},r=Te,s)=>ve({[me](o){const i=t({type:o,key:r,readable:!0,writable:s,enumerable:!1,configurable:!1,get:t=>e(t,r),set:(e,t)=>n(e,t,r)});return i&&i.componentDef||{}}}),r=(e,t)=>n({get:(t,n)=>e(t,n)},t,!1),s=(e,n,r)=>te(e,n,r,r=>{const{get:s,set:o}=r,i=e.constructor,{get:u,set:a,configurable:c,enumerable:l,componentDef:f={}}=t({type:i,key:n,readable:!!r.get,writable:!!r.set,enumerable:!!r.enumerable,configurable:!!r.configurable,get:s?e=>s.call(e):Pe(n),set:o?(e,t)=>o.call(e,t):Re(n)})||{};be.define(i,f);const d=Object.assign(Object.assign({},r),{configurable:null!=c?c:r.configurable,enumerable:null!=l?l:r.enumerable});return(u||a)&&(d.get=u&&function(){return u(this,n)},d.set=a&&function(e){a(this,e,n)}),d});return s.With=(e,t)=>n(e,t,!0),s.By=r,s.As=(t,n)=>r(e(t),n),s.Bind=(e,t=Te)=>{const r=Symbol(`${String(t)}:accessor`),s=n=>{const s=n[r];if(s)return s;const o=e(n,t);return n[r]={get:o.get?o.get.bind(o):Pe(t),set:o.set?o.set.bind(o):Re(t)}};return n({get:e=>s(e).get(),set:(e,t)=>s(e).set(t)},t,!0)},s}function Pe(e){return()=>{throw new TypeError(`"${String(e)}" is not readable`)}}function Re(e){return()=>{throw new TypeError(`"${String(e)}" is not writable`)}}class Fe extends w{constructor(){super("element-adapter"),this.upKey=this.createUpKey(e=>e.seed.keepThru((...t)=>{const n=t.reduce((e,t)=>n=>e(n)||t(n),qe),r=()=>_(qe);return n!==qe?n:O(e.byDefault(r)||r())}))}grow(e){let t;return e.context.get(this.upKey,"or"in e?{or:null!=e.or?_(e.or):e.or}:void 0).to(e=>t=e),e=>t(e)}}function qe(e){return e[ke]}const Ae=new Fe,$e=new b("element-observer",{byDefault:Q(e=>{const t=e.get(Ae);class n extends MutationObserver{constructor(e){super(n=>{n.forEach(e=>{l(f(e.removedNodes),e=>{var t;return null===(t=function(e){var t;return null===(t=e[ke])||void 0===t?void 0:t.mount}(e))||void 0===t?void 0:t.checkConnected()}),l(c(f(e.addedNodes),re),e=>{var n,r;return null===(r=null===(n=t(e))||void 0===n?void 0:n.mount)||void 0===r?void 0:r.checkConnected()})}),e(n,this)})}observe(e,t){super.observe(e,Object.assign(Object.assign({},t),{childList:!0}))}}return e=>new n(e)})});const Me=Symbol("component-factory");function Ne(e){const t=e[Me];if(!t)throw new TypeError(`Component is not defined: ${e}`);return t}const Be=new h("custom-elements",{byDefault:function(e){const t=e.get(I).customElements,n=e.get(H);return new class extends Ke{define(e,r){if(M(e))return void t.define(B.name(e,n),r);const s=Ne(e),{name:o,extend:i}=s.elementDef;o?i&&i.name?t.define(B.name(o,n),r,{extends:i.name}):t.define(B.name(o,n),r):ze(e).resolve(void 0)}whenDefined(e){if(M(e))return t.whenDefined(B.name(e,n));const r=Ne(e),{name:s}=r.elementDef;return s?t.whenDefined(B.name(s,n)):ze(e).promise}}}});class Ke{static get[m](){return Be}}const Ve=Symbol("component-resolver");function ze(e){return e[Ve]||(e[Ve]=new oe)}const Qe=new h("definition-context"),Ue=new h("element-def",{byDefault(e){const t=e.get(Qe).componentType,{name:n,extend:r}=be.of(t),s={get type(){return r&&r.type||e.get(I).HTMLElement},get name(){return r&&r.name}};return{get name(){return n},get extend(){return s}}}});class Le extends p{static get[m](){return Qe}get elementDef(){return this.get(Ue)}}const Ie=new h("bootstrap-context-registry");class We extends g{constructor(){super(),this.provide({a:We,is:this}),this.values=this.newValues()}static get[m](){return Ie}static create(){return new We}}const He=new h("component-context-registry",{byDefault:Q(()=>new Ge)});class Ge extends g{static get[m](){return He}}const Je=new h("definition-context-registry",{byDefault:Q(e=>new Xe(e))});class Xe extends g{static get[m](){return Je}}const Ye=Symbol("post-def-setup");function Ze(e){if(e.hasOwnProperty(Ye))return e[Ye];const r=v(),s=new A,o=r.read().thru(e=>e?t(e):n()),i=R(o,s),u=ee(e,e=>me in e);if(u){const e=Ze(u);i.to(t=>e.send(t))}const a={on:i,send(e){s.send(e)},setup(e){r.it=e}};return Object.defineProperty(e,Ye,{value:a}),a}class et{constructor(){const e=v(0),t=new A;this.onCreated=C(n=>{const r=e.it+1;t.on({supply:n.supply,receive:(e,t,s)=>{s<r&&n.receive({onRecurrent(t){e.onRecurrent(e=>t(e))}},t)}}),++e.it}),this.readNotifier=e.read().keepThru_(e=>(n,r)=>(t.send(n,r),e))}}const tt=new h("element-builder",{byDefault:Q((function(r){const o=r.get(Xe),i=r.get(Ge),u=new A,a=new A;return{definitions:u,components:a,buildElement(r){var a;const l=be.of(r),f=new et;let d;const h=v(!1),p=h.read().thru(e=>e?t():n());let m;function g(){return i.append(d)}const w=new class extends L{get componentType(){return m.componentType}get elementType(){return m.elementType}get elementDef(){return m.elementDef}mountTo(e){if(e[ke])throw new Error(`Element ${e} already bound to component`);const t=c({definitionContext:m,whenComponent:f,registry:g(),element:e,elementSuper:t=>e[t],createMount:t=>new class extends class{get component(){return this.context.component}get element(){return this.context.element}}{get context(){return t}get connected(){return 3===rt(e).it}set connected(t){rt(e).it=t?3:2}checkConnected(){const t=e,n=t.ownerDocument;return this.connected=null!=n&&n.contains(t)}}}).mount;return t.checkConnected(),st(t.context),t}};m=new class extends Le{constructor(){var e;super();const t=new Xe(o.seedIn(this));t.provide({a:Le,is:this}),t.provide({a:L,is:w}),this.get=t.newValues().get,d=new Ge(t.seedIn(this));const n=this.whenReady().F,s=this.whenComponent().F,i={get componentType(){return r},get whenReady(){return n},get whenComponent(){return s},perDefinition:e=>t.provide(e),perComponent:e=>d.provide(e)};null===(e=l.setup)||void 0===e||e.call(l,i),Ze(r).setup(i)}get componentType(){return r}get elementType(){throw new Error("Custom element class is not constructed yet. Consider to use a `whenReady()` callback")}whenReady(t){return(this.whenReady=p.thru_(e(this)).once().F)(t)}whenComponent(e){return(this.whenComponent=f.onCreated.F)(e)}perComponent(e){return d.provide(e)}},null===(a=l.define)||void 0===a||a.call(l,m),u.send(m);const y=function(e,t,n){const r=e.get(Ue);class o extends r.extend.type{constructor(){super(),st(c({definitionContext:e,whenComponent:t,registry:n(),element:this,createMount:s,elementSuper:e=>super[e]}))}connectedCallback(){rt(this).it=3}disconnectedCallback(){rt(this).it=2}}return o}(m,f,g);return Object.defineProperty(m,"elementType",{configurable:!0,enumerable:!0,value:y}),h.it=!0,w}};function c({definitionContext:e,whenComponent:r,registry:s,element:o,createMount:i,elementSuper:u}){const c=v(0),l=v();let f;T(c).whenOff(e=>l.it=[e]);const d=s.newValues();const h=new class extends Ce{constructor(){super(...arguments),this.get=d.get,this.elementSuper=u}get componentType(){return e.componentType}get element(){return o}get component(){throw new Error("The component is not constructed yet. Consider to use a `whenReady()` callback")}get mount(){return f||(f=i(this))}get connected(){return 3===c.it}get[j](){return T(c)}whenReady(e){return(this.whenReady=c.read().thru(e=>e?t(this):n()).once().F)(e)}whenOn(e){return(this.whenOn=c.read().thru_(e=>{if(3!==e)return n();const r=E();return this.whenOff().once(()=>r.off()).cuts(r),t(r)}).F)(e)}whenOff(e){return(this.whenOff=c.read().thru_(e=>2===e?t():n()).F)(e)}whenDestroyed(e){return(this.whenDestroyed=l.read().thru(e=>e?t(e[0]):n()).once().F)(e)}destroy(e){c.done(e)}};let p=0;h.whenDestroyed(()=>function(e){const{element:t,mount:n}=e;n&&(n.connected=!1);const r=t.parentElement;r&&r.removeChild(t)}(h)),s.provide({a:Ce,is:h}),Object.defineProperty(o,ke,{value:h}),Object.defineProperty(o,nt,{writable:!0,value:c}),r.readNotifier.once(e=>p=e(h,p)),h.whenOn(e=>{r.readNotifier.to({supply:e,receive(e,t){p=t(h,p)}})}),a.send(h);const m=function(e,t){const n=e.prototype,r=n[ke];n[ke]=t;try{const s=new e(t);return Object.defineProperty(s,ke,{value:t}),s}finally{n[ke]=r}}(e.componentType,h);return Object.defineProperty(h,"component",{configurable:!0,enumerable:!0,value:m}),c.it=1,h}}))}),nt=Symbol("component-status");function rt(e){return e[nt]}function st(e){e.whenOn().once(()=>e.dispatchEvent(new Ee("wesib:component",{bubbles:!0})))}const ot=e(s);class it{constructor(e){this._context=e,this._definitionQueue=[],e.whenReady(()=>{this._definitionQueue.forEach(e=>e()),delete this._definitionQueue})}get customElements(){return this._context.get(Ke)}define(e){this._definitionQueue.push(()=>{const t=this._context.get(tt).buildElement(e);e[Me]=t,this.customElements.define(e,t.elementType)})}}const ut=Symbol("feature-key");class at extends w{static of(e){return e.hasOwnProperty(ut)?e[ut]:e[ut]=new at(e)}get upKey(){return this}constructor(e){super(`feature:${e.name}`)}grow(e){return r=e.context.get(z),s=e.seed.keepThru(ct),x(e=>{let n,o=_(),i=Promise.resolve("idle");return D({clause:s,deps:lt(r,s)}).keepThru_(({clause:[e],deps:s})=>{if(!e)return t();const[u,,a]=e;if(u.feature===n)return O(o);if(n=u.feature,a!==n)return O(o=r.get(at.of(n)).keepThru_(e=>(e.to(i),i=e.stage,e)));const c=new dt(r,u,s).to(i),l=_(c);return O(o=x(e=>l.to(e).whenOff(()=>{i=c.unload()})).share())}).to(e)}).keepThru(function(){let e=null;return r=>e===r?n():(e=r,r?t(r):t())}());var r,s}}function ct(...e){let t,n=!1;for(const r of e)switch(r[1]){case"is":n=!0,t||(t=r);break;case"has":t=r;break;case"needs":n=!0}return n?t:void 0}function lt(e,n){return n.keepThru_(n=>{if(!n)return t();const[{def:r}]=n,s=new Z(r.needs);return s.size?O(k(...a(s,t=>e.get(at.of(t)))).keepThru_(ft)):t()})}function ft(...e){return t(...c(a(e,e=>e[0]),o))}class dt{constructor(e,t,n){this.bsContext=e,this.request=t,this.deps=n,this.state=v(!1),this.down=new Promise(e=>this._down=e),this._stage=Promise.resolve(new pt(this))}get stage(){return this._stage.then(e=>e.after)}get ready(){return this.state.it}to(e){const t=this._stage;return this._stage=e.then(e=>t.then(t=>t[e]())),this}async setup(){await(this._stage=this._stage.then(e=>e.setup()))}async init(){await(this._stage=this._stage.then(e=>e.init()))}async unload(){const e=this._stage;delete this._stage;const t=await e,n=await t.stop();return this._down(),n}}class ht{constructor(e,t=(()=>Promise.resolve())){this.loader=e,this._stop=t}idle(){return Promise.resolve(this)}stop(){return this._stop().then(()=>this.after)}perDep(e){const{deps:t}=this.loader;return Promise.all(t.map(t=>e(t)))}}class pt extends ht{get after(){return"idle"}async setup(){var e;await this.perDep(e=>e.setup());const{bsContext:t,request:{def:s}}=this.loader,[o,i]=function(e,t){const s=function(){const e=[];let t=t=>{const n=t();return e.push(n),n};return{supply:E(()=>{t=ot,l(f(e).reverse(),e=>e()),e.length=0}),add:e=>t(e)}}();let o;const i=e.get(Xe),u=e.get(Ge),a=new g(e),c=e.get(tt);return[new class extends he{constructor(){super(),this.get=a.newValues().get,a.provide({a:he,is:this}),o=new it(this)}get feature(){return t.request.feature}whenReady(s){return(this.whenReady=D({st:t.state,bs:v().by(e.whenReady())}).thru(({st:[e],bs:[t]})=>t&&e?r(this):n()).once().F)(s)}onDefinition(e){return(this.onDefinition=c.definitions.on().tillOff(s.supply).F)(e)}onComponent(e){return(this.onComponent=c.components.on().tillOff(s.supply).F)(e)}provide(t){return s.add(()=>e.get(We).provide(t))}perDefinition(e){return s.add(()=>i.provide(e))}perComponent(e){return s.add(()=>u.provide(e))}setupDefinition(e){return function(e,t){const{on:n}=Ze(e);return C(e=>{n.to({supply:e.supply.needs(t.supply),receive(n,r){const s=r.whenReady().tillOff(t.supply).F,o=r.whenComponent().tillOff(t.supply).F;e.receive(n,{get componentType(){return r.componentType},get whenReady(){return s},get whenComponent(){return o},perDefinition:e=>t.add(()=>r.perDefinition(e)),perComponent:e=>t.add(()=>r.perComponent(e))})}})})}(e,s)}define(e){o.define(e)}},s.supply]}(t,this.loader);return null===(e=s.setup)||void 0===e||e.call(s,o),new mt(this.loader,o,()=>Promise.resolve(i.off()))}init(){return this.setup().then(e=>e.init())}}class mt extends ht{constructor(e,t,n){super(e,n),this._context=t}get after(){return"setup"}setup(){return Promise.resolve(this)}async init(){var e;await this.perDep(e=>e.init());const{request:{def:t}}=this.loader;return null===(e=t.init)||void 0===e||e.call(t,this._context),new gt(this)}}class gt extends ht{get after(){return"init"}constructor(e){super(e.loader,()=>e.stop()),e.loader.state.it=!0}setup(){return Promise.resolve(this)}init(){return Promise.resolve(this)}}class wt{constructor(e,t,n){this._requester=e,this.feature=t,this._revoke=n,this._uses=0,this.def=function(e){let t=le.of(e);if(me in e){t=le.merge(t,{init(t){t.define(e)}});const{feature:n}=be.of(e);n&&(t=le.merge(t,n))}return t}(t)}request(e){const t=this._requester,{registry:n}=t,r=[this,"is",this.feature];return this._revokeBy(n.provide({a:at.of(this.feature),is:r})),new Z(this.def.has).forEach(r=>{const s=[this,"has",r];this._revokeBy(n.provide({a:at.of(r),is:s}));const o=t.request(r,[...e,s]);this._revokeBy(()=>o.unuse())}),new Z(this.def.needs).forEach(r=>{const s=[this,"needs",r],o=t.request(r,[...e,s]);this._revokeBy(()=>o.unuse()),this._revokeBy(n.provide({a:at.of(r),is:s}))}),this._uses=1,this}reuse(e){if(!this._uses)throw new pe(e.map(([{feature:e},t,n])=>[e,t,n]));return++this._uses,this}unuse(){--this._uses||this._revoke()}_revokeBy(e){this._revoke=ne(e,this._revoke)}}const yt=new h("feature-requester",{byDefault:Q(e=>new bt(e))});class bt{constructor(e){this._map=new Map,this.registry=e.get(We)}static get[m](){return yt}request(e,t=[]){const n=this._map.get(e);if(n)return n.reuse(t);const r=new wt(this,e,()=>this._map.delete(e));return this._map.set(e,r),r.request(t)}}function vt(...e){const r=We.create(),{bootstrapContext:s,complete:o}=function(e){const r=v(0),s=e.values;const o=new class extends z{constructor(){super(),this.get=s.get,e.provide({a:H,by:$}),e.provide({a:z,is:this})}async whenDefined(e){return await this.whenReady(),await this.get(Ke).whenDefined(e),Ne(e)}whenReady(e){return(this.whenReady=r.read().thru(e=>e?t(this):n()).once().F)(e)}load(e){const t=x(t=>{const n=o.get(bt).request(e),r=v({status:{feature:e,ready:!1}});this.get(at.of(e)).to({supply:t.supply,receive(e,t){const n=t;r.it={status:{feature:n.request.feature,ready:n.ready},down:n.down},n.ready||n.init().then(()=>{r.it={status:{feature:n.request.feature,ready:!0},down:n.down}})}}).whenOff(()=>{n.unuse()}),r.read(t)}).share();let n;const r=t.to(({down:e})=>{n=e});return new class extends class{[q](){return this.read()}}{get down(){return n}read(e){return(this.read=t.tillOff(r).keepThru(e=>e.status).F)(e)}dismiss(e){return r.off(e),n}}}};return{bootstrapContext:o,complete(){r.it=1}}}(r),i=1===e.length?e[0]:(u=e,le.define(class{},{needs:u}));var u;return s.get(bt).request(i),s.get(at.of(i)).to(e=>{e.init().then(o)}),s}const xt=new y("attribute-descriptor"),_t=Symbol("attribute");function Dt(e){return[_t,e]}function Ot(e,t=!0){if(!1===t)return s;if(!0===t||"function"==typeof t){const n=Dt(e),r=!0===t?kt:t;return(e,t,s)=>r(e,n,t,s)}return(e,n,r)=>kt(e,t,n,r)}function kt(e,t,n,r){Ce.of(e).updateState(t,n,r)}function Ct(e,t,n){let r,s;if("string"==typeof n)r=n,s=Ot(r);else{if(n&&n.name)r=n.name;else{if("string"!=typeof t)throw new TypeError("Attribute name is required as property key is not a string: "+`${e.constructor.name}.prototype.${String(t)}`);r=t}s=Ot(r,n&&n.updateState)}return{name:r,change:s}}const St=new h("attribute-registry");class Et{constructor(e){this._context=e}static get[m](){return St}get attrs(){if(this._attrs)return this._attrs;const e=new Map;return this._context.get(xt).forEach(t=>{const{name:n,change:r}=t;e.set(n,ne(e.get(n),r))}),this._attrs=e}define(e){const t=this.attrs,n=Array.from(t.keys());n.length&&(Object.defineProperty(e,"observedAttributes",{configurable:!0,enumerable:!0,value:n}),Object.defineProperty(e.prototype,"attributeChangedCallback",{configurable:!0,enumerable:!0,value:function(e,n,r){t.get(e)(Ce.of(this).component,r,n)}}))}mount(e){const t=e.element,n=this.attrs,r=Array.from(n.keys());r.length&&new(0,this._context.get(I).MutationObserver)(e=>e.forEach(e=>{const r=e.attributeName;return n.get(r)(Ce.of(t).component,t.getAttribute(r),e.oldValue)})).observe(t,{attributes:!0,attributeFilter:r,attributeOldValue:!0})}}const Tt={setup(e){e.perDefinition({as:Et}),e.onDefinition(e=>{e.whenReady(({elementType:t})=>e.get(Et).define(t))}),e.onComponent(e=>{const t=e.mount;t&&e.get(Et).mount(t)})}};class jt{static get[ie](){return Tt}}function Pt(e){return je(({type:t,key:n})=>{const r=Ct(t.prototype,n,e),{name:s}=r;return{componentDef:{feature:{needs:jt},setup(e){e.perDefinition({a:xt,is:r})}},get:e=>Ce.of(e).element.getAttribute(s),set(e,t){const{element:n}=Ce.of(e);null!=t?n.setAttribute(s,t):n.removeAttribute(s)}}})}function Rt(e){return je(({type:t,get:n,key:r})=>{const{name:s,change:o}=Ct(t.prototype,r,e);return{componentDef:{feature:{needs:jt},setup(e){e.perDefinition({a:xt,is:{name:s,change(e,t,r){n(e).call(e,t,r),o(e,t,r)}}})}}}})}function Ft(e){return ve({feature:{needs:jt},setup(t){const n=e=>{"string"==typeof e?t.perDefinition({a:xt,is:{name:e,change:Ot(e)}}):Object.keys(e).forEach(n=>{t.perDefinition({a:xt,is:{name:n,change:Ot(n,e[n])}})})};Y(e)?e.forEach(n):n(e)}})}const qt=new h("component-state");class At extends F{static get[m](){return qt}}const $t=Symbol("state-property");function Mt(e){return[$t,e]}function Nt(e,t,n,r){n!==r&&Ce.of(e).updateState(t,n,r)}const Bt={setup(e){e.perComponent({a:At,by(e){const t=new At;return e.whenDestroyed(e=>t.done(e)),t}}),e.perComponent({a:Oe,by:e=>e.update,with:[At]})}};class Kt{static get[ie](){return Bt}}function Vt({updateState:e}={}){return je(({get:t,set:n,key:r})=>{if(!1!==e){const s=n,o=function(e,t=!0){if(!0===t||"function"==typeof t){const n=Mt(e),r=!0===t?Nt:t;return(e,t,s)=>r(e,n,t,s)}return(e,n,r)=>{n!==r&&Ce.of(e).updateState(t,n,r)}}(r,e);n=(e,n)=>{const r=t(e);s(e,n),o(e,n,r)}}return{componentDef:{feature:{needs:Kt}},get:t,set:n}})}var zt;class Qt extends S{constructor(e,t,n){super(),this._context=e,this._name=t,this._path=n,this[zt]=E()}get it(){return this._context.element.getAttribute(this._name)}set it(e){T(this).isOff||(null==e?this._context.element.removeAttribute(this._name):this._context.element.setAttribute(this._name,e))}on(e){return(this.on=this._context.get(At).track(this._path).onUpdate().thru((e,n,r)=>t(n,r)).tillOff(this).F)(e)}}function Ut(e,t,n=Dt(t)){return new Qt(e,t,n)}zt=j;const Lt=new y("dom-property-descriptor"),It=new h("dom-property-registry");class Wt{constructor(e){this._context=e}static get[m](){return It}get props(){return this._props?this._props:this._props=new Map(this._context.get(Lt).map(({key:e,descriptor:t})=>[e,t]))}define(e){const t=e.prototype;this.props.forEach((e,n)=>{Object.defineProperty(t,n,e)})}mount(e){const t=e.element;this.props.forEach((e,n)=>{Object.defineProperty(t,n,e)})}}const Ht={setup(e){e.perDefinition({as:Wt}),e.onDefinition(e=>{e.whenReady(({elementType:t})=>e.get(Wt).define(t))}),e.onComponent(e=>{const t=e.mount;t&&e.get(Wt).mount(t)})}};class Gt{static get[ie](){return Ht}}const Jt=Symbol("dom-property");function Xt(e){return[Jt,e]}function Yt(e,t,n,r){n!==r&&Ce.of(e).updateState(t,n,r)}function Zt(e={}){return je(t=>{const{key:n,get:r}=t;let{set:s}=t;const o=function(e,{propertyKey:t=e.key,configurable:n=e.configurable,enumerable:r=e.enumerable,writable:s=e.writable}){const o=e.key;return{key:t,descriptor:{configurable:n,enumerable:r,get:function(){return Ce.of(this).component[o]},set:s?function(e){Ce.of(this).component[o]=e}:void 0}}}(t,e);if(!1!==e.updateState){const t=function(e,t=!0){if(!0===t||"function"==typeof t){const n=Xt(e),r=!0===t?Yt:t;return(e,t,s)=>r(e,n,t,s)}return(e,n,r)=>{n!==r&&Ce.of(e).updateState(t,n,r)}}(n,e.updateState),o=s;s=(e,n)=>{const s=r(e);o(e,n),t(e,n,s)}}return{componentDef:{feature:{needs:Gt},setup(e){e.perDefinition({a:Lt,is:o})}},get:r,set:s}})}const en={render(e,t,n={}){const{offline:r,path:o=[]}=n,i=e.get(At).track(o),u=e.get(X)();let a=0;const c=i.onUpdate(()=>{r||e.connected?l():a=0});function l(){a=1,u(d)}function f(){1===a&&(u(s),a=-1)}function d(e){if(!(a<0))for(a=2;;){const n=t(e);if(n===t||"function"!=typeof n)break;t=n}}r?l():e.whenOn(e=>{e.whenOff(f),a<=0&&l()}).whenOff(e=>{f(),c.off(e)})}};function tn(e){return je(({get:t})=>({componentDef:{feature:{needs:Kt},define(n){n.whenComponent(n=>{n.whenReady(()=>{const{component:r}=n;en.render(n,t(r).bind(r),e)})})}}}))}const nn=new h("shadow-content-root");class rn extends Event{get shadowRoot(){return this.target.shadowRoot}}const sn=new b("shadow-root-builder"),on={setup(e){e.provide({a:sn,is:an})}};class un{static get[ie](){return on}}function an(e,t){const n=function(e,t){const n=e.shadowRoot;if(n)return n;if("attachShadow"in e)return e.attachShadow(t);return}(e.element,t);return n&&(n[ke]=e,e.whenOn().once(()=>e.dispatchEvent(new rn("wesib:shadowAttached",{bubbles:!0})))),n}const cn={mode:"open"};function ln(e=cn){return ve({setup(t){t.perComponent({a:nn,by:t=>t.get(sn)(t,e)}),t.perComponent({a:De,by:e=>e.get(nn,{or:null})})},feature:{needs:un}})}const fn=new N("https://wesib.github.io/ns","b","wesib");export{Ft as A,I as B,ve as C,Zt as D,Ae as E,fe as F,tn as R,Vt as S,fn as W,Q as a,vt as b,Pt as c,je as d,Ce as e,Rt as f,ln as g,Xt as h,be as i,H as j,ie as k,X as l,Z as m,z as n,Kt as o,W as p,ke as q,re as r,$e as s,Ut as t,At as u,ne as v,Mt as w};//# sourceMappingURL=wesib.4cfe016a.js.map
