import{v as e,n as t,b as n,d as s,c as r,g as o}from"../proc7ts/call-thru.505a1d44.js";import{b as i,m as u,c as a,f as c,i as h,a as d}from"../proc7ts/a-iterable.1242fbf9.js";import{a as l,b as p,C as f,c as m,d as g,M as y,F as w}from"../proc7ts/context-values.36bc76d6.js";import{t as b,m as _,a as v,g as x,b as C,l as D,V as k,h as O,i as T,j as S,D as E,e as R,r as j,S as P,A as q,s as A,E as F}from"../proc7ts/fun-events.5a9906d8.js";import{n as B,i as N,N as K,h as M}from"../proc7ts/namespace-aliaser.1d67b636.js";import{n as V,i as $}from"../proc7ts/render-scheduler.88834b66.js";const z=new l("bootstrap-context");class Q extends p{static get[f](){return z}}function U(e){return(t,n)=>{const s=t.get(Q);return t===s?e(s,n):s.get(n)}}function L(e){return Array.isArray(e)}class I{constructor(e){this.items=null==e?new Set:L(e)?new Set(e):new Set([e])}get value(){switch(this.items.size){case 0:return;case 1:return this.items[Symbol.iterator]().next().value;default:return[...this.items]}}[Symbol.iterator](){return this.items[Symbol.iterator]()}add(...e){return e.forEach(e=>this.items.add(e)),this}get size(){return this.items.size}merge(e){return null==e?this:L(e)?this.add(...e):this.add(e)}}function W(e,t=(()=>!0)){const n=Object.getPrototypeOf(e.prototype);if(null==n)return;const s=n.constructor;return t(s)?s:W(s,t)}function H(e,t,n,s){const r=!n,o=s(n?function(e){if(function(e){return void 0===e.value&&void 0===e.writable}(e))return e;const t=Symbol("value"),n=e.value,s=Object.assign(Object.assign({},e),{writable:void 0,value:void 0,get(){return t in this?this[t]:n}});return e.writable&&(s.set=function(e){this[t]=e}),delete s.writable,delete s.value,s}(n):function(e,t){const n=Symbol(String(t)+":value"),s=e[t];return{configurable:!0,enumerable:!0,get(){return n in this?this[n]:s},set(e){this[n]=e}}}(e,t));if(!r||!o)return o;Object.defineProperty(e,t,o)}function G(e,t,n=((e,t)=>t)){return e?t?function(...s){return n(e.apply(this,s),t.apply(this,s))}:e:t}function J(e){return e.nodeType===Node.ELEMENT_NODE}class X{constructor(e){this.symbol=e}own(e){return e.hasOwnProperty(this.symbol)?e[this.symbol]:void 0}of(e){const t=this.own(e),n=W(e),s=n&&this.of(n);return t?s?this.merge([s,t]):t:s}define(e,t){const n=this.own(e),s=u(t,t=>this.meta(t,e)),r=this.merge(n?c([[n],s]):s);return Object.defineProperty(e,this.symbol,{configurable:!0,value:r}),e}}class Y{constructor(){this.promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}resolve(e){this._resolve(e)}reject(e){this._reject(e)}}const Z=Symbol("feature-def");class ee extends X{constructor(){super(Z)}merge(e){return i(e,(e,t)=>({needs:new I(e.needs).merge(t.needs).value,has:new I(e.has).merge(t.has).value,setup:G(e.setup,t.setup),init:G(e.init,t.init)}),{})}meta(e,t){const n=e[Z];return null==n?e:this.meta("function"==typeof n?e[Z](t):n,t)}}const te=new ee,ne={[Z]:()=>({})},se={of:e=>te.of(e)||{},for:(e,t)=>te.meta(t,e),merge:(...e)=>te.merge(e),all:(...e)=>i(e,(e,t)=>({[Z]:n=>se.merge(se.for(n,e),se.for(n,t))}),ne),define:(e,...t)=>te.define(e,t)};function re(...e){return t=>se.define(t,...e)}const oe=new l("feature-context");class ie extends Q{static get[f](){return oe}whenDefined(e){return this.get(Q).whenDefined(e)}load(e){return this.get(Q).load(e)}}class ue extends Error{constructor(e){super("Circular feature needs: "+e.reduce((e,[t,n,s])=>(e||t.name)+` ${n} ${s.name}`,"")),this.needs=e}}class ae{[q](){return this.read()}}const ce=Symbol("component-def");class he extends X{constructor(){super(ce)}merge(e){return i(e,(e,t)=>Object.assign(Object.assign(Object.assign({},e),t),{setup:G(e.setup,t.setup),define:G(e.define,t.define),feature:e.feature?t.feature?se.merge(e.feature,t.feature):e.feature:t.feature}),{})}meta(e,t){const n=e[ce];return null!=n?this.meta("function"==typeof n?e[ce](t):n,t):null!=e[Z]?{feature:se.for(t,e)}:N(e)?{name:e}:e}}const de=new he,le={[ce]:()=>({})},pe={of:e=>de.of(e)||{},for:(e,t)=>de.meta(t,e),merge:(...e)=>de.merge(e),all:(...e)=>i(e,(e,t)=>({[ce]:n=>pe.merge(pe.for(n,e),pe.for(n,t))}),le),define:(e,...t)=>de.define(e,t)};function fe(...e){const t=t=>pe.define(t,...e);return t[ce]=()=>pe.all(...e),t}const me=new l("component-context"),ge=new l("component-event-dispatcher",{byDefault(e){const t=e.get(me),n=new E(t.element);return T(n).needs(t),{dispatch:e=>n.dispatch(e),on:e=>n.on(e)}}}),ye=new l("content-root",{byDefault:e=>e.get(me).element}),we=new w("state-updater",{byDefault:e(s)}),be=Symbol("component-context");class _e extends p{constructor(){super(...arguments),this.updateState=ve.bind(this)}static get[f](){return me}static of(e){const t=e[be];if(!t)throw TypeError("No component context found in "+e);return t}get contentRoot(){return this.get(ye)}on(e){return this.get(ge).on(e)}dispatchEvent(e){this.get(ge).dispatch(e)}}function ve(e,t,n){this.get(we)(e,t,n)}class xe extends Event{get context(){return _e.of(this.target)}}const Ce=Symbol("anonymous-component-property");function De(t){const n=({get:e,set:n},s=Ce,r)=>fe({[ce](o){const i=t({type:o,key:s,readable:!0,writable:r,enumerable:!1,configurable:!1,get:t=>e(t,s),set:(e,t)=>n(e,t,s)});return i&&i.componentDef||{}}}),s=(e,t)=>n({get:(t,n)=>e(t,n)},t,!1),r=(e,n,s)=>H(e,n,s,s=>{const{get:r,set:o}=s,i=e.constructor,{get:u,set:a,configurable:c,enumerable:h,componentDef:d={}}=t({type:i,key:n,readable:!!s.get,writable:!!s.set,enumerable:!!s.enumerable,configurable:!!s.configurable,get:r?e=>r.call(e):ke(n),set:o?(e,t)=>o.call(e,t):Oe(n)})||{};pe.define(i,d);const l=Object.assign(Object.assign({},s),{configurable:null!=c?c:s.configurable,enumerable:null!=h?h:s.enumerable});return(u||a)&&(l.get=u&&function(){return u(this,n)},l.set=a&&function(e){a(this,e,n)}),l});return r.With=(e,t)=>n(e,t,!0),r.By=s,r.As=(t,n)=>s(e(t),n),r.Bind=(e,t=Ce)=>{const s=Symbol(String(t)+":accessor"),r=n=>{const r=n[s];if(r)return r;const o=e(n,t);return n[s]={get:o.get?o.get.bind(o):ke(t),set:o.set?o.set.bind(o):Oe(t)}};return n({get:e=>r(e).get(),set:(e,t)=>r(e).set(t)},t,!0)},r}function ke(e){return()=>{throw new TypeError(`"${String(e)}" is not readable`)}}function Oe(e){return()=>{throw new TypeError(`"${String(e)}" is not writable`)}}const Te=new l("bootstrap-context-registry");class Se extends m{constructor(){super(),this.provide({a:Se,is:this}),this.values=this.newValues()}static get[f](){return Te}static create(){return new Se}}const Ee=new l("component-context-registry",{byDefault:U(()=>new Re)});class Re extends m{static get[f](){return Ee}}const je=new l("definition-context-registry",{byDefault:U(e=>new Pe(e))});class Pe extends m{static get[f](){return je}}const qe=Symbol("post-def-setup");function Ae(e){if(e.hasOwnProperty(qe))return e[qe];const s=b(),r=new F,o=s.read().thru(e=>e?t(e):n()),i=A(o,r),u=W(e,e=>ce in e);if(u){const e=Ae(u);i.to(t=>e.send(t))}const a={on:i,send(e){r.send(e)},setup(e){s.it=e}};return Object.defineProperty(e,qe,{value:a}),a}const Fe=new l("window",{byDefault:()=>window}),Be=new l("bootstrap-root",{byDefault:e=>e.get(Fe).document.body}),Ne=new l("default-namespace-aliaser");class Ke extends g{constructor(){super("default-render-scheduler"),this.upKey=this.createUpKey(e=>e.seed.keepThru((...t)=>{if(t.length)return Me(e.context,t[t.length-1]);const n=()=>v(Me(e.context,V));return C(e.byDefault(n)||n())}))}grow(e){let t;return e.context.get(this.upKey,"or"in e?{or:null!=e.or?v(e.or):e.or}:void 0).to(n=>t=Me(e.context,n)),(...e)=>t(...e)}}function Me(e,t){return(n={})=>t(Object.assign(Object.assign({},n),{window:n.window||e.get(Fe)}))}const Ve=new Ke;class $e extends g{constructor(){super("element-adapter"),this.upKey=this.createUpKey(e=>e.seed.keepThru((...t)=>{const n=t.reduce((e,t)=>n=>e(n)||t(n),ze),s=()=>v(ze);return n!==ze?n:C(e.byDefault(s)||s())}))}grow(e){let t;return e.context.get(this.upKey,"or"in e?{or:null!=e.or?v(e.or):e.or}:void 0).to(e=>t=e),e=>t(e)}}function ze(e){return e[be]}const Qe=new $e,Ue=new w("element-observer",{byDefault:U(e=>{const t=e.get(Qe);class n extends MutationObserver{constructor(e){super(n=>{n.forEach(e=>{h(d(e.removedNodes),e=>{var t;return null===(t=function(e){var t;return null===(t=e[be])||void 0===t?void 0:t.mount}(e))||void 0===t?void 0:t.checkConnected()}),h(a(d(e.addedNodes),J),e=>{var n,s;return null===(s=null===(n=t(e))||void 0===n?void 0:n.mount)||void 0===s?void 0:s.checkConnected()})}),e(n,this)})}observe(e,t){super.observe(e,Object.assign(Object.assign({},t),{childList:!0}))}}return e=>new n(e)})});const Le=Symbol("definition-context");function Ie(e){if(!e.hasOwnProperty(Le))throw new TypeError("Component is not defined: "+e);return e[Le]}const We=new l("custom-elements",{byDefault:U((function(e){const t=e.get(Fe).customElements,n=e.get(Ne);return new class extends He{define(e,s){if(N(e))return void t.define(M.name(e,n),s);const r=Ie(e),{name:o,extend:i}=r.elementDef;o?i&&i.name?t.define(M.name(o,n),s,{extends:i.name}):t.define(M.name(o,n),s):Je(e).resolve(void 0)}whenDefined(e){if(N(e))return t.whenDefined(M.name(e,n));const s=Ie(e),{name:r}=s.elementDef;return r?t.whenDefined(M.name(r,n)):Je(e).promise}}}))});class He{static get[f](){return We}}const Ge=Symbol("component-resolver");function Je(e){return e.hasOwnProperty(Ge)?e[Ge]:e[Ge]=new Y}const Xe=new l("definition-context"),Ye=new l("element-def",{byDefault(e){const t=e.get(Xe).componentType,{name:n,extend:s}=pe.of(t),r={get type(){return s&&s.type||e.get(Fe).HTMLElement},get name(){return s&&s.name}};return{get name(){return n},get extend(){return r}}}});class Ze extends p{static get[f](){return Xe}get elementDef(){return this.get(Ye)}connectTo(e){const t=this.mountTo(e);return t.connect(),t}}class et extends _e{constructor(e,t,n){super(),this._definitionContext=e,this.element=t,this.elementSuper=n,this._status=b(0);const s=e._newComponentRegistry();s.provide({a:_e,is:this}),this.get=s.newValues().get}get componentType(){return this._definitionContext.componentType}get component(){return this._component()}get connected(){return 2===this._status.it&&!T(this).isOff}get[S](){return T(this._status)}_component(){throw new TypeError("Component is not constructed yet. Consider to use a `whenReady()` callback")}whenReady(e){return(this.whenReady=this._status.read().thru(e=>e?t(this):n()).once().F)(e)}whenConnected(e){return(this.whenConnected=this._status.read().thru_(e=>2===e?r(this):n()).once().F)(e)}destroy(e){try{this._status.done(e)}finally{delete this.component[be],delete this.element[be],this._component=tt,function(e){const{parentNode:t}=e;t&&t.removeChild(e)}(this.element)}}_createComponent(){const t=this._definitionContext._whenComponent;let n=0;this.element[be]=this,t.readNotifier.once(e=>n=e(this,n)),this.whenConnected(()=>{t.readNotifier.to({supply:O().needs(this),receive:(e,t)=>{n=t(this,n)}})}),this._definitionContext._elementBuilder.components.send(this);const s=function(e){const t=e.componentType,n=t.prototype,s=n[be];n[be]=e;try{const r=new t(e);return r[be]=e,r}finally{n[be]=s}}(this);return this._component=e(s),this._status.it=1,this}_connect(){this._status.it=2}_created(){this.whenConnected(()=>this.dispatchEvent(new xe("wesib:component",{bubbles:!0})))}}function tt(){throw new TypeError("Component destroyed already")}class nt extends class{get component(){return this.context.component}get element(){return this.context.element}}{constructor(e){super(),this.context=e}get connected(){return this.context.connected}connect(){this.context._connect()}checkConnected(){const e=this.context.element,t=e.ownerDocument,n=null!=t&&t.contains(e);return n!==this.connected&&(n?this.connect():this.context.destroy()),n}}class st extends et{constructor(e,t){super(e,t,e=>t[e]),this.mount=new nt(this)}}class rt extends et{get mount(){}}class ot{constructor(){const e=b(0),t=new F;this.onCreated=R(n=>{const s=e.it+1;t.on({supply:n.supply,receive:(e,t,r)=>{r<s&&n.receive({onRecurrent(t){e.onRecurrent(e=>t(e))}},t)}}),++e.it}),this.readNotifier=e.read().keepThru_(e=>(n,s)=>(t.send(n,s),e))}}class it extends Ze{constructor(e,s,r){var o,i;super(),this._bsContext=e,this._elementBuilder=s,this.componentType=r,this._whenComponent=new ot,this._ready=b(!1),this._whenReady=this._ready.read().thru(e=>e?t():n()),this._def=pe.of(r);const u=new Pe(e.get(Pe).seedIn(this));u.provide({a:Ze,is:this}),this.get=u.newValues().get,this._perTypeRegistry=new Re(u.seedIn(this));const a=this.whenReady().F,c=this.whenComponent().F,h={get componentType(){return r},get whenReady(){return a},get whenComponent(){return c},perDefinition:e=>u.provide(e),perComponent:e=>this._perTypeRegistry.provide(e)};null===(i=(o=this._def).setup)||void 0===i||i.call(o,h),Ae(r).setup(h)}get elementType(){return this._elementType()}whenReady(t){return(this.whenReady=this._whenReady.thru_(e(this)).once().F)(t)}mountTo(e){if(e[be])throw new Error(`Element ${e} already bound to component`);const t=new st(this,e);t._createComponent();const{mount:n}=t;return n.checkConnected(),t._created(),n}whenComponent(e){return(this.whenComponent=this._whenComponent.onCreated.F)(e)}perComponent(e){return this._perTypeRegistry.provide(e)}_newComponentRegistry(){return this._bsContext.get(Re).append(this._perTypeRegistry)}_elementType(){throw new Error("Custom element class is not constructed yet. Consider to use a `whenReady()` callback")}_define(){var t,n;null===(n=(t=this._def).define)||void 0===n||n.call(t,this),this._elementBuilder.definitions.send(this),this._elementType=e(function(e){const t=e.get(Ye);class n extends t.extend.type{constructor(){super();const t=new rt(e,this,e=>super[e]);t._createComponent(),t._created()}connectedCallback(){this[be]._connect()}disconnectedCallback(){this[be].destroy()}}return n}(this)),this.componentType[Le]=this,this._ready.it=!0}}const ut=new l("element-builder",{byDefault:U((function(e){return{definitions:new F,components:new F,buildElement(t){const n=new it(e,this,t);return n._define(),n}}}))});const at=e(s);class ct{constructor(e){this._context=e,this._definitionQueue=[],e.whenReady(()=>{this._definitionQueue.forEach(e=>e()),delete this._definitionQueue})}get customElements(){return this._context.get(He)}define(e){this._definitionQueue.push(()=>{const t=this._context.get(ut).buildElement(e);this.customElements.define(e,t.elementType)})}}class ht extends ie{constructor(e,t){super(),this._bsContext=e,this._loader=t,this._unloader=function(){const e=[];let t=t=>{const n=t();return e.push(n),n};return{supply:O(()=>{t=at,h(d(e).reverse(),e=>e()),e.length=0}),add:e=>t(e)}}();const n=new m(e);n.provide({a:ie,is:this}),this.get=n.newValues().get,this._componentRegistry=new ct(this)}get feature(){return this._loader.request.feature}whenReady(e){return(this.whenReady=x({st:this._loader.state,bs:b().by(this._bsContext.whenReady())}).thru(({st:[e],bs:[t]})=>t&&e?r(this):n()).once().F)(e)}onDefinition(e){return(this.onDefinition=this._bsContext.get(ut).definitions.on().tillOff(this._unloader.supply).F)(e)}onComponent(e){return(this.onComponent=this._bsContext.get(ut).components.on().tillOff(this._unloader.supply).F)(e)}provide(e){return this._unloader.add(()=>this._bsContext.get(Se).provide(e))}perDefinition(e){return this._unloader.add(()=>this._bsContext.get(Pe).provide(e))}perComponent(e){return this._unloader.add(()=>this._bsContext.get(Re).provide(e))}setupDefinition(e){return function(e,t){const{on:n}=Ae(e);return R(e=>{n.to({supply:e.supply.needs(t.supply),receive(n,s){const r=s.whenReady().tillOff(t.supply).F,o=s.whenComponent().tillOff(t.supply).F;e.receive(n,{get componentType(){return s.componentType},get whenReady(){return r},get whenComponent(){return o},perDefinition:e=>t.add(()=>s.perDefinition(e)),perComponent:e=>t.add(()=>s.perComponent(e))})}})})}(e,this._unloader)}define(e){this._componentRegistry.define(e)}}const dt=Symbol("feature-key");class lt extends g{static of(e){return e.hasOwnProperty(dt)?e[dt]:e[dt]=new lt(e)}get upKey(){return this}constructor(e){super("feature:"+e.name)}grow(e){return s=e.context.get(Q),r=e.seed.keepThru(pt),_(e=>{let n,o=v(),i=Promise.resolve("idle");return x({clause:r,deps:ft(s,r)}).keepThru_(({clause:[e],deps:r})=>{if(!e)return t();const[u,,a]=e;if(u.feature===n)return C(o);if(n=u.feature,a!==n)return C(o=s.get(lt.of(n)).keepThru_(e=>(e.to(i),i=e.stage,e)));const c=new gt(s,u,r).to(i),h=v(c);return C(o=_(e=>h.to(e).whenOff(()=>{i=c.unload()})).share())}).to(e)}).keepThru(function(){let e=null;return s=>e===s?n():(e=s,s?t(s):t())}());var s,r}}function pt(...e){let t,n=!1;for(const s of e)switch(s[1]){case"is":n=!0,t||(t=s);break;case"has":t=s;break;case"needs":n=!0}return n?t:void 0}function ft(e,n){return n.keepThru_(n=>{if(!n)return t();const[{def:s}]=n,r=new I(s.needs);return r.size?C(D(...u(r,t=>e.get(lt.of(t)))).keepThru_(mt)):t()})}function mt(...e){return t(...a(u(e,e=>e[0]),o))}class gt{constructor(e,t,n){this.bsContext=e,this.request=t,this.deps=n,this.state=b(!1),this.down=new Promise(e=>this._down=e),this._stage=Promise.resolve(new wt(this))}get stage(){return this._stage.then(e=>e.after)}get ready(){return this.state.it}to(e){const t=this._stage;return this._stage=e.then(e=>t.then(t=>t[e]())),this}async setup(){await(this._stage=this._stage.then(e=>e.setup()))}async init(){await(this._stage=this._stage.then(e=>e.init()))}async unload(){const e=this._stage;delete this._stage;const t=await e,n=await t.stop();return this._down(),n}}class yt{constructor(e,t=(()=>Promise.resolve())){this.loader=e,this._stop=t}idle(){return Promise.resolve(this)}stop(){return this._stop().then(()=>this.after)}perDep(e){const{deps:t}=this.loader;return Promise.all(t.map(t=>e(t)))}}class wt extends yt{get after(){return"idle"}async setup(){var e;await this.perDep(e=>e.setup());const{bsContext:t,request:{def:n}}=this.loader,s=new ht(t,this.loader),r=s._unloader.supply;return null===(e=n.setup)||void 0===e||e.call(n,s),new bt(this.loader,s,()=>Promise.resolve(r.off()))}init(){return this.setup().then(e=>e.init())}}class bt extends yt{constructor(e,t,n){super(e,n),this._context=t}get after(){return"setup"}setup(){return Promise.resolve(this)}async init(){var e;await this.perDep(e=>e.init());const{request:{def:t}}=this.loader;return null===(e=t.init)||void 0===e||e.call(t,this._context),new _t(this)}}class _t extends yt{get after(){return"init"}constructor(e){super(e.loader,()=>e.stop()),e.loader.state.it=!0}setup(){return Promise.resolve(this)}init(){return Promise.resolve(this)}}class vt{constructor(e,t,n){this._requester=e,this.feature=t,this._revoke=n,this._uses=0,this.def=function(e){let t=se.of(e);if(ce in e){t=se.merge(t,{init(t){t.define(e)}});const{feature:n}=pe.of(e);n&&(t=se.merge(t,n))}return t}(t)}request(e){const t=this._requester,{registry:n}=t,s=[this,"is",this.feature];this._revokeBy(n.provide({a:lt.of(this.feature),is:s}));for(const s of new I(this.def.has)){const r=[this,"has",s];this._revokeBy(n.provide({a:lt.of(s),is:r}));const o=t.request(s,[...e,r]);this._revokeBy(()=>o.unuse())}for(const s of new I(this.def.needs)){const r=[this,"needs",s],o=t.request(s,[...e,r]);this._revokeBy(()=>o.unuse()),this._revokeBy(n.provide({a:lt.of(s),is:r}))}return this._uses=1,this}reuse(e){if(!this._uses)throw new ue(e.map(([{feature:e},t,n])=>[e,t,n]));return++this._uses,this}unuse(){--this._uses||this._revoke()}_revokeBy(e){this._revoke=G(e,this._revoke)}}const xt=new l("feature-requester",{byDefault:U(e=>new Ct(e))});class Ct{constructor(e){this._map=new Map,this.registry=e.get(Se)}static get[f](){return xt}request(e,t=[]){const n=this._map.get(e);if(n)return n.reuse(t);const s=new vt(this,e,()=>this._map.delete(e));return this._map.set(e,s),s.request(t)}}const Dt=Symbol("when-defined");function kt(...e){const s=Se.create(),{bootstrapContext:r,complete:o}=function(e){const s=b(0),r=e.values;const o=new class extends Q{constructor(){super(),this.get=r.get,e.provide({a:Ne,by:B}),e.provide({a:Q,is:this})}whenDefined(e){return function(e,t){if(t.hasOwnProperty(Dt))return t[Dt];const n=j(Promise.resolve(e.whenReady()).then(()=>e.get(He).whenDefined(t)).then(()=>Ie(t)));return t[Dt]=n}(this,e)}whenReady(e){return(this.whenReady=s.read().thru(e=>e?t(this):n()).once().F)(e)}load(e){const t=_(t=>{const n=o.get(Ct).request(e),s=b({status:{feature:e,ready:!1}});this.get(lt.of(e)).to({supply:t.supply,receive(e,t){const n=t;s.it={status:{feature:n.request.feature,ready:n.ready},down:n.down},n.ready||n.init().then(()=>{s.it={status:{feature:n.request.feature,ready:!0},down:n.down}})}}).whenOff(()=>{n.unuse()}),s.read(t)}).share();let n;const s=t.to(({down:e})=>{n=e});return new class extends ae{get down(){return n}read(e){return(this.read=t.tillOff(s).keepThru(e=>e.status).F)(e)}dismiss(e){return s.off(e),n}}}};return{bootstrapContext:o,complete(){s.it=1}}}(s),i=1===e.length?e[0]:(u=e,se.define(class{},{needs:u}));var u;return r.get(Ct).request(i),r.get(lt.of(i)).to(e=>{e.init().then(o)}),r}const Ot=new y("attribute-descriptor"),Tt=Symbol("attribute");function St(e){return[Tt,e]}function Et(e,t=!0){if(!1===t)return s;if(!0===t||"function"==typeof t){const n=St(e),s=!0===t?Rt:t;return(e,t,r)=>s(e,n,t,r)}return(e,n,s)=>Rt(e,t,n,s)}function Rt(e,t,n,s){_e.of(e).updateState(t,n,s)}function jt(e,t,n){let s,r;if("string"==typeof n)s=n,r=Et(s);else{if(n&&n.name)s=n.name;else{if("string"!=typeof t)throw new TypeError(`Attribute name is required as property key is not a string: ${e.constructor.name}.prototype.${String(t)}`);s=t}r=Et(s,n&&n.updateState)}return{name:s,change:r}}const Pt=new l("attribute-registry");class qt{constructor(e){this._context=e}static get[f](){return Pt}get attrs(){if(this._attrs)return this._attrs;const e=new Map;return this._context.get(Ot).forEach(t=>{const{name:n,change:s}=t;e.set(n,G(e.get(n),s))}),this._attrs=e}define(e){const t=this.attrs,n=Array.from(t.keys());n.length&&(Object.defineProperty(e,"observedAttributes",{configurable:!0,enumerable:!0,value:n}),Object.defineProperty(e.prototype,"attributeChangedCallback",{configurable:!0,enumerable:!0,value:function(e,n,s){t.get(e)(_e.of(this).component,s,n)}}))}mount(e){const t=e.element,n=this.attrs,s=Array.from(n.keys());s.length&&new(0,this._context.get(Fe).MutationObserver)(e=>e.forEach(e=>{const s=e.attributeName;return n.get(s)(_e.of(t).component,t.getAttribute(s),e.oldValue)})).observe(t,{attributes:!0,attributeFilter:s,attributeOldValue:!0})}}const At={setup(e){e.perDefinition({as:qt}),e.onDefinition(e=>{e.whenReady(({elementType:t})=>e.get(qt).define(t))}),e.onComponent(e=>{const t=e.mount;t&&e.get(qt).mount(t)})}};class Ft{static get[Z](){return At}}function Bt(e){return De(({type:t,key:n})=>{const s=jt(t.prototype,n,e),{name:r}=s;return{componentDef:{feature:{needs:Ft},setup(e){e.perDefinition({a:Ot,is:s})}},get:e=>_e.of(e).element.getAttribute(r),set(e,t){const{element:n}=_e.of(e);null!=t?n.setAttribute(r,t):n.removeAttribute(r)}}})}function Nt(e){return De(({type:t,get:n,key:s})=>{const{name:r,change:o}=jt(t.prototype,s,e);return{componentDef:{feature:{needs:Ft},setup(e){e.perDefinition({a:Ot,is:{name:r,change(e,t,s){n(e).call(e,t,s),o(e,t,s)}}})}}}})}function Kt(e){return fe({feature:{needs:Ft},setup(t){const n=e=>{"string"==typeof e?t.perDefinition({a:Ot,is:{name:e,change:Et(e)}}):Object.keys(e).forEach(n=>{t.perDefinition({a:Ot,is:{name:n,change:Et(n,e[n])}})})};L(e)?e.forEach(n):n(e)}})}const Mt=new l("component-state");class Vt extends P{static get[f](){return Mt}}const $t=Symbol("state-property");function zt(e){return[$t,e]}function Qt(e,t,n,s){n!==s&&_e.of(e).updateState(t,n,s)}const Ut={setup(e){e.perComponent({a:Vt,by(e){const t=new Vt;return T(e).whenOff(e=>t.done(e)),t}}),e.perComponent({a:we,by:e=>e.update,with:[Vt]})}};class Lt{static get[Z](){return Ut}}function It({updateState:e}={}){return De(({get:t,set:n,key:s})=>{if(!1!==e){const r=n,o=function(e,t=!0){if(!0===t||"function"==typeof t){const n=zt(e),s=!0===t?Qt:t;return(e,t,r)=>s(e,n,t,r)}return(e,n,s)=>{n!==s&&_e.of(e).updateState(t,n,s)}}(s,e);n=(e,n)=>{const s=t(e);r(e,n),o(e,n,s)}}return{componentDef:{feature:{needs:Lt}},get:t,set:n}})}var Wt;class Ht extends k{constructor(e,t,n){super(),this._context=e,this._name=t,this._path=n,this[Wt]=O()}get it(){return this._context.element.getAttribute(this._name)}set it(e){T(this).isOff||(null==e?this._context.element.removeAttribute(this._name):this._context.element.setAttribute(this._name,e))}on(e){return(this.on=this._context.get(Vt).track(this._path).onUpdate().thru((e,n,s)=>t(n,s)).tillOff(this).F)(e)}}function Gt(e,t,n=St(t)){return new Ht(e,t,n)}Wt=S;const Jt=new y("dom-property-descriptor"),Xt=new l("dom-property-registry");class Yt{constructor(e){this._context=e}static get[f](){return Xt}get props(){return this._props?this._props:this._props=new Map(this._context.get(Jt).map(({key:e,descriptor:t})=>[e,t]))}define(e){const t=e.prototype;this.props.forEach((e,n)=>{Object.defineProperty(t,n,e)})}mount(e){const t=e.element;this.props.forEach((e,n)=>{Object.defineProperty(t,n,e)})}}const Zt={setup(e){e.perDefinition({as:Yt}),e.onDefinition(e=>{e.whenReady(({elementType:t})=>e.get(Yt).define(t))}),e.onComponent(e=>{const t=e.mount;t&&e.get(Yt).mount(t)})}};class en{static get[Z](){return Zt}}const tn=Symbol("dom-property");function nn(e){return[tn,e]}function sn(e,t,n,s){n!==s&&_e.of(e).updateState(t,n,s)}function rn(e={}){return De(t=>{const{key:n,get:s}=t;let{set:r}=t;const o=function(e,{propertyKey:t=e.key,configurable:n=e.configurable,enumerable:s=e.enumerable,writable:r=e.writable}){const o=e.key;return{key:t,descriptor:{configurable:n,enumerable:s,get:function(){return _e.of(this).component[o]},set:r?function(e){_e.of(this).component[o]=e}:void 0}}}(t,e);if(!1!==e.updateState){const t=function(e,t=!0){if(!0===t||"function"==typeof t){const n=nn(e),s=!0===t?sn:t;return(e,t,r)=>s(e,n,t,r)}return(e,n,s)=>{n!==s&&_e.of(e).updateState(t,n,s)}}(n,e.updateState),o=r;r=(e,n)=>{const r=s(e);o(e,n),t(e,n,r)}}return{componentDef:{feature:{needs:en},setup(e){e.perDefinition({a:Jt,is:o})}},get:s,set:r}})}class on{constructor(e){this._context=e,this._renders=new Set}renderBy(e,t={}){const{path:n=[]}=t,r=this._context.get(Vt).track(n),o=this._context.get(Ve)();let i=1;const u=r.onUpdate(()=>{this._context.connected&&c()}).needs(this._context).whenOff((function(){2===i&&o(s);i=-1}));this._context.whenConnected(()=>{i&&c()});const a=$();return this._renders.add(h),u.whenOff(()=>this._renders.delete(h));function c(){i=2,o(d)}function h(){a(d)}function d(t){if(i>0)for(i=0;;){const n=e(t);if(n===e||"function"!=typeof n)break;e=n}}}renderNow(){this._renders.forEach(e=>e())}}const un=new l("element-render-ctl",{byDefault:e=>new on(e.get(_e))});function an(e){return De(({get:t})=>({componentDef:{feature:{needs:Lt},define(n){n.whenComponent(n=>{n.whenReady(()=>{const{component:s}=n,r=t(s).bind(s);n.get(un).renderBy(r,e)})})}}}))}const cn=new l("shadow-content-root");class hn extends Event{get shadowRoot(){return this.target.shadowRoot}}const dn=new w("shadow-root-builder"),ln={setup(e){e.provide({a:dn,is:fn})}};class pn{static get[Z](){return ln}}function fn(e,t){const n=function(e,t){const n=e.shadowRoot;if(n)return n;if("attachShadow"in e)return e.attachShadow(t);return}(e.element,t);return n&&(n[be]=e,e.whenConnected(()=>e.dispatchEvent(new hn("wesib:shadowAttached",{bubbles:!0})))),n}const mn={mode:"open"};function gn(e=mn){return fe({setup(t){t.perComponent({a:cn,by:t=>t.get(dn)(t,e)}),t.perComponent({a:ye,by:e=>e.get(cn,{or:null})})},feature:{needs:pn}})}const yn=new K("https://wesib.github.io/ns","b","wesib");export{Nt as A,Fe as B,fe as C,rn as D,un as E,re as F,an as R,It as S,yn as W,U as a,kt as b,gn as c,nn as d,Kt as e,Bt as f,De as g,_e as h,pe as i,Ne as j,Z as k,Ve as l,I as m,Q as n,Lt as o,Be as p,be as q,Qe as r,J as s,Gt as t,Ue as u,Vt as v,G as w,zt as x};//# sourceMappingURL=wesib.2306ec70.js.map
