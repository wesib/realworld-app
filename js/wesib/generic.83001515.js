import{n as e,d as t,g as n,c as s,b as r,v as o,h as i,f as a}from"../proc7ts/call-thru.86e41caf.js";import{m as c,i as u,a as h,c as l,g as d,f,b as p,h as g}from"../proc7ts/a-iterable.5d8defb1.js";import{b as m,C as _,a as w,c as b,F as y,d as v,S as x}from"../proc7ts/context-values.3c0d9224.js";import{j as k,i as O,b as S,l as C,a as R,f as U,m as A,h as j,t as L,O as D,A as E,D as F,E as N,e as M,r as T,o as P,s as q,d as I,V as z,u as K,q as $,p as B,g as W}from"../proc7ts/fun-events.6756e60e.js";import{c as H,h as V}from"../proc7ts/namespace-aliaser.1d67b636.js";import{C as J,l as G,m as Q,j as X,n as Y,o as Z,B as ee,h as te,p as ne,q as se,r as re,s as oe,W as ie,a as ae,u as ce,v as ue,w as he,d as le,x as de,g as fe}from"./wesib.21207b5a.js";import{l as pe,m as ge,n as me,o as _e,p as we}from"../proc7ts/input-aspects.56cb8264.js";function be({$:e,n:t,t:n,v:s,x:r=[],p:o={},pl:i=[]}){return{$:e,n:t,t:n,v:s,x:r,p:o,pl:i}}function ye({p:e,pl:t},n){const s=n.n||n.v,r=e[s];(!r||!r.n&&n.n)&&(e[s]=n),t.push(n)}function ve(e){return t=>{const n=t.s[t.i];return t.d=e.delimiterOf(n),n}}const xe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), \d\d (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) \d\d\d\d \d\d:\d\d:\d\d GMT/;function ke(e,t){return e.s=e.s.substring(e.i),e.i=0,!!xe.test(e.s)&&(t(e.s.substring(e.i,e.i+=29)),!0)}const Oe=()=>!1;function Se(e,{named:t=!0,tagged:n=!0,extra:s=!0,next:r=ve(e)}={}){const o=function(e){return(t,n)=>{let s="";for(++t.i;t.i<t.s.length;++t.i){const r=t.s[t.i];if("\\"===r){const e=t.s[++t.i];s+=e||r}else{if(65536&e.delimiterOf(r))return++t.i,void n(s);s+=r}}n(s)}}(e),i=function(e){return(t,n)=>{if(!(262144&e.delimiterOf(t.s[t.i])))return!1;let s="";for(++t.i;t.i<t.s.length;){const n=t.s[t.i++];if(524288&e.delimiterOf(n))break;s+=n}return n(s),!0}}(e),a=s?Se(e,{next:r,tagged:!1,named:!1,extra:!1}):Oe;return(e,s)=>{let c,u,h,l="",d="raw";for(;e.i<e.s.length;){const s=r(e);if(e.d){if(12&e.d)break;if(null==u){if(16&e.d){u=l?"":s,++e.i;continue}if(65536&e.d){!n&&l||o(e,e=>{l?(d="tagged-string",c=l):d="quoted-string",l="",u=e});break}if(!l&&i(e,e=>{d="angle-bracketed-string",u=e}))break;u=l,l=""}else{if(65536&e.d){!n&&u||o(e,e=>{u?(d="tagged-string",c=u):d="quoted-string",u=e});break}if(!u&&i(e,e=>{d="angle-bracketed-string",u=e}))break}}if(null==u){if(!l&&ke(e,e=>u=e)){d="date-time";break}t?l+=s:u=s}else{if(!u&&ke(e,e=>u=e)){d="date-time";break}u+=s}++e.i}if(null==u){if(!l)return!1;h=be({$:d,v:l})}else h=be({$:d,n:l||void 0,t:c,v:u});for(;a(e,e=>h.x.push(e)););return s(h),!0}}function Ce(e){return t=>{let n=t.s[t.i];return"\\"!==n?(t.d=e.delimiterOf(n),n):(++t.i,t.i<t.s.length?(n=t.s[t.i],t.d=e.delimiterOf(n)?1:0):t.d=1,n)}}function Re(e){return t=>{const n=t.i;do{const n=t.s[t.i];if(!(2&e.delimiterOf(n)))break;t.i++}while(t.i<t.s.length);return t.i!==n}}function Ue(e,t={}){const n=Re(e),s=Se(e,Object.assign(Object.assign({},t),{tagged:!1}));return(t,r)=>!!(8&e.delimiterOf(t.s[t.i]))&&(++t.i,n(t),s(t,r))}const Ae={" ":7,"\t":7,",":5,";":9,'"':65569,"\\":33,"<":262145,">":524289,"=":17,"(":1,")":1,"/":1,":":1,"?":1,"@":1,"[":1,"]":1,"{":1,"}":1};function je({delimit:e}={}){const t=e?Object.assign(Object.assign({},Ae),e):Ae;return{delimiterOf:e=>t[e]||(e>="\0"&&e<=" "||"\x7f"===e?1:0)}}const Le=je(),De=je({delimit:{":":17,"(":131105,")":37," ":3,"\t":3,"=":1,",":1}});function Ee(e){const t=e?je(e):Le,n=function(e){const t=Re(e);return n=>!!(4&e.delimiterOf(n.s[n.i]))&&(n.i++,t(n),!0)}(t),s=Ue(t),r=Se(t),o=(null==e?void 0:e.comments)?function(e){const t=Re(e),n={next:Ce(e)},s=Se(e,n),r=Ue(e,n);return(n,o)=>{if(!(131072&e.delimiterOf(n.s[n.i])))return!1;let i;for(++n.i;t(n)||r(n,e=>{i||(i=be({$:"raw",v:""})),ye(i,e)})||s(n,e=>i=e););return++n.i,o(i||be({$:"raw",v:""})),!0}}(De):Oe;return e=>{const t=[],i={i:0,s:e};for(;i.i<i.s.length&&(n(i)||s(i,e=>{t.length||t.push(be({$:"raw",v:""})),ye(t[t.length-1],e)})||o(i,e=>t.push(e))||r(i,e=>t.push(e))););return t}}const Fe=Ee();function Ne(e){if(!e)return'""';let t,n=!1;for(let s=0;s<e.length;++s){const r=e[s],o=Le.delimiterOf(r);o?(32&o&&(t||(t=e.substring(0,s)),t+="\\"+r),n=!0):t&&(t+=r)}return n?`"${t||e}"`:e}class Me extends v{constructor(e){super(e),this.upKey=this.createUpKey(e=>e.seed.keepThru((...t)=>{if(t.length)return s(function(e){return(t,n)=>{const s=(n,r)=>{const o=e[n];return o?q(o((e=r)=>s(n+1,e),r)):t(r)};return s(0,n)}}(t));const n=()=>R(Te);return S(e.byDefault(n)||n())}))}grow(e){let t;return e.context.get(this.upKey,"or"in e?{or:null!=e.or?R(e.or):e.or}:void 0).to(e=>t=e),(e,n)=>t(e,n)}}function Te(e,t){return e(t)}const Pe=new Me("http-fetch-agent"),qe={};const Ie=new y("http-fetch",{byDefault:ae((function(e){const t=e.get(ee),n=e.get(Pe);return(e,t)=>n(s,new Request(e,t));function s(e){return M(n=>{const s=new N;let r;if("AbortController"in t){const o=new t.AbortController,{signal:i}=o;r=j(e=>{e===qe&&o.abort()}),n.supply.whenOff(()=>r.off(qe)).needs(r),s.on({supply:r,receive(e,t){n.receive(e,t)}});const a=e.signal;a&&(new F(a).on("abort").once(()=>o.abort()),a.aborted&&o.abort()),e=new Request(e,{signal:i})}else r=s.on(n);t.fetch(e).then(e=>{s.send(e),r.off()}).catch(e=>r.off(e))})}}))});const ze=new w("hierarchy-root",{byDefault:e=>{const t=e.get(se);return new F(t).on("wesib:component").to(({context:e})=>e.get($e).issue()),L()}}),Ke=new w("hierarchy-updates",{byDefault:e=>new $e(e.get(te))});class $e{constructor(e){const t=new N,n=e.get(ne).get(ze);this.on=t.on(),this.send=()=>t.send(e),this.issue=()=>{const t=Be(e);t?t[0].get($e).send():n.it=e}}static get[_](){return Ke}}function Be(e){const t=e.get(ne).get(se);let n=e.element,s=!0;if(n!==t)for(;;){const e=n.parentNode;if(!e)return;const r=e[re];if(r)return[r,s];if(e===t)return;s=!1,n=e}}const We=new w("hierarchy-context",{byDefault:e=>new Ve(e.get(te))});class He extends m{static get[_](){return We}get[k](){return O(this.context)}}class Ve extends He{constructor(n){super(),this.context=n;const s=this._parent=L();n.whenConnected(t).cuts(s);const r=this._registry=(o=this.up(),new b(t=>o.keepThru(n=>n?S(n.get(t)):e())));var o;this.get=r.newValues().get}provide(e){const t=this._registry.provide(e);return O(this).whenOff(t),t}up(e){return(this.up=A(e=>{const{supply:t}=e;t.needs(this);const n=L();n.by(this._parent),t.cuts(n);const s=j().needs(t),r=j().needs(t),o=()=>{const e=Be(this.context);if(e){const[t,o]=e;n.it=t.get(He),s.off(),o&&r.off()}else n.it=void 0};this.context.get(ne).get(ze).read({supply:s,receive:()=>this.context.connected&&o()}),n.read().tillOff(r).consume(e=>e&&e.context.get($e).on.to(o)),n.read(e),this.context.whenConnected({supply:j().needs(t),receive:o})}).share().F)(e)}inside(e){return this._parent.it=e&&e.get(He),this}}const Je=new w("component-node");class Ge{[D](){return this.onUpdate()}[E](){return this.read()}}const Qe={subtree:!0};function Xe(e,t,r,o,{deep:i,all:f}){const p=new N,m=i?Qe:void 0;let _,w,b=new Set;const y=i?Ye:h;"string"==typeof r?w=r:e.whenDefined(r).then(({elementDef:{name:t}})=>{if(_=void 0,t&&(w=V.name(t,e.get(X)),p.size)){const e=x();if(e.size){const t=Array.from(l(c(e,e=>o(e)),n));t.length&&p.send(t,[])}}}),f||t.addEventListener("wesib:component",e=>{const t=e.target;if(b.has(t)){const e=o(t);p.send([e],[])}});class v extends Ge{onUpdate(n){const s=e.get(ue)(k);return(this.onUpdate=M(e=>{const n=!p.size,r=p.on(e);return n&&(x(),s.observe(t,m)),r.whenOff(()=>{p.size||(s.disconnect(),_=void 0,b.clear())})}).F)(n)}read(e){return(this.read=I(this.onUpdate().thru(()=>this),a(this)).F)(e)}track(e){const t=this.onUpdate();return(this.track=A(e=>{const n=new N;n.on(e),n.send(Array.from(this),[]),t.to(e)}).F)(e)}first(e){return(this.first=U(this.read()).keepThru(e=>s(g(e))).F)(e)}[Symbol.iterator](){return d(_||(_=l(c(p.size?b:x(),e=>o(e)),n)))}}return new v;function x(){_=void 0;const e=function(){const e=w;if(!e)return new Set;if(i)return new Set(h(t.querySelectorAll(e)));return new Set(l(h(t.children),t=>t.matches(e)))}();return p.size&&(b=e),e}function k(e){const t=[],s=[];e.forEach(e=>{u(l(c(y(e.removedNodes),S),n),e=>s.push(e)),u(l(c(y(e.addedNodes),O),n),e=>t.push(e))}),(t.length||s.length)&&p.send(t,s)}function O(e){if(ce(e))return w&&e.matches(w)&&!b.has(e)?(b.add(e),o(e)):void 0}function S(e){if(ce(e)&&b.delete(e))return o(e,!0)}}function Ye(e){return f(h(e),e=>[e,...Ye(e.childNodes)])}class Ze{constructor(e,t){this._bs=e,this.element=t,this._emitters=new Map}get observer(){if(this._observer)return this._observer;const e=this._bs.get(ee).MutationObserver;return this._observer=new e(e=>this._update(e))}observe(e,t){const n=this,s=this.observer,r=this._emitter(e),o=T(t),i=r.on({supply:j(()=>{this._emitters.delete(e),s.disconnect(),this._emitters.size?a():this._observer=void 0}).needs(o.supply),receive:(e,t,n)=>o.receive(e,t,n)});return s.disconnect(),a(),i;function a(){n._update(s.takeRecords()),s.observe(n.element,{attributes:!0,attributeOldValue:!0,attributeFilter:Array.from(n._emitters.keys())})}}_update(e){e.forEach(e=>{const t=e.attributeName,n=this._emitters.get(t);n&&n.send(this.element.getAttribute(t),e.oldValue)})}_emitter(e){const t=new N;return this._emitters.set(e,t),t}}class et extends z{constructor(e,t){super(),this._observer=e,this._name=t,this._updates=new N}get[k](){return O(this._updates)}get it(){return this._observer.element.getAttribute(this._name)}set it(e){null!=e?this._observer.element.setAttribute(this._name,e):this._observer.element.removeAttribute(this._name)}on(e){let t=$();return(this.on=M(e=>{this._updates.size||(t=this._observer.observe(this._name,(e,t)=>this._updates.send(e,t))),e.supply.needs(t),this._updates.on(e).whenOff(e=>{this._updates.size||t.off(e)})}).F)(e)}}class tt{constructor(e,t){this._attrs=new Map,this._observer=new Ze(e,t)}get(e){const t=this._attrs.get(e);if(t)return t;const n=new et(this._observer,e);return this._attrs.set(e,n),n}}class nt extends z{constructor(e,t){super(),this._element=e,this._key=t,this._updates=new N}get[k](){return O(this._updates)}get it(){return this._element[this._key]}set it(e){this._element[this._key]=e}on(e){return(this.on=this._updates.on().F)(e)}bind(e){e.get(he).track(le(this._key)).onUpdate().to({supply:O(this),receive:(e,t,n,s)=>this._updates.send(n,s)})}}class st{constructor(e){this._element=e,this._props=new Map}bind(e){this._context=e,this._props.forEach(t=>t.bind(e))}get(e){const t=this._props.get(e);if(t)return t;const n=new nt(this._element,e);return this._context&&n.bind(this._context),this._props.set(e,n),n}}const rt=Symbol("element-node");class ot{constructor(e,t){this._bs=e,this.element=t,this._attrs=new tt(e,t),this._props=new st(t),t[rt]=this;const n=t[re];n?this._bind(n):t.addEventListener("wesib:component",e=>this._bind(e.context))}get context(){return this.element[re]}get parent(){const e=this.element.parentNode;return e&&it(this._bs,e)}select(e,t){return function(e,t,n,s={}){if(s.all)return Xe(e,t,n,(t,n)=>it(e,t,n),s);const r=e.get(oe);return Xe(e,t,n,(t,n)=>r(t)&&it(e,t,n),s)}(this._bs,this.element,e,t)}attribute(e){return this._attrs.get(e)}property(e){return this._props.get(e)}_bind(e){this._props.bind(e)}}function it(e,t,n){const s=t[rt];return s||n?s:new ot(e,t)}const at={needs:Z,setup(e){e.perComponent({a:Je,by:e=>it(e.get(ne),e.element)})}};class ct{static get[G](){return at}}function ut(e){return new URL(e.hash.substring(1),e.origin)}function ht(e,t){if(t.origin!==e.origin||t.username)return new URL("#"+t,e);const{pathname:n,search:s,hash:r}=t,o=new URL("",e);return o.hash=s||r||n.length>1?n+s+r:s+r,o}const lt=Symbol("page-param");class dt{get[lt](){return this}byDefault(e,t){}}class ft extends dt{create(e,t){let n;const s={get:()=>n,put(t){n="string"==typeof t?new URL(t,e.url.origin):t}};return s.put(t),s}}const pt=new ft;class gt extends dt{create(e,t){const n={get:()=>e.get(pt)||ut(e.url),put(t){e.put(pt,t)}};return n.put(t),n}byDefault(e){return this.create(e,null)}}const mt=new gt;class _t extends v{constructor(e){super(e),this.upKey=this.createUpKey(e=>{const{document:t}=e.context.get(ee);return e.seed.keepThru((...n)=>{if(n.length)return s((function(e,s,r,o){return function o(i,a){const c=n[i];if(!c)return e(a);c(({url:e=a.url,title:n=a.title,data:s=a.data}=a)=>o(i+1,{url:new URL(String(e),t.baseURI),title:n,data:s,get visited(){return a.visited},get current(){return a.current},get:e=>a.get(e),put(e,t){a.put(e,t)}}),s,r,a)}(0,o)}));const r=()=>R(wt);return S(e.byDefault(r)||r())})})}grow(e){let t;return e.context.get(this.upKey,"or"in e?{or:null!=e.or?R(e.or):e.or}:void 0).to(e=>t=e),(e,n,s,r)=>t(e,n,s,r)}}function wt(e,t,n,s){e(s)}const bt=new _t("navigation-agent"),yt=new w("navigation");class vt{static get[_](){return yt}[D](){return this.on()}[E](){return this.read()}back(){this.go(-1)}forward(){this.go(1)}reload(){this.go()}}class xt extends m{}const kt=new w("nav-history",{byDefault:ae(e=>new St(e))});function Ot(e){return null==e||"object"!=typeof e?{data:e}:e["wesib:navigation:data"]}class St{constructor(e){this._context=e,this._entries=new Map,this._lastId=0;const t=e.get(ee);this._document=t.document,this._location=t.location,this._history=t.history,this._uid=btoa(String(Math.random()))}static get[_](){return kt}init(){const{data:e}=Ot(this._history.state),t=this.newEntry({url:new URL(this._location.href),data:e,title:this._document.title});return this._entries.set(t.id,t),t.schedule(()=>{t.enter("init"),this._history.replaceState(this._historyState(t),"")}),t}newEntry(e){return new Ct(this._context,++this._lastId,e)}open(e,t){const{page:{title:n="",url:s}}=e;this._history.pushState(this._historyState(e),n,s.href),this._enter("open",e,t)}_enter(e,t,n){const s=n.it;this._entries.set(t.id,t);try{for(let e=s.next;e;e=e.next)this._forget(e)}finally{t.prev=s,s.next=t,t.schedule(()=>{try{s.leave()}finally{t.enter(e)}}),n.it=t}}replace(e,t){const n=t.it,{page:{title:s="",url:r}}=e;this._history.replaceState(this._historyState(e),s,r.href),this._entries.set(e.id,e);const o=n.prev;o&&(e.prev=o,o.next=e),e.schedule(()=>{try{n.leave()}finally{try{this._forget(n)}finally{e.enter("replace")}}}),t.it=e}popState(e,t){const{state:n}=e;if(null==n)return null==this._history.state?this._changeHash(t):void 0;const s=t.it,{uid:r,data:o,id:i}=Ot(n);let a;const c=r===this._uid&&null!=i?this._entries.get(i):void 0;return c?a=c:(a=this.newEntry({url:new URL(this._location.href),data:o,title:this._document.title}),s.transfer(a,"return"),this._entries.set(a.id,a),this._history.replaceState(this._historyState(a),"")),a.schedule(()=>{try{s.leave()}finally{a.enter("return")}}),t.it=a,a}hashChange(e){if(null==this._history.state)return this._changeHash(e)}update(e,t){const n=e.it,s=new Ct(this._context,++this._lastId,Object.assign(Object.assign({},n.page),{url:t}),n);return this._entries.set(s.id,s),this._history.replaceState(this._historyState(s),"",t.href),this._entries.delete(n.id),e.it=s}_changeHash(e){const t=e.it,n=this.newEntry({url:new URL(this._location.href),data:null,title:this._document.title});try{t.transfer(n,"enter")}finally{this._history.replaceState(this._historyState(n),""),this._enter("enter",n,e)}return n}_forget(e){this._entries.delete(e.id),e.forget()}_historyState({id:e,page:{data:t}}){return{"wesib:navigation:data":{uid:this._uid,id:e,data:t}}}}class Ct{constructor(e,n,s,r){this._bsContext=e,this.id=n,this._status=0,this._update=t,this._params=r?r._params:new Map;const o=this;this.page={get url(){return s.url},get title(){return s.title},get data(){return s.data},get visited(){return!!o._status},get current(){return 2===o._status},get:e=>o.get(e),put(e,t){o.put(e,t)}}}get(e){const t=e[lt],n=this._params.get(t);if(n)return n.get();const s=t.byDefault(this.page,this._newContext());return s&&this._init(t,s)}put(e,t){const n=e[lt],s=this._params.get(n);return s?(s.put(t),s.get()):this._init(n,n.create(this.page,t,this._newContext()))}_newContext(){const e=new b(this._bsContext);return new class extends xt{constructor(){super(...arguments),this.get=e.newValues().get}}}_init(e,t){return this._params.set(e,t),this.page.current&&t.enter&&t.enter(this.page,"init"),t.get()}transfer(e,t){u(this._params.entries(),([n,s])=>{if(s.transfer){const r=s.transfer(e.page,t);r&&e._params.set(n,r)}})}stay(e){u(this._params.values(),t=>t.stay&&t.stay(e))}enter(e){this._status=2,u(this._params.values(),t=>t.enter&&t.enter(this.page,e))}leave(){this._status=1,u(this._params.values(),e=>e.leave&&e.leave())}forget(){u(this._params.values(),e=>e.forget&&e.forget()),this._params.clear()}schedule(e){this._update=e}apply(){const e=this._update;this._update=t,e()}}class Rt extends Event{constructor(e,t){super(e,Object.assign(Object.assign({},t),{cancelable:!1})),this.when=t.when,this.to=t.to}}class Ut extends Event{constructor(e,t){super(e,Object.assign(Object.assign({},t),{cancelable:!0})),this.when=t.when,this.from=t.from,this.to=t.to}}class At extends Event{constructor(e,t){super(e,Object.assign(Object.assign({},t),{cancelable:!0})),this.from=t.from,this.to=t.to,this.reason=t.reason}get when(){return"stay"}}function jt(e){const n=e.get(ee),{document:s,history:r}=n,o=new F(n),i=e.get(St),a=e.get(bt),c=L(i.init());c.read(e=>e.apply());let u=Promise.resolve();o.on("popstate").to(e=>{const t=i.popState(e,c);t&&o.dispatch(new Rt("wesib:enterPage",{when:null!=e.state?"return":"enter",to:t.page}))}),o.on("hashchange").to(()=>{const e=i.hashChange(c);e&&o.dispatch(new Rt("wesib:enterPage",{when:"enter",to:e.page}))});return new class extends vt{get page(){return c.it.page}get length(){return r.length}onEnter(e){return(this.onEnter=o.on("wesib:enterPage").F)(e)}onLeave(e){return(this.onLeave=o.on("wesib:leavePage").F)(e)}onStay(e){return(this.onStay=o.on("wesib:stayOnPage").F)(e)}on(e){return(this.on=K(this.onEnter(),this.onLeave(),this.onStay()).F)(e)}read(e){return(this.read=c.read().keepThru(e=>e.page).F)(e)}go(e){r.go(e)}open(e){return d("pre-open","open",e)}replace(e){return d("pre-replace","replace",e)}update(e){return i.update(c,h(e)).page}with(e,t){return function e(t){return{with:(n,s)=>e(de(t,e=>e.put(n,s))),open:e=>d("pre-open","open",e,t),replace:e=>d("pre-replace","replace",e,t),pretend(e,n=((e,t)=>t)){let s;"function"==typeof e?(n=e,s=void 0):s=e;const r=l(s),o=c.it,i=f("pretend",o,r,t);try{return p("pretend",o,r,i)?n(o.page,i.page):void 0}finally{i.stay(c.it.page)}}}}(n=>n.put(e,t))}};function h(e){return"string"==typeof e?new URL(e,s.baseURI):e||c.it.page.url}function l(e){return null==e||"string"==typeof e||e instanceof URL?{url:h(e)}:e.url instanceof URL?e:Object.assign(Object.assign({},e),{url:h(e.url)})}function d(e,n,s,r=t){const a=l(s),h=u=u.then(d,d);return h;function d(){let t=void 0;try{const s=function(){if(u!==h)return g();const t=c.it,n=f(e,t,a,r),s=new Ut("wesib:leavePage",{when:e,from:t.page,to:n.page});if(!o.dispatch(s)||u!==h||!p(e,t,a,n))return g(n);return n}();return s?(t=s,i[n](t,c),o.dispatch(new Rt("wesib:enterPage",{when:n,to:t.page})),t.page):s}catch(e){throw g(t,e),e}}function g(e,t){return e&&e.stay(c.it.page),o.dispatch(new At("wesib:stayOnPage",{from:c.it.page,to:a,reason:t})),null}}function f(e,t,n,s){const r=i.newEntry(n);try{t.transfer(r,e),s(r.page)}catch(e){throw r.stay(c.it.page),e}return r}function p(e,t,n,s){let r=!1;return a(({url:e,data:t,title:s})=>{r=!0,n.url=e,n.data=t,n.title=s},e,t.page,s.page),r}}const Lt={setup(e){e.provide({a:vt,by:jt})}};class Dt{static get[G](){return Lt}}const Et={needs:Dt,setup(e){e.provide({a:bt,is:Nt})}};class Ft{static get[G](){return Et}}function Nt(e,t,n,s){const r=s.get(pt);r?e({url:ht(s.url,r)}):e()}function Mt(n={}){const{select:s="a",pick:r={all:!0,deep:!0}}=n;return J({feature:{needs:[ct,Dt]},define(o){o.whenComponent(o=>{const i=function(e,n){const s=e.get(Q),{active:r=zt}=n,o=H.name(r,e.get(X)),i=n.activate?n.activate.bind(n):t;return e=>{const{element:t}=e.node,n=t[It]||(t[It]=s({node:t})),r=t=>{n(()=>((e,{node:t})=>{const n=t.element,{classList:s}=n;e?s.add(o):s.remove(o)})(t,e)),i(t,e)};let a;return r(!0),{supply(){const e=a=j(()=>{a===e&&r(!1)});return e}}}}(o,n),a=function(t){if(!t.weigh)return Tt;return n=>{const s=t.weigh(n);if("number"==typeof s)return R(n.node,s);let r=U(s).keepThru_(t=>e(n.node,t));return A(e=>{r.to({supply:j().needs(e.supply).whenOff(()=>{r=R(n.node,0),r.to(e)}),receive:e.receive.bind(e)})})}}(n),u=o.get(vt),h=o.get(Je);o.whenConnected(()=>{let e=new Map;u.read().tillOff(o).consume(t=>h.select(s,r).read().keepThru_(e=>S(C(...c(e,e=>a({node:e,context:o,page:t}))))).consume((...n)=>{const s=function(e){let t=0,n=[];return e.forEach(([e,s])=>{s>t?(t=s,n=[e]):s===t&&n.push(e)}),n}(n),r=new Map,a=j();return s.forEach(n=>{let s;const c=e.get(n);c?(r.set(n,c),s=c):(s=i({node:n,context:o,page:t}),r.set(n,s)),s.supply().needs(a)}),e=r,a}))})})}})}function Tt({node:e,page:t}){const n=e.element,s=n.getAttribute("href");if(null==s)return R(e,-1);const r=new URL(s,n.ownerDocument.baseURI);return R(e,function e(t,n){if(t.origin!==n.origin)return-1;const s=Pt(t),r=Pt(n);if(t.hash){if(s!==r)return-1;const o=qt(t,n);return o<0||qt(n,t)<0?-1:t.pathname.length+o+e(ut(t),ut(n))}const o=qt(t,n);if(o)return o<0||s!==r?-1:t.pathname.length+o;if(!r.startsWith(s))return-1;return t.pathname.length}(r,t.url))}function Pt(e){const t=e.pathname;return t.endsWith("/")?t:t+"/"}function qt({searchParams:e},{searchParams:t}){let n=0;return e.forEach((s,r)=>{if(!function(e){return e.startsWith("__")&&e.endsWith("__")}(r)){const s=new Set(t.getAll(r));n>=0&&(e.getAll(r).every(e=>s.has(e))?n+=1:n=-1)}}),n}const It=Symbol("nav-link-render-schedule"),zt=["active",ie];function Kt(e={}){const t=e.handle?e.handle.bind(e):function(e){const t=e.href?e.href.bind(e):$t;return({event:e,page:n,navigation:s})=>{const r=t(e);if(null==r)return;const o=e.target,i=n.url,a=new URL(r,o.ownerDocument.baseURI);a.origin===i.origin&&(e.preventDefault(),i.href!==a.href&&s.open(r))}}(e),n=new Y(e.event||"click");return J({feature:{needs:Dt},define(e){e.whenComponent(e=>{e.whenConnected(()=>{const s=e.get(vt);for(const r of n)e.on(r).to(n=>{s.read().once(r=>t({event:n,page:r,context:e,navigation:s}))})})})}})}function $t(e){return e.target.getAttribute("href")}function Bt(e,t,n,s=Wt){let r;"function"==typeof n?(s=n,r=null):r=n||null;const o=t.ownerDocument;if(ce(e)){const n=o.createElement(e.tagName.toLowerCase());return e.getAttributeNames().forEach(t=>n.setAttribute(t,e.getAttribute(t))),s(e,n),t.insertBefore(n,r),n}const i=o.importNode(e,!1);return t.insertBefore(i,r),i}function Wt(e,t){u(h(e.childNodes),e=>Bt(e,t))}function Ht(t){let n;return s=>{const o=function(e){return new URL("",e.url).href}(s);if(n){if(n.url===o)return n.on;n.sup.off()}let i;const a=j().whenOff(()=>{n=void 0,i=void 0}),c=M(n=>{if(!i){const n=t(s),o=L(),c=n.to(e=>{o.it=e}).whenOff(e=>{null!=e&&a.off(e)});a.cuts(c).cuts(o),i={on:o.read().thru_(t=>t?e(t):r()),num:0}}const o=i;return++o.num,o.on.tillOff(a).to(n).whenOff(e=>{--o.num||Promise.resolve().then(()=>{o.num||o!==i||a.off(e)})})});return n={url:o,on:c,sup:a},c}}class Vt extends Error{}const Jt=new class extends dt{create(e,n){return{get:()=>n,put:t}}};class Gt{constructor(e,t){this._navigation=e,this._loader=t,this._map=new Map}get fragments(){const e=[];for(const t of this){if(!t.fragment)return[];e.push(t.fragment)}return e}[Symbol.iterator](){return d(f(this._map.values()))}handle(){const e=this,t=j();let n=$();return{get(){},put(t){e._add(t)},transfer(t,n){if("pretend"===n)return;const s=e._transfer();return t.put(Jt,s),s.handle()},enter(s,r){if("init"===r)return;n=j().needs(t);const o=M(t=>{const r=new N,o=r.on(t);return e._loader(s).tillOff(n).to(e=>r.send(e)).whenOff(e=>{void 0===e||e instanceof Vt||r.send({ok:!1,page:s,error:e})}),o}).share();u(e,({fragment:e,receiver:t})=>function(e,t){return t?e.thru_(e=>e.ok?Object.assign(Object.assign({},e),{fragment:(null!=t.tag?e.document.getElementsByTagName(t.tag)[0]:e.document.getElementById(t.id))||void 0}):e):e}(o,e).to({supply:j().needs(t.supply),receive(e,n){t.receive(e,n)}}))},leave(){n.off(new Vt("page left"))},stay(){t.off(new Vt("navigation cancelled"))},forget(){t.off(new Vt("page forgotten"))}}}_add(e){const t=Object.assign(Object.assign({},e),{receiver:T(e.receiver)}),{supply:n}=t.receiver,s=this._map.get(n);s?s.push(t):(this._map.set(n,[t]),n.whenOff(()=>this._map.delete(n)))}_transfer(){const e=new Gt(this._navigation,this._loader);for(const[t,n]of this._map.entries())e._map.set(t,Array.from(n));return e}}const Qt=new Me("page-load-agent"),Xt=new y("page-load-url",{byDefault:o(t)}),Yt=new w("page-loader",{byDefault:ae((function(e){const t=e.get(ee),n=e.get(Ie),s=e.get(Xt),r=e.get(Qt),o=new t.DOMParser;return e=>{const t=new URL(e.url.href);s(t);const a=new Request(t.href,{mode:"same-origin",credentials:"same-origin",headers:new Headers({Accept:"text/html"})});return M(e=>r(c,a).to(e));function c(s){return function(e,t){var n;const s=null===(n=e.get(Jt))||void 0===n?void 0:n.fragments;s&&s.length&&t.headers.set("Accept-Fragment",p(s,(e,t)=>(e?e+", ":"")+(null!=t.tag?"tag="+Ne(t.tag):"id="+Ne(t.id)),""))}(e,s),M(r=>{const a=new B;a.on(r),a.send({page:e}),P(n(s).thru_(e=>Promise.all([e,e.text()]))).thru_((...e)=>i(e),([n,s])=>{if(!n.ok)return{ok:!1,page:e,response:n,error:n.status};try{return{ok:!0,page:e,response:n,document:Zt(o,t,n,s)}}catch(t){return{ok:!1,page:e,response:n,error:t}}}).to(r)})}}}))});function Zt(e,t,n,s){const r=e.parseFromString(s,Fe(n.headers.get("Content-Type")||"text/html")[0].v);if(r.head){const e=r.head.querySelector("base");if(e)e.href=new URL(e.getAttribute("href"),t).href;else{const e=r.createElement("base");e.href=t.href,r.head.appendChild(e)}}return r}class en extends dt{create(e,t,n){const s=new Gt(n.get(vt),Ht(n.get(Yt))),r=s.handle();return e.put(Jt,s),r.put(t),r}}const tn=new en,nn=new w("page-cache-buster",{byDefault:ae(e=>new sn(e))});class sn{constructor(e){const t=rn(e.get(ee).document);if(t){const n=e.get(vt);this.urlModifier=R(e=>e.searchParams.set("__wesib_app_rev__",t)),this.agent=R((e,s)=>e(new Request(s.url,s)).thru_(e=>{if(e.ok){const s=rn(e.document);if(s&&s!==t){const t=new URL(e.page.url.href);t.searchParams.set("__wesib_app_rev__",s),n.update(t),n.reload()}}return e}))}else this.urlModifier=R(),this.agent=R()}static get[_](){return nn}}function rn(e){var t;return null===(t=e.querySelector("meta[name=wesib-app-rev]"))||void 0===t?void 0:t.getAttribute("content")}function on(e){const t=e.get(ee).document;return e=>e().thru_(e=>{if(e.ok){const n=new Set(c(an(t,h(t.scripts)),([e])=>e));u(l(an(e.document,h(e.document.querySelectorAll("script"))),([e])=>!n.has(e)),([e,s])=>{Bt(s,t.head,(t,n)=>n.src=e),n.add(e)})}return e})}function an(e,t){return c(l(t,e=>!!e.src),t=>[new URL(t.src,e.baseURI).href,t])}function cn(e){const t=e.get(ee).document;return e=>e().thru_(e=>{if(!e.ok)return e;const n=e.document.querySelectorAll("link[rel=stylesheet]");if(!n.length)return e;let s=t.head,r=null;const o=t.querySelectorAll("link[rel=stylesheet]"),i=new Map,a=o.item(0);return a&&(s=a.parentNode,r=a,u(h(o),e=>i.set(new URL(e.href,t.baseURI).href,e))),u(h(n),e=>{const n=new URL(e.href,t.baseURI).href,o=i.get(n);o?(g(i.keys())===n?(s=o.parentNode,r=o.nextSibling):s.insertBefore(o,r),i.delete(n)):Bt(e,s,r,(e,t)=>t.href=n)}),u(i.values(),e=>e.parentNode.removeChild(e)),e})}function un(e){const t=e.get(ee).document;return e=>e().thru_(e=>{if(e.ok){const n=e.document.getElementsByTagName("title").item(0);n&&n.textContent&&(t.title=n.textContent)}return e})}const hn={needs:Dt,setup(e){e.provide({a:Xt,by:e=>e.urlModifier,with:[sn]}),e.provide({a:Qt,by:e=>e.agent,with:[sn]}),e.provide({a:Qt,by:on}),e.provide({a:Qt,by:cn}),e.provide({a:Qt,by:un})}};class ln{static get[G](){return hn}}function dn(e={}){const n=e.onResponse?e.onResponse.bind(e):t,s=e.contentKey?e.contentKey.bind(e):fn;return J({feature:{needs:[ln,Z]},define(t){t.whenComponent(t=>{const r=t.get(ee).document,o=t.get(Q)(),i=t.get(vt);let a=s(i.page);const c=()=>{const{fragment:n}=e;if(n)return n;const{element:{id:s,tagName:r}}=t;return s?{id:s}:{tag:r}};t.whenConnected(()=>{const e=r.createRange();e.selectNodeContents(t.contentRoot),i.read().once(i=>{i.put(tn,{fragment:c(),receiver:{supply:j().needs(t),receive:(i,c)=>function(i){const c=s(i.page);if(c===a)return;if(!i.ok)return void o(()=>n({context:t,range:e,response:i}));a=c,o(()=>{e.deleteContents();const s=r.createDocumentFragment(),{fragment:o}=i;o&&(Wt(o,s),e.insertNode(s)),n({context:t,range:e,response:i})})}(c)}})})})})}})}function fn({url:e}){return new URL("",e).href}class pn extends v{get upKey(){return this}constructor(){super("default-in-aspects")}grow(e){const t=e.context.get(X),n=e.context.get(Q);return e.seed.keepThru((...e)=>me(...e,we.to(n),_e.to(t)))}}const gn=new pn,mn=new x("input-from-control",{byDefault:()=>({})});function _n(e,t){const n=e.get(He).provide({a:mn,by:()=>({root:e,control:t})});return j(n).needs(e).needs(t)}function wn(t){return J({feature:{needs:Z},define(n){n.whenComponent(n=>{const{up:r}=n.get(He);W({parent:r().keepThru_(e=>e?S(e.get(mn)):s({})),aspects:n.get(gn)}).keepThru_(({parent:[s],aspects:[r]})=>{if(s.control){const o=t({control:s,context:n,aspects:r});if(o)return o instanceof pe?e(o):S(o)}return e()}).consume((e,t)=>{if(!e)return;const s=_n(n,e);return(t||O(e)).needs(s),s})})}})}const bn=new x("input-to-form",{byDefault:()=>({})});function yn(t){const{select:n="form",pick:s={deep:!0,all:!0}}=t;return J({feature:{needs:ct},define(r){r.whenComponent(r=>{const o=r.get(Je);r.whenConnected(()=>{W({node:o.select(n,s).first(),aspects:r.get(gn)}).keepThru(({node:[n],aspects:[s]})=>{if(!n)return e();const o=t.makeForm({node:n,context:r,aspects:s});return o?Array.isArray(o)?e(...o):S(o):e()}).consume((e,t,n)=>{if(!e)return;const s=function(e,t,n){const s=e.get(He),r=s.provide({a:bn,by:()=>({root:e,control:t,form:n})});return s.provide({a:mn,via:bn}),j(r).needs(e).needs(t).needs(n)}(r,e,t);return n?n.needs(s):s.cuts(t).cuts(e),s})})})}})}function vn(e={}){const{cancel:t=!0}=e;return fe(({get:e})=>({componentDef:{define(n){n.whenComponent(n=>{n.whenConnected(()=>{const s=n.get(He),{component:r}=n;s.get(bn).consume(s=>{if(!s.control)return;const o=new F(s.form.element);O(o).needs(n);const i=o.on("submit");return(t?i.instead():i).to(t=>e(r).call(r,s,t))})})})}}}))}function xn(e){const t="string"==typeof e?o(R(e)):t=>{const n=e(t);return"string"==typeof n?R(n):n};return J({define(e){e.whenComponent(e=>{const n=e.get(He);W({group:n.up().keepThru_(e=>e?S(e.get(mn)):s({}),({control:e})=>e&&e.aspect(ge)),control:n.get(mn),name:t(e)}).consume(({group:[e],control:[{control:t}],name:[n]})=>{if(null!=n&&e&&t&&e!==t)return e.controls.set(n,t)})})}})}function kn(t){const{select:n="input",pick:s={deep:!0,all:!0}}=t;return J({feature:{needs:ct},define(r){r.whenComponent(r=>{const o=r.get(Je);r.whenConnected(()=>{W({node:o.select(n,s).first(),aspects:r.get(gn)}).keepThru(({node:[n],aspects:[s]})=>{if(!n)return e();const o=t.makeControl({node:n,context:r,aspects:s});return o?o instanceof pe?e(o):S(o):e()}).consume((e,t)=>{if(!e)return;const n=_n(r,e);return(t||O(e)).needs(n),n})})})}})}export{Mt as A,wn as C,gn as D,yn as F,Ie as H,mn as I,vt as N,vn as O,mt as P,xn as S,kn as U,He as a,ct as b,Je as c,bn as d,dn as e,Kt as f,dt as g,Ft as h,_n as i};//# sourceMappingURL=generic.83001515.js.map
