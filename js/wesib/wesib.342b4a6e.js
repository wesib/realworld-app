import{n as e,m as t,v as n,f as o,t as s,g as r,h as i,j as c,s as a,k as u,S as d,a as h,l}from"../proc7ts/primitives.ada6e792.js";import{i as p,a as f,f as m}from"../proc7ts/push-iterator.b943ed6f.js";import{a as y,b as g,C as w,c as b,F as _,g as x,d as v,e as C,h as D}from"../proc7ts/context-values.bb33d989.js";import{n as k,N as S,i as R,h as E}from"../frontmeans/namespace-aliaser.e08188c9.js";import{v as T,o as O,t as A,d as j,A as P,K as N,L as B,I as F,F as K,h as M,M as $,S as L,c as V,b as U,N as q,f as W,V as z,q as H,E as I,J,a as Z,m as G}from"../proc7ts/fun-events.3d56e7e0.js";import{W as Q,a as X}from"../proc7ts/workbench.76998d65.js";import{D as Y}from"../frontmeans/dom-events.455a522c.js";import{i as ee,n as te}from"../frontmeans/render-scheduler.78bb570f.js";const ne=new y("bootstrap-context");class oe extends g{static get[w](){return ne}}function se(e){return(t,n)=>{const o=t.get(oe);return t===o?e(o,n):o.get(n)}}function re(e){return e.nodeType===Node.ELEMENT_NODE}class ie{constructor(e){this.symbol=e}own(e){return e.hasOwnProperty(this.symbol)?e[this.symbol]:void 0}of(e){const t=this.own(e),n=u(e),o=n&&this.of(n);return t?o?this.merge([o,t]):t:o}define(e,t){const n=this.own(e),o=t.map((t=>this.meta(t,e))),s=this.merge(n?[n,...o]:o);return Object.defineProperty(e,this.symbol,{configurable:!0,value:s}),e}}function ce(e,t,n,o){const s=t&&t.bind(e),r=o&&o.bind(n);return r?s?async(...e)=>{await s(...e),await r(...e)}:r:s}const ae=Symbol("feature-def");class ue extends ie{constructor(){super(ae)}merge(e){return e.reduce(((e,t)=>({needs:i(c(a(e.needs),t.needs)),has:i(c(a(e.has),t.has)),setup:ce(e,e.setup,t,t.setup),init:ce(e,e.init,t,t.init)})),{})}meta(e,t){const n=e[ae];return null==n?e:this.meta("function"==typeof n?e[ae](t):n,t)}}const de=new ue,he={[ae]:()=>({})},le={of:e=>de.of(e)||{},for:(e,t)=>de.meta(t,e),merge:(...e)=>de.merge(e),all:(...e)=>e.reduce(((e,t)=>({[ae]:n=>le.merge(le.for(n,e),le.for(n,t))})),he),define:(e,...t)=>de.define(e,t)};function pe(...e){return t=>le.define(t,...e)}const fe=new y("feature-context");class me extends oe{static get[w](){return fe}whenDefined(e){return this.get(oe).whenDefined(e)}load(e,t){return this.get(oe).load(e,t?(new d).needs(this).needs(t):this)}}const ye=new y("bootstrap-workbench",{byDefault:se((()=>new Q))}),ge=new X("feature setup"),we=new X("feature init",{after:ge}),be=new X("component definition",{after:we}),_e=Symbol("component-def");class xe extends ie{constructor(){super(_e)}merge(e){return e.reduce(((e,n)=>({...e,...n,setup:t(e.setup,n.setup),define:t(e.define,n.define),feature:e.feature?n.feature?le.merge(e.feature,n.feature):e.feature:n.feature})),{})}meta(e,t){const n=e[_e];return null!=n?this.meta("function"==typeof n?e[_e](t):n,t):null!=e[ae]?{feature:le.for(t,e)}:R(e)?{name:e}:e}}const ve=new xe,Ce={[_e]:()=>({})},De={of:e=>ve.of(e)||{},for:(e,t)=>ve.meta(t,e),merge:(...e)=>ve.merge(e),all:(...e)=>e.reduce(((e,t)=>({[_e]:n=>De.merge(De.for(n,e),De.for(n,t))})),Ce),define:(e,...t)=>ve.define(e,t)};function ke(...e){const t=t=>De.define(t,...e);return t[_e]=()=>De.all(...e),t}const Se=new y("component-context"),Re=new y("component-event-dispatcher",{byDefault(e){const t=e.get(Se),n=new Y(t.element);return n.supply.needs(t),{dispatch:e=>n.dispatch(e),on:e=>n.on(e)}}}),Ee=new y("content-root",{byDefault:e=>e.get(Se).element});class Te extends v{constructor(){super("state-updater"),this.upKey=this.createUpKey((n=>n.insert(n.seed.do(V(((...o)=>{if(o.length){const n=o.reduce(((e,n)=>t(n,e)),e);return U(((e,t,o)=>n(q(e),t,o)))}return n.hasFallback&&n.or?n.or:U(e)}))))))}grow(t){let n;t.context.get(this.upKey,t.hasFallback?{or:null!=t.or?U(t.or):t.or}:void 0)((e=>n=e)).whenOff((()=>n=e)),t.insert(((e,t,o)=>n(e,t,o)))}}const Oe=new Te,Ae=Symbol("component-context");class je extends g{constructor(){super(),this.updateState=(e,t,n)=>{this.get(Oe)(e,t,n)}}static get[w](){return Se}static of(e){if("function"!=typeof e[Ae])throw new TypeError(`No component context found in ${String(e)}`);return e[Ae]()}get contentRoot(){return this.get(Ee)}on(e){return this.get(Re).on(e)}dispatchEvent(e){this.get(Re).dispatch(e)}}const Pe=Symbol("component-slot"),Ne={of(e){const t=e[Pe];return t||(e[Pe]=new Be)}};class Be{constructor(){this._ctx=A(),this.whenReady=this._ctx.read.do(j((e=>e&&e.whenReady)),O)}get context(){return this._ctx.it}get read(){return this._ctx.read}[P](){return this._ctx.read}bind(e){this._ctx.it=e}unbind(){this._ctx.it=void 0}}class Fe extends Event{get context(){return Ne.of(this.target).context}}const Ke=Symbol("anonymous-component-property");function Me(e){const t=({get:t,set:n},o=Ke,s)=>ke({[_e](r){const i=e({type:r,key:o,readable:!0,writable:s,enumerable:!1,configurable:!1,get:e=>t(e,o),set:(e,t)=>n(e,t,o)});return i&&i.componentDef||{}}}),o=(e,n)=>t({get:(t,n)=>e(t,n)},n,!1),i=(t,n,o)=>function(e,t,n,o){const i=!n,c=o(n?s(n):r(e,t));if(!i||!c)return c;Object.defineProperty(e,t,c)}(t,n,o,(o=>{const{get:s,set:r}=o,i=t.constructor,{get:c,set:a,configurable:u,enumerable:d,componentDef:h={}}=e({type:i,key:n,readable:!!o.get,writable:!!o.set,enumerable:!!o.enumerable,configurable:!!o.configurable,get:s?e=>s.call(e):$e(n),set:r?(e,t)=>r.call(e,t):Le(n)})||{};De.define(i,h);const l={...o,configurable:null!=u?u:o.configurable,enumerable:null!=d?d:o.enumerable};return(c||a)&&(l.get=c&&function(){return c(this,n)},l.set=a&&function(e){a(this,e,n)}),l}));return i.With=(e,n)=>t(e,n,!0),i.By=o,i.As=(e,t)=>o(n(e),t),i.Bind=(e,n=Ke)=>{const o=Symbol(`${String(n)}:accessor`),s=t=>{const s=t[o];if(s)return s;const r=e(t,n);return t[o]={get:r.get?r.get.bind(r):$e(n),set:r.set?r.set.bind(r):Le(n)}};return t({get:e=>s(e).get(),set:(e,t)=>s(e).set(t)},n,!0)},i}function $e(e){return()=>{throw new TypeError(`"${String(e)}" is not readable`)}}function Le(e){return()=>{throw new TypeError(`"${String(e)}" is not writable`)}}const Ve=new y("bootstrap-context-registry");class Ue extends b{constructor(){super(),this.provide({a:Ue,is:this}),this.values=this.newValues()}static get[w](){return Ve}static create(){return new Ue}}const qe=new y("per-component-registry",{byDefault:se((()=>new We))});class We extends b{}const ze=new y("per-definition-registry",{byDefault:se((e=>new He(e)))});class He extends b{}const Ie=Symbol("post-def-setup");function Je(e){if(e.hasOwnProperty(Ie))return e[Ie];const t=A(),n=new I,o=t.read.do(N(h)),s=J(o,n),r=u(e,(e=>_e in e));if(r){const e=Je(r);s((t=>e.send(t)))}const i={on:s,send(e){n.send(e)},setup(e){t.it=e}};return Object.defineProperty(e,Ie,{value:i}),i}const Ze=new y("window",{byDefault:()=>window}),Ge=new y("bootstrap-root",{byDefault:e=>e.get(Ze).document.body}),Qe=new y("default-namespace-aliaser");class Xe extends v{constructor(){super("default-render-scheduler"),this.upKey=this.createUpKey((e=>e.insert(e.seed.do(V(((...t)=>t.length?U(Ye(e.context,t[t.length-1])):e.hasFallback&&e.or?e.or:U(Ye(e.context,te))))))))}grow(e){let t;e.context.get(this.upKey,e.hasFallback?{or:null!=e.or?U(e.or):e.or}:void 0)((n=>t=Ye(e.context,n))).whenOff((e=>t=C(e))),e.insert(((...e)=>t(...e)))}}function Ye(e,t){return(n={})=>t({...n,window:n.window||e.get(Ze)})}const et=new Xe;class tt extends v{constructor(){super("element-adapter"),this.upKey=this.createUpKey((e=>e.insert(e.seed.do(V(((...t)=>{if(0===t.length)return e.hasFallback&&e.or?e.or:U(nt);const n=e.context.get(Qe),o=new Map;for(const e of t){const t=E.name(e.to,n).toLowerCase(),s=o.get(t)||nt;o.set(t,(t=>{const n=s(t);return n||(e.bind(t),nt(t))}))}return U((e=>(o.get(e.tagName.toLowerCase())||nt)(e)))}))))))}grow(e){let t;e.context.get(this.upKey,e.hasFallback?{or:null!=e.or?U(e.or):e.or}:void 0)((e=>t=e)).whenOff((e=>t=C(e))),e.insert((e=>t(e)))}}function nt(e){const t=e[Pe];return t&&t.context}const ot=new tt,st=new _("element-observer",{byDefault:se((e=>{const t=e.get(ot);class n extends MutationObserver{constructor(e){super((n=>{n.forEach((e=>{p(f(e.removedNodes),(e=>{var t;return null===(t=function(e){var t,n;return null===(n=null===(t=e[Pe])||void 0===t?void 0:t.context)||void 0===n?void 0:n.mount}(e))||void 0===t?void 0:t.checkConnected()})),p(m(e.addedNodes,re),(e=>{var n,o;return null===(o=null===(n=t(e))||void 0===n?void 0:n.mount)||void 0===o?void 0:o.checkConnected()}))})),e(n,this)}))}observe(e,t){super.observe(e,{...t,childList:!0})}}return e=>new n(e)}))});const rt=Symbol("definition-context");function it(e){if(!e.hasOwnProperty(rt))throw new TypeError(`Component is not defined: ${e}`);return e[rt]}const ct=new y("custom-elements",{byDefault:se((function(e){const t=e.get(Ze).customElements,n=e.get(Qe);return new class extends at{define(e,o){if(R(e))return void t.define(E.name(e,n),o);const s=it(e),{name:r,extend:i}=s.elementDef;r?i&&i.name?t.define(E.name(r,n),o,{extends:i.name}):t.define(E.name(r,n),o):dt(e).resolve(void 0)}whenDefined(e){if(R(e))return t.whenDefined(E.name(e,n));const o=it(e),{name:s}=o.elementDef;return s?t.whenDefined(E.name(s,n)):dt(e).promise()}}}))});class at{static get[w](){return ct}}const ut=Symbol("component-resolver");function dt(e){return e.hasOwnProperty(ut)?e[ut]:e[ut]=l()}const ht=new y("definition-context"),lt=new y("element-def",{byDefault(e){const t=e.get(ht).componentType,{name:n,extend:o}=De.of(t),s={get type(){return o&&o.type||e.get(Ze).HTMLElement},get name(){return o&&o.name}};return{get name(){return n},get extend(){return s}}}});class pt extends g{static get[w](){return ht}get elementDef(){return this.get(lt)}connectTo(e){const t=this.mountTo(e);return t.connect(),t}}const ft=Symbol("newComponent");function mt(e){const t=e.componentType;return t[ft]||(t[ft]=function(e){const t=Symbol("component-context");let n;return e.prototype[Ae]=function(){return this[t]||(this[t]=n)},function(e){const o=n;n=e;try{const s=new this(e);return s[t]=e,s}finally{n=o}}}(t)),t[ft](e)}class yt extends je{constructor(e,t){super(),this._definitionContext=e,this.element=t,this._status=A(0),this.whenReady=this._status.read.do(T((e=>!!e&&this)),O),this.whenSettled=this._status.read.do(T((e=>e>=3&&this)),O),this.whenConnected=this._status.read.do(T((e=>e>=4&&this)),O);const n=e._newComponentRegistry();n.provide({a:je,is:this}),this.get=n.newValues().get}get componentType(){return this._definitionContext.componentType}get component(){return this._component()}get settled(){return this._status.it>=3&&!this.supply.isOff}get connected(){return this._status.it>=4&&!this.supply.isOff}get supply(){return this._status.supply}_component(){throw new TypeError("Component is not constructed yet. Consider to use a `whenReady()` callback")}settle(){2===this._status.it&&(this._status.it=3)}destroy(e){try{this._status.supply.off(e)}finally{delete this.component[Ae],this._component=gt,Ne.of(this.element).unbind(),function(e){const{parentNode:t}=e;t&&t.removeChild(e)}(this.element)}}_createComponent(){const e=this._definitionContext._whenComponent;let t=0;Ne.of(this.element).bind(this),e.readNotifier.do(O)((e=>t=e(this,t))),this.whenConnected((()=>{e.readNotifier({supply:(new d).needs(this),receive:(e,n)=>{t=n(this,t)}})})),this._definitionContext._elementBuilder.components.send(this);const o=mt(this);return this._component=n(o),this._status.it=1,this}_connect(){this._status.it=4}_created(){this._status.it<2&&(this._status.it=2),this.whenConnected((()=>this.dispatchEvent(new Fe("wesib:component",{bubbles:!0}))))}}function gt(){throw new TypeError("Component destroyed already")}class wt extends class{get component(){return this.context.component}get element(){return this.context.element}}{constructor(e){super(),this.context=e}get connected(){return this.context.connected}connect(){this.context._connect()}checkConnected(){const e=this.context.element,t=e.ownerDocument,n=null!=t&&t.contains(e);return n!==this.connected&&(n?this.connect():this.context.destroy()),n}}class bt extends yt{constructor(e,t){super(e,t),this.mount=this.mount=new wt(this)}}class _t extends yt{get mount(){}}class xt{constructor(){const e=A(0),t=new I;this.onCreated=W((n=>{const o=e.it+1;t.on({supply:n.supply,receive:(e,t,s)=>{s<o&&n.receive({onRecurrent(t){e.onRecurrent((e=>t(e)))}},t)}}),++e.it})),this.readNotifier=e.read.do(G((e=>(n,o)=>(t.send(n,o),e))))}}class vt extends pt{constructor(e,t,o){var s,r;super(),this._bsContext=e,this._elementBuilder=t,this.componentType=o,this._whenComponent=new xt,this._ready=A(!1),this._whenReady=this._ready.read.do(H(((e,t)=>t&&e()))),this._def=De.of(o);const i=new He(e.get(ze).seeds());i.provide({a:pt,is:this}),this.get=i.newValues().get;const c=e.get(qe).append((e=>this.get(e)));this._perComponentRegistry=new We(c.seeds()),this.whenReady=this._whenReady.do(Z(n(this)),O);const a={get componentType(){return o},whenReady:this.whenReady,whenComponent:this.whenComponent,perDefinition:e=>i.provide(e),perComponent:e=>this._perComponentRegistry.provide(e)};null===(r=(s=this._def).setup)||void 0===r||r.call(s,a),Je(o).setup(a)}get elementType(){return this._elementType()}get whenComponent(){return this._whenComponent.onCreated}mountTo(e){if(Ne.of(e).context)throw new Error(`Element ${String(e)} already bound to component`);const t=new bt(this,e);t._createComponent();const{mount:n}=t;return n.checkConnected(),t._created(),t.settle(),n}perComponent(e){return this._perComponentRegistry.provide(e)}_newComponentRegistry(){return new We(this._perComponentRegistry.seeds())}_elementType(){throw new Error("Custom element class is not constructed yet. Consider to use a `whenReady()` callback")}_define(){var e,t;null===(t=(e=this._def).define)||void 0===t||t.call(e,this),this._elementBuilder.definitions.send(this),this._elementType=n(function(e){const t=e.get(lt);class n extends t.extend.type{constructor(){super();const t=new _t(e,this);t._createComponent(),t._created()}connectedCallback(){var e;null===(e=super.connectedCallback)||void 0===e||e.call(this),Ne.of(this).context._connect()}disconnectedCallback(){var e;Ne.of(this).context.destroy(),null===(e=super.disconnectedCallback)||void 0===e||e.call(this)}}return n}(this)),this.componentType[rt]=this,this._ready.it=!0}}const Ct=new y("element-builder",{byDefault:se((function(e){return{definitions:new I,components:new I,buildElement(t){const n=new vt(e,this,t);return n._define(),n}}}))});class Dt{constructor(e){this._setup=e,this._components=void 0}define(e){this._components?this._components.push(e):(this._components=[e],this._defineAll(this._components))}_defineAll(e){const t=this._setup.get(ye).work(be).run((()=>{const t=this._setup.get(at),n=this._setup.get(Ct);e.forEach((e=>{const o=n.buildElement(e);t.define(e,o.elementType)})),this._components=void 0}));this._setup.initBy(n(t))}}class kt extends me{constructor(e,t){super(),this.feature=e,this._setup=t,this._bsContext=t.get(oe);const n=t.get(t.module),o=new b(this._bsContext);o.provide({a:me,is:this}),this.get=o.newValues().get,this.whenReady=n.read.do(T((({ready:e})=>e&&this)),O),this._componentRegistry=new Dt(this._setup)}get supply(){return this._setup.supply}get onDefinition(){return this._onDefinition||(this._onDefinition=this._setup.get(Ct).definitions.on.do(K(this)))}get onComponent(){return this._onComponent||(this._onComponent=this._setup.get(Ct).components.on.do(K(this)))}provide(e){return this._bsContext.get(Ue).provide(e).needs(this)}perDefinition(e){return this._bsContext.get(ze).provide(e).needs(this)}perComponent(e){return this._bsContext.get(qe).provide(e).needs(this)}setupDefinition(e){return function(e,t){const{on:n}=Je(e);return W((e=>{n({supply:e.supply.needs(t),receive(n,o){const s=o.whenReady.do(K(t)),r=o.whenComponent.do(K(t));e.receive(n,{get componentType(){return o.componentType},get whenReady(){return s},get whenComponent(){return r},perDefinition:e=>o.perDefinition(e).needs(t),perComponent:e=>o.perComponent(e).needs(t)})}})}))}(e,this.supply)}define(e){this._componentRegistry.define(e)}}const St=Symbol("feature-module");class Rt extends x{constructor(e){super(e.name,function(e){const t=function(e){let t=le.of(e);if(_e in e){t=le.merge(t,{init(t){t.define(e)}});const{feature:n}=De.of(e);n&&(t=le.merge(t,n))}return t}(e),o=[],s=[];for(const e of a(t.has))o.push(Rt.of(e));for(const e of a(t.needs))s.push(Rt.of(e));return{needs:s,has:o,async setup(o){var s;const r=o.get(ye),i=new kt(e,o);if(t.init){const e=r.work(we).run((async()=>{await t.init(i)}));o.initBy(n(e))}await(null===(s=t.setup)||void 0===s?void 0:s.call(t,i))}}}(e)),this.feature=e}static of(e){return Object.prototype.hasOwnProperty.call(e,St)?e[St]:e[St]=new Rt(e)}async setup(e){const t=e.get(ye);await t.work(ge).run((()=>super.setup(e)))}}const Et=Symbol("when-defined");function Tt(...e){const t=Ue.create(),{bootstrapContext:o,complete:s}=function(e){const t=A(0),o=e.values;class s extends oe{constructor(){super(),this.get=o.get,this.whenReady=t.read.do(N((e=>!!e&&this)),O),e.provide({a:Qe,by:k}),e.provide({a:oe,is:this})}whenDefined(e){return function(e,t){if(t.hasOwnProperty(Et))return t[Et];const n=$(Promise.resolve(e.whenReady).then((()=>e.get(at).whenDefined(t))).then((()=>it(t))));return t[Et]=n}(this,e)}load(t,o){const s=Rt.of(t),r=e.provide(s);o?r.needs(o):o=r;const i=function(e,t){const n=A({feature:e,ready:!1});return t.read((({module:e,ready:t})=>{const o=e.feature,s=n.it;s&&s.feature===o&&s.ready===t||(n.it={feature:o,ready:t})})).needs(t),n.supply.needs(t),n.read}(t,this.get(s).use(o));return{read:i,whenReady:i.do(T((e=>e.ready&&e)),O),[P]:n(i),supply:r}}}return{bootstrapContext:new s,complete(){t.it=1}}}(t),r=1===e.length?e[0]:(i=e,le.define(class{},{needs:i}));var i;return o.load(r).read.do(T((({ready:e})=>e)),O).then(s).catch(console.error),o}const Ot=Symbol("attribute");function At(e){return[Ot,e]}function jt(t,n=!0){if(!1===n)return e;if(!0===n||"function"==typeof n){const e=At(t),o=!0===n?Pt:n;return(t,n,s)=>o(t,e,n,s)}return(e,t,o)=>Pt(e,n,t,o)}function Pt(e,t,n,o){je.of(e).updateState(t,n,o)}function Nt(e){let t;for(let n=0;n<e.length;++n){const o=e[n];o<="Z"&&o>="A"?(t||(t=e.substring(0,n)),t+="-"+o.toLowerCase()):t&&(t+=o)}return t||e}function Bt(e,t,n){let o,s;if("string"==typeof n)o=Nt(n),s=jt(o);else{if(n&&n.name)o=Nt(n.name);else{if("string"!=typeof t)throw new TypeError(`Attribute name is required as property key is not a string: ${e.constructor.name}.prototype.${String(t)}`);o=Nt(t)}s=jt(o,n&&n.updateState)}return{name:o,change:s}}const Ft=new y("attribute-registry",{byDefault:e=>new Kt(e.get(pt))});class Kt{constructor(e){this._context=e,this.attrs=new Map,e.whenReady((({elementType:e})=>this.define(e))),e.whenComponent((({mount:e})=>{e&&this.mount(e)}))}declareAttribute({name:e,change:n}){this.attrs.set(e,t(this.attrs.get(e),n))}define(e){const{attrs:t}=this;t.size&&(Object.defineProperty(e,"observedAttributes",{configurable:!0,enumerable:!0,value:Mt(e,[...t.keys()])}),Object.defineProperty(e.prototype,"attributeChangedCallback",{configurable:!0,enumerable:!0,value:$t(e,t)}))}mount(e){const{element:t}=e,{attrs:n}=this,o=[...n.keys()];if(!o.length)return;new(0,this._context.get(Ze).MutationObserver)((o=>o.forEach((o=>{const s=o.attributeName;return n.get(s)(e.context.component,t.getAttribute(s),o.oldValue)})))).observe(t,{attributes:!0,attributeFilter:o,attributeOldValue:!0})}}function Mt(e,t){const n=e.observedAttributes;if(Array.isArray(n)){const e=new Set(n);t.forEach((t=>e.add(t))),t=[...e]}return t}function $t(e,t){const n=e.prototype.attributeChangedCallback;return n?function(e,o,s){const r=t.get(e);r?Ne.of(this).whenReady((({component:e})=>r(e,s,o))):n.call(this,e,o,s)}:function(e,n,o){Ne.of(this).whenReady((({component:s})=>{t.get(e)(s,o,n)}))}}function Lt(e){return Me((({type:t,key:n})=>{const o=Bt(t.prototype,n,e),{name:s}=o;return{componentDef:{define(e){e.get(Ft).declareAttribute(o)}},get:e=>je.of(e).element.getAttribute(s),set(e,t){const{element:n}=je.of(e);null!=t?n.setAttribute(s,t):n.removeAttribute(s)}}}))}function Vt(e){return Me((({type:t,get:n,key:o})=>{const{name:s,change:r}=Bt(t.prototype,o,e);return{componentDef:{define(e){e.get(Ft).declareAttribute({name:s,change(e,t,o){n(e).call(e,t,o),r(e,t,o)}})}}}}))}function Ut(...e){return ke({define(t){const n=t.get(Ft);for(const t of e)if("string"==typeof t){const e=Nt(t);n.declareAttribute({name:e,change:jt(e)})}else for(const[e,o]of Object.entries(t)){const t=Nt(e);n.declareAttribute({name:t,change:jt(t,o)})}}})}class qt extends D{constructor(){super("component-state")}grow(e){const t=e.seed();let n;if(null!=t)n=t,e.insert(n);else{if(e.hasFallback)return;n=new zt,e.context.get(je).supply.whenOff((e=>n.done(e))),e.insert(n)}e.setup((({registry:e})=>{e.provide({a:Oe,is:n.update})}))}}const Wt=new qt;class zt extends L{static get[w](){return Wt}}const Ht=Symbol("state-property");function It(e){return[Ht,e]}function Jt(e,t,n,o){n!==o&&je.of(e).updateState(t,n,o)}function Zt({updateState:e}={}){return Me((({get:t,set:n,key:o})=>{if(!1!==e){const s=n,r=function(e,t=!0){if(!0===t||"function"==typeof t){const n=It(e),o=!0===t?Jt:t;return(e,t,s)=>o(e,n,t,s)}return(e,n,o)=>{n!==o&&je.of(e).updateState(t,n,o)}}(o,e);n=(e,n)=>{const o=t(e);s(e,n),r(e,n,o)}}return{get:t,set:n}}))}class Gt extends z{constructor(e,t,n){super(),this._context=e,this._name=t,this.supply=new d,this.on=this._context.get(zt).track(n).onUpdate.do(H(((e,t,n,o)=>e(n,o))),K(this))}get it(){return this._context.element.getAttribute(this._name)}set it(e){this.supply.isOff||(null==e?this._context.element.removeAttribute(this._name):this._context.element.setAttribute(this._name,e))}}function Qt(e,t,n=At(t)){return new Gt(e,t,n)}const Xt=new y("dom-property-registry",{byDefault:e=>new Yt(e.get(pt))});class Yt{constructor(e){this.props=new Map,e.whenReady((({elementType:e})=>this.define(e))),e.whenComponent((({mount:e})=>{e&&this.mount(e)}))}declareDomProperty({key:e,descriptor:t}){this.props.set(e,t)}define(e){const t=e.prototype;this.props.forEach(((e,n)=>{Object.defineProperty(t,n,e)}))}mount({element:e}){this.props.forEach(((t,n)=>{Object.defineProperty(e,n,t)}))}}const en=Symbol("dom-property");function tn(e){return[en,e]}function nn(e,t,n,o){n!==o&&je.of(e).updateState(t,n,o)}function on(e={}){return Me((t=>{const{key:n,get:o}=t;let{set:s}=t;const r=function(e,{propertyKey:t=e.key,configurable:n=e.configurable,enumerable:o=e.enumerable,writable:s=e.writable}){const r=e.key;return{key:t,descriptor:{configurable:n,enumerable:o,get:function(){var e;return null===(e=Ne.of(this).context)||void 0===e?void 0:e.component[r]},set:s?function(e){Ne.of(this).whenReady((({component:t})=>t[r]=e))}:void 0}}}(t,e);if(!1!==e.updateState){const t=function(e,t=!0){if(!0===t||"function"==typeof t){const n=tn(e),o=!0===t?nn:t;return(e,t,s)=>o(e,n,t,s)}return(e,n,o)=>{n!==o&&je.of(e).updateState(t,n,o)}}(n,e.updateState),r=s;s=(e,n)=>{const s=o(e);r(e,n),t(e,n,s)}}return{componentDef:{define(e){e.get(Xt).declareDomProperty(r)}},get:o,set:s}}))}const sn=Symbol("render"),rn={spec:(e,t)=>o(t,e),fulfill(e,t={}){const{on:n=t.on,error:o}=e;return{on:n,error:o?o.bind(e):t.error&&t.error.bind(t)}},trigger(e,t={}){const{on:n=[]}=t;if(("object"==typeof n||"function"==typeof n)&&B(n))return F(n).do(K(e));const o=e.get(zt).track(n).onUpdate.do(K(e));return Array.isArray(n)&&!n.length?o.do(M(((e,t)=>t[0]!==sn&&e()))):o}};class cn{constructor(e){this._context=e,this._renders=new Set}renderBy(t,n={}){const o=rn.spec(this._context,n),s=rn.trigger(this._context,o),r=this._context.get(et)({...rn.fulfill(o),node:this._context.element}),i="connected"===o.when;let c=1;const a=s(i?()=>this._context.connected&&d():()=>this._context.settled&&d()).needs(this._context).whenOff((function(){2===c&&r(e);c=-1}));(i?this._context.whenConnected:this._context.whenSettled)((()=>c&&d()));const u=ee();return this._renders.add(h),a.whenOff((()=>this._renders.delete(h)));function d(){c=2,r(l)}function h(){u(l)}function l(e){if(c>0)for(c=0;;){const n=t(e);if(n===t||"function"!=typeof n)break;t=n}}}renderNow(){this._renders.forEach((e=>e()))}}const an=new y("element-render-ctl",{byDefault:e=>new cn(e.get(je))});const un=new y("element-render-scheduler",{byDefault:function(t){const n=t.get(an);return(t={})=>{const o=A(e);return n.renderBy((e=>{o.it(e)}),rn.fulfill({on:o.on},t)),e=>{o.it=t=>e(t)}}}});function dn(e){return Me((({get:t})=>({componentDef:{define(n){n.whenComponent((n=>{n.whenReady((()=>{const{component:o}=n,s=t(o).bind(o);n.get(an).renderBy(s,e)}))}))}}})))}const hn=new y("shadow-content-root");class ln extends Event{get shadowRoot(){return this.target.shadowRoot}}const pn=new _("shadow-root-builder",{byDefault:()=>fn});function fn(e,t){const n=function(e,t){const n=e.shadowRoot;if(n)return n;if("attachShadow"in e)return e.attachShadow(t);return}(e.element,t);return n&&e.whenConnected((()=>e.dispatchEvent(new ln("wesib:shadowAttached",{bubbles:!0})))),n}const mn={mode:"open"};function yn(e=mn){return ke({setup(t){t.perComponent({a:hn,by:t=>t.get(pn)(t,e)}),t.perComponent({a:Ee,by:e=>e.get(hn,{or:null})})}})}const gn=new S("https://wesib.github.io/ns","b","wesib");export{Ut as A,Ze as B,ke as C,on as D,an as E,pe as F,dn as R,Zt as S,gn as W,se as a,Tt as b,Lt as c,Me as d,je as e,rn as f,De as g,sn as h,Vt as i,yn as j,tn as k,Qe as l,Ne as m,un as n,oe as o,ae as p,Pe as q,ot as r,Ge as s,Qt as t,st as u,re as v,zt as w,It as x};//# sourceMappingURL=wesib.342b4a6e.js.map
