import{n as e,m as t,v as n,e as s,t as o,f as r,g as i,h as c,s as a,j as u,S as d,a as h,k as l}from"../proc7ts/primitives.3596c309.js";import{i as p,a as f,f as m}from"../proc7ts/push-iterator.b943ed6f.js";import{a as y,b as g,C as w,c as b,F as _,g as x,d as v,e as C,h as D}from"../proc7ts/context-values.91624d4c.js";import{n as k,N as S,i as E,h as R}from"../frontmeans/namespace-aliaser.e08188c9.js";import{v as T,o as O,t as A,K as j,A as P,L as N,I as B,F,n as K,M as $,S as M,c as V,b as L,N as U,l as q,V as W,q as z,E as H,J as I,a as J,m as Z}from"../proc7ts/fun-events.26e814e4.js";import{W as G,a as Q}from"../proc7ts/workbench.47577449.js";import{D as X}from"../frontmeans/dom-events.272f64a1.js";import{i as Y,n as ee}from"../frontmeans/render-scheduler.78bb570f.js";const te=new y("bootstrap-context");class ne extends g{static get[w](){return te}}function se(e){return(t,n)=>{const s=t.get(ne);return t===s?e(s,n):s.get(n)}}function oe(e){return e.nodeType===Node.ELEMENT_NODE}class re{constructor(e){this.symbol=e}own(e){return e.hasOwnProperty(this.symbol)?e[this.symbol]:void 0}of(e){const t=this.own(e),n=u(e),s=n&&this.of(n);return t?s?this.merge([s,t]):t:s}define(e,t){const n=this.own(e),s=t.map((t=>this.meta(t,e))),o=this.merge(n?[n,...s]:s);return Object.defineProperty(e,this.symbol,{configurable:!0,value:o}),e}}const ie=Symbol("feature-def");class ce extends re{constructor(){super(ie)}merge(e){return e.reduce(((e,n)=>({needs:i(c(a(e.needs),n.needs)),has:i(c(a(e.has),n.has)),setup:t(e.setup,n.setup),init:t(e.init,n.init)})),{})}meta(e,t){const n=e[ie];return null==n?e:this.meta("function"==typeof n?e[ie](t):n,t)}}const ae=new ce,ue={[ie]:()=>({})},de={of:e=>ae.of(e)||{},for:(e,t)=>ae.meta(t,e),merge:(...e)=>ae.merge(e),all:(...e)=>e.reduce(((e,t)=>({[ie]:n=>de.merge(de.for(n,e),de.for(n,t))})),ue),define:(e,...t)=>ae.define(e,t)};function he(...e){return t=>de.define(t,...e)}const le=new y("feature-context");class pe extends ne{static get[w](){return le}whenDefined(e){return this.get(ne).whenDefined(e)}load(e,t){return this.get(ne).load(e,t?(new d).needs(this).needs(t):this)}}const fe=new y("bootstrap-workbench",{byDefault:se((()=>new G))}),me=new Q("feature setup"),ye=new Q("feature init",{after:me}),ge=new Q("component definition",{after:ye}),we=Symbol("component-def");class be extends re{constructor(){super(we)}merge(e){return e.reduce(((e,n)=>({...e,...n,setup:t(e.setup,n.setup),define:t(e.define,n.define),feature:e.feature?n.feature?de.merge(e.feature,n.feature):e.feature:n.feature})),{})}meta(e,t){const n=e[we];return null!=n?this.meta("function"==typeof n?e[we](t):n,t):null!=e[ie]?{feature:de.for(t,e)}:E(e)?{name:e}:e}}const _e=new be,xe={[we]:()=>({})},ve={of:e=>_e.of(e)||{},for:(e,t)=>_e.meta(t,e),merge:(...e)=>_e.merge(e),all:(...e)=>e.reduce(((e,t)=>({[we]:n=>ve.merge(ve.for(n,e),ve.for(n,t))})),xe),define:(e,...t)=>_e.define(e,t)};function Ce(...e){const t=t=>ve.define(t,...e);return t[we]=()=>ve.all(...e),t}const De=new y("component-context"),ke=new y("component-event-dispatcher",{byDefault(e){const t=e.get(De),n=new X(t.element);return n.supply.needs(t),{dispatch:e=>n.dispatch(e),on:e=>n.on(e)}}}),Se=new y("content-root",{byDefault:e=>e.get(De).element});class Ee extends v{constructor(){super("state-updater"),this.upKey=this.createUpKey((n=>n.insert(n.seed.do(V(((...s)=>{if(s.length){const n=s.reduce(((e,n)=>t(n,e)),e);return L(((e,t,s)=>n(U(e),t,s)))}return n.hasFallback&&n.or?n.or:L(e)}))))))}grow(t){let n;t.context.get(this.upKey,t.hasFallback?{or:null!=t.or?L(t.or):t.or}:void 0)((e=>n=e)).whenOff((()=>n=e)),t.insert(((e,t,s)=>n(e,t,s)))}}const Re=new Ee,Te=Symbol("component-context");class Oe extends g{constructor(){super(),this.updateState=(e,t,n)=>{this.get(Re)(e,t,n)}}static get[w](){return De}static of(e){const t=e[Te];if(!t)throw TypeError(`No component context found in ${String(e)}`);return t}get contentRoot(){return this.get(Se)}on(e){return this.get(ke).on(e)}dispatchEvent(e){this.get(ke).dispatch(e)}}class Ae extends Event{get context(){return Oe.of(this.target)}}const je=Symbol("anonymous-component-property");function Pe(e){const t=({get:t,set:n},s=je,o)=>Ce({[we](r){const i=e({type:r,key:s,readable:!0,writable:o,enumerable:!1,configurable:!1,get:e=>t(e,s),set:(e,t)=>n(e,t,s)});return i&&i.componentDef||{}}}),s=(e,n)=>t({get:(t,n)=>e(t,n)},n,!1),i=(t,n,s)=>function(e,t,n,s){const i=!n,c=s(n?o(n):r(e,t));if(!i||!c)return c;Object.defineProperty(e,t,c)}(t,n,s,(s=>{const{get:o,set:r}=s,i=t.constructor,{get:c,set:a,configurable:u,enumerable:d,componentDef:h={}}=e({type:i,key:n,readable:!!s.get,writable:!!s.set,enumerable:!!s.enumerable,configurable:!!s.configurable,get:o?e=>o.call(e):Ne(n),set:r?(e,t)=>r.call(e,t):Be(n)})||{};ve.define(i,h);const l={...s,configurable:null!=u?u:s.configurable,enumerable:null!=d?d:s.enumerable};return(c||a)&&(l.get=c&&function(){return c(this,n)},l.set=a&&function(e){a(this,e,n)}),l}));return i.With=(e,n)=>t(e,n,!0),i.By=s,i.As=(e,t)=>s(n(e),t),i.Bind=(e,n=je)=>{const s=Symbol(`${String(n)}:accessor`),o=t=>{const o=t[s];if(o)return o;const r=e(t,n);return t[s]={get:r.get?r.get.bind(r):Ne(n),set:r.set?r.set.bind(r):Be(n)}};return t({get:e=>o(e).get(),set:(e,t)=>o(e).set(t)},n,!0)},i}function Ne(e){return()=>{throw new TypeError(`"${String(e)}" is not readable`)}}function Be(e){return()=>{throw new TypeError(`"${String(e)}" is not writable`)}}const Fe=new y("bootstrap-context-registry");class Ke extends b{constructor(){super(),this.provide({a:Ke,is:this}),this.values=this.newValues()}static get[w](){return Fe}static create(){return new Ke}}const $e=new y("per-component-registry",{byDefault:se((()=>new Me))});class Me extends b{}const Ve=new y("per-definition-registry",{byDefault:se((e=>new Le(e)))});class Le extends b{}const Ue=Symbol("post-def-setup");function qe(e){if(e.hasOwnProperty(Ue))return e[Ue];const t=A(),n=new H,s=t.read.do(j(h)),o=I(s,n),r=u(e,(e=>we in e));if(r){const e=qe(r);o((t=>e.send(t)))}const i={on:o,send(e){n.send(e)},setup(e){t.it=e}};return Object.defineProperty(e,Ue,{value:i}),i}const We=new y("window",{byDefault:()=>window}),ze=new y("bootstrap-root",{byDefault:e=>e.get(We).document.body}),He=new y("default-namespace-aliaser");class Ie extends v{constructor(){super("default-render-scheduler"),this.upKey=this.createUpKey((e=>e.insert(e.seed.do(V(((...t)=>t.length?L(Je(e.context,t[t.length-1])):e.hasFallback&&e.or?e.or:L(Je(e.context,ee))))))))}grow(e){let t;e.context.get(this.upKey,e.hasFallback?{or:null!=e.or?L(e.or):e.or}:void 0)((n=>t=Je(e.context,n))).whenOff((e=>t=C(e))),e.insert(((...e)=>t(...e)))}}function Je(e,t){return(n={})=>t({...n,window:n.window||e.get(We)})}const Ze=new Ie;class Ge extends v{constructor(){super("element-adapter"),this.upKey=this.createUpKey((e=>e.insert(e.seed.do(V(((...t)=>{const n=t.reduce(((e,t)=>n=>e(n)||t(n)),Qe);return n!==Qe?L(n):e.hasFallback&&e.or?e.or:L(Qe)}))))))}grow(e){let t;e.context.get(this.upKey,e.hasFallback?{or:null!=e.or?L(e.or):e.or}:void 0)((e=>t=e)).whenOff((e=>t=C(e))),e.insert((e=>t(e)))}}function Qe(e){return e[Te]}const Xe=new Ge,Ye=new _("element-observer",{byDefault:se((e=>{const t=e.get(Xe);class n extends MutationObserver{constructor(e){super((n=>{n.forEach((e=>{p(f(e.removedNodes),(e=>{var t;return null===(t=function(e){var t;return null===(t=e[Te])||void 0===t?void 0:t.mount}(e))||void 0===t?void 0:t.checkConnected()})),p(m(e.addedNodes,oe),(e=>{var n,s;return null===(s=null===(n=t(e))||void 0===n?void 0:n.mount)||void 0===s?void 0:s.checkConnected()}))})),e(n,this)}))}observe(e,t){super.observe(e,{...t,childList:!0})}}return e=>new n(e)}))});const et=Symbol("definition-context");function tt(e){if(!e.hasOwnProperty(et))throw new TypeError(`Component is not defined: ${e}`);return e[et]}const nt=new y("custom-elements",{byDefault:se((function(e){const t=e.get(We).customElements,n=e.get(He);return new class extends st{define(e,s){if(E(e))return void t.define(R.name(e,n),s);const o=tt(e),{name:r,extend:i}=o.elementDef;r?i&&i.name?t.define(R.name(r,n),s,{extends:i.name}):t.define(R.name(r,n),s):rt(e).resolve(void 0)}whenDefined(e){if(E(e))return t.whenDefined(R.name(e,n));const s=tt(e),{name:o}=s.elementDef;return o?t.whenDefined(R.name(o,n)):rt(e).promise()}}}))});class st{static get[w](){return nt}}const ot=Symbol("component-resolver");function rt(e){return e.hasOwnProperty(ot)?e[ot]:e[ot]=l()}const it=new y("definition-context"),ct=new y("element-def",{byDefault(e){const t=e.get(it).componentType,{name:n,extend:s}=ve.of(t),o={get type(){return s&&s.type||e.get(We).HTMLElement},get name(){return s&&s.name}};return{get name(){return n},get extend(){return o}}}});class at extends g{static get[w](){return it}get elementDef(){return this.get(ct)}connectTo(e){const t=this.mountTo(e);return t.connect(),t}}class ut extends Oe{constructor(e,t){super(),this._definitionContext=e,this.element=t,this._status=A(0),this.whenReady=this._status.read.do(T((e=>!!e&&this)),O),this.whenSettled=this._status.read.do(T((e=>e>=3&&this)),O),this.whenConnected=this._status.read.do(T((e=>e>=4&&this)),O);const n=e._newComponentRegistry();n.provide({a:Oe,is:this}),this.get=n.newValues().get}get componentType(){return this._definitionContext.componentType}get component(){return this._component()}get settled(){return this._status.it>=3&&!this.supply.isOff}get connected(){return this._status.it>=4&&!this.supply.isOff}get supply(){return this._status.supply}_component(){throw new TypeError("Component is not constructed yet. Consider to use a `whenReady()` callback")}settle(){2===this._status.it&&(this._status.it=3)}destroy(e){try{this._status.supply.off(e)}finally{delete this.component[Te],delete this.element[Te],this._component=dt,function(e){const{parentNode:t}=e;t&&t.removeChild(e)}(this.element)}}_createComponent(){const e=this._definitionContext._whenComponent;let t=0;this.element[Te]=this,e.readNotifier.do(O)((e=>t=e(this,t))),this.whenConnected((()=>{e.readNotifier({supply:(new d).needs(this),receive:(e,n)=>{t=n(this,t)}})})),this._definitionContext._elementBuilder.components.send(this);const s=function(e){const t=e.componentType,n=t.prototype,s=n[Te];n[Te]=e;try{const o=new t(e);return o[Te]=e,o}finally{n[Te]=s}}(this);return this._component=n(s),this._status.it=1,this}_connect(){this._status.it=4}_created(){this._status.it<2&&(this._status.it=2),this.whenConnected((()=>this.dispatchEvent(new Ae("wesib:component",{bubbles:!0}))))}}function dt(){throw new TypeError("Component destroyed already")}class ht extends class{get component(){return this.context.component}get element(){return this.context.element}}{constructor(e){super(),this.context=e}get connected(){return this.context.connected}connect(){this.context._connect()}checkConnected(){const e=this.context.element,t=e.ownerDocument,n=null!=t&&t.contains(e);return n!==this.connected&&(n?this.connect():this.context.destroy()),n}}class lt extends ut{constructor(e,t){super(e,t),this.mount=this.mount=new ht(this)}}class pt extends ut{get mount(){}}class ft{constructor(){const e=A(0),t=new H;this.onCreated=q((n=>{const s=e.it+1;t.on({supply:n.supply,receive:(e,t,o)=>{o<s&&n.receive({onRecurrent(t){e.onRecurrent((e=>t(e)))}},t)}}),++e.it})),this.readNotifier=e.read.do(Z((e=>(n,s)=>(t.send(n,s),e))))}}class mt extends at{constructor(e,t,s){var o,r;super(),this._bsContext=e,this._elementBuilder=t,this.componentType=s,this._whenComponent=new ft,this._ready=A(!1),this._whenReady=this._ready.read.do(z(((e,t)=>t&&e()))),this._def=ve.of(s);const i=new Le(e.get(Ve).seeds());i.provide({a:at,is:this}),this.get=i.newValues().get;const c=e.get($e).append((e=>this.get(e)));this._perComponentRegistry=new Me(c.seeds()),this.whenReady=this._whenReady.do(J(n(this)),O);const a={get componentType(){return s},whenReady:this.whenReady,whenComponent:this.whenComponent,perDefinition:e=>i.provide(e),perComponent:e=>this._perComponentRegistry.provide(e)};null===(r=(o=this._def).setup)||void 0===r||r.call(o,a),qe(s).setup(a)}get elementType(){return this._elementType()}get whenComponent(){return this._whenComponent.onCreated}mountTo(e){if(e[Te])throw new Error(`Element ${String(e)} already bound to component`);const t=new lt(this,e);t._createComponent();const{mount:n}=t;return n.checkConnected(),t._created(),t.settle(),n}perComponent(e){return this._perComponentRegistry.provide(e)}_newComponentRegistry(){return new Me(this._perComponentRegistry.seeds())}_elementType(){throw new Error("Custom element class is not constructed yet. Consider to use a `whenReady()` callback")}_define(){var e,t;null===(t=(e=this._def).define)||void 0===t||t.call(e,this),this._elementBuilder.definitions.send(this),this._elementType=n(function(e){const t=e.get(ct);class n extends t.extend.type{constructor(){super();const t=new pt(e,this);t._createComponent(),t._created()}connectedCallback(){var e;null===(e=super.connectedCallback)||void 0===e||e.call(this),this[Te]._connect()}disconnectedCallback(){var e;this[Te].destroy(),null===(e=super.disconnectedCallback)||void 0===e||e.call(this)}}return n}(this)),this.componentType[et]=this,this._ready.it=!0}}const yt=new y("element-builder",{byDefault:se((function(e){return{definitions:new H,components:new H,buildElement(t){const n=new mt(e,this,t);return n._define(),n}}}))});class gt{constructor(e){this._setup=e,this._components=void 0}define(e){this._components?this._components.push(e):(this._components=[e],this._defineAll(this._components))}_defineAll(e){const t=this._setup.get(fe).work(ge).run((()=>{const t=this._setup.get(st),n=this._setup.get(yt);e.forEach((e=>{const s=n.buildElement(e);t.define(e,s.elementType)})),this._components=void 0}));this._setup.initBy(n(t))}}class wt extends pe{constructor(e,t){super(),this.feature=e,this._setup=t,this._bsContext=t.get(ne);const n=t.get(t.module),s=new b(this._bsContext);s.provide({a:pe,is:this}),this.get=s.newValues().get,this.whenReady=n.read.do(T((({ready:e})=>e&&this)),O),this._componentRegistry=new gt(this._setup)}get supply(){return this._setup.supply}get onDefinition(){return this._onDefinition||(this._onDefinition=this._setup.get(yt).definitions.on.do(F(this)))}get onComponent(){return this._onComponent||(this._onComponent=this._setup.get(yt).components.on.do(F(this)))}provide(e){return this._bsContext.get(Ke).provide(e).needs(this)}perDefinition(e){return this._bsContext.get(Ve).provide(e).needs(this)}perComponent(e){return this._bsContext.get($e).provide(e).needs(this)}setupDefinition(e){return function(e,t){const{on:n}=qe(e);return q((e=>{n({supply:e.supply.needs(t),receive(n,s){const o=s.whenReady.do(F(t)),r=s.whenComponent.do(F(t));e.receive(n,{get componentType(){return s.componentType},get whenReady(){return o},get whenComponent(){return r},perDefinition:e=>s.perDefinition(e).needs(t),perComponent:e=>s.perComponent(e).needs(t)})}})}))}(e,this.supply)}define(e){this._componentRegistry.define(e)}}const bt=Symbol("feature-module");class _t extends x{constructor(e){super(e.name,function(e){const t=function(e){let t=de.of(e);if(we in e){t=de.merge(t,{init(t){t.define(e)}});const{feature:n}=ve.of(e);n&&(t=de.merge(t,n))}return t}(e),s=[],o=[];for(const e of a(t.has))s.push(_t.of(e));for(const e of a(t.needs))o.push(_t.of(e));return{needs:o,has:s,setup(s){var o;const r=s.get(fe),i=new wt(e,s);if(t.init){const e=r.work(ye).run((()=>{t.init(i)}));s.initBy(n(e))}null===(o=t.setup)||void 0===o||o.call(t,i)}}}(e)),this.feature=e}static of(e){return Object.prototype.hasOwnProperty.call(e,bt)?e[bt]:e[bt]=new _t(e)}async setup(e){const t=e.get(fe);await t.work(me).run((()=>super.setup(e)))}}const xt=Symbol("when-defined");function vt(...e){const t=Ke.create(),{bootstrapContext:s,complete:o}=function(e){const t=A(0),s=e.values;class o extends ne{constructor(){super(),this.get=s.get,this.whenReady=t.read.do(j((e=>!!e&&this)),O),e.provide({a:He,by:k}),e.provide({a:ne,is:this})}whenDefined(e){return function(e,t){if(t.hasOwnProperty(xt))return t[xt];const n=$(Promise.resolve(e.whenReady).then((()=>e.get(st).whenDefined(t))).then((()=>tt(t))));return t[xt]=n}(this,e)}load(t,s){const o=_t.of(t),r=e.provide(o);s?r.needs(s):s=r;const i=function(e,t){const n=A({feature:e,ready:!1});return t.read((({module:e,ready:t})=>{const s=e.feature,o=n.it;o&&o.feature===s&&o.ready===t||(n.it={feature:s,ready:t})})).needs(t),n.supply.needs(t),n.read}(t,this.get(o).use(s));return{read:i,whenReady:i.do(T((e=>e.ready&&e)),O),[P]:n(i),supply:r}}}return{bootstrapContext:new o,complete(){t.it=1}}}(t),r=1===e.length?e[0]:(i=e,de.define(class{},{needs:i}));var i;return s.load(r).read.do(T((({ready:e})=>e)),O).then(o).catch(console.error),s}const Ct=Symbol("attribute");function Dt(e){return[Ct,e]}function kt(t,n=!0){if(!1===n)return e;if(!0===n||"function"==typeof n){const e=Dt(t),s=!0===n?St:n;return(t,n,o)=>s(t,e,n,o)}return(e,t,s)=>St(e,n,t,s)}function St(e,t,n,s){Oe.of(e).updateState(t,n,s)}function Et(e){let t;for(let n=0;n<e.length;++n){const s=e[n];s<="Z"&&s>="A"?(t||(t=e.substring(0,n)),t+="-"+s.toLowerCase()):t&&(t+=s)}return t||e}function Rt(e,t,n){let s,o;if("string"==typeof n)s=Et(n),o=kt(s);else{if(n&&n.name)s=Et(n.name);else{if("string"!=typeof t)throw new TypeError(`Attribute name is required as property key is not a string: ${e.constructor.name}.prototype.${String(t)}`);s=Et(t)}o=kt(s,n&&n.updateState)}return{name:s,change:o}}const Tt=new y("attribute-registry",{byDefault:e=>new Ot(e.get(at))});class Ot{constructor(e){this._context=e,this.attrs=new Map,e.whenReady((({elementType:e})=>this.define(e))),e.whenComponent((({mount:e})=>{e&&this.mount(e)}))}declareAttribute({name:e,change:n}){this.attrs.set(e,t(this.attrs.get(e),n))}define(e){const{attrs:t}=this;t.size&&(Object.defineProperty(e,"observedAttributes",{configurable:!0,enumerable:!0,value:At(e,[...t.keys()])}),Object.defineProperty(e.prototype,"attributeChangedCallback",{configurable:!0,enumerable:!0,value:jt(e,t)}))}mount(e){const{element:t}=e,{attrs:n}=this,s=[...n.keys()];if(!s.length)return;new(0,this._context.get(We).MutationObserver)((e=>e.forEach((e=>{const s=e.attributeName;return n.get(s)(Oe.of(t).component,t.getAttribute(s),e.oldValue)})))).observe(t,{attributes:!0,attributeFilter:s,attributeOldValue:!0})}}function At(e,t){const n=e.observedAttributes;if(Array.isArray(n)){const e=new Set(n);t.forEach((t=>e.add(t))),t=[...e]}return t}function jt(e,t){const n=e.prototype.attributeChangedCallback;return n?function(e,s,o){const r=t.get(e);r?r(Oe.of(this).component,o,s):n.call(this,e,s,o)}:function(e,n,s){t.get(e)(Oe.of(this).component,s,n)}}function Pt(e){return Pe((({type:t,key:n})=>{const s=Rt(t.prototype,n,e),{name:o}=s;return{componentDef:{define(e){e.get(Tt).declareAttribute(s)}},get:e=>Oe.of(e).element.getAttribute(o),set(e,t){const{element:n}=Oe.of(e);null!=t?n.setAttribute(o,t):n.removeAttribute(o)}}}))}function Nt(e){return Pe((({type:t,get:n,key:s})=>{const{name:o,change:r}=Rt(t.prototype,s,e);return{componentDef:{define(e){e.get(Tt).declareAttribute({name:o,change(e,t,s){n(e).call(e,t,s),r(e,t,s)}})}}}}))}function Bt(...e){return Ce({define(t){const n=t.get(Tt);for(const t of e)if("string"==typeof t){const e=Et(t);n.declareAttribute({name:e,change:kt(e)})}else for(const[e,s]of Object.entries(t)){const t=Et(e);n.declareAttribute({name:t,change:kt(t,s)})}}})}class Ft extends D{constructor(){super("component-state")}grow(e){const t=e.seed();let n;if(null!=t)n=t,e.insert(n);else{if(e.hasFallback)return;n=new $t,e.context.get(Oe).supply.whenOff((e=>n.done(e))),e.insert(n)}e.setup((({registry:e})=>{e.provide({a:Re,is:n.update})}))}}const Kt=new Ft;class $t extends M{static get[w](){return Kt}}const Mt=Symbol("state-property");function Vt(e){return[Mt,e]}function Lt(e,t,n,s){n!==s&&Oe.of(e).updateState(t,n,s)}function Ut({updateState:e}={}){return Pe((({get:t,set:n,key:s})=>{if(!1!==e){const o=n,r=function(e,t=!0){if(!0===t||"function"==typeof t){const n=Vt(e),s=!0===t?Lt:t;return(e,t,o)=>s(e,n,t,o)}return(e,n,s)=>{n!==s&&Oe.of(e).updateState(t,n,s)}}(s,e);n=(e,n)=>{const s=t(e);o(e,n),r(e,n,s)}}return{get:t,set:n}}))}class qt extends W{constructor(e,t,n){super(),this._context=e,this._name=t,this.supply=new d,this.on=this._context.get($t).track(n).onUpdate.do(z(((e,t,n,s)=>e(n,s))),F(this))}get it(){return this._context.element.getAttribute(this._name)}set it(e){this.supply.isOff||(null==e?this._context.element.removeAttribute(this._name):this._context.element.setAttribute(this._name,e))}}function Wt(e,t,n=Dt(t)){return new qt(e,t,n)}const zt=new y("dom-property-registry",{byDefault:e=>new Ht(e.get(at))});class Ht{constructor(e){this.props=new Map,e.whenReady((({elementType:e})=>this.define(e))),e.whenComponent((({mount:e})=>{e&&this.mount(e)}))}declareDomProperty({key:e,descriptor:t}){this.props.set(e,t)}define(e){const t=e.prototype;this.props.forEach(((e,n)=>{Object.defineProperty(t,n,e)}))}mount({element:e}){this.props.forEach(((t,n)=>{Object.defineProperty(e,n,t)}))}}const It=Symbol("dom-property");function Jt(e){return[It,e]}function Zt(e,t,n,s){n!==s&&Oe.of(e).updateState(t,n,s)}function Gt(e={}){return Pe((t=>{const{key:n,get:s}=t;let{set:o}=t;const r=function(e,{propertyKey:t=e.key,configurable:n=e.configurable,enumerable:s=e.enumerable,writable:o=e.writable}){const r=e.key;return{key:t,descriptor:{configurable:n,enumerable:s,get:function(){return Oe.of(this).component[r]},set:o?function(e){Oe.of(this).component[r]=e}:void 0}}}(t,e);if(!1!==e.updateState){const t=function(e,t=!0){if(!0===t||"function"==typeof t){const n=Jt(e),s=!0===t?Zt:t;return(e,t,o)=>s(e,n,t,o)}return(e,n,s)=>{n!==s&&Oe.of(e).updateState(t,n,s)}}(n,e.updateState),r=o;o=(e,n)=>{const o=s(e);r(e,n),t(e,n,o)}}return{componentDef:{define(e){e.get(zt).declareDomProperty(r)}},get:s,set:o}}))}const Qt=Symbol("render"),Xt={spec:(e,t)=>s(t,e),fulfill(e,t={}){const{on:n=t.on,error:s}=e;return{on:n,error:s?s.bind(e):t.error&&t.error.bind(t)}},trigger(e,t={}){const{on:n=[]}=t;if(("object"==typeof n||"function"==typeof n)&&N(n))return B(n).do(F(e));const s=e.get($t).track(n).onUpdate.do(F(e));return Array.isArray(n)&&!n.length?s.do(K(((e,t)=>t[0]!==Qt&&e()))):s}};class Yt{constructor(e){this._context=e,this._renders=new Set}renderBy(t,n={}){const s=Xt.spec(this._context,n),o=Xt.trigger(this._context,s),r=this._context.get(Ze)({...Xt.fulfill(s),node:this._context.element}),i="connected"===s.when;let c=1;const a=o(i?()=>this._context.connected&&d():()=>this._context.settled&&d()).needs(this._context).whenOff((function(){2===c&&r(e);c=-1}));(i?this._context.whenConnected:this._context.whenSettled)((()=>c&&d()));const u=Y();return this._renders.add(h),a.whenOff((()=>this._renders.delete(h)));function d(){c=2,r(l)}function h(){u(l)}function l(e){if(c>0)for(c=0;;){const n=t(e);if(n===t||"function"!=typeof n)break;t=n}}}renderNow(){this._renders.forEach((e=>e()))}}const en=new y("element-render-ctl",{byDefault:e=>new Yt(e.get(Oe))});const tn=new y("element-render-scheduler",{byDefault:function(t){const n=t.get(en);return(t={})=>{const s=A(e);return n.renderBy((e=>{s.it(e)}),Xt.fulfill({on:s.on},t)),e=>{s.it=t=>e(t)}}}});function nn(e){return Pe((({get:t})=>({componentDef:{define(n){n.whenComponent((n=>{n.whenReady((()=>{const{component:s}=n,o=t(s).bind(s);n.get(en).renderBy(o,e)}))}))}}})))}const sn=new y("shadow-content-root");class on extends Event{get shadowRoot(){return this.target.shadowRoot}}const rn=new _("shadow-root-builder",{byDefault:()=>cn});function cn(e,t){const n=function(e,t){const n=e.shadowRoot;if(n)return n;if("attachShadow"in e)return e.attachShadow(t);return}(e.element,t);return n&&(n[Te]=e,e.whenConnected((()=>e.dispatchEvent(new on("wesib:shadowAttached",{bubbles:!0}))))),n}const an={mode:"open"};function un(e=an){return Ce({setup(t){t.perComponent({a:sn,by:t=>t.get(rn)(t,e)}),t.perComponent({a:Se,by:e=>e.get(sn,{or:null})})}})}const dn=new S("https://wesib.github.io/ns","b","wesib");export{Bt as A,We as B,Ce as C,Gt as D,en as E,he as F,nn as R,Ut as S,dn as W,se as a,vt as b,Pt as c,Pe as d,Oe as e,Xt as f,ve as g,Qt as h,Nt as i,un as j,Jt as k,He as l,tn as m,ne as n,ie as o,Te as p,Xe as q,ze as r,Ye as s,Wt as t,oe as u,$t as v,Vt as w};//# sourceMappingURL=wesib.a2d60763.js.map
