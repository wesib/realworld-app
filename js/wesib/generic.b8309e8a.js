import{n as e,d as t,g as n,c as r,b as s,v as i,h as o,f as a}from"../lib/call-thru.3be1c170.js";import{i as u,a as c,c as l,m as h,g as f,f as d,b as p,h as g,A as m}from"../lib/a-iterable.01fedd29.js";import{b as _,C as w,a as b,c as y,F as v,d as x,S as O}from"../lib/context-values.10677615.js";import{b as k,l as S,a as R,f as U,m as A,h as C,t as E,O as j,A as L,D,E as F,e as N,r as M,o as T,s as P,d as q,V as I,j as K,i as z,u as $,q as B,p as W,g as H}from"../lib/fun-events.f47c7338.js";import{c as V,h as J}from"../lib/namespace-aliaser.535f16ce.js";import{C as G,k as Q,l as X,j as Y,m as Z,B as ee,e as te,n as ne,o as re,p as se,q as ie,E as oe,W as ae,a as ue,r as ce,s as le,u as he,h as fe,v as de,d as pe}from"./wesib.4cfe016a.js";import{l as ge,m as me,n as _e,o as we,p as be}from"../lib/input-aspects.e48d1860.js";function ye({$:e,n:t,t:n,v:r,x:s=[],p:i={},pl:o=[]}){return{$:e,n:t,t:n,v:r,x:s,p:i,pl:o}}function ve({p:e,pl:t},n){const r=n.n||n.v,s=e[r];(!s||!s.n&&n.n)&&(e[r]=n),t.push(n)}function xe(e){return t=>{const n=t.s[t.i];return t.d=e.delimiterOf(n),n}}const Oe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), \d\d (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) \d\d\d\d \d\d:\d\d:\d\d GMT/;function ke(e,t){return e.s=e.s.substring(e.i),e.i=0,!!e.s.match(Oe)&&(t(e.s.substring(e.i,e.i+=29)),!0)}const Se=()=>!1;function Re(e,{named:t=!0,tagged:n=!0,extra:r=!0,next:s=xe(e)}={}){const i=function(e){return(t,n)=>{let r="";for(++t.i;t.i<t.s.length;++t.i){const s=t.s[t.i];if("\\"===s){const e=t.s[++t.i];r+=e||s}else{if(65536&e.delimiterOf(s))return++t.i,void n(r);r+=s}}n(r)}}(e),o=function(e){return(t,n)=>{if(!(262144&e.delimiterOf(t.s[t.i])))return!1;let r="";for(++t.i;t.i<t.s.length;){const n=t.s[t.i++];if(524288&e.delimiterOf(n))break;r+=n}return n(r),!0}}(e),a=r?Re(e,{next:s,tagged:!1,named:!1,extra:!1}):Se;return(e,r)=>{let u,c,l,h="",f="raw";for(;e.i<e.s.length;){const r=s(e);if(e.d){if(12&e.d)break;if(null==c){if(16&e.d){c=h?"":r,++e.i;continue}if(65536&e.d){!n&&h||i(e,e=>{h?(f="tagged-string",u=h):f="quoted-string",h="",c=e});break}if(!h&&o(e,e=>{f="angle-bracketed-string",c=e}))break;c=h,h=""}else{if(65536&e.d){!n&&c||i(e,e=>{c?(f="tagged-string",u=c):f="quoted-string",c=e});break}if(!c&&o(e,e=>{f="angle-bracketed-string",c=e}))break}}if(null==c){if(!h&&ke(e,e=>c=e)){f="date-time";break}t?h+=r:c=r}else{if(!c&&ke(e,e=>c=e)){f="date-time";break}c+=r}++e.i}if(null==c){if(!h)return!1;l=ye({$:f,v:h})}else l=ye({$:f,n:h||void 0,t:u,v:c});for(;a(e,e=>l.x.push(e)););return r(l),!0}}function Ue(e){return t=>{let n=t.s[t.i];return"\\"!==n?(t.d=e.delimiterOf(n),n):(++t.i,t.i<t.s.length?(n=t.s[t.i],t.d=e.delimiterOf(n)?1:0):t.d=1,n)}}function Ae(e){return t=>{const n=t.i;do{const n=t.s[t.i];if(!(2&e.delimiterOf(n)))break;t.i++}while(t.i<t.s.length);return t.i!==n}}function Ce(e,t={}){const n=Ae(e),r=Re(e,Object.assign(Object.assign({},t),{tagged:!1}));return(t,s)=>!!(8&e.delimiterOf(t.s[t.i]))&&(++t.i,n(t),r(t,s))}const Ee={" ":7,"\t":7,",":5,";":9,'"':65569,"\\":33,"<":262145,">":524289,"=":17,"(":1,")":1,"/":1,":":1,"?":1,"@":1,"[":1,"]":1,"{":1,"}":1};function je({delimit:e}={}){const t=e?Object.assign(Object.assign({},Ee),e):Ee;return{delimiterOf:e=>t[e]||(e>="\0"&&e<=" "||"\x7f"===e?1:0)}}const Le=je(),De=je({delimit:{":":17,"(":131105,")":37," ":3,"\t":3,"=":1,",":1}});function Fe(e){var t;const n=e?je(e):Le,r=function(e){const t=Ae(e);return n=>!!(4&e.delimiterOf(n.s[n.i]))&&(n.i++,t(n),!0)}(n),s=Ce(n),i=Re(n),o=(null===(t=e)||void 0===t?void 0:t.comments)?function(e){const t=Ae(e),n={next:Ue(e)},r=Re(e,n),s=Ce(e,n);return(n,i)=>{if(!(131072&e.delimiterOf(n.s[n.i])))return!1;let o;for(++n.i;t(n)||s(n,e=>{o||(o=ye({$:"raw",v:""})),ve(o,e)})||r(n,e=>o=e););return++n.i,i(o||ye({$:"raw",v:""})),!0}}(De):Se;return e=>{const t=[],n={i:0,s:e};for(;n.i<n.s.length&&(r(n)||s(n,e=>{t.length||t.push(ye({$:"raw",v:""})),ve(t[t.length-1],e)})||o(n,e=>t.push(e))||i(n,e=>t.push(e))););return t}}const Ne=Fe();function Me(e){if(!e)return'""';let t,n=!1;for(let r=0;r<e.length;++r){const s=e[r],i=Le.delimiterOf(s);i?(32&i&&(t||(t=e.substring(0,r)),t+="\\"+s),n=!0):t&&(t+=s)}return n?`"${t||e}"`:e}class Te extends x{constructor(e){super(e),this.upKey=this.createUpKey(e=>e.seed.keepThru((...t)=>{if(t.length)return r(function(e){return(t,n)=>{const r=(n,s)=>{const i=e[n];return i?P(i((e=s)=>r(n+1,e),s)):t(s)};return r(0,n)}}(t));const n=()=>R(Pe);return k(e.byDefault(n)||n())}))}grow(e){let t;return e.context.get(this.upKey,"or"in e?{or:null!=e.or?R(e.or):e.or}:void 0).to(e=>t=e),(e,n)=>t(e,n)}}function Pe(e,t){return e(t)}const qe=new Te("http-fetch-agent"),Ie={};const Ke=new v("http-fetch",{byDefault:ue((function(e){const t=e.get(ee),n=e.get(qe);return(e,t)=>n(r,new Request(e,t));function r(e){return N(n=>{const r=new F;let s;if("AbortController"in t){const i=new t.AbortController,{signal:o}=i;s=C(e=>{e===Ie&&i.abort()}),n.supply.whenOff(()=>s.off(Ie)).needs(s),r.on({supply:s,receive(e,t){n.receive(e,t)}});const a=e.signal;a&&(new D(a).on("abort").once(()=>i.abort()),a.aborted&&i.abort()),e=new Request(e,{signal:o})}else s=r.on(n);t.fetch(e).then(e=>{r.send(e),s.off()}).catch(e=>s.off(e))})}}))});const ze=new b("hierarchy-root",{byDefault:e=>{const t=e.get(se);return new D(t).on("wesib:component").to(({context:e})=>e.get(Be).issue()),E()}}),$e=new b("hierarchy-updates",{byDefault:e=>new Be(e.get(te))});class Be{constructor(e){const t=new F,n=e.get(ne).get(ze);this.on=t.on(),this.send=()=>t.send(e),this.issue=()=>{const t=We(e);t?t[0].get(Be).send():n.it=e}}static get[w](){return $e}}function We(e){const t=e.get(ne).get(se);let n=e.element,r=!0;if(n!==t)for(;;){const e=n.parentNode;if(!e)return;const s=e[ie];if(s)return[s,r];if(e===t)return;r=!1,n=e}}const He=new b("hierarchy-context",{byDefault:e=>new Je(e.get(te))});class Ve extends _{static get[w](){return He}}class Je extends Ve{constructor(t){super(),this.context=t;const n=this._registry=(r=this.up(),new y(t=>r.keepThru(n=>n?k(n.get(t)):e())));var r;this.get=n.newValues().get}provide(e){return this._registry.provide(e)}up(e){return(this.up=A(e=>{const t=E(),n=C().needs(e.supply),r=C().needs(e.supply),s=()=>{const e=We(this.context);if(e){const[s,i]=e;t.it=s.get(Ve),n.off(),i&&r.off()}else t.it=void 0};this.context.get(ne).get(ze).read({supply:n,receive:()=>this.context.connected&&s()}),t.read().tillOff(r).consume(e=>e&&e.context.get(Be).on.to(s)),t.read(e),this.context.whenOn({supply:e.supply,receive:(e,n)=>{s(),n.whenOff(()=>{Promise.resolve().then(()=>this.context.connected||(t.it=void 0))})}})}).share().F)(e)}}const Ge=new b("component-node");class Qe extends m{[j](){return this.onUpdate()}[L](){return this.read()}}const Xe={subtree:!0};function Ye(t,s,i,o,{deep:d,all:p}){const _=new F,w=d?Xe:void 0;let b,y,v=new Set;const x=d?Ze:c;"string"==typeof i?y=i:t.whenDefined(i).then(({elementDef:{name:e}})=>{if(b=void 0,e&&(y=J.name(e,t.get(Y)),_.size)){const e=O();if(e.size){const t=Array.from(l(h(e,e=>o(e)),n));t.length&&_.send(t,[])}}}),p||s.addEventListener("wesib:component",e=>{const t=e.target;if(v.has(t)){const e=o(t);_.send([e],[])}});return new class extends Qe{onUpdate(e){const n=t.get(le)(k);return(this.onUpdate=N(e=>{const t=!_.size,r=_.on(e);return t&&(O(),n.observe(s,w)),r.whenOff(()=>{_.size||n.disconnect()})}).F)(e)}read(e){return(this.read=q(this.onUpdate().thru(()=>this),a(this)).F)(e)}track(t){const n=this.onUpdate().thru((t,n)=>e(m.of(t),m.of(n)));return(this.track=A(e=>{const t=new F;t.on(e),t.send(this,m.of([])),n.to(e)}).F)(t)}first(e){return(this.first=U(this.read()).keepThru(e=>r(g(e))).F)(e)}[Symbol.iterator](){return f(b||(b=l(h(_.size?v:O(),e=>o(e)),n)))}};function O(){return b=void 0,v=function(){const e=y;if(!e)return new Set;if(d)return new Set(c(s.querySelectorAll(e)));return new Set(l(c(s.children),t=>t.matches(e)))}()}function k(e){const t=[],r=[];e.forEach(e=>{u(l(h(x(e.removedNodes),R),n),e=>r.push(e)),u(l(h(x(e.addedNodes),S),n),e=>t.push(e))}),(t.length||r.length)&&_.send(t,r)}function S(e){if(ce(e))return y&&e.matches(y)&&!v.has(e)?(v.add(e),o(e)):void 0}function R(e){if(ce(e)&&v.delete(e))return o(e,!0)}}function Ze(e){return d(c(e),e=>[e,...Ze(e.childNodes)])}class et{constructor(e,t){this._bs=e,this.element=t,this._emitters=new Map}get observer(){if(this._observer)return this._observer;const e=this._bs.get(ee).MutationObserver;return this._observer=new e(e=>this._update(e))}observe(e,t){const n=this,r=this.observer,s=this._emitter(e),i=M(t),o=s.on({supply:C(()=>{this._emitters.delete(e),r.disconnect(),this._emitters.size?a():this._observer=void 0}).needs(i.supply),receive:(e,t,n)=>i.receive(e,t,n)});return r.disconnect(),a(),o;function a(){n._update(r.takeRecords()),r.observe(n.element,{attributes:!0,attributeOldValue:!0,attributeFilter:Array.from(n._emitters.keys())})}}_update(e){e.forEach(e=>{const t=e.attributeName,n=this._emitters.get(t);n&&n.send(this.element.getAttribute(t),e.oldValue)})}_emitter(e){const t=new F;return this._emitters.set(e,t),t}}class tt extends I{constructor(e,t){super(),this._observer=e,this._name=t,this._updates=new F}get[K](){return z(this._updates)}get it(){return this._observer.element.getAttribute(this._name)}set it(e){null!=e?this._observer.element.setAttribute(this._name,e):this._observer.element.removeAttribute(this._name)}on(e){let t=B();return(this.on=N(e=>{this._updates.size||(t=this._observer.observe(this._name,(e,t)=>this._updates.send(e,t))),e.supply.needs(t),this._updates.on(e).whenOff(e=>{this._updates.size||t.off(e)})}).F)(e)}}class nt{constructor(e,t){this._attrs=new Map,this._observer=new et(e,t)}get(e){const t=this._attrs.get(e);if(t)return t;const n=new tt(this._observer,e);return this._attrs.set(e,n),n}}class rt extends I{constructor(e,t){super(),this._element=e,this._key=t,this._updates=new F}get[K](){return z(this._updates)}get it(){return this._element[this._key]}set it(e){this._element[this._key]=e}on(e){return(this.on=this._updates.on().F)(e)}bind(e){e.get(he).track(fe(this._key)).onUpdate().to({supply:z(this),receive:(e,t,n,r)=>this._updates.send(n,r)})}}class st{constructor(e){this._element=e,this._props=new Map}bind(e){this._context=e,this._props.forEach(t=>t.bind(e))}get(e){const t=this._props.get(e);if(t)return t;const n=new rt(this._element,e);return this._context&&n.bind(this._context),this._props.set(e,n),n}}const it=Symbol("element-node");class ot{constructor(e,t){this._bs=e,this.element=t,this._attrs=new nt(e,t),this._props=new st(t),t[it]=this;const n=t[ie];n?this._bind(n):t.addEventListener("wesib:component",e=>this._bind(e.context))}get context(){return this.element[ie]}get parent(){const e=this.element.parentNode;return e&&at(this._bs,e)}select(e,t){return function(e,t,n,r={}){if(r.all)return Ye(e,t,n,(t,n)=>at(e,t,n),r);const s=e.get(oe);return Ye(e,t,n,(t,n)=>s(t)&&at(e,t,n),r)}(this._bs,this.element,e,t)}attribute(e){return this._attrs.get(e)}property(e){return this._props.get(e)}_bind(e){this._props.bind(e)}}function at(e,t,n){const r=t[it];return r||n?r:new ot(e,t)}const ut={needs:re,setup(e){e.perComponent({a:Ge,by:e=>at(e.get(ne),e.element)})}};class ct{static get[Q](){return ut}}function lt(e){return new URL(e.hash.substring(1),e.origin)}function ht(e,t){if(t.origin!==e.origin||t.username)return new URL("#"+t,e);const{pathname:n,search:r,hash:s}=t,i=new URL("",e);return i.hash=r||s||n.length>1?n+r+s:r+s,i}const ft=Symbol("page-param");class dt{get[ft](){return this}byDefault(e,t){}}class pt extends dt{create(e,t){let n;const r={get:()=>n,put(t){n="string"==typeof t?new URL(t,e.url.origin):t}};return r.put(t),r}}const gt=new pt;class mt extends dt{create(e,t){const n={get:()=>e.get(gt)||lt(e.url),put(t){e.put(gt,t)}};return n.put(t),n}byDefault(e){return this.create(e,null)}}const _t=new mt;class wt extends x{constructor(e){super(e),this.upKey=this.createUpKey(e=>{const{document:t}=e.context.get(ee);return e.seed.keepThru((...n)=>{if(n.length)return r((function(e,r,s,i){return function i(o,a){const u=n[o];if(!u)return e(a);u(({url:e=a.url,title:n=a.title,data:r=a.data}=a)=>i(o+1,{url:new URL(String(e),t.baseURI),title:n,data:r,get visited(){return a.visited},get current(){return a.current},get:e=>a.get(e),put(e,t){a.put(e,t)}}),r,s,a)}(0,i)}));const s=()=>R(bt);return k(e.byDefault(s)||s())})})}grow(e){let t;return e.context.get(this.upKey,"or"in e?{or:null!=e.or?R(e.or):e.or}:void 0).to(e=>t=e),(e,n,r,s)=>t(e,n,r,s)}}function bt(e,t,n,r){e(r)}const yt=new wt("navigation-agent"),vt=new b("navigation");class xt{static get[w](){return vt}[j](){return this.on()}[L](){return this.read()}back(){this.go(-1)}forward(){this.go(1)}reload(){this.go()}}class Ot extends _{}const kt=new b("nav-history",{byDefault:ue(e=>new Rt(e))});function St(e){return null==e||"object"!=typeof e?{data:e}:e["wesib:navigation:data"]}class Rt{constructor(e){this._context=e,this._entries=new Map,this._lastId=0;const t=e.get(ee);this._document=t.document,this._location=t.location,this._history=t.history,this._uid=btoa(String(Math.random()))}static get[w](){return kt}init(){const{data:e}=St(this._history.state),t=this.newEntry({url:new URL(this._location.href),data:e,title:this._document.title});return this._entries.set(t.id,t),t.schedule(()=>{t.enter("init"),this._history.replaceState(this._historyState(t),"")}),t}newEntry(e){return new Ut(this._context,++this._lastId,e)}open(e,t){const{page:{title:n="",url:r}}=e;this._history.pushState(this._historyState(e),n,r.href),this._enter("open",e,t)}_enter(e,t,n){const r=n.it;this._entries.set(t.id,t);try{for(let e=r.next;e;e=e.next)this._forget(e)}finally{t.prev=r,r.next=t,t.schedule(()=>{try{r.leave()}finally{t.enter(e)}}),n.it=t}}replace(e,t){const n=t.it,{page:{title:r="",url:s}}=e;this._history.replaceState(this._historyState(e),r,s.href),this._entries.set(e.id,e);const i=n.prev;i&&(e.prev=i,i.next=e),e.schedule(()=>{try{n.leave()}finally{try{this._forget(n)}finally{e.enter("replace")}}}),t.it=e}popState(e,t){const{state:n}=e;if(null==n)return null==this._history.state?this._changeHash(t):void 0;const r=t.it,{uid:s,data:i,id:o}=St(n);let a;const u=s===this._uid&&null!=o?this._entries.get(o):void 0;return u?a=u:(a=this.newEntry({url:new URL(this._location.href),data:i,title:this._document.title}),r.transfer(a,"return"),this._entries.set(a.id,a),this._history.replaceState(this._historyState(a),"")),a.schedule(()=>{try{r.leave()}finally{a.enter("return")}}),t.it=a,a}hashChange(e){if(null==this._history.state)return this._changeHash(e)}update(e,t){const n=e.it,r=new Ut(this._context,++this._lastId,Object.assign(Object.assign({},n.page),{url:t}),n);return this._entries.set(r.id,r),this._history.replaceState(this._historyState(r),"",t.href),this._entries.delete(n.id),e.it=r}_changeHash(e){const t=e.it,n=this.newEntry({url:new URL(this._location.href),data:null,title:this._document.title});try{t.transfer(n,"enter")}finally{this._history.replaceState(this._historyState(n),""),this._enter("enter",n,e)}return n}_forget(e){this._entries.delete(e.id),e.forget()}_historyState({id:e,page:{data:t}}){return{"wesib:navigation:data":{uid:this._uid,id:e,data:t}}}}class Ut{constructor(e,n,r,s){this._bsContext=e,this.id=n,this._status=0,this._update=t,this._params=s?s._params:new Map;const i=this;this.page={get url(){return r.url},get title(){return r.title},get data(){return r.data},get visited(){return!!i._status},get current(){return 2===i._status},get:e=>i.get(e),put(e,t){i.put(e,t)}}}get(e){const t=e[ft],n=this._params.get(t);if(n)return n.get();const r=t.byDefault(this.page,this._newContext());return r&&this._init(t,r)}put(e,t){const n=e[ft],r=this._params.get(n);return r?(r.put(t),r.get()):this._init(n,n.create(this.page,t,this._newContext()))}_newContext(){const e=new y(this._bsContext);return new class extends Ot{constructor(){super(...arguments),this.get=e.newValues().get}}}_init(e,t){return this._params.set(e,t),this.page.current&&t.enter&&t.enter(this.page,"init"),t.get()}transfer(e,t){u(this._params.entries(),([n,r])=>{if(r.transfer){const s=r.transfer(e.page,t);s&&e._params.set(n,s)}})}stay(e){u(this._params.values(),t=>t.stay&&t.stay(e))}enter(e){this._status=2,u(this._params.values(),t=>t.enter&&t.enter(this.page,e))}leave(){this._status=1,u(this._params.values(),e=>e.leave&&e.leave())}forget(){u(this._params.values(),e=>e.forget&&e.forget()),this._params.clear()}schedule(e){this._update=e}apply(){const e=this._update;this._update=t,e()}}class At extends Event{constructor(e,t){super(e,Object.assign(Object.assign({},t),{cancelable:!1})),this.when=t.when,this.to=t.to}}class Ct extends Event{constructor(e,t){super(e,Object.assign(Object.assign({},t),{cancelable:!0})),this.when=t.when,this.from=t.from,this.to=t.to}}class Et extends Event{constructor(e,t){super(e,Object.assign(Object.assign({},t),{cancelable:!0})),this.from=t.from,this.to=t.to,this.reason=t.reason}get when(){return"stay"}}function jt(e){const n=e.get(ee),{document:r,history:s}=n,i=new D(n),o=e.get(Rt),a=e.get(yt),u=E(o.init());u.read(e=>e.apply());let c=Promise.resolve();i.on("popstate").to(e=>{const t=o.popState(e,u);t&&i.dispatch(new At("wesib:enterPage",{when:null!=e.state?"return":"enter",to:t.page}))}),i.on("hashchange").to(()=>{const e=o.hashChange(u);e&&i.dispatch(new At("wesib:enterPage",{when:"enter",to:e.page}))});return new class extends xt{get page(){return u.it.page}get length(){return s.length}onEnter(e){return(this.onEnter=i.on("wesib:enterPage").F)(e)}onLeave(e){return(this.onLeave=i.on("wesib:leavePage").F)(e)}onStay(e){return(this.onStay=i.on("wesib:stayOnPage").F)(e)}on(e){return(this.on=$(this.onEnter(),this.onLeave(),this.onStay()).F)(e)}read(e){return(this.read=u.read().keepThru(e=>e.page).F)(e)}go(e){s.go(e)}open(e){return f("pre-open","open",e)}replace(e){return f("pre-replace","replace",e)}update(e){return o.update(u,l(e)).page}with(e,t){return function e(t){return{with:(n,r)=>e(de(t,e=>e.put(n,r))),open:e=>f("pre-open","open",e,t),replace:e=>f("pre-replace","replace",e,t),pretend(e,n=((e,t)=>t)){let r;"function"==typeof e?(n=e,r=void 0):r=e;const s=h(r),i=u.it,o=d("pretend",i,s,t);try{return p("pretend",i,s,o)?n(i.page,o.page):void 0}finally{o.stay(u.it.page)}}}}(n=>n.put(e,t))}};function l(e){return"string"==typeof e?new URL(e,r.baseURI):e||u.it.page.url}function h(e){return null==e||"string"==typeof e||e instanceof URL?{url:l(e)}:e.url instanceof URL?e:Object.assign(Object.assign({},e),{url:l(e.url)})}function f(e,n,r,s=t){const a=h(r),l=c=c.then(f,f);return l;function f(){let t=void 0;try{const r=function(){if(c!==l)return g();const t=u.it,n=d(e,t,a,s),r=new Ct("wesib:leavePage",{when:e,from:t.page,to:n.page});if(!i.dispatch(r)||c!==l||!p(e,t,a,n))return g(n);return n}();return r?(t=r,o[n](t,u),i.dispatch(new At("wesib:enterPage",{when:n,to:t.page})),t.page):r}catch(e){throw g(t,e),e}}function g(e,t){return e&&e.stay(u.it.page),i.dispatch(new Et("wesib:stayOnPage",{from:u.it.page,to:a,reason:t})),null}}function d(e,t,n,r){const s=o.newEntry(n);try{t.transfer(s,e),r(s.page)}catch(e){throw s.stay(u.it.page),e}return s}function p(e,t,n,r){let s=!1;return a(({url:e,data:t,title:r})=>{s=!0,n.url=e,n.data=t,n.title=r},e,t.page,r.page),s}}const Lt={setup(e){e.provide({a:xt,by:jt})}};class Dt{static get[Q](){return Lt}}const Ft={needs:Dt,setup(e){e.provide({a:yt,is:Mt})}};class Nt{static get[Q](){return Ft}}function Mt(e,t,n,r){const s=r.get(gt);s?e({url:ht(r.url,s)}):e()}function Tt(n={}){const{select:r="a",pick:s={all:!0,deep:!0}}=n;return G({feature:{needs:[ct,Dt]},define(i){i.whenComponent(i=>{const o=function(e,n){const r=e.get(X),{active:s=zt}=n,i=V.name(s,e.get(Y)),o=n.activate?n.activate.bind(n):t;return e=>{const{element:t}=e.node,n=t[Kt]||(t[Kt]=r({node:t})),s=t=>{n(()=>((e,{node:t})=>{const n=t.element,{classList:r}=n;e?r.add(i):r.remove(i)})(t,e)),o(t,e)};let a;return s(!0),{supply(){const e=a=C(()=>{a===e&&s(!1)});return e}}}}(i,n),a=function(t){if(!t.weigh)return Pt;return n=>{const r=t.weigh(n);if("number"==typeof r)return R(n.node,r);let s=U(r).keepThru_(t=>e(n.node,t));return A(e=>{s.to({supply:C().needs(e.supply).whenOff(()=>{s=R(n.node,0),s.to(e)}),receive:e.receive.bind(e)})})}}(n),u=i.get(xt),c=i.get(Ge);i.whenOn(e=>{let t=new Map;u.read().tillOff(e).consume(e=>c.select(r,s).read().keepThru_(t=>k(S(...t.map(t=>a({node:t,context:i,page:e}))))).consume((...n)=>{const r=function(e){let t=0,n=[];return e.forEach(([e,r])=>{r>t?(t=r,n=[e]):r===t&&n.push(e)}),n}(n),s=new Map,a=C();return r.forEach(n=>{let r;const u=t.get(n);u?(s.set(n,u),r=u):(r=o({node:n,context:i,page:e}),s.set(n,r)),r.supply().needs(a)}),t=s,a}))})})}})}function Pt({node:e,page:t}){const n=e.element,r=n.getAttribute("href");if(null==r)return R(e,-1);const s=new URL(r,n.ownerDocument.baseURI);return R(e,function e(t,n){if(t.origin!==n.origin)return-1;const r=qt(t),s=qt(n);if(t.hash){if(r!==s)return-1;const i=It(t,n);return i<0||It(n,t)<0?-1:t.pathname.length+i+e(lt(t),lt(n))}const i=It(t,n);if(i)return i<0||r!==s?-1:t.pathname.length+i;if(!s.startsWith(r))return-1;return t.pathname.length}(s,t.url))}function qt(e){const t=e.pathname;return t.endsWith("/")?t:t+"/"}function It({searchParams:e},{searchParams:t}){let n=0;return e.forEach((r,s)=>{if(!function(e){return e.startsWith("__")&&e.endsWith("__")}(s)){const r=new Set(t.getAll(s));n>=0&&(e.getAll(s).every(e=>r.has(e))?n+=1:n=-1)}}),n}const Kt=Symbol("nav-link-render-schedule"),zt=["active",ae];function $t(e={}){const t=e.handle?e.handle.bind(e):function(e){const t=e.href?e.href.bind(e):Bt;return({event:e,page:n,navigation:r})=>{const s=t(e);if(null==s)return;const i=e.target,o=n.url,a=new URL(s,i.ownerDocument.baseURI);a.origin===o.origin&&(e.preventDefault(),o.href!==a.href&&r.open(s))}}(e),n=new Z(e.event||"click");return G({feature:{needs:Dt},define(e){e.whenComponent(e=>{e.whenOn(r=>{const s=e.get(xt);n.forEach(n=>{e.on(n).to({supply:r,receive(n,r){s.read().once(n=>t({event:r,page:n,context:e,navigation:s}))}})})})})}})}function Bt(e){return e.target.getAttribute("href")}function Wt(e,t,n,r=Ht){let s;"function"==typeof n?(r=n,s=null):s=n||null;const i=t.ownerDocument;if(ce(e)){const n=i.createElement(e.tagName.toLowerCase());return e.getAttributeNames().forEach(t=>n.setAttribute(t,e.getAttribute(t))),r(e,n),t.insertBefore(n,s),n}const o=i.importNode(e,!1);return t.insertBefore(o,s),o}function Ht(e,t){u(c(e.childNodes),e=>Wt(e,t))}function Vt(t){let n;return r=>{const i=function(e){return new URL("",e.url).href}(r);if(n){if(n.url===i)return n.on;n.sup.off()}let o;const a=C().whenOff(()=>{n=void 0,o=void 0}),u=N(n=>{if(!o){const n=t(r),i=E(),u=n.to(e=>{i.it=e}).whenOff(e=>{null!=e&&a.off(e)});a.cuts(u).cuts(i),o={on:i.read().thru_(t=>t?e(t):s()),num:0}}const i=o;return++i.num,i.on.tillOff(a).to(n).whenOff(e=>{--i.num||Promise.resolve().then(()=>{i.num||i!==o||a.off(e)})})});return n={url:i,on:u,sup:a},u}}class Jt extends Error{}const Gt=new class extends dt{create(e,n){return{get:()=>n,put:t}}};class Qt{constructor(e,t){this._navigation=e,this._loader=t,this._map=new Map}get fragments(){const e=[];for(const t of this){if(!t.fragment)return[];e.push(t.fragment)}return e}[Symbol.iterator](){return f(d(this._map.values()))}handle(){const e=this,t=C();let n=B();return{get(){},put(t){e._add(t)},transfer(t,n){if("pretend"===n)return;const r=e._transfer();return t.put(Gt,r),r.handle()},enter(r,s){if("init"===s)return;n=C().needs(t);const i=N(t=>{const s=new F,i=s.on(t);return e._loader(r).tillOff(n).to(e=>s.send(e)).whenOff(e=>{void 0===e||e instanceof Jt||s.send({ok:!1,page:r,error:e})}),i}).share();u(e,({fragment:e,receiver:t})=>function(e,t){return t?e.thru_(e=>e.ok?Object.assign(Object.assign({},e),{fragment:(null!=t.tag?e.document.getElementsByTagName(t.tag)[0]:e.document.getElementById(t.id))||void 0}):e):e}(i,e).to({supply:C().needs(t.supply),receive(e,n){t.receive(e,n)}}))},leave(){n.off(new Jt("page left"))},stay(){t.off(new Jt("navigation cancelled"))},forget(){t.off(new Jt("page forgotten"))}}}_add(e){const t=Object.assign(Object.assign({},e),{receiver:M(e.receiver)}),{supply:n}=t.receiver,r=this._map.get(n);r?r.push(t):(this._map.set(n,[t]),n.whenOff(()=>this._map.delete(n)))}_transfer(){const e=new Qt(this._navigation,this._loader);for(const[t,n]of this._map.entries())e._map.set(t,Array.from(n));return e}}const Xt=new Te("page-load-agent"),Yt=new v("page-load-url",{byDefault:i(t)}),Zt=new b("page-loader",{byDefault:ue((function(e){const t=e.get(ee),n=e.get(Ke),r=e.get(Yt),s=e.get(Xt),i=new t.DOMParser;return e=>{const t=new URL(e.url.href);r(t);const a=new Request(t.href,{mode:"same-origin",credentials:"same-origin",headers:new Headers({Accept:"text/html"})});return N(e=>s(u,a).to(e));function u(r){return function(e,t){var n;const r=null===(n=e.get(Gt))||void 0===n?void 0:n.fragments;r&&r.length&&t.headers.set("Accept-Fragment",p(r,(e,t)=>(e?e+", ":"")+(null!=t.tag?"tag="+Me(t.tag):"id="+Me(t.id)),""))}(e,r),N(s=>{const a=new W;a.on(s),a.send({page:e}),T(n(r).thru_(e=>Promise.all([e,e.text()]))).thru_((...e)=>o(e),([n,r])=>{if(!n.ok)return{ok:!1,page:e,response:n,error:n.status};try{return{ok:!0,page:e,response:n,document:en(i,t,n,r)}}catch(t){return{ok:!1,page:e,response:n,error:t}}}).to(s)})}}}))});function en(e,t,n,r){const s=e.parseFromString(r,Ne(n.headers.get("Content-Type")||"text/html")[0].v);if(s.head){const e=s.head.querySelector("base");if(e)e.href=new URL(e.getAttribute("href"),t).href;else{const e=s.createElement("base");e.href=t.href,s.head.appendChild(e)}}return s}class tn extends dt{create(e,t,n){const r=new Qt(n.get(xt),Vt(n.get(Zt))),s=r.handle();return e.put(Gt,r),s.put(t),s}}const nn=new tn,rn=new b("page-cache-buster",{byDefault:ue(e=>new sn(e))});class sn{constructor(e){const t=on(e.get(ee).document);if(t){const n=e.get(xt);this.urlModifier=R(e=>e.searchParams.set("__wesib_app_rev__",t)),this.agent=R((e,r)=>e(new Request(r.url,r)).thru_(e=>{if(e.ok){const r=on(e.document);if(r&&r!==t){const t=new URL(e.page.url.href);t.searchParams.set("__wesib_app_rev__",r),n.update(t),n.reload()}}return e}))}else this.urlModifier=R(),this.agent=R()}static get[w](){return rn}}function on(e){var t;return null===(t=e.querySelector("meta[name=wesib-app-rev]"))||void 0===t?void 0:t.getAttribute("content")}function an(e){const t=e.get(ee).document;return e=>e().thru_(e=>{if(e.ok){const n=new Set(h(un(t,c(t.scripts)),([e])=>e));u(l(un(e.document,c(e.document.querySelectorAll("script"))),([e])=>!n.has(e)),([e,r])=>{Wt(r,t.head,(t,n)=>n.src=e),n.add(e)})}return e})}function un(e,t){return h(l(t,e=>!!e.src),t=>[new URL(t.src,e.baseURI).href,t])}function cn(e){const t=e.get(ee).document;return e=>e().thru_(e=>{if(!e.ok)return e;const n=e.document.querySelectorAll("link[rel=stylesheet]");if(!n.length)return e;let r=t.head,s=null;const i=t.querySelectorAll("link[rel=stylesheet]"),o=new Map,a=i.item(0);return a&&(r=a.parentNode,s=a,u(c(i),e=>o.set(new URL(e.href,t.baseURI).href,e))),u(c(n),e=>{const n=new URL(e.href,t.baseURI).href,i=o.get(n);i?(g(o.keys())===n?(r=i.parentNode,s=i.nextSibling):r.insertBefore(i,s),o.delete(n)):Wt(e,r,s,(e,t)=>t.href=n)}),u(o.values(),e=>e.parentNode.removeChild(e)),e})}function ln(e){const t=e.get(ee).document;return e=>e().thru_(e=>{if(e.ok){const n=e.document.getElementsByTagName("title").item(0);n&&n.textContent&&(t.title=n.textContent)}return e})}const hn={needs:Dt,setup(e){e.provide({a:Yt,by:e=>e.urlModifier,with:[sn]}),e.provide({a:Xt,by:e=>e.agent,with:[sn]}),e.provide({a:Xt,by:an}),e.provide({a:Xt,by:cn}),e.provide({a:Xt,by:ln})}};class fn{static get[Q](){return hn}}function dn(e={}){const n=e.onResponse?e.onResponse.bind(e):t,r=e.contentKey?e.contentKey.bind(e):pn;return G({feature:{needs:fn},define(t){t.whenComponent(t=>{const s=t.get(ee).document,i=t.get(X)(),o=t.get(xt);let a=r(o.page);const u=()=>{const{fragment:n}=e;if(n)return n;const{element:{id:r,tagName:s}}=t;return r?{id:r}:{tag:s}};t.whenOn(e=>{const c=s.createRange();c.selectNodeContents(t.contentRoot),o.read().once(o=>{o.put(nn,{fragment:u(),receiver:{supply:e,receive:(e,o)=>function(e){const o=r(e.page);if(o===a)return;if(!e.ok)return void i(()=>n({context:t,range:c,response:e}));a=o,i(()=>{c.deleteContents();const r=s.createDocumentFragment(),{fragment:i}=e;i&&(Ht(i,r),c.insertNode(r)),n({context:t,range:c,response:e})})}(o)}})})})})}})}function pn({url:e}){return new URL("",e).href}class gn extends x{get upKey(){return this}constructor(){super("default-in-aspects")}grow(e){const t=e.context.get(Y);return H({scheduler:e.context.get(X[w].upKey),fns:e.seed}).keepThru(({scheduler:[e],fns:n})=>_e(...n,be.to(e),we.to(t)))}}const mn=new gn,_n=new O("input-from-control",{byDefault:()=>({})});function wn(e,t){const n=e.get(Ve).provide({a:_n,by:()=>({root:e,control:t})});return C(n).needs(t)}function bn(t){return G({define(n){n.whenComponent(n=>{const{up:s}=n.get(Ve);H({parent:s().keepThru_(e=>e?k(e.get(_n)):r({})),aspects:n.get(mn)}).keepThru_(({parent:[r],aspects:[s]})=>{if(r.control){const i=t({control:r,context:n,aspects:s});if(i)return i instanceof ge?e(i):k(i)}return e()}).consume((e,t)=>{if(!e)return;const r=wn(n,e);return(t||z(e)).needs(r),r})})}})}const yn=new O("input-to-form",{byDefault:()=>({})});function vn(t){const{select:n="form",pick:r={deep:!0,all:!0}}=t;return G({feature:{needs:ct},define(s){s.whenComponent(s=>{const i=s.get(Ge);s.whenOn(o=>{H({node:i.select(n,r).first(),aspects:s.get(mn)}).keepThru(({node:[n],aspects:[r]})=>{if(!n)return e();const i=t.makeForm({node:n,context:s,aspects:r});return i?Array.isArray(i)?e(...i):k(i):e()}).tillOff(o).consume((e,t,n)=>{if(!e)return;const r=function(e,t,n){const r=e.get(Ve),s=r.provide({a:yn,by:()=>({root:e,control:t,form:n})});return r.provide({a:_n,via:yn}),C(s).needs(t).needs(n)}(s,e,t);return n?n.needs(r):r.cuts(t).cuts(e),r})})})}})}function xn(e={}){const{cancel:t=!0}=e;return pe(({get:e})=>({componentDef:{define(n){n.whenComponent(n=>{n.whenOn(r=>{const s=n.get(Ve),{component:i}=n;s.get(yn).consume(n=>{if(!n.control)return;const s=new D(n.form.element);r.cuts(s);const o=s.on("submit");return(t?o.instead():o).to(t=>e(i).call(i,n,t))})})})}}}))}function On(e){const t="string"==typeof e?i(R(e)):t=>{const n=e(t);return"string"==typeof n?R(n):n};return G({define(e){e.whenComponent(e=>{const n=e.get(Ve);H({group:n.up().keepThru_(e=>e?k(e.get(_n)):r({}),({control:e})=>e&&e.aspect(me)),control:n.get(_n),name:t(e)}).consume(({group:[e],control:[{control:t}],name:[n]})=>{if(null!=n&&e&&t&&e!==t)return e.controls.set(n,t)})})}})}function kn(t){const{select:n="input",pick:r={deep:!0,all:!0}}=t;return G({feature:{needs:ct},define(s){s.whenComponent(s=>{const i=s.get(Ge);s.whenOn(o=>{H({node:i.select(n,r).first(),aspects:s.get(mn)}).keepThru(({node:[n],aspects:[r]})=>{if(!n)return e();const i=t.makeControl({node:n,context:s,aspects:r});return i?i instanceof ge?e(i):k(i):e()}).tillOff(o).consume((e,t)=>{if(!e)return;const n=wn(s,e);return(t||z(e)).needs(n),n})})})}})}export{Tt as A,bn as C,mn as D,vn as F,Ke as H,_n as I,xt as N,xn as O,_t as P,On as S,kn as U,Ve as a,ct as b,Ge as c,yn as d,dn as e,$t as f,dt as g,Nt as h,wn as i};//# sourceMappingURL=generic.b8309e8a.js.map
