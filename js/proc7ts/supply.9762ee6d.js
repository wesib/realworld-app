let t=n;function n(t){console.error("Supply aborted unexpectedly.",t)}let e,f=!1;function s(){const t=f;return f=!0,t}function r(n){if(f=n,!n){const n=e;if(n){e=void 0;for(const e of n)t(e)}}}const i=Symbol("SupplyState"),o={isOff:!0,off:c,whenOff(t,n){n()}};function u(t){return void 0===t?o:{isOff:!0,off:c,whenOff(n,e){e(t)}}}function c(t,n){}const h={isOff:!1,off(t,n){const f=s();try{t[i]=u(n),function(t){void 0!==t&&(e||(e=new Set),e.add(t))}(n)}finally{r(f)}},whenOff(t,n){t[i]=l(n)}};function l(t){return{isOff:!1,off(n,e){const f=s();try{n[i]=u(e),t(e)}finally{r(f)}},whenOff(n,e){const f=t;t=t=>{f(t),e(t)}}}}class O{constructor(t){this[i]=t?l(t):h}static onUnexpectedAbort(e){!function(e=n){t=e}(e)}get supply(){return this}get isOff(){return this[i].isOff}off(t){return this[i].off(this,t),this}whenOff(t){return this[i].whenOff(this,t),this}whenDone(){return new Promise(((t,n)=>this.whenOff((e=>void 0===e?t():n(e)))))}cuts(t){return t.supply.needs(this),this}needs(t){return t.supply.whenOff((t=>this.off(t))),this}as(t){return this.needs(t).cuts(t)}}class d extends O{get isOff(){return!1}off(t){return this}whenOff(t){return this}cuts(t){return this}needs(t){return this}}const a=new d;function p(){return a}function w(t){return t===a}class y extends O{get isOff(){return!0}off(){return this}whenOff(t){return t(),this}cuts(t){return t.supply.off(),this}needs(t){return this}}const S=new y;function x(){return S}export{O as S,p as a,w as i,x as n};//# sourceMappingURL=supply.9762ee6d.js.map
