{"version":3,"file":"pager.483b9b5d.js","sources":["../../../src/generic/pager/render-pager.decorator.ts"],"sourcesContent":["import { HandleNavLinks } from '@wesib/generic';\nimport {\n  BootstrapWindow,\n  ComponentClass,\n  ComponentContext,\n  ComponentDef,\n  ComponentProperty,\n  ComponentPropertyDecorator,\n  Render,\n} from '@wesib/wesib';\nimport { StatePath } from 'fun-events';\n\nexport type PagingInfo =\n    | PagingInfo.Empty\n    | PagingInfo.WithPages;\n\nexport namespace PagingInfo {\n\n  export interface Empty {\n    totalPages?: 0 | 1;\n    visiblePages?: number;\n    currentPage?: number;\n    pageHref?(page: number): string;\n  }\n\n  export interface WithPages {\n    totalPages: number;\n    visiblePages?: number;\n    currentPage?: number;\n    pageHref(page: number): string;\n  }\n\n}\n\nconst PagingInfo__symbol = Symbol('paging-info');\n\nexport function RenderPager<T extends ComponentClass>(): ComponentPropertyDecorator<PagingInfo, T> {\n  return ComponentProperty(({ get, set, key }) => {\n\n    const path: StatePath = [PagingInfo__symbol, key];\n    const componentDef = Render({ path }).As(\n        function (this: InstanceType<T>) {\n\n          const context = ComponentContext.of(this);\n          const { contentRoot }: { contentRoot: Node } = context;\n          const { document } = context.get(BootstrapWindow);\n          const range = document.createRange();\n\n          range.setStartAfter(contentRoot.appendChild(document.createComment(`[PAGER(${String(key)})[`)));\n          range.setEndBefore(contentRoot.appendChild(document.createComment(`]PAGER(${String(key)})]`)));\n\n          return () => {\n            range.deleteContents();\n\n            const pagingInfo = get(this);\n\n            if (!pagingInfo.totalPages || pagingInfo.totalPages <= 1) {\n              return;\n            }\n\n            const info = pagingInfo as PagingInfo.WithPages;\n            const { totalPages, visiblePages = 5, currentPage = 0 } = info;\n\n            const visible = Math.max(1, visiblePages);\n            const current = Math.max(0, currentPage);\n\n            const ul = document.createElement('ul');\n\n            ul.className = 'pagination';\n\n            let startPage = Math.max(0, current - (visible >> 1));\n            let endPage = startPage + visible;\n\n            if (endPage > totalPages) {\n              startPage = Math.max(0, startPage - (endPage - totalPages));\n              endPage = totalPages;\n            }\n\n            ul.appendChild(pageItem('<<', 0, current > 0));\n            ul.appendChild(pageItem('<', current - 1, current > 0));\n            for (let page = startPage; page < endPage; ++page) {\n              ul.appendChild(pageItem(String(page + 1), page, true, current === page));\n            }\n            ul.appendChild(pageItem('>', current + 1, current + 1 < totalPages));\n            ul.appendChild(pageItem('>>', totalPages - 1, current + 1 < totalPages));\n\n            range.insertNode(ul);\n\n            function pageItem(\n                text: string,\n                page: number,\n                enabled: boolean,\n                active = false,\n            ): HTMLLIElement {\n\n              const li = document.createElement('li');\n\n              li.className = 'page-item';\n\n              let link: HTMLElement;\n\n              if (enabled && !active) {\n                link = document.createElement('a');\n                link.setAttribute('href', info.pageHref(page));\n              } else {\n                li.classList.add(active ? 'active' : 'disabled');\n                link = document.createElement('span');\n              }\n              link.className = 'page-link';\n              link.innerHTML = text;\n              li.appendChild(link);\n\n              return li;\n            }\n          };\n        },\n        key,\n    );\n\n    return {\n      componentDef: ComponentDef.all(\n          componentDef,\n          HandleNavLinks(),\n      ),\n      get,\n      set(component, value) {\n\n        const prev = get(component);\n\n        set(component, value);\n        ComponentContext.of(component).updateState(path, value, prev);\n      },\n    };\n  });\n}\n"],"names":["PagingInfo__symbol","Symbol","RenderPager","ComponentProperty","get","set","key","path","componentDef","Render","As","context","ComponentContext","of","this","contentRoot","document","BootstrapWindow","range","createRange","setStartAfter","appendChild","createComment","String","setEndBefore","deleteContents","pagingInfo","totalPages","info","visiblePages","currentPage","visible","Math","max","current","ul","createElement","className","startPage","endPage","pageItem","page","text","enabled","active","li","link","setAttribute","pageHref","classList","add","innerHTML","insertNode","ComponentDef","all","HandleNavLinks","[object Object]","component","value","prev","updateState"],"mappings":"8HAkCA,MAAMA,EAAqBC,OAAO,wBAElBC,IACd,OAAOC,EAAkB,EAAGC,IAAAA,EAAKC,IAAAA,EAAKC,IAAAA,MAEpC,MAAMC,EAAkB,CAACP,EAAoBM,GACvCE,EAAeC,EAAO,CAAEF,KAAAA,IAAQG,IAClC,WAEE,MAAMC,EAAUC,EAAiBC,GAAGC,OAC9BC,YAAEA,GAAuCJ,GACzCK,SAAEA,GAAaL,EAAQP,IAAIa,GAC3BC,EAAQF,EAASG,cAKvB,OAHAD,EAAME,cAAcL,EAAYM,YAAYL,EAASM,cAAc,UAAUC,OAAOjB,UACpFY,EAAMM,aAAaT,EAAYM,YAAYL,EAASM,cAAc,UAAUC,OAAOjB,UAE5E,KACLY,EAAMO,iBAEN,MAAMC,EAAatB,EAAIU,MAEvB,IAAKY,EAAWC,YAAcD,EAAWC,YAAc,EACrD,OAGF,MAAMC,EAAOF,GACPC,WAAEA,EAAUE,aAAEA,EAAe,EAACC,YAAEA,EAAc,GAAMF,EAEpDG,EAAUC,KAAKC,IAAI,EAAGJ,GACtBK,EAAUF,KAAKC,IAAI,EAAGH,GAEtBK,EAAKnB,EAASoB,cAAc,MAElCD,EAAGE,UAAY,aAEf,IAAIC,EAAYN,KAAKC,IAAI,EAAGC,GAAWH,GAAW,IAC9CQ,EAAUD,EAAYP,EAEtBQ,EAAUZ,IACZW,EAAYN,KAAKC,IAAI,EAAGK,GAAaC,EAAUZ,IAC/CY,EAAUZ,GAGZQ,EAAGd,YAAYmB,EAAS,KAAM,EAAGN,EAAU,IAC3CC,EAAGd,YAAYmB,EAAS,IAAKN,EAAU,EAAGA,EAAU,IACpD,IAAK,IAAIO,EAAOH,EAAWG,EAAOF,IAAWE,EAC3CN,EAAGd,YAAYmB,EAASjB,OAAOkB,EAAO,GAAIA,GAAM,EAAMP,IAAYO,IAOpE,SAASD,EACLE,EACAD,EACAE,EACAC,GAAS,GAGX,MAAMC,EAAK7B,EAASoB,cAAc,MAIlC,IAAIU,EAaJ,OAfAD,EAAGR,UAAY,YAIXM,IAAYC,GACdE,EAAO9B,EAASoB,cAAc,KAC9BU,EAAKC,aAAa,OAAQnB,EAAKoB,SAASP,MAExCI,EAAGI,UAAUC,IAAIN,EAAS,SAAW,YACrCE,EAAO9B,EAASoB,cAAc,SAEhCU,EAAKT,UAAY,YACjBS,EAAKK,UAAYT,EACjBG,EAAGxB,YAAYyB,GAERD,EA7BTV,EAAGd,YAAYmB,EAAS,IAAKN,EAAU,EAAGA,EAAU,EAAIP,IACxDQ,EAAGd,YAAYmB,EAAS,KAAMb,EAAa,EAAGO,EAAU,EAAIP,IAE5DT,EAAMkC,WAAWjB,MA8BrB7B,GAGJ,MAAO,CACLE,aAAc6C,EAAaC,IACvB9C,EACA+C,KAEJnD,IAAAA,EACAoD,IAAIC,EAAWC,GAEb,MAAMC,EAAOvD,EAAIqD,GAEjBpD,EAAIoD,EAAWC,GACf9C,EAAiBC,GAAG4C,GAAWG,YAAYrD,EAAMmD,EAAOC"}