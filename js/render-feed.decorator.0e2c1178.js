import{d as e}from"./lib/call-thru.3be1c170.js";import{S as t,C as s,a}from"./lib/context-values.10677615.js";import{g as r,t as n,n as i}from"./lib/fun-events.f47c7338.js";import{d as o,i as l,e as c,B as p,S as d,D as u,C as f,r as h,R as g}from"./wesib/wesib.4cfe016a.js";import{_ as m}from"./helpers.920c7f83.js";import{n as b,b as C}from"./core/auth.b91b93f3.js";import{f as v,g as w,P as E,a as _,N as y}from"./wesib/generic.b8309e8a.js";import{C as P}from"./core.f6946162.js";import{R as x,a as j}from"./core/loader.dfe39bab.js";import{A as O}from"./article-buttons-support.feature.97b617e0.js";import{f as q,F as S,a as D,b as R}from"./core/feed.326d2eb7.js";import{a as A,C as M}from"./current-article.4d677396.js";const N=Symbol("paging-info");const I=new class extends w{create(e,t){const s=this.byDefault(e);return s.put(t),s}byDefault(e){return{get(){const{searchParams:t,pathname:s}=e.get(E);return{feed:"/personal-feed"===s?s:void 0,tag:t.get("tag")||void 0,limit:parseInt(t.get("limit")||"",10)||void 0,offset:parseInt(t.get("offset")||"",10)||void 0}},put(t){const{feed:s}=t,a=new URL(e.get(E).href);a.pathname="/personal-feed"===s?s:"";const r=q(t).toString();a.search=r?"?"+r:"",e.put(E,a)}}}};let k=class{constructor(e){this._context=e,this._article=new A,this.user=b;const t=e.get(C),s=e.get(_);e.whenOn(e=>{t.user().tillOff(e).to(e=>this.user=e).whenOff(()=>this.user=b);const a=s.provide({a:M,is:this._article});e.whenOff(a)})}get article(){return this._article.it}set article(e){this._article.set(e)}postMeta(){if(!this.article.slug)return;console.log("[article",this.article.slug);const{author:e}=this.article,{document:t}=this._context.get(p),s=t.createDocumentFragment(),a=s.appendChild(t.createElement("div"));a.className="post-meta",a.appendChild(t.createElement("conduit-article-author")),this.user.username===e.username?(a.appendChild(t.createElement("conduit-edit-post-btn")).tabIndex=0,a.appendChild(t.createElement("conduit-delete-post-btn")).tabIndex=0):a.appendChild(t.createElement("conduit-favorite-post-btn")).tabIndex=0;const r=s.appendChild(t.createElement("a"));return r.className="preview-link",r.setAttribute("href",`article/#/${encodeURIComponent(this.article.slug)}`),r.appendChild(t.createElement("h1")).innerText=this.article.title,r.appendChild(t.createElement("p")).innerText=this.article.description,r.appendChild(t.createElement("span")).innerText="Read more...",r.appendChild(t.createElement("conduit-article-tags")),console.log("]article",this.article.slug),s}};m([d()],k.prototype,"user",void 0),m([u({propertyKey:"feedArticle"})],k.prototype,"article",null),m([x()],k.prototype,"postMeta",null),k=m([f(["article-preview",P],{feature:{needs:[O]}},v({href(e){let t=e.target;for(;;){const e=t.getAttribute("href");if(null!=e)return e;const{parentNode:s}=t;if(!s||!h(s))return;t=s}}}))],k);const T=new t("feed-article-list",{byDefault:()=>({articles:[],articlesCount:0})});let F=class{constructor(e){this._context=e,this.articles={articles:[],articlesCount:0};const t=e.get(_);e.whenOn(e=>{t.get(T).tillOff(e).to(e=>this.articles=e)})}render(){const e=this._context.get(p).document,t=e.createRange();return t.selectNodeContents(this._context.contentRoot),()=>{if(t.deleteContents(),!this.articles.articlesCount)return;console.log("LIST");const s=e.createDocumentFragment();this.articles.articles.forEach(t=>{s.appendChild(e.createElement("conduit-article-preview")).feedArticle=t}),t.insertNode(s)}}};m([d()],F.prototype,"articles",void 0),m([g()],F.prototype,"render",null),F=m([f(["article-list",P],{feature:{needs:k}})],F);const L=new t("feed-request-page-param",{byDefault:()=>I});let H=class{constructor(e){this._feedPaging={};const t=e.get(_),s=e.get(y);e.whenOn(e=>{r({param:t.get(L),page:s,list:t.get(T)}).tillOff(e).to(({param:[e],page:[t],list:[{articlesCount:a}]})=>{const r=t.get(e),{limit:n=20,offset:i=0}=r;this.feedPaging={totalPages:Math.ceil(a/n),currentPage:Math.floor(i/n),pageHref(t){var a;return(null===(a=s.with(e,Object.assign(Object.assign({},r),{offset:n*t})).pretend())||void 0===a?void 0:a.url.href)||""}}})})}get feedPaging(){return this._feedPaging}set feedPaging(e){this._feedPaging=e}};m([o(({get:e,set:t,key:s})=>{const a=[N,s];return{componentDef:l.all(x({path:a,comment:`PAGER(${String(s)})`}).As((function(){const t=c.of(this),{document:s}=t.get(p),a=e(this);if(!a.totalPages||a.totalPages<=1)return;const r=a,{totalPages:n,visiblePages:i=5,currentPage:o=0}=r,l=Math.max(1,i),d=Math.max(0,o),u=s.createElement("ul");u.className="pagination";let f=Math.max(0,d-(l>>1)),h=f+l;h>n&&(f=Math.max(0,f-(h-n)),h=n),u.appendChild(g("<<",0,d>0)),u.appendChild(g("<",d-1,d>0));for(let e=f;e<h;++e)u.appendChild(g(String(e+1),e,!0,d===e));return u.appendChild(g(">",d+1,d+1<n)),u.appendChild(g(">>",n-1,d+1<n)),u;function g(e,t,a,n=!1){const i=s.createElement("li");let o;return i.className="page-item",a&&!n?(o=s.createElement("a"),o.setAttribute("href",r.pageHref(t))):(i.classList.add(n?"active":"disabled"),o=s.createElement("span")),o.className="page-link",o.innerHTML=e,i.appendChild(o),i}}),s),v()),get:e,set(s,r){const n=e(s);t(s,r),c.of(s).updateState(a,r,n)}}})],H.prototype,"feedPaging",null),H=m([f(["feed-pager",P])],H);const $=new a("render-feed-state"),B=Symbol("render-feed-state");class U{constructor(e,t){this.response=n(),this._request=n({});const s=e.get(D);this.response.on((s,a)=>e.updateState(t,s,a)),e.get(_).provide({a:T,is:this.response.read().keepThru_(e=>(null==e?void 0:e.ok)?e.body:{articles:[],articlesCount:0})}),e.whenOn(t=>{this._request.read().tillOff(t).thru_(e=>(this.response.it=void 0,i(s.articles(e)))).to(e=>this.response.it=e),e.on("conduit:article").to(()=>this._request.it=Object.assign({},this._request.it))})}static get[s](){return $}get request(){return this._request.it}set request(e){const t=this.request;R(e,t)||(this._request.it=e)}}function G({requestParam:t}={}){return o(({get:s,set:a,key:r})=>{const n=[B,r];return{componentDef:l.all({feature:{needs:[F,H,S]},define(e){e.perComponent({a:U,by:e=>new U(e,n)}),t&&e.whenComponent(e=>{e.get(_).provide({a:L,is:t})})}},j({path:n,offline:!0,comment:`FEED(${String(r)})`}).By((function(e){return c.of(e).get(U).response.it}),r),g({path:n,offline:!0}).As((function(){const t=c.of(this),{contentRoot:s}=t,a=t.get(p).document;return s.appendChild(a.createElement("conduit-article-list")),s.appendChild(a.createElement("conduit-feed-pager")),e}),r)),get:s,set(e,t){a(e,t),c.of(e).get(U).request=t}}})}export{I as P,G as R};//# sourceMappingURL=render-feed.decorator.0e2c1178.js.map
