{"version":3,"file":"render-feed.decorator.9736d1eb.js","sources":["../../src/pages/home/page-feed-param.ts","../../src/pages/home/article-preview.component.ts","../../src/pages/home/feed-article-list.ts","../../src/pages/home/article-list.component.ts","../../src/pages/home/feed-request-page-param.ts","../../src/pages/home/feed-pager.component.ts","../../src/pages/home/render-feed.decorator.ts"],"sourcesContent":["import { Page, PageHashURLParam, PageParam } from '@wesib/generic';\nimport { FeedRequest, feedRequestSearchParams } from '../../core/feed';\n\nclass PageFeedParam$ extends PageParam<FeedRequest, FeedRequest> {\n\n  create(page: Page, input: FeedRequest): PageParam.Handle<FeedRequest, FeedRequest> {\n\n    const handle = this.byDefault(page);\n\n    handle.put(input);\n\n    return handle;\n  }\n\n  byDefault(page: Page): PageParam.Handle<FeedRequest, FeedRequest> {\n    return {\n      get() {\n\n        const { searchParams: params, pathname } = page.get(PageHashURLParam);\n\n        return {\n          feed: pathname === '/personal-feed' ? pathname : undefined,\n          tag: params.get('tag') || undefined,\n          limit: parseInt(params.get('limit') || '', 10) || undefined,\n          offset: parseInt(params.get('offset') || '', 10) || undefined,\n        };\n      },\n      put(value) {\n\n        const { feed } = value;\n        const url = new URL(page.get(PageHashURLParam).href);\n\n        url.pathname = feed === '/personal-feed' ? feed : '';\n\n        const searchParams = feedRequestSearchParams(value).toString();\n\n        url.search = searchParams ? '?' + searchParams : '';\n\n        page.put(PageHashURLParam, url);\n      },\n    };\n  }\n\n}\n\nexport const PageFeedParam: PageParam.WithDefaults<FeedRequest, FeedRequest> = new PageFeedParam$();\n","import { supplyAfter } from '@proc7ts/fun-events';\nimport { HandleNavLinks, HierarchyContext } from '@wesib/generic';\nimport { BootstrapWindow, Component, ComponentContext, DomProperty, isElement, StateProperty } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { Article } from '../../core/articles';\nimport { AuthService, AuthUser, notAuthenticated, NotAuthenticated } from '../../core/auth';\nimport { renderNow } from '../../core/util';\nimport { RenderHTML } from '../../reusable';\nimport { ArticleButtonsSupport } from '../article/buttons';\nimport { CurrentArticle, CurrentArticleTracker, NoArticle } from '../article/current-article';\n\nexport interface ArticlePreviewEl extends HTMLElement {\n  feedArticle?: Article;\n}\n\n@Component(\n    ['article-preview', Conduit__NS],\n    {\n      feature: {\n        needs: [\n          ArticleButtonsSupport,\n        ],\n      },\n    },\n    HandleNavLinks({\n      href(event) {\n\n        let target = event.target as Element;\n\n        for (;;) {\n\n          const href = target.getAttribute('href');\n\n          if (href != null) {\n            return href;\n          }\n\n          const { parentNode } = target;\n\n          if (!parentNode || !isElement(parentNode)) {\n            return;\n          }\n\n          target = parentNode;\n        }\n      },\n    }),\n)\nexport class ArticlePreviewComponent {\n\n  private readonly _article = new CurrentArticleTracker();\n\n  @StateProperty()\n  user: AuthUser | NotAuthenticated = notAuthenticated;\n\n  constructor(private readonly _context: ComponentContext) {\n\n    const authService = _context.get(AuthService);\n    const hierarchy = _context.get(HierarchyContext);\n\n    authService.user\n        .do(supplyAfter(_context))(\n            user => this.user = user,\n        )\n        .whenOff(\n            () => this.user = notAuthenticated,\n        );\n    hierarchy.provide({ a: CurrentArticle, is: this._article.read });\n  }\n\n  get article(): Article | NoArticle {\n    return this._article.it;\n  }\n\n  @DomProperty({ propertyKey: 'feedArticle' })\n  set article(value: Article | NoArticle) {\n    this._article.set(value);\n  }\n\n  @RenderHTML()\n  postMeta(): Node | undefined {\n    if (!this.article.slug) {\n      return;\n    }\n\n    const { author } = this.article;\n    const { document } = this._context.get(BootstrapWindow);\n    const fragment = document.createDocumentFragment();\n    const meta = fragment.appendChild(document.createElement('div'));\n\n    meta.className = 'post-meta';\n\n    const authorElt = meta.appendChild(document.createElement('conduit-article-author'));\n\n    renderNow(authorElt, this._context);\n    if (this.user.username === author.username) {\n\n      const editBtn = meta.appendChild(document.createElement('conduit-edit-post-btn'));\n\n      editBtn.tabIndex = 0;\n      renderNow(editBtn, this._context);\n\n      const deleteBtn = meta.appendChild(document.createElement('conduit-delete-post-btn'));\n\n      deleteBtn.tabIndex = 0;\n      renderNow(deleteBtn, this._context);\n    } else {\n\n      const favoriteBtn = meta.appendChild(document.createElement('conduit-favorite-post-btn'));\n\n      favoriteBtn.tabIndex = 0;\n      renderNow(favoriteBtn, this._context);\n    }\n\n    const previewLink = fragment.appendChild(document.createElement('a'));\n\n    previewLink.className = 'preview-link';\n    previewLink.setAttribute('href', `article/#/${encodeURIComponent(this.article.slug)}`);\n\n    const title = previewLink.appendChild(document.createElement('h1'));\n\n    title.innerText = this.article.title;\n\n    const description = previewLink.appendChild(document.createElement('p'));\n\n    description.innerText = this.article.description;\n\n    const readMore = previewLink.appendChild(document.createElement('span'));\n\n    readMore.innerText = 'Read more...';\n\n    const tagsEl = previewLink.appendChild(document.createElement('conduit-article-tags'));\n\n    renderNow(tagsEl, this._context);\n\n    return fragment;\n  }\n\n}\n","import { SingleContextUpKey, SingleContextUpRef } from '@proc7ts/context-values/updatable';\nimport { ArticleList, noArticles } from '../../core/feed';\n\nexport type FeedArticleList = ArticleList;\n\nexport const FeedArticleList: SingleContextUpRef<FeedArticleList> = (\n    /*#__PURE__*/ new SingleContextUpKey<FeedArticleList>(\n        'feed-article-list',\n        {\n          byDefault: () => noArticles,\n        },\n    )\n);\n","import { HierarchyContext } from '@wesib/generic';\nimport { BootstrapWindow, Component, ComponentContext, ElementRenderer, Render, StateProperty } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { noArticles } from '../../core/feed';\nimport { renderNow } from '../../core/util';\nimport { ArticlePreviewComponent, ArticlePreviewEl } from './article-preview.component';\nimport { FeedArticleList } from './feed-article-list';\n\n@Component(\n    ['article-list', Conduit__NS],\n    {\n      feature: {\n        needs: ArticlePreviewComponent,\n      },\n    },\n)\nexport class ArticleListComponent {\n\n  @StateProperty()\n  articles: FeedArticleList = noArticles;\n\n  constructor(private readonly _context: ComponentContext) {\n\n    const hierarchy = _context.get(HierarchyContext);\n\n    hierarchy.get(FeedArticleList)(\n        list => this.articles = list,\n    ).whenOff(\n        () => this.articles = noArticles,\n    );\n  }\n\n  @Render()\n  render(): ElementRenderer {\n\n    const document = this._context.get(BootstrapWindow).document;\n    const range = document.createRange();\n\n    range.selectNodeContents(this._context.contentRoot);\n\n    return () => {\n      range.deleteContents();\n      if (!this.articles.articlesCount) {\n        return;\n      }\n\n      const fragment = document.createDocumentFragment();\n\n      this.articles.articles.forEach(article => {\n\n        const previewElt = fragment.appendChild(document.createElement('conduit-article-preview') as ArticlePreviewEl);\n\n        previewElt.feedArticle = article;\n        renderNow(previewElt, this._context);\n      });\n\n      range.insertNode(fragment);\n    };\n  }\n\n}\n","import { SingleContextUpKey, SingleContextUpRef } from '@proc7ts/context-values/updatable';\nimport { PageParam } from '@wesib/generic';\nimport { FeedRequest } from '../../core/feed';\nimport { PageFeedParam } from './page-feed-param';\n\nexport type FeedRequestPageParam = PageParam.WithDefaults<FeedRequest, FeedRequest>;\n\nexport const FeedRequestPageParam: SingleContextUpRef<FeedRequestPageParam> = (\n    /*#__PURE__*/ new SingleContextUpKey<FeedRequestPageParam>(\n        'feed-request-page-param',\n        {\n          byDefault: () => PageFeedParam,\n        },\n    )\n);\n","import { afterAll, supplyAfter } from '@proc7ts/fun-events';\nimport { HierarchyContext, Navigation } from '@wesib/generic';\nimport { Component, ComponentContext } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { PagingInfo, RenderPager } from '../../reusable';\nimport { FeedArticleList } from './feed-article-list';\nimport { FeedRequestPageParam } from './feed-request-page-param';\n\n@Component(['feed-pager', Conduit__NS])\nexport class FeedPagerComponent {\n\n  private _feedPaging: PagingInfo = {};\n\n  constructor(context: ComponentContext) {\n\n    const hierarchy = context.get(HierarchyContext);\n    const navigation = context.get(Navigation);\n\n    context.whenConnected(() => {\n      afterAll({\n        param: hierarchy.get(FeedRequestPageParam),\n        page: navigation,\n        list: hierarchy.get(FeedArticleList),\n      }).do(supplyAfter(context))(\n          ({\n            param: [paramRef],\n            page: [page],\n            list: [{ articlesCount }],\n          }) => {\n\n            const param = page.get(paramRef);\n            const { limit = 20, offset = 0 } = param;\n\n            this.feedPaging = {\n              totalPages: Math.ceil(articlesCount / limit),\n              currentPage: Math.floor(offset / limit),\n              pageHref(page: number): string {\n                return navigation.with(\n                    paramRef,\n                    { ...param, offset: limit * page },\n                ).pretend()?.url.href || '';\n              },\n            };\n          },\n      );\n    });\n  }\n\n  @RenderPager()\n  get feedPaging(): PagingInfo {\n    return this._feedPaging;\n  }\n\n  set feedPaging(value: PagingInfo) {\n    this._feedPaging = value;\n  }\n\n}\n","import { ContextKey, ContextKey__symbol, SingleContextKey } from '@proc7ts/context-values';\nimport { digOn_, EventEmitter, mapAfter_, StatePath, trackValue } from '@proc7ts/fun-events';\nimport { noop } from '@proc7ts/primitives';\nimport { HierarchyContext } from '@wesib/generic';\nimport {\n  BootstrapWindow,\n  ComponentClass,\n  ComponentContext,\n  ComponentDef,\n  ComponentProperty,\n  ComponentPropertyDecorator,\n  ElementRenderer,\n  Render,\n  RenderDef,\n  RenderPath__root,\n} from '@wesib/wesib';\nimport { ApiResponse } from '../../core/api';\nimport { ArticleList, FeedRequest, feedRequestsEqual, FeedService, FeedSupport } from '../../core/feed';\nimport { LoadStatus, RenderLoader } from '../../core/loader';\nimport { ArticleListComponent } from './article-list.component';\nimport { FeedArticleList } from './feed-article-list';\nimport { FeedPagerComponent } from './feed-pager.component';\nimport { FeedRequestPageParam } from './feed-request-page-param';\n\nconst RenderFeedState__key = (/*#__PURE__*/ new SingleContextKey<RenderFeedState>('render-feed-state'));\nconst RenderFeedState__symbol = (/*#__PURE__*/ Symbol('render-feed-state'));\n\nclass RenderFeedState {\n\n  static get [ContextKey__symbol](): ContextKey<RenderFeedState> {\n    return RenderFeedState__key;\n  }\n\n  readonly response = trackValue<ApiResponse<ArticleList>>();\n  private readonly _request = trackValue<FeedRequest>({});\n\n  constructor(\n      context: ComponentContext,\n      path: StatePath,\n  ) {\n    context.supply.cuts(this._request);\n\n    const feedService = context.get(FeedService);\n\n    this.response.on((newResponse, oldResponse) => context.updateState(path, newResponse, oldResponse));\n    context.get(HierarchyContext).provide({\n      a: FeedArticleList,\n      is: this.response.read.do(\n          mapAfter_(response => response?.ok\n              ? response.body\n              : { articles: [], articlesCount: 0 }),\n      ),\n    });\n    this._request.read.do(\n        digOn_(request => {\n          this.response.it = undefined;\n\n          const emitter = new EventEmitter<[ApiResponse<ArticleList>]>();\n\n          context.supply.cuts(emitter);\n          feedService.articles(request)(\n              response => emitter.send(response),\n          ).needs(context);\n\n          return emitter.on;\n        }),\n    )(\n        response => this.response.it = response,\n    );\n    context.on('conduit:article')(\n        () => this._request.it = { ...this._request.it }, // Reload articles\n    );\n  }\n\n  get request(): FeedRequest {\n    return this._request.it;\n  }\n\n  set request(value: FeedRequest) {\n\n    const prevRequest = this.request;\n\n    if (!feedRequestsEqual(value, prevRequest)) {\n      this._request.it = value;\n    }\n  }\n\n}\n\nexport function RenderFeed<T extends ComponentClass>(\n    def: RenderFeedDef = {},\n): ComponentPropertyDecorator<FeedRequest, T> {\n\n  const { requestParam, render: renderOptions } = def;\n\n  return ComponentProperty(({ get, set: setValue, key }) => {\n\n    const path: StatePath = [RenderPath__root, RenderFeedState__symbol, key];\n    const render: RenderDef.Spec = RenderDef.fulfill({ on: path }, renderOptions);\n\n    return {\n      componentDef: ComponentDef.all(\n          {\n            feature: {\n              needs: [\n                ArticleListComponent,\n                FeedPagerComponent,\n                FeedSupport,\n              ],\n            },\n            define(defContext) {\n              defContext.perComponent({\n                a: RenderFeedState,\n                by: (context: ComponentContext) => new RenderFeedState(context, path),\n              });\n              if (requestParam) {\n                defContext.whenComponent(context => {\n                  context.get(HierarchyContext).provide({ a: FeedRequestPageParam, is: requestParam });\n                });\n              }\n            },\n          },\n          RenderLoader({ render, comment: `FEED(${String(key)})` }).By(renderLoader, key),\n          Render(render).As(renderFeed, key),\n      ),\n      get,\n      set(component, value) {\n        setValue(component, value);\n        ComponentContext.of(component).get(RenderFeedState).request = value;\n      },\n    };\n\n    function renderLoader(component: InstanceType<T>): LoadStatus | undefined {\n      return ComponentContext.of(component).get(RenderFeedState).response.it;\n    }\n\n    function renderFeed(this: InstanceType<T>): ElementRenderer {\n\n      const context = ComponentContext.of(this);\n      const { contentRoot }: { contentRoot: Node } = context;\n      const document = context.get(BootstrapWindow).document;\n\n      contentRoot.appendChild(document.createElement('conduit-article-list'));\n      contentRoot.appendChild(document.createElement('conduit-feed-pager'));\n\n      return noop;\n    }\n  });\n}\n\nexport interface RenderFeedDef {\n  readonly requestParam?: FeedRequestPageParam;\n  readonly render?: RenderDef.Options;\n}\n"],"names":["PageFeedParam","PageParam","[object Object]","page","input","handle","this","byDefault","put","searchParams","params","pathname","get","PageHashURLParam","feed","undefined","tag","limit","parseInt","offset","value","url","URL","href","feedRequestSearchParams","toString","search","ArticlePreviewComponent","_context","CurrentArticleTracker","notAuthenticated","authService","AuthService","hierarchy","HierarchyContext","user","do","supplyAfter","whenOff","provide","a","CurrentArticle","is","_article","read","article","it","set","slug","author","document","BootstrapWindow","fragment","createDocumentFragment","meta","appendChild","createElement","className","authorElt","renderNow","username","editBtn","tabIndex","deleteBtn","favoriteBtn","previewLink","setAttribute","encodeURIComponent","innerText","title","description","tagsEl","__decorate","StateProperty","DomProperty","propertyKey","RenderHTML","Component","Conduit__NS","feature","needs","ArticleButtonsSupport","HandleNavLinks","event","target","getAttribute","parentNode","isElement","FeedArticleList","SingleContextUpKey","noArticles","ArticleListComponent","list","articles","range","createRange","selectNodeContents","contentRoot","deleteContents","articlesCount","forEach","previewElt","feedArticle","insertNode","Render","FeedRequestPageParam","FeedPagerComponent","context","navigation","Navigation","whenConnected","afterAll","param","paramRef","feedPaging","totalPages","Math","ceil","currentPage","floor","with","pretend","_feedPaging","RenderPager","RenderFeedState__key","SingleContextKey","RenderFeedState__symbol","Symbol","RenderFeedState","path","trackValue","supply","cuts","_request","feedService","FeedService","response","on","newResponse","oldResponse","updateState","mapAfter_","ok","body","digOn_","request","emitter","EventEmitter","send","ContextKey__symbol","prevRequest","feedRequestsEqual","RenderFeed","def","requestParam","render","renderOptions","ComponentProperty","setValue","key","RenderPath__root","RenderDef","fulfill","componentDef","ComponentDef","all","FeedSupport","defContext","perComponent","by","whenComponent","RenderLoader","comment","String","By","component","ComponentContext","of","As","noop"],"mappings":"y0BA6CaA,EAAkE,IA1C/E,cAA6BC,EAE3BC,OAAOC,EAAYC,GAEjB,MAAMC,EAASC,KAAKC,UAAUJ,GAI9B,OAFAE,EAAOG,IAAIJ,GAEJC,EAGTH,UAAUC,GACR,MAAO,CACLD,MAEE,MAAQO,aAAcC,EAAMC,SAAEA,GAAaR,EAAKS,IAAIC,GAEpD,MAAO,CACLC,KAAmB,mBAAbH,EAAgCA,OAAWI,EACjDC,IAAKN,EAAOE,IAAI,aAAUG,EAC1BE,MAAOC,SAASR,EAAOE,IAAI,UAAY,GAAI,UAAOG,EAClDI,OAAQD,SAASR,EAAOE,IAAI,WAAa,GAAI,UAAOG,IAGxDb,IAAIkB,GAEF,MAAMN,KAAEA,GAASM,EACXC,EAAM,IAAIC,IAAInB,EAAKS,IAAIC,GAAkBU,MAE/CF,EAAIV,SAAoB,mBAATG,EAA4BA,EAAO,GAElD,MAAML,EAAee,EAAwBJ,GAAOK,WAEpDJ,EAAIK,OAASjB,EAAe,IAAMA,EAAe,GAEjDN,EAAKK,IAAIK,EAAkBQ,OCUnC,IAAaM,EAAb,MAOEzB,YAA6B0B,GAAAtB,cAAAsB,EALZtB,cAAW,IAAIuB,EAGhCvB,UAAoCwB,EAIlC,MAAMC,EAAcH,EAAShB,IAAIoB,GAC3BC,EAAYL,EAAShB,IAAIsB,GAE/BH,EAAYI,KACPC,GAAGC,EAAYT,GADpBG,EAEQI,GAAQ7B,KAAK6B,KAAOA,IAEvBG,SACG,IAAMhC,KAAK6B,KAAOL,IAE1BG,EAAUM,QAAQ,CAAEC,EAAGC,EAAgBC,GAAIpC,KAAKqC,SAASC,OAG3DC,cACE,OAAOvC,KAAKqC,SAASG,GAIvBD,YAAYzB,GACVd,KAAKqC,SAASI,IAAI3B,GAIpBlB,WACE,IAAKI,KAAKuC,QAAQG,KAChB,OAGF,MAAMC,OAAEA,GAAW3C,KAAKuC,SAClBK,SAAEA,GAAa5C,KAAKsB,SAAShB,IAAIuC,GACjCC,EAAWF,EAASG,yBACpBC,EAAOF,EAASG,YAAYL,EAASM,cAAc,QAEzDF,EAAKG,UAAY,YAEjB,MAAMC,EAAYJ,EAAKC,YAAYL,EAASM,cAAc,2BAG1D,GADAG,EAAUD,EAAWpD,KAAKsB,UACtBtB,KAAK6B,KAAKyB,WAAaX,EAAOW,SAAU,CAE1C,MAAMC,EAAUP,EAAKC,YAAYL,EAASM,cAAc,0BAExDK,EAAQC,SAAW,EACnBH,EAAUE,EAASvD,KAAKsB,UAExB,MAAMmC,EAAYT,EAAKC,YAAYL,EAASM,cAAc,4BAE1DO,EAAUD,SAAW,EACrBH,EAAUI,EAAWzD,KAAKsB,cACrB,CAEL,MAAMoC,EAAcV,EAAKC,YAAYL,EAASM,cAAc,8BAE5DQ,EAAYF,SAAW,EACvBH,EAAUK,EAAa1D,KAAKsB,UAG9B,MAAMqC,EAAcb,EAASG,YAAYL,EAASM,cAAc,MAEhES,EAAYR,UAAY,eACxBQ,EAAYC,aAAa,OAAQ,aAAaC,mBAAmB7D,KAAKuC,QAAQG,SAEhEiB,EAAYV,YAAYL,EAASM,cAAc,OAEvDY,UAAY9D,KAAKuC,QAAQwB,MAEXJ,EAAYV,YAAYL,EAASM,cAAc,MAEvDY,UAAY9D,KAAKuC,QAAQyB,YAEpBL,EAAYV,YAAYL,EAASM,cAAc,SAEvDY,UAAY,eAErB,MAAMG,EAASN,EAAYV,YAAYL,EAASM,cAAc,yBAI9D,OAFAG,EAAUY,EAAQjE,KAAKsB,UAEhBwB,IAlFToB,GADCC,gCAuBDD,GADCE,EAAY,CAAEC,YAAa,6CAM5BH,GADCI,kCA/BUjD,KAjCZkD,EACG,CAAC,kBAAmBC,GACpB,CACEC,QAAS,CACPC,MAAO,CACLC,KAINC,EAAe,CACbhF,KAAKiF,GAEH,IAAIC,EAASD,EAAMC,OAEnB,OAAS,CAEP,MAAM7D,EAAO6D,EAAOC,aAAa,QAEjC,GAAY,MAAR9D,EACF,OAAOA,EAGT,MAAM+D,WAAEA,GAAeF,EAEvB,IAAKE,IAAeC,EAAUD,GAC5B,OAGFF,EAASE,QAKN3D,GC3CN,MAAM6D,MACSC,EACd,oBACA,CACElF,UAAW,IAAMmF,ICO3B,IAAaC,EAAb,MAKEzF,YAA6B0B,GAAAtB,cAAAsB,EAF7BtB,cAA4BoF,EAIR9D,EAAShB,IAAIsB,GAErBtB,IAAI4E,EAAdvD,EACI2D,GAAQtF,KAAKuF,SAAWD,IAC1BtD,SACE,IAAMhC,KAAKuF,SAAWH,IAK5BxF,SAEE,MAAMgD,EAAW5C,KAAKsB,SAAShB,IAAIuC,GAAiBD,SAC9C4C,EAAQ5C,EAAS6C,cAIvB,OAFAD,EAAME,mBAAmB1F,KAAKsB,SAASqE,aAEhC,KAEL,GADAH,EAAMI,kBACD5F,KAAKuF,SAASM,cACjB,OAGF,MAAM/C,EAAWF,EAASG,yBAE1B/C,KAAKuF,SAASA,SAASO,SAAQvD,IAE7B,MAAMwD,EAAajD,EAASG,YAAYL,EAASM,cAAc,4BAE/D6C,EAAWC,YAAczD,EACzBc,EAAU0C,EAAY/F,KAAKsB,aAG7BkE,EAAMS,WAAWnD,MArCrBoB,GADCC,oCAeDD,GADCgC,gCAhBUb,KARZd,EACG,CAAC,eAAgBC,GACjB,CACEC,QAAS,CACPC,MAAOrD,MAIFgE,GCTN,MAAMc,MACShB,EACd,0BACA,CACElF,UAAW,IAAMP,ICF3B,IAAa0G,EAAb,MAIExG,YAAYyG,GAFJrG,iBAA0B,GAIhC,MAAM2B,EAAY0E,EAAQ/F,IAAIsB,GACxB0E,EAAaD,EAAQ/F,IAAIiG,GAE/BF,EAAQG,eAAc,KACpBC,EAAS,CACPC,MAAO/E,EAAUrB,IAAI6F,GACrBtG,KAAMyG,EACNhB,KAAM3D,EAAUrB,IAAI4E,KACnBpD,GAAGC,EAAYsE,GAJlBI,EAKI,EACEC,OAAQC,GACR9G,MAAOA,GACPyF,OAASO,cAAAA,QAGT,MAAMa,EAAQ7G,EAAKS,IAAIqG,IACjBhG,MAAEA,EAAQ,GAAEE,OAAEA,EAAS,GAAM6F,EAEnC1G,KAAK4G,WAAa,CAChBC,WAAYC,KAAKC,KAAKlB,EAAgBlF,GACtCqG,YAAaF,KAAKG,MAAMpG,EAASF,GACjCf,SAASC,SACP,iBAAOyG,EAAWY,KACdP,EACA,IAAKD,EAAO7F,OAAQF,EAAQd,IAC9BsH,gCAAWpG,IAAIE,OAAQ,WASvC2F,iBACE,OAAO5G,KAAKoH,YAGdR,eAAe9F,GACbd,KAAKoH,YAActG,IALrBoD,GADCmD,oCAvCUjB,KADZ7B,EAAU,CAAC,aAAcC,KACb4B,GCeb,MAAMkB,MAA0CC,EAAkC,qBAC5EC,EAAyCC,OAAO,qBAEtD,MAAMC,EASJ9H,YACIyG,EACAsB,GALK3H,cAAW4H,IACH5H,cAAW4H,EAAwB,IAMlDvB,EAAQwB,OAAOC,KAAK9H,KAAK+H,UAEzB,MAAMC,EAAc3B,EAAQ/F,IAAI2H,GAEhCjI,KAAKkI,SAASC,IAAG,CAACC,EAAaC,IAAgBhC,EAAQiC,YAAYX,EAAMS,EAAaC,KACtFhC,EAAQ/F,IAAIsB,GAAkBK,QAAQ,CACpCC,EAAGgD,EACH9C,GAAIpC,KAAKkI,SAAS5F,KAAKR,GACnByG,GAAUL,IAAYA,MAAAA,SAAAA,EAAUM,IAC1BN,EAASO,KACT,CAAElD,SAAU,GAAIM,cAAe,QAG3C7F,KAAK+H,SAASzF,KAAKR,GACf4G,GAAOC,IACL3I,KAAKkI,SAAS1F,QAAK/B,EAEnB,MAAMmI,EAAU,IAAIC,EAOpB,OALAxC,EAAQwB,OAAOC,KAAKc,GACpBZ,EAAYzC,SAASoD,EAArBX,EACIE,GAAYU,EAAQE,KAAKZ,KAC3BxD,MAAM2B,GAEDuC,EAAQT,MAXrBnI,EAcIkI,GAAYlI,KAAKkI,SAAS1F,GAAK0F,IAEnC7B,EAAQ8B,GAAG,kBAAX9B,EACI,IAAMrG,KAAK+H,SAASvF,GAAK,IAAKxC,KAAK+H,SAASvF,MAzClDuG,WAAYA,KACV,OAAOzB,EA4CTqB,cACE,OAAO3I,KAAK+H,SAASvF,GAGvBmG,YAAY7H,GAEV,MAAMkI,EAAchJ,KAAK2I,QAEpBM,EAAkBnI,EAAOkI,KAC5BhJ,KAAK+H,SAASvF,GAAK1B,aAMToI,EACZC,EAAqB,IAGvB,MAAMC,aAAEA,EAAcC,OAAQC,GAAkBH,EAEhD,OAAOI,GAAkB,EAAGjJ,IAAAA,EAAKmC,IAAK+G,EAAUC,IAAAA,MAE9C,MAAM9B,EAAkB,CAAC+B,EAAkBlC,EAAyBiC,GAC9DJ,EAAyBM,EAAUC,QAAQ,CAAEzB,GAAIR,GAAQ2B,GAE/D,MAAO,CACLO,aAAcC,EAAaC,IACvB,CACEtF,QAAS,CACPC,MAAO,CACLW,EACAe,EACA4D,IAGJpK,OAAOqK,GACLA,EAAWC,aAAa,CACtBhI,EAAGwF,EACHyC,GAAK9D,GAA8B,IAAIqB,EAAgBrB,EAASsB,KAE9DyB,GACFa,EAAWG,eAAc/D,IACvBA,EAAQ/F,IAAIsB,GAAkBK,QAAQ,CAAEC,EAAGiE,EAAsB/D,GAAIgH,SAK7EiB,EAAa,CAAEhB,OAAAA,EAAQiB,QAAS,QAAQC,OAAOd,QAAWe,IAUhE,SAAsBC,GACpB,OAAOC,EAAiBC,GAAGF,GAAWnK,IAAIoH,GAAiBQ,SAAS1F,KAXWiH,GAC3EvD,EAAOmD,GAAQuB,IAarB,WAEE,MAAMvE,EAAUqE,EAAiBC,GAAG3K,OAC9B2F,YAAEA,GAAuCU,EACzCzD,EAAWyD,EAAQ/F,IAAIuC,GAAiBD,SAK9C,OAHA+C,EAAY1C,YAAYL,EAASM,cAAc,yBAC/CyC,EAAY1C,YAAYL,EAASM,cAAc,uBAExC2H,IAtB2BpB,IAElCnJ,IAAAA,EACAV,IAAI6K,EAAW3J,GACb0I,EAASiB,EAAW3J,GACpB4J,EAAiBC,GAAGF,GAAWnK,IAAIoH,GAAiBiB,QAAU7H"}