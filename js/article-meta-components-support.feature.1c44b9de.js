import{d as t}from"./lib/context-values.956fc686.js";import{V as e,t as s,E as r,g as a,q as i}from"./lib/fun-events.a21352be.js";import{p as n,R as o,C as c,B as l,F as d}from"./wesib/wesib.b48306cb.js";import{_ as u}from"./helpers.920c7f83.js";import{P as h,c as m,a as f,d as p,b as g,N as b}from"./wesib/generic.e7ebea81.js";import{C as v}from"./core.f6946162.js";import{A as x,a as y}from"./core/articles.af52d4d1.js";import{f as j}from"./core/feed.b95193f2.js";const C={},_=new t("current-article",{byDefault:()=>C});class w extends e{constructor(){super(...arguments),this._it=s(C)}get on(){return this._it.on}get[r](){return a(this._it)}get it(){return this._it.it}set it(t){this._it.it=t}set(t){this.it=this.cast(t)}byArticles(t){return this.by(i(t).thru_(t=>this.cast(t)))}cast(t){return t.slug?Object.assign(Object.assign({},t),{update:t=>this.set(t)}):C}}const O=new class extends h{create(t,e){const s=this.byDefault(t);return s.put(e),s}byDefault(t){return{get(){const{searchParams:e,pathname:s}=t.get(m),r=s.indexOf("/",1),a=decodeURIComponent(r<0?s.substring(1):s.substring(1,r));let i,n;return r>0&&"favorite"===s.substring(r+1)?n=a:i=a,{tag:e.get("tag")||void 0,author:i,favorited:n,limit:parseInt(e.get("limit")||"",10)||void 0,offset:parseInt(e.get("offset")||"",10)||void 0}},put(e){const{favorited:s,author:r=""}=e,a=new URL(t.get(m).href);a.pathname=s?`/${encodeURIComponent(s)}/favorite`:`/${encodeURIComponent(r)}`;const i=j(Object.assign(Object.assign({},e),{favorited:void 0,author:void 0})).toString();a.search=i?"?"+i:"",t.put(m,a)}}}};let A=class{constructor(t){this._context=t,this.article={};const e=t.get(g);t.whenOn(t=>{e.get(_).tillOff(t)(t=>this.article=t)})}render(){const t=this._context.get(b),{document:e}=this._context.get(l),{contentRoot:s}=this._context,r=e.createDocumentFragment(),a=r.appendChild(e.createElement("a")),i=r.appendChild(e.createElement("div"));i.className="info";const n=i.appendChild(e.createElement("a"));n.className="author";const o=i.appendChild(e.createElement("time"));return o.className="date",s.appendChild(r),()=>{var e,s;const r=this.article;let i="",c="",l="",d="",u="";if(r.slug){const{author:a}=r;i=(null===(s=null===(e=t.with(O,{author:a.username}).pretend("profile/"))||void 0===e?void 0:e.url)||void 0===s?void 0:s.href)||"",c=a.image?`<img src="${encodeURI(a.image)}"/>`:"",l=a.username,d=r.createdAt,h=new Date(r.createdAt),u=((new Date).getFullYear()===h.getFullYear()?D:I).format(h)}var h;a.href=i,a.innerHTML=c,n.href=i,n.innerText=l,o.innerText=u,d?o.setAttribute("datetime",d):o.removeAttribute("datetime")}}};u([n()],A.prototype,"article",void 0),u([o()],A.prototype,"render",null),A=u([c(["article-author",v],{feature:{needs:p}},f())],A);const D=new Intl.DateTimeFormat("en-US",{month:"long",day:"numeric"}),I=new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"numeric"});let N=class{constructor(t){this._context=t,this.article=C;const e=t.get(g),s=t.get(x);t.whenOn(t=>{e.get(_).tillOff(t)(t=>{this.article=t})}),t.on("click")(()=>{const{article:t}=this;if(t.slug){const e=!t.favorited;t.update(Object.assign(Object.assign({},t),{favorited:e})),s.likeArticle(t.slug,e)(e=>{this.article.slug&&(e.ok?this.article.update(e.body):(this.article.update(t),console.error(`Failed to like article ${t.slug}`,e.errors)))})}})}render(){const{contentRoot:t}=this._context,{document:e}=this._context.get(l),s=e.createElement("i");t.insertBefore(s,t.childNodes[0]);const r=t.appendChild(e.createElement("span"));return r.className="counter",()=>{s.className=this.article.slug&&this.article.favorited?"ion-heart":"ion-ios-heart-outline",r.innerText=this.article.slug&&this.article.favoritesCount?String(this.article.favoritesCount):"",t.className=this.article.slug&&this.article.favorited?"btn-secondary":"btn-outline-secondary"}}};u([n()],N.prototype,"article",void 0),u([o()],N.prototype,"render",null),N=u([c(["favorite-post",v],{feature:{needs:y}})],N);let R=class{};R=u([d({needs:[A,N]})],R);export{R as A,_ as C,O as P,w as a,C as n};//# sourceMappingURL=article-meta-components-support.feature.1c44b9de.js.map
