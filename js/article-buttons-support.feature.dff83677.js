import{o as t}from"./proc7ts/fun-events.f7c44dc9.js";import{s as e}from"./core/auth.e0c9460a.js";import{S as r,R as s,C as o,B as i,F as a}from"./wesib/wesib.acbfb4f5.js";import{_ as n}from"./helpers.e1623395.js";import{f as c,P as l,d,g as u,a as h,N as p}from"./wesib/generic.5b4ac940.js";import{C as m}from"./core.c152f8fe.js";import{f,R as g}from"./core/loader.57d9ca02.js";import{A as v,a as b}from"./core/articles.34c878ba.js";import{f as x}from"./core/feed.9db6d3c0.js";import{C,n as E}from"./current-article.2a3b7c3c.js";const y=new class extends c{create(t,e){const r=this.byDefault(t);return r.put(e),r}byDefault(t){return{get(){const{searchParams:e,pathname:r}=t.get(l),s=r.indexOf("/",1),o=decodeURIComponent(s<0?r.substring(1):r.substring(1,s));let i,a;return s>0&&"favorite"===r.substr(s+1)?a=o:i=o,{tag:e.get("tag")||void 0,author:i,favorited:a,limit:parseInt(e.get("limit")||"",10)||void 0,offset:parseInt(e.get("offset")||"",10)||void 0}},put(e){const{favorited:r,author:s=""}=e,o=new URL(t.get(l).href);o.pathname=r?`/${encodeURIComponent(r)}/favorite`:`/${encodeURIComponent(s)}`;const i=x({...e,favorited:void 0,author:void 0}).toString();o.search=i?"?"+i:"",t.put(l,o)}}}};let _=class{constructor(t){this._context=t,this.article={};t.get(h).get(C)((t=>this.article=t))}render(){const t=this._context.get(p),{document:e}=this._context.get(i),{contentRoot:r}=this._context,s=e.createDocumentFragment(),o=s.appendChild(e.createElement("a")),a=s.appendChild(e.createElement("div"));a.className="info";const n=a.appendChild(e.createElement("a"));n.className="author";const c=a.appendChild(e.createElement("time"));return c.className="date",r.appendChild(s),()=>{var e,r;const s=this.article;let i="",a="",l="",d="",u="";if(s.slug){const{author:o}=s;i=(null===(r=null===(e=t.with(y,{author:o.username}).pretend("profile/"))||void 0===e?void 0:e.url)||void 0===r?void 0:r.href)||"",a=o.image?`<img src="${encodeURI(o.image)}"/>`:"",l=o.username,d=s.createdAt,u=f(new Date(s.createdAt))}o.href=i,o.innerHTML=a,n.href=i,n.innerText=l,c.innerText=u,d?c.setAttribute("datetime",d):c.removeAttribute("datetime")}}};n([r()],_.prototype,"article",void 0),n([s()],_.prototype,"render",null),_=n([o(["article-author",m],{feature:{needs:u}},d())],_);const w=[];let A=class{constructor(t){this._context=t,this.tags=w;t.get(h).get(C)((t=>this.tags=t.slug?t.tagList:w)).whenOff((()=>this.tags=[]))}render(){if(!this.tags.length)return;const{document:t}=this._context.get(i),e=t.createElement("ul");return this.tags.forEach((r=>{const s=e.appendChild(t.createElement("li")).appendChild(t.createElement("a"));s.href=`#/?tag=${encodeURIComponent(r)}`,s.innerText=r})),e}};n([r()],A.prototype,"tags",void 0),n([g()],A.prototype,"render",null),A=n([o(["article-tags",m],d())],A);class R extends CustomEvent{}let j=class{constructor(r){this._context=r,this.article=E;const s=r.get(v);r.get(h).get(C)((t=>this.article=t)).whenOff((()=>this.article=E)),r.on("click").do(e)((()=>{this.article.slug&&function(e){if(!confirm("Are you sure you want to delete this article?"))return;s.deleteArticle(e).do(t)((t=>{t.ok?r.dispatchEvent(new R("conduit:article",{bubbles:!0,detail:{removed:e}})):console.error("Failed to remove article",t.errors)}))}(this.article.slug)}))}render(){const{article:t}=this;if(!t.slug)return;const{document:e}=this._context.get(i),r=e.createDocumentFragment();return r.appendChild(e.createElement("i")).className="ion-trash-a",r.append(" Delete Article"),r}};n([r()],j.prototype,"article",void 0),n([g()],j.prototype,"render",null),j=n([o(["delete-post-btn",m],{feature:{needs:b}})],j);let N=class{constructor(t){this._context=t,this.article=E;const e=t.get(p);t.get(h).get(C)((t=>this.article=t)).whenOff((()=>this.article=E)),this._context.on("click")((()=>{var t;this.article.slug&&(t=this.article.slug,e.with(l,encodeURIComponent(t)).open("editor/").catch((t=>console.error("Failed to edit article",t))))}))}render(){const{article:t}=this;if(!t.slug)return;const{document:e}=this._context.get(i),r=e.createDocumentFragment();return r.appendChild(e.createElement("i")).className="ion-edit",r.append(" Edit Article"),r}};n([r()],N.prototype,"article",void 0),n([g()],N.prototype,"render",null),N=n([o(["edit-post-btn",m],{feature:{needs:u}})],N);let D=class{constructor(t){this._context=t,this.article=E;const e=t.get(h),r=t.get(v);e.get(C)((t=>{this.article=t})),t.on("click")((()=>{const{article:t}=this;if(t.slug){const e=!t.favorited;t.update({...t,favorited:e}),r.likeArticle(t.slug,e)((e=>{this.article.slug&&(e.ok?this.article.update(e.body):(this.article.update(t),console.error(`Failed to like article ${t.slug}`,e.errors)))}))}}))}render(){const{contentRoot:t,element:e}=this._context,{document:r}=this._context.get(i),s=r.createElement("i");t.insertBefore(s,t.childNodes[0]);const o=t.appendChild(r.createElement("span"));return o.className="counter",()=>{s.className=this.article.slug&&this.article.favorited?"ion-heart":"ion-ios-heart-outline",o.innerText=this.article.slug&&this.article.favoritesCount?String(this.article.favoritesCount):"",e.className=this.article.slug&&this.article.favorited?"btn-success":"btn-outline-success"}}};n([r()],D.prototype,"article",void 0),n([s()],D.prototype,"render",null),D=n([o(["favorite-post-btn",m],{feature:{needs:b}})],D);let I=class{};I=n([a({needs:[_,A,j,N,D]})],I);export{I as A,j as D,N as E,y as P};//# sourceMappingURL=article-buttons-support.feature.dff83677.js.map
