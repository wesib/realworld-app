import{S as t,R as e,C as r,B as o,F as n}from"./wesib/wesib.3e2b94f7.js";import{_ as s}from"./helpers.e1623395.js";import{f as i,P as a,e as c,g as l,a as d,N as u}from"./wesib/generic.a8985d00.js";import{C as h}from"./core.714cbb7b.js";import{R as m}from"./core/loader.a2b38bd6.js";import"./core/input.b9e80c52.js";import{A as p,a as g}from"./core/articles.35c4af86.js";import{f}from"./core/feed.ff4126c4.js";import{C as v,n as b}from"./current-article.80211657.js";const x=new Intl.DateTimeFormat("en-US",{month:"long",day:"numeric"}),C=new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"numeric"});function y(t){return((new Date).getFullYear()===t.getFullYear()?x:C).format(t)}const w=new class extends i{create(t,e){const r=this.byDefault(t);return r.put(e),r}byDefault(t){return{get(){const{searchParams:e,pathname:r}=t.get(a),o=r.indexOf("/",1),n=decodeURIComponent(o<0?r.substring(1):r.substring(1,o));let s,i;return o>0&&"favorite"===r.substring(o+1)?i=n:s=n,{tag:e.get("tag")||void 0,author:s,favorited:i,limit:parseInt(e.get("limit")||"",10)||void 0,offset:parseInt(e.get("offset")||"",10)||void 0}},put(e){const{favorited:r,author:o=""}=e,n=new URL(t.get(a).href);n.pathname=r?`/${encodeURIComponent(r)}/favorite`:"/"+encodeURIComponent(o);const s=f({...e,favorited:void 0,author:void 0}).toString();n.search=s?"?"+s:"",t.put(a,n)}}}};let E=(()=>{let n=class{constructor(t){this._context=t,this.article={};t.get(d).get(v).to(t=>this.article=t)}render(){const t=this._context.get(u),{document:e}=this._context.get(o),{contentRoot:r}=this._context,n=e.createDocumentFragment(),s=n.appendChild(e.createElement("a")),i=n.appendChild(e.createElement("div"));i.className="info";const a=i.appendChild(e.createElement("a"));a.className="author";const c=i.appendChild(e.createElement("time"));return c.className="date",r.appendChild(n),()=>{var e,r;const o=this.article;let n="",i="",l="",d="",u="";if(o.slug){const{author:s}=o;n=(null===(r=null===(e=t.with(w,{author:s.username}).pretend("profile/"))||void 0===e?void 0:e.url)||void 0===r?void 0:r.href)||"",i=s.image?`<img src="${encodeURI(s.image)}"/>`:"",l=s.username,d=o.createdAt,u=y(new Date(o.createdAt))}s.href=n,s.innerHTML=i,a.href=n,a.innerText=l,c.innerText=u,d?c.setAttribute("datetime",d):c.removeAttribute("datetime")}}};return s([t()],n.prototype,"article",void 0),s([e()],n.prototype,"render",null),n=s([r(["article-author",h],{feature:{needs:l}},c())],n),n})();const _=[];let A=(()=>{let e=class{constructor(t){this._context=t,this.tags=_;t.get(d).get(v).to(t=>this.tags=t.slug?t.tagList:_).whenOff(()=>this.tags=[])}render(){if(!this.tags.length)return;const{document:t}=this._context.get(o),e=t.createElement("ul");return this.tags.forEach(r=>{const o=e.appendChild(t.createElement("li")).appendChild(t.createElement("a"));o.href="#/?tag="+encodeURIComponent(r),o.innerText=r}),e}};return s([t()],e.prototype,"tags",void 0),s([m()],e.prototype,"render",null),e=s([r(["article-tags",h],c())],e),e})();class D extends CustomEvent{}let F=(()=>{let e=class{constructor(t){this._context=t,this.article=b;const e=t.get(p);t.get(d).get(v).to(t=>this.article=t).whenOff(()=>this.article=b),t.on("click").just(()=>{this.article.slug&&function(r){if(!confirm("Are you sure you want to delete this article?"))return;e.deleteArticle(r).once(e=>{e.ok?t.dispatchEvent(new D("conduit:article",{bubbles:!0,detail:{removed:r}})):console.error("Failed to remove article",e.errors)})}(this.article.slug)})}render(){const{article:t}=this;if(!t.slug)return;const{document:e}=this._context.get(o),r=e.createDocumentFragment();return r.appendChild(e.createElement("i")).className="ion-trash-a",r.append(" Delete Article"),r}};return s([t()],e.prototype,"article",void 0),s([m()],e.prototype,"render",null),e=s([r(["delete-post-btn",h],{feature:{needs:g}})],e),e})(),R=(()=>{let e=class{constructor(t){this._context=t,this.article=b;const e=t.get(u);t.get(d).get(v).to(t=>this.article=t).whenOff(()=>this.article=b),this._context.on("click").to(()=>{var t;this.article.slug&&(t=this.article.slug,e.with(a,encodeURIComponent(t)).open("editor/").catch(t=>console.error("Failed to edit article",t)))})}render(){const{article:t}=this;if(!t.slug)return;const{document:e}=this._context.get(o),r=e.createDocumentFragment();return r.appendChild(e.createElement("i")).className="ion-edit",r.append(" Edit Article"),r}};return s([t()],e.prototype,"article",void 0),s([m()],e.prototype,"render",null),e=s([r(["edit-post-btn",h],{feature:{needs:l}})],e),e})(),j=(()=>{let n=class{constructor(t){this._context=t,this.article=b;const e=t.get(d),r=t.get(p);e.get(v).to(t=>{this.article=t}),t.on("click").to(()=>{const{article:t}=this;if(t.slug){const e=!t.favorited;t.update({...t,favorited:e}),r.likeArticle(t.slug,e).to(e=>{this.article.slug&&(e.ok?this.article.update(e.body):(this.article.update(t),console.error("Failed to like article "+t.slug,e.errors)))})}})}render(){const{contentRoot:t,element:e}=this._context,{document:r}=this._context.get(o),n=r.createElement("i");t.insertBefore(n,t.childNodes[0]);const s=t.appendChild(r.createElement("span"));return s.className="counter",()=>{n.className=this.article.slug&&this.article.favorited?"ion-heart":"ion-ios-heart-outline",s.innerText=this.article.slug&&this.article.favoritesCount?String(this.article.favoritesCount):"",e.className=this.article.slug&&this.article.favorited?"btn-success":"btn-outline-success"}}};return s([t()],n.prototype,"article",void 0),s([e()],n.prototype,"render",null),n=s([r(["favorite-post-btn",h],{feature:{needs:g}})],n),n})(),I=(()=>{let t=class{};return t=s([n({needs:[E,A,F,R,j]})],t),t})();export{I as A,F as D,R as E,w as P,y as f};//# sourceMappingURL=article-buttons-support.feature.86818239.js.map
