{"version":3,"file":"render-feed.decorator.287da9d8.js","sources":["../../src/reusable/render-pager.decorator.ts","../../src/pages/home/page-feed-param.ts","../../src/pages/home/article-preview.component.ts","../../src/pages/home/feed-article-list.ts","../../src/pages/home/article-list.component.ts","../../src/pages/home/feed-request-page-param.ts","../../src/pages/home/feed-pager.component.ts","../../src/pages/home/render-feed.decorator.ts"],"sourcesContent":["import { StatePath } from '@proc7ts/fun-events';\nimport { HandleNavLinks } from '@wesib/generic';\nimport {\n  BootstrapWindow,\n  ComponentClass,\n  ComponentContext,\n  ComponentDef,\n  ComponentProperty,\n  ComponentPropertyDecorator,\n  RenderDef,\n  RenderPath__root,\n} from '@wesib/wesib';\nimport { RenderHTML } from './render-html.decorator';\n\nexport type PagingInfo =\n    | PagingInfo.Empty\n    | PagingInfo.WithPages;\n\nexport namespace PagingInfo {\n\n  export interface Empty {\n    readonly totalPages?: 0 | 1;\n    readonly visiblePages?: number;\n    readonly currentPage?: number;\n    pageHref?(page: number): string;\n  }\n\n  export interface WithPages {\n    readonly totalPages: number;\n    readonly visiblePages?: number;\n    readonly currentPage?: number;\n    pageHref(page: number): string;\n  }\n\n}\n\nconst PagingInfo__symbol = (/*#__PURE__*/ Symbol('paging-info'));\n\nexport function RenderPager<T extends ComponentClass>(\n    def: {\n      render?: RenderDef.Options;\n    } = {},\n): ComponentPropertyDecorator<PagingInfo, T> {\n\n  const { render: renderOptions } = def;\n\n  return ComponentProperty(({ get, set, key }) => {\n\n    const path: StatePath = [RenderPath__root, PagingInfo__symbol, key];\n    const render = RenderDef.fulfill({ on: path }, renderOptions);\n\n    return {\n      componentDef: ComponentDef.all(\n          RenderHTML({ render, comment: `PAGER(${String(key)})` }).As(pagerContent, key),\n          HandleNavLinks(),\n      ),\n      get,\n      set(component, value) {\n\n        const prev = get(component);\n\n        set(component, value);\n        ComponentContext.of(component).updateState(path, value, prev);\n      },\n    };\n\n    function pagerContent(this: InstanceType<T>): Node | undefined {\n\n      const context = ComponentContext.of(this);\n      const { document } = context.get(BootstrapWindow);\n      const pagingInfo = get(this);\n\n      if (!pagingInfo.totalPages || pagingInfo.totalPages <= 1) {\n        return;\n      }\n\n      const info = pagingInfo as PagingInfo.WithPages;\n      const { totalPages, visiblePages = 5, currentPage = 0 } = info;\n\n      const visible = Math.max(1, visiblePages);\n      const current = Math.max(0, currentPage);\n\n      const ul = document.createElement('ul');\n\n      ul.className = 'pagination';\n\n      let startPage = Math.max(0, current - (visible >> 1));\n      let endPage = startPage + visible;\n\n      if (endPage > totalPages) {\n        startPage = Math.max(0, startPage - (endPage - totalPages));\n        endPage = totalPages;\n      }\n\n      ul.appendChild(pageItem('<<', 0, current > 0));\n      ul.appendChild(pageItem('<', current - 1, current > 0));\n      for (let page = startPage; page < endPage; ++page) {\n        ul.appendChild(pageItem(String(page + 1), page, true, current === page));\n      }\n      ul.appendChild(pageItem('>', current + 1, current + 1 < totalPages));\n      ul.appendChild(pageItem('>>', totalPages - 1, current + 1 < totalPages));\n\n      return ul;\n\n      function pageItem(\n          text: string,\n          page: number,\n          enabled: boolean,\n          active = false,\n      ): HTMLLIElement {\n\n        const li = document.createElement('li');\n\n        li.className = 'page-item';\n\n        let link: HTMLElement;\n\n        if (enabled && !active) {\n          link = document.createElement('a');\n          link.setAttribute('href', info.pageHref(page));\n        } else {\n          li.classList.add(active ? 'active' : 'disabled');\n          link = document.createElement('span');\n        }\n        link.className = 'page-link';\n        link.innerHTML = text;\n        li.appendChild(link);\n\n        return li;\n      }\n    }\n\n  });\n}\n","import { Page, PageHashURLParam, PageParam } from '@wesib/generic';\nimport { FeedRequest, feedRequestSearchParams } from '../../core/feed';\n\nclass PageFeedParam$ extends PageParam<FeedRequest, FeedRequest> {\n\n  create(page: Page, input: FeedRequest): PageParam.Handle<FeedRequest, FeedRequest> {\n\n    const handle = this.byDefault(page);\n\n    handle.put(input);\n\n    return handle;\n  }\n\n  byDefault(page: Page): PageParam.Handle<FeedRequest, FeedRequest> {\n    return {\n      get() {\n\n        const { searchParams: params, pathname } = page.get(PageHashURLParam);\n\n        return {\n          feed: pathname === '/personal-feed' ? pathname : undefined,\n          tag: params.get('tag') || undefined,\n          limit: parseInt(params.get('limit') || '', 10) || undefined,\n          offset: parseInt(params.get('offset') || '', 10) || undefined,\n        };\n      },\n      put(value) {\n\n        const { feed } = value;\n        const url = new URL(page.get(PageHashURLParam).href);\n\n        url.pathname = feed === '/personal-feed' ? feed : '';\n\n        const searchParams = feedRequestSearchParams(value).toString();\n\n        url.search = searchParams ? '?' + searchParams : '';\n\n        page.put(PageHashURLParam, url);\n      },\n    };\n  }\n\n}\n\nexport const PageFeedParam: PageParam.WithDefaults<FeedRequest, FeedRequest> = new PageFeedParam$();\n","import { HandleNavLinks, HierarchyContext } from '@wesib/generic';\nimport { BootstrapWindow, Component, ComponentContext, DomProperty, isElement, StateProperty } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { Article } from '../../core/articles';\nimport { AuthService, AuthUser, notAuthenticated, NotAuthenticated } from '../../core/auth';\nimport { renderNow } from '../../core/util';\nimport { RenderHTML } from '../../reusable';\nimport { ArticleButtonsSupport } from '../article/buttons';\nimport { CurrentArticle, CurrentArticleTracker, NoArticle } from '../article/current-article';\n\n@Component(\n    ['article-preview', Conduit__NS],\n    {\n      feature: {\n        needs: [\n          ArticleButtonsSupport,\n        ],\n      },\n    },\n    HandleNavLinks({\n      href(event) {\n\n        let target = event.target as Element;\n\n        for (;;) {\n\n          const href = target.getAttribute('href');\n\n          if (href != null) {\n            return href;\n          }\n\n          const { parentNode } = target;\n\n          if (!parentNode || !isElement(parentNode)) {\n            return;\n          }\n\n          target = parentNode;\n        }\n      },\n    }),\n)\nexport class ArticlePreviewComponent {\n\n  private readonly _article = new CurrentArticleTracker();\n\n  @StateProperty()\n  user: AuthUser | NotAuthenticated = notAuthenticated;\n\n  constructor(private readonly _context: ComponentContext) {\n\n    const authService = _context.get(AuthService);\n    const hierarchy = _context.get(HierarchyContext);\n\n    authService.user()\n        .tillOff(_context)\n        .to(user => this.user = user)\n        .whenOff(() => this.user = notAuthenticated);\n    hierarchy.provide({ a: CurrentArticle, is: this._article });\n  }\n\n  get article(): Article | NoArticle {\n    return this._article.it;\n  }\n\n  @DomProperty({ propertyKey: 'feedArticle' })\n  set article(value: Article | NoArticle) {\n    this._article.set(value);\n  }\n\n  @RenderHTML()\n  postMeta(): Node | undefined {\n    if (!this.article.slug) {\n      return;\n    }\n\n    const { author } = this.article;\n    const { document } = this._context.get(BootstrapWindow);\n    const fragment = document.createDocumentFragment();\n    const meta = fragment.appendChild(document.createElement('div'));\n\n    meta.className = 'post-meta';\n\n    const authorElt = meta.appendChild(document.createElement('conduit-article-author'));\n\n    renderNow(authorElt, this._context);\n    if (this.user.username === author.username) {\n\n      const editBtn = meta.appendChild(document.createElement('conduit-edit-post-btn'));\n\n      editBtn.tabIndex = 0;\n      renderNow(editBtn, this._context);\n\n      const deleteBtn = meta.appendChild(document.createElement('conduit-delete-post-btn'));\n\n      deleteBtn.tabIndex = 0;\n      renderNow(deleteBtn, this._context);\n    } else {\n\n      const favoriteBtn = meta.appendChild(document.createElement('conduit-favorite-post-btn'));\n\n      favoriteBtn.tabIndex = 0;\n      renderNow(favoriteBtn, this._context);\n    }\n\n    const previewLink = fragment.appendChild(document.createElement('a'));\n\n    previewLink.className = 'preview-link';\n    previewLink.setAttribute('href', `article/#/${encodeURIComponent(this.article.slug)}`);\n\n    const title = previewLink.appendChild(document.createElement('h1'));\n\n    title.innerText = this.article.title;\n\n    const description = previewLink.appendChild(document.createElement('p'));\n\n    description.innerText = this.article.description;\n\n    const readMore = previewLink.appendChild(document.createElement('span'));\n\n    readMore.innerText = 'Read more...';\n\n    const tagsEl = previewLink.appendChild(document.createElement('conduit-article-tags'));\n\n    renderNow(tagsEl, this._context);\n\n    return fragment;\n  }\n\n}\n","import { SingleContextUpKey, SingleContextUpRef } from '@proc7ts/context-values/updatable';\nimport { ArticleList, noArticles } from '../../core/feed';\n\nexport type FeedArticleList = ArticleList;\n\nexport const FeedArticleList: SingleContextUpRef<FeedArticleList> = (\n    /*#__PURE__*/ new SingleContextUpKey<FeedArticleList>(\n        'feed-article-list',\n        {\n          byDefault: () => noArticles,\n        },\n    )\n);\n","import { HierarchyContext } from '@wesib/generic';\nimport { BootstrapWindow, Component, ComponentContext, ElementRenderer, Render, StateProperty } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { noArticles } from '../../core/feed';\nimport { renderNow } from '../../core/util';\nimport { ArticlePreviewComponent } from './article-preview.component';\nimport { FeedArticleList } from './feed-article-list';\n\n@Component(\n    ['article-list', Conduit__NS],\n    {\n      feature: {\n        needs: ArticlePreviewComponent,\n      },\n    },\n)\nexport class ArticleListComponent {\n\n  @StateProperty()\n  articles: FeedArticleList = noArticles;\n\n  constructor(private readonly _context: ComponentContext) {\n\n    const hierarchy = _context.get(HierarchyContext);\n\n    hierarchy.get(FeedArticleList)\n        .to(list => this.articles = list)\n        .whenOff(() => this.articles = noArticles);\n  }\n\n  @Render()\n  render(): ElementRenderer {\n\n    const document = this._context.get(BootstrapWindow).document;\n    const range = document.createRange();\n\n    range.selectNodeContents(this._context.contentRoot);\n\n    return () => {\n      range.deleteContents();\n      if (!this.articles.articlesCount) {\n        return;\n      }\n\n      const fragment = document.createDocumentFragment();\n\n      this.articles.articles.forEach(article => {\n\n        const previewElt: any = fragment.appendChild(document.createElement('conduit-article-preview'));\n\n        previewElt.feedArticle = article;\n        renderNow(previewElt, this._context);\n      });\n\n      range.insertNode(fragment);\n    };\n  }\n\n}\n","import { SingleContextUpKey, SingleContextUpRef } from '@proc7ts/context-values/updatable';\nimport { PageParam } from '@wesib/generic';\nimport { FeedRequest } from '../../core/feed';\nimport { PageFeedParam } from './page-feed-param';\n\nexport type FeedRequestPageParam = PageParam.WithDefaults<FeedRequest, FeedRequest>;\n\nexport const FeedRequestPageParam: SingleContextUpRef<FeedRequestPageParam> = (\n    /*#__PURE__*/ new SingleContextUpKey<FeedRequestPageParam>(\n        'feed-request-page-param',\n        {\n          byDefault: () => PageFeedParam,\n        },\n    )\n);\n","import { afterAll } from '@proc7ts/fun-events';\nimport { HierarchyContext, Navigation } from '@wesib/generic';\nimport { Component, ComponentContext } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { PagingInfo, RenderPager } from '../../reusable';\nimport { FeedArticleList } from './feed-article-list';\nimport { FeedRequestPageParam } from './feed-request-page-param';\n\n@Component(['feed-pager', Conduit__NS])\nexport class FeedPagerComponent {\n\n  private _feedPaging: PagingInfo = {};\n\n  constructor(context: ComponentContext) {\n\n    const hierarchy = context.get(HierarchyContext);\n    const navigation = context.get(Navigation);\n\n    context.whenConnected(() => {\n      afterAll({\n        param: hierarchy.get(FeedRequestPageParam),\n        page: navigation,\n        list: hierarchy.get(FeedArticleList),\n      }).tillOff(context).to(\n          ({\n            param: [paramRef],\n            page: [page],\n            list: [{ articlesCount }],\n          }) => {\n\n            const param = page.get(paramRef);\n            const { limit = 20, offset = 0 } = param;\n\n            this.feedPaging = {\n              totalPages: Math.ceil(articlesCount / limit),\n              currentPage: Math.floor(offset / limit),\n              pageHref(page: number): string {\n                return navigation.with(\n                    paramRef,\n                    { ...param, offset: limit * page },\n                ).pretend()?.url.href || '';\n              },\n            };\n          },\n      );\n    });\n  }\n\n  @RenderPager()\n  get feedPaging(): PagingInfo {\n    return this._feedPaging;\n  }\n\n  set feedPaging(value: PagingInfo) {\n    this._feedPaging = value;\n  }\n\n}\n","import { ContextKey, ContextKey__symbol, SingleContextKey } from '@proc7ts/context-values';\nimport { eventSupplyOf, nextOnEvent, StatePath, trackValue } from '@proc7ts/fun-events';\nimport { noop } from '@proc7ts/primitives';\nimport { HierarchyContext } from '@wesib/generic';\nimport {\n  BootstrapWindow,\n  ComponentClass,\n  ComponentContext,\n  ComponentDef,\n  ComponentProperty,\n  ComponentPropertyDecorator,\n  ElementRenderer,\n  Render,\n  RenderDef,\n  RenderPath__root,\n} from '@wesib/wesib';\nimport { ApiResponse } from '../../core/api';\nimport { ArticleList, FeedRequest, feedRequestsEqual, FeedService, FeedSupport } from '../../core/feed';\nimport { LoadStatus, RenderLoader } from '../../core/loader';\nimport { ArticleListComponent } from './article-list.component';\nimport { FeedArticleList } from './feed-article-list';\nimport { FeedPagerComponent } from './feed-pager.component';\nimport { FeedRequestPageParam } from './feed-request-page-param';\n\nconst RenderFeedState__key = (/*#__PURE__*/ new SingleContextKey<RenderFeedState>('render-feed-state'));\nconst RenderFeedState__symbol = (/*#__PURE__*/ Symbol('render-feed-state'));\n\nclass RenderFeedState {\n\n  static get [ContextKey__symbol](): ContextKey<RenderFeedState> {\n    return RenderFeedState__key;\n  }\n\n  readonly response = trackValue<ApiResponse<ArticleList>>();\n  private readonly _request = trackValue<FeedRequest>({});\n\n  constructor(\n      context: ComponentContext,\n      path: StatePath,\n  ) {\n    eventSupplyOf(context).cuts(this._request);\n\n    const feedService = context.get(FeedService);\n\n    this.response.on((newResponse, oldResponse) => context.updateState(path, newResponse, oldResponse));\n    context.get(HierarchyContext).provide({\n      a: FeedArticleList,\n      is: this.response.read().keepThru_(\n          response => response?.ok\n              ? response.body\n              : { articles: [], articlesCount: 0 },\n      ),\n    });\n    this._request.read()\n        .thru_(\n            request => {\n              this.response.it = undefined;\n              return nextOnEvent(feedService.articles(request));\n            },\n        ).to(\n            response => this.response.it = response,\n        );\n    context.on('conduit:article').to(\n        () => this._request.it = { ...this._request.it }, // Reload articles\n    );\n  }\n\n  get request(): FeedRequest {\n    return this._request.it;\n  }\n\n  set request(value: FeedRequest) {\n\n    const prevRequest = this.request;\n\n    if (!feedRequestsEqual(value, prevRequest)) {\n      this._request.it = value;\n    }\n  }\n\n}\n\nexport function RenderFeed<T extends ComponentClass>(\n    def: RenderFeedDef = {},\n): ComponentPropertyDecorator<FeedRequest, T> {\n\n  const { requestParam, render: renderOptions } = def;\n\n  return ComponentProperty(({ get, set: setValue, key }) => {\n\n    const path: StatePath = [RenderPath__root, RenderFeedState__symbol, key];\n    const render: RenderDef.Spec = RenderDef.fulfill({ on: path }, renderOptions);\n\n    return {\n      componentDef: ComponentDef.all(\n          {\n            feature: {\n              needs: [\n                ArticleListComponent,\n                FeedPagerComponent,\n                FeedSupport,\n              ],\n            },\n            define(defContext) {\n              defContext.perComponent({\n                a: RenderFeedState,\n                by: (context: ComponentContext) => new RenderFeedState(context, path),\n              });\n              if (requestParam) {\n                defContext.whenComponent(context => {\n                  context.get(HierarchyContext).provide({ a: FeedRequestPageParam, is: requestParam });\n                });\n              }\n            },\n          },\n          RenderLoader({ render, comment: `FEED(${String(key)})` }).By(renderLoader, key),\n          Render(render).As(renderFeed, key),\n      ),\n      get,\n      set(component, value) {\n        setValue(component, value);\n        ComponentContext.of(component).get(RenderFeedState).request = value;\n      },\n    };\n\n    function renderLoader(component: InstanceType<T>): LoadStatus | undefined {\n      return ComponentContext.of(component).get(RenderFeedState).response.it;\n    }\n\n    function renderFeed(this: InstanceType<T>): ElementRenderer {\n\n      const context = ComponentContext.of(this);\n      const { contentRoot }: { contentRoot: Node } = context;\n      const document = context.get(BootstrapWindow).document;\n\n      contentRoot.appendChild(document.createElement('conduit-article-list'));\n      contentRoot.appendChild(document.createElement('conduit-feed-pager'));\n\n      return noop;\n    }\n  });\n}\n\nexport interface RenderFeedDef {\n  readonly requestParam?: FeedRequestPageParam;\n  readonly render?: RenderDef.Options;\n}\n"],"names":["PagingInfo__symbol","Symbol","RenderPager","def","render","renderOptions","ComponentProperty","get","set","key","path","RenderPath__root","RenderDef","fulfill","on","componentDef","ComponentDef","all","RenderHTML","comment","String","As","context","ComponentContext","of","this","document","BootstrapWindow","pagingInfo","totalPages","info","visiblePages","currentPage","visible","Math","max","current","ul","createElement","className","startPage","endPage","appendChild","pageItem","page","text","enabled","active","li","link","setAttribute","pageHref","classList","add","innerHTML","HandleNavLinks","[object Object]","component","value","prev","updateState","PageFeedParam","PageParam","input","handle","byDefault","put","searchParams","params","pathname","PageHashURLParam","feed","undefined","tag","limit","parseInt","offset","url","URL","href","feedRequestSearchParams","toString","search","ArticlePreviewComponent","_context","CurrentArticleTracker","notAuthenticated","authService","AuthService","hierarchy","HierarchyContext","user","tillOff","to","whenOff","provide","a","CurrentArticle","is","_article","article","it","slug","author","fragment","createDocumentFragment","meta","authorElt","renderNow","username","editBtn","tabIndex","deleteBtn","favoriteBtn","previewLink","encodeURIComponent","innerText","title","description","tagsEl","__decorate","StateProperty","DomProperty","propertyKey","Component","Conduit__NS","feature","needs","ArticleButtonsSupport","event","target","getAttribute","parentNode","isElement","FeedArticleList","SingleContextUpKey","noArticles","ArticleListComponent","list","articles","range","createRange","selectNodeContents","contentRoot","deleteContents","articlesCount","forEach","previewElt","feedArticle","insertNode","Render","FeedRequestPageParam","FeedPagerComponent","navigation","Navigation","whenConnected","afterAll","param","paramRef","feedPaging","ceil","floor","with","pretend","_feedPaging","RenderFeedState__key","SingleContextKey","RenderFeedState__symbol","RenderFeedState","trackValue","eventSupplyOf","cuts","_request","feedService","FeedService","response","newResponse","oldResponse","read","keepThru_","ok","body","thru_","request","nextOnEvent","ContextKey__symbol","prevRequest","feedRequestsEqual","RenderFeed","requestParam","setValue","FeedSupport","defContext","perComponent","by","whenComponent","RenderLoader","By","noop"],"mappings":"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"}