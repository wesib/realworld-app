import{_ as t}from"./helpers.e1623395.js";import{S as e,R as r,C as s,B as o,F as i}from"./wesib/wesib.c496f508.js";import{m as a,P as n,l as c,d as l,g as d,n as u,N as h}from"./wesib/generic.daf122de.js";import{C as p}from"./core.10059585.js";import{f as m,R as f}from"./core/loader.b1c22415.js";import{f as g,n as v}from"./core/feed.d56f0914.js";import{C as x}from"./proc7ts/context-values.24d38e04.js";import{m as C,o as b}from"./proc7ts/fun-events.3257bf57.js";import{s as w}from"./frontmeans/dom-events.1d1a7091.js";import{A as E,a as F}from"./core/articles.101ad419.js";const y=new class extends a{create(t,e){const r=this.byDefault(t);return r.put(e),r}byDefault(t){return{get(){const{searchParams:e,pathname:r}=t.get(n),s=r.indexOf("/",1),o=decodeURIComponent(s<0?r.substring(1):r.substring(1,s));let i,a;return s>0&&"favorite"===r.substr(s+1)?a=o:i=o,{tag:e.get("tag")||void 0,author:i,favorited:a,limit:parseInt(e.get("limit")||"",10)||void 0,offset:parseInt(e.get("offset")||"",10)||void 0}},put(e){const{favorited:r,author:s=""}=e,o=new URL(t.get(n).href);o.pathname=r?`/${encodeURIComponent(r)}/favorite`:`/${encodeURIComponent(s)}`;const i=g({...e,favorited:void 0,author:void 0}).toString();o.search=i?"?"+i:"",t.put(n,o)}}}};var _;class A extends c{constructor(){super("current-article")}static get[(_=l,x)](){return this[l][x]}static articleFor(t){return this[l].articleFor(t)}articleFor(t){return this.valueFor(t).do(C(((t,e)=>t||v)))}}A[_]=new A;let R=class{constructor(t){this._context=t,this.article=v,A.articleFor(t)((t=>{this.article=t})).whenOff((()=>{this.article=v}))}render(){const t=this._context.get(h),{document:e}=this._context.get(o),{contentRoot:r}=this._context,s=e.createDocumentFragment(),i=s.appendChild(e.createElement("a")),a=s.appendChild(e.createElement("div"));a.className="info";const n=a.appendChild(e.createElement("a"));n.className="author";const c=a.appendChild(e.createElement("time"));return c.className="date",r.appendChild(s),()=>{var e,r;const s=this.article;let o="",a="",l="",d="",u="";if(s.slug){const{author:i}=s;o=(null===(r=null===(e=t.with(y,{author:i.username}).pretend("profile/"))||void 0===e?void 0:e.url)||void 0===r?void 0:r.href)||"",a=i.image?`<img src="${encodeURI(i.image)}"/>`:"",l=i.username,d=s.createdAt,u=m(new Date(s.createdAt))}i.href=o,i.innerHTML=a,n.href=o,n.innerText=l,c.innerText=u,d?c.setAttribute("datetime",d):c.removeAttribute("datetime")}}};t([e()],R.prototype,"article",void 0),t([r()],R.prototype,"render",null),R=t([s(["article-author",p],{feature:{needs:u}},d())],R);const j=[];let N=class{constructor(t){this._context=t,this.tags=j,A.articleFor(t)((t=>{this.tags=t.slug?t.tagList:j})).whenOff((()=>{this.tags=j}))}render(){if(!this.tags.length)return;const{document:t}=this._context.get(o),e=t.createElement("ul");return this.tags.forEach((r=>{const s=e.appendChild(t.createElement("li")).appendChild(t.createElement("a"));s.href=`#/?tag=${encodeURIComponent(r)}`,s.innerText=r})),e}};t([e()],N.prototype,"tags",void 0),t([f()],N.prototype,"render",null),N=t([s(["article-tags",p],d())],N);class D extends CustomEvent{}let I=class{constructor(t){this._context=t,this.article=v;const e=t.get(E);A.articleFor(t)((t=>{this.article=t})).whenOff((()=>{this.article=v})),t.on("click").do(w)((()=>{this.article.slug&&function(r){if(!confirm("Are you sure you want to delete this article?"))return;e.deleteArticle(r).do(b)((e=>{e.ok?t.dispatchEvent(new D("conduit:article",{bubbles:!0,detail:{removed:r}})):console.error("Failed to remove article",e.errors)}))}(this.article.slug)}))}render(){const{article:t}=this;if(!t.slug)return;const{document:e}=this._context.get(o),r=e.createDocumentFragment();return r.appendChild(e.createElement("i")).className="ion-trash-a",r.append(" Delete Article"),r}};t([e()],I.prototype,"article",void 0),t([f()],I.prototype,"render",null),I=t([s(["delete-post-btn",p],{feature:{needs:F}})],I);let k=class{constructor(t){this._context=t,this.article=v;const e=t.get(h);A.articleFor(t)((t=>{this.article=t})).whenOff((()=>{this.article=v})),this._context.on("click")((()=>{var t;this.article.slug&&(t=this.article.slug,e.with(n,encodeURIComponent(t)).open("editor/").catch((t=>console.error("Failed to edit article",t))))}))}render(){const{article:t}=this;if(!t.slug)return;const{document:e}=this._context.get(o),r=e.createDocumentFragment();return r.appendChild(e.createElement("i")).className="ion-edit",r.append(" Edit Article"),r}};t([e()],k.prototype,"article",void 0),t([f()],k.prototype,"render",null),k=t([s(["edit-post-btn",p],{feature:{needs:u}})],k);let U=class{constructor(t){this._context=t,this.article=v;const e=t.get(E);A.articleFor(t)((t=>{this.article=t})).whenOff((()=>{this.article=v})),t.on("click")((()=>{const{article:t}=this;if(t.slug){const r=!t.favorited;t.update({...t,favorited:r}),e.likeArticle(t.slug,r)((e=>{this.article.slug&&(e.ok?this.article.update(e.body):(this.article.update(t),console.error(`Failed to like article ${t.slug}`,e.errors)))}))}}))}render(){const{contentRoot:t,element:e}=this._context,{document:r}=this._context.get(o),s=r.createElement("i");t.insertBefore(s,t.childNodes[0]);const i=t.appendChild(r.createElement("span"));return i.className="counter",()=>{s.className=this.article.slug&&this.article.favorited?"ion-heart":"ion-ios-heart-outline",i.innerText=this.article.slug&&this.article.favoritesCount?String(this.article.favoritesCount):"",e.className=this.article.slug&&this.article.favorited?"btn-success":"btn-outline-success"}}};t([e()],U.prototype,"article",void 0),t([r()],U.prototype,"render",null),U=t([s(["favorite-post-btn",p],{feature:{needs:F}})],U);let O=class{};O=t([i({needs:[R,N,I,k,U]})],O);export{O as A,A as C,I as D,k as E,y as P};//# sourceMappingURL=article-buttons-support.feature.8a881d48.js.map
