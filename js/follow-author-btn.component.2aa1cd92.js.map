{"version":3,"file":"follow-author-btn.component.2aa1cd92.js","sources":["../../src/pages/profile/current-user-profile.ts","../../src/pages/profile/current-user.share.ts","../../src/pages/profile/follow-author-btn.component.ts"],"sourcesContent":["import { AfterEvent, mapAfter_, trackValueBy, ValueTracker } from '@proc7ts/fun-events';\nimport { UserProfile } from '../../core/users';\n\nexport interface UpdatableUserProfile extends UserProfile {\n\n  update(profile: UserProfile): void;\n\n}\n\nexport interface NoUserProfile {\n  readonly username?: undefined;\n}\n\nexport type CurrentUserProfile =\n    | UpdatableUserProfile\n    | NoUserProfile;\n\nexport const noUserProfile: NoUserProfile = {};\n\nexport function currentUserProfileBy(\n    source: AfterEvent<[UserProfile | NoUserProfile]>,\n): ValueTracker<CurrentUserProfile> {\n\n  const currentProfile = trackValueBy<CurrentUserProfile>(\n      source.do(\n          mapAfter_(profile => {\n            if (profile.username == null) {\n              return profile;\n            }\n\n            const update = (updated: UserProfile): void => {\n              currentProfile.it = {\n                ...updated,\n                update,\n              };\n            };\n\n            return {\n              ...profile,\n              update,\n            };\n          }),\n      ),\n  );\n\n  return currentProfile;\n}\n","import { ContextKey__symbol } from '@proc7ts/context-values';\nimport { AfterEvent, mapAfter_ } from '@proc7ts/fun-events';\nimport { Share, Share__symbol } from '@wesib/generic';\nimport { ComponentContext } from '@wesib/wesib';\nimport { CurrentUserProfile, noUserProfile } from './current-user-profile';\n\nexport class CurrentUserShare extends Share<CurrentUserProfile> {\n\n  private constructor() {\n    super('current-user-profile');\n  }\n\n  static readonly [Share__symbol]: CurrentUserShare = new CurrentUserShare();\n\n  static get [ContextKey__symbol](): Share.Key<CurrentUserProfile> {\n    return this[Share__symbol][ContextKey__symbol];\n  }\n\n  static userFor(consumer: ComponentContext): AfterEvent<[CurrentUserProfile]> {\n    return this[Share__symbol].userFor(consumer);\n  }\n\n  userFor(consumer: ComponentContext): AfterEvent<[CurrentUserProfile]> {\n    return this.valueFor(consumer).do(\n        mapAfter_((user?, _sharer?) => user || noUserProfile),\n    );\n  }\n\n}\n","import { escapeHTML } from '@frontmeans/httongue';\nimport { Component, ComponentContext, ContentRoot, ElementRenderer, Render, StateProperty } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { UserService, UserSupport } from '../../core/users';\nimport { CurrentUserProfile, noUserProfile } from './current-user-profile';\nimport { CurrentUserShare } from './current-user.share';\n\n@Component(\n    ['follow-author-btn', Conduit__NS],\n    {\n      feature: {\n        needs: UserSupport,\n      },\n    },\n)\nexport class FollowAuthorBtnComponent {\n\n  @StateProperty()\n  private author: CurrentUserProfile = noUserProfile;\n\n  constructor(private readonly _context: ComponentContext) {\n\n    const userService = _context.get(UserService);\n\n    CurrentUserShare.userFor(_context)(profile => {\n      this.author = profile;\n    });\n    _context.on('click')(() => {\n\n      const { author } = this;\n\n      if (author.username) {\n\n        const follow = !author.following;\n\n        author.update({\n          ...author,\n          following: follow,\n        });\n        userService.followUser(author.username, follow)(\n            response => {\n              if (this.author.username) {\n                if (response.ok) {\n                  this.author.update(response.body);\n                } else {\n                  this.author.update(author);\n                  console.error(`Failed to follow user ${author.username}`, response.errors);\n                }\n              }\n            },\n        );\n      }\n    });\n  }\n\n  @Render()\n  render(): ElementRenderer {\n\n    const { contentRoot, element } = this._context as { contentRoot: ContentRoot; element: Element };\n\n    return () => {\n      if (this.author.username) {\n        element.className = this.author.following ? 'btn-secondary' : 'btn-outline-secondary';\n        contentRoot.innerHTML = `<i class=\"ion-plus-round\"></i> Follow ${escapeHTML(this.author.username)}`;\n      } else {\n        contentRoot.innerHTML = '';\n      }\n\n    };\n  }\n\n}\n"],"names":["noUserProfile","currentUserProfileBy","source","currentProfile","trackValueBy","do","mapAfter_","profile","username","update","updated","it","CurrentUserShare","Share","[object Object]","super","static","Share__symbol","ContextKey__symbol","this","consumer","userFor","valueFor","user","_sharer","FollowAuthorBtnComponent","_context","userService","get","UserService","author","on","follow","following","followUser","response","ok","body","console","error","errors","contentRoot","element","className","innerHTML","escapeHTML","__decorate","StateProperty","Render","Component","Conduit__NS","feature","needs","UserSupport"],"mappings":"yaAiBaA,EAA+B,YAE5BC,EACZC,GAGF,MAAMC,EAAiBC,EACnBF,EAAOG,GACHC,GAAUC,IACR,GAAwB,MAApBA,EAAQC,SACV,OAAOD,EAGT,MAAME,EAAUC,IACdP,EAAeQ,GAAK,IACfD,EACHD,OAAAA,IAIJ,MAAO,IACFF,EACHE,OAAAA,QAMZ,OAAON,cCvCIS,UAAyBC,EAEpCC,cACEC,MAAM,wBAKRC,cAFiBC,EAELC,MACV,OAAOC,KAAKF,GAAeC,GAG7BJ,eAAeM,GACb,OAAOD,KAAKF,GAAeI,QAAQD,GAGrCN,QAAQM,GACN,OAAOD,KAAKG,SAASF,GAAUf,GAC3BC,GAAU,CAACiB,EAAOC,IAAaD,GAAQvB,MAZ7BY,KAAoC,IAAIA,MCG7Ca,EAAb,MAKEX,YAA6BY,GAAAP,cAAAO,EAFrBP,YAA6BnB,EAInC,MAAM2B,EAAcD,EAASE,IAAIC,GAEjCjB,EAAiBS,QAAQK,EAAzBd,EAAmCL,IACjCY,KAAKW,OAASvB,KAEhBmB,EAASK,GAAG,QAAZL,EAAqB,KAEnB,MAAMI,OAAEA,GAAWX,KAEnB,GAAIW,EAAOtB,SAAU,CAEnB,MAAMwB,GAAUF,EAAOG,UAEvBH,EAAOrB,OAAO,IACTqB,EACHG,UAAWD,IAEbL,EAAYO,WAAWJ,EAAOtB,SAAUwB,EAAxCL,EACIQ,IACMhB,KAAKW,OAAOtB,WACV2B,EAASC,GACXjB,KAAKW,OAAOrB,OAAO0B,EAASE,OAE5BlB,KAAKW,OAAOrB,OAAOqB,GACnBQ,QAAQC,MAAM,yBAAyBT,EAAOtB,WAAY2B,EAASK,iBAUnF1B,SAEE,MAAM2B,YAAEA,EAAWC,QAAEA,GAAYvB,KAAKO,SAEtC,MAAO,KACDP,KAAKW,OAAOtB,UACdkC,EAAQC,UAAYxB,KAAKW,OAAOG,UAAY,gBAAkB,wBAC9DQ,EAAYG,UAAY,yCAAyCC,EAAW1B,KAAKW,OAAOtB,aAExFiC,EAAYG,UAAY,MA/C9BE,GADCC,kCAuCDD,GADCE,gCAxCUvB,KARZwB,EACG,CAAC,oBAAqBC,GACtB,CACEC,QAAS,CACPC,MAAOC,MAIF5B"}