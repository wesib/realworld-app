import{_ as e}from"./helpers.e1623395.js";import{S as t,R as r,C as s,B as o,F as i}from"./wesib/wesib.289eabae.js";import{l as a,P as n,g as c,m as l,h as d,N as u}from"./wesib/generic.e05bd5a6.js";import{C as h}from"./core.10059585.js";import{f as p,R as m}from"./core/loader.6a8fc6bd.js";import{f}from"./core/feed.6cf2400c.js";import{C as g,n as v}from"./current-article.e2211b9a.js";import{s as b}from"./frontmeans/dom-events.bc847677.js";import{o as x}from"./proc7ts/fun-events.8f536596.js";import{A as C,a as E}from"./core/articles.bc0dc78d.js";const y=new class extends a{create(e,t){const r=this.byDefault(e);return r.put(t),r}byDefault(e){return{get(){const{searchParams:t,pathname:r}=e.get(n),s=r.indexOf("/",1),o=decodeURIComponent(s<0?r.substring(1):r.substring(1,s));let i,a;return s>0&&"favorite"===r.substr(s+1)?a=o:i=o,{tag:t.get("tag")||void 0,author:i,favorited:a,limit:parseInt(t.get("limit")||"",10)||void 0,offset:parseInt(t.get("offset")||"",10)||void 0}},put(t){const{favorited:r,author:s=""}=t,o=new URL(e.get(n).href);o.pathname=r?`/${encodeURIComponent(r)}/favorite`:`/${encodeURIComponent(s)}`;const i=f({...t,favorited:void 0,author:void 0}).toString();o.search=i?"?"+i:"",e.put(n,o)}}}};let _=class{constructor(e){this._context=e,this.article={};e.get(d).get(g)((e=>this.article=e))}render(){const e=this._context.get(u),{document:t}=this._context.get(o),{contentRoot:r}=this._context,s=t.createDocumentFragment(),i=s.appendChild(t.createElement("a")),a=s.appendChild(t.createElement("div"));a.className="info";const n=a.appendChild(t.createElement("a"));n.className="author";const c=a.appendChild(t.createElement("time"));return c.className="date",r.appendChild(s),()=>{var t,r;const s=this.article;let o="",a="",l="",d="",u="";if(s.slug){const{author:i}=s;o=(null===(r=null===(t=e.with(y,{author:i.username}).pretend("profile/"))||void 0===t?void 0:t.url)||void 0===r?void 0:r.href)||"",a=i.image?`<img src="${encodeURI(i.image)}"/>`:"",l=i.username,d=s.createdAt,u=p(new Date(s.createdAt))}i.href=o,i.innerHTML=a,n.href=o,n.innerText=l,c.innerText=u,d?c.setAttribute("datetime",d):c.removeAttribute("datetime")}}};e([t()],_.prototype,"article",void 0),e([r()],_.prototype,"render",null),_=e([s(["article-author",h],{feature:{needs:l}},c())],_);const w=[];let A=class{constructor(e){this._context=e,this.tags=w;e.get(d).get(g)((e=>this.tags=e.slug?e.tagList:w)).whenOff((()=>this.tags=[]))}render(){if(!this.tags.length)return;const{document:e}=this._context.get(o),t=e.createElement("ul");return this.tags.forEach((r=>{const s=t.appendChild(e.createElement("li")).appendChild(e.createElement("a"));s.href=`#/?tag=${encodeURIComponent(r)}`,s.innerText=r})),t}};e([t()],A.prototype,"tags",void 0),e([m()],A.prototype,"render",null),A=e([s(["article-tags",h],c())],A);class R extends CustomEvent{}let j=class{constructor(e){this._context=e,this.article=v;const t=e.get(C);e.get(d).get(g)((e=>this.article=e)).whenOff((()=>this.article=v)),e.on("click").do(b)((()=>{this.article.slug&&function(r){if(!confirm("Are you sure you want to delete this article?"))return;t.deleteArticle(r).do(x)((t=>{t.ok?e.dispatchEvent(new R("conduit:article",{bubbles:!0,detail:{removed:r}})):console.error("Failed to remove article",t.errors)}))}(this.article.slug)}))}render(){const{article:e}=this;if(!e.slug)return;const{document:t}=this._context.get(o),r=t.createDocumentFragment();return r.appendChild(t.createElement("i")).className="ion-trash-a",r.append(" Delete Article"),r}};e([t()],j.prototype,"article",void 0),e([m()],j.prototype,"render",null),j=e([s(["delete-post-btn",h],{feature:{needs:E}})],j);let N=class{constructor(e){this._context=e,this.article=v;const t=e.get(u);e.get(d).get(g)((e=>this.article=e)).whenOff((()=>this.article=v)),this._context.on("click")((()=>{var e;this.article.slug&&(e=this.article.slug,t.with(n,encodeURIComponent(e)).open("editor/").catch((e=>console.error("Failed to edit article",e))))}))}render(){const{article:e}=this;if(!e.slug)return;const{document:t}=this._context.get(o),r=t.createDocumentFragment();return r.appendChild(t.createElement("i")).className="ion-edit",r.append(" Edit Article"),r}};e([t()],N.prototype,"article",void 0),e([m()],N.prototype,"render",null),N=e([s(["edit-post-btn",h],{feature:{needs:l}})],N);let D=class{constructor(e){this._context=e,this.article=v;const t=e.get(d),r=e.get(C);t.get(g)((e=>{this.article=e})),e.on("click")((()=>{const{article:e}=this;if(e.slug){const t=!e.favorited;e.update({...e,favorited:t}),r.likeArticle(e.slug,t)((t=>{this.article.slug&&(t.ok?this.article.update(t.body):(this.article.update(e),console.error(`Failed to like article ${e.slug}`,t.errors)))}))}}))}render(){const{contentRoot:e,element:t}=this._context,{document:r}=this._context.get(o),s=r.createElement("i");e.insertBefore(s,e.childNodes[0]);const i=e.appendChild(r.createElement("span"));return i.className="counter",()=>{s.className=this.article.slug&&this.article.favorited?"ion-heart":"ion-ios-heart-outline",i.innerText=this.article.slug&&this.article.favoritesCount?String(this.article.favoritesCount):"",t.className=this.article.slug&&this.article.favorited?"btn-success":"btn-outline-success"}}};e([t()],D.prototype,"article",void 0),e([r()],D.prototype,"render",null),D=e([s(["favorite-post-btn",h],{feature:{needs:E}})],D);let I=class{};I=e([i({needs:[_,A,j,N,D]})],I);export{I as A,j as D,N as E,y as P};//# sourceMappingURL=article-buttons-support.feature.4c75d087.js.map
