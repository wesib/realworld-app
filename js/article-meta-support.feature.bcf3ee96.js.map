{"version":3,"file":"article-meta-support.feature.bcf3ee96.js","sources":["../../src/pages/article/current-article.ts","../../src/pages/article/article-author.component.ts","../../src/pages/article/favorite-post.component.ts","../../src/pages/article/article-meta-support.feature.ts"],"sourcesContent":["import { SingleContextUpKey, SingleContextUpRef } from 'context-values/updatable';\nimport { Article } from '../../common/articles';\n\nexport type CurrentArticle = Article | { readonly slug?: undefined };\n\nexport const CurrentArticle: SingleContextUpRef<CurrentArticle> = new SingleContextUpKey<CurrentArticle>(\n    'current-article',\n    {\n      byDefault: () => ({}),\n    },\n);\n","import { HandleNavLinks, HierarchyContext } from '@wesib/generic';\nimport { BootstrapWindow, Component, ComponentContext, ElementRenderer, Render, StateProperty } from '@wesib/wesib';\nimport { Conduit__NS } from '../../common';\nimport { CurrentArticle } from './current-article';\n\n@Component(\n    ['article-author', Conduit__NS],\n    HandleNavLinks(),\n)\nexport class ArticleAuthorComponent {\n\n  @StateProperty()\n  private article: CurrentArticle = {};\n\n  constructor(private readonly _context: ComponentContext) {\n\n    const hierarchy = _context.get(HierarchyContext);\n\n    _context.whenOn(supply => {\n      hierarchy.get(CurrentArticle).tillOff(supply)(article => this.article = article);\n    });\n  }\n\n  @Render()\n  render(): ElementRenderer {\n\n    const { document } = this._context.get(BootstrapWindow);\n    const { contentRoot }: { contentRoot: Node } = this._context;\n    const fragment = document.createDocumentFragment();\n    const authorImgLink = fragment.appendChild(document.createElement('a'));\n    const info = fragment.appendChild(document.createElement('div'));\n\n    info.className = 'info';\n\n    const authorLink = info.appendChild(document.createElement('a'));\n\n    authorLink.className = 'author';\n\n    const time = info.appendChild(document.createElement('time'));\n\n    time.className = 'date';\n\n    contentRoot.appendChild(fragment);\n\n    return () => {\n\n      const article = this.article;\n\n      let profileURL = '';\n      let profileImage = '';\n      let username = '';\n      let timestamp = '';\n      let postDate = '';\n\n      if (article.slug) {\n\n        const { author } = article;\n\n        profileURL = `profile/#/${encodeURIComponent(author.username)}`;\n        profileImage = author.image ? `<img src=\"${encodeURI(author.image)}\"/>` : '';\n        username = author.username;\n        timestamp = article.createdAt;\n        postDate = formatArticleDate(new Date(article.createdAt));\n      }\n\n      authorImgLink.href = profileURL;\n      authorImgLink.innerHTML = profileImage;\n      authorLink.href = profileURL;\n      authorLink.innerText = username;\n      time.innerText = postDate;\n      if (timestamp) {\n        time.setAttribute('datetime', timestamp);\n      } else {\n        time.removeAttribute('datetime');\n      }\n    };\n  }\n\n}\n\nconst thisYearDateFormat = new Intl.DateTimeFormat('en-US', { month: 'long', day: 'numeric' });\nconst otherYearFateFormat = new Intl.DateTimeFormat('en-US', { year: 'numeric', month: 'long', day: 'numeric' });\n\nfunction formatArticleDate(date: Date): string {\n\n  const now = new Date();\n  const format = now.getFullYear() === date.getFullYear() ? thisYearDateFormat : otherYearFateFormat;\n\n  return format.format(date);\n}\n","import { HierarchyContext } from '@wesib/generic';\nimport { BootstrapWindow, Component, ComponentContext, ElementRenderer, Render, StateProperty } from '@wesib/wesib';\nimport { Conduit__NS } from '../../common';\nimport { CurrentArticle } from './current-article';\n\n@Component(['favorite-post', Conduit__NS])\nexport class FavoritePostComponent {\n\n  @StateProperty()\n  private _post?: { favorited: boolean; favoritesCount: number };\n\n  constructor(private readonly _context: ComponentContext) {\n\n    const hierarchy = _context.get(HierarchyContext);\n\n    _context.whenOn(supply => {\n      hierarchy.get(CurrentArticle).tillOff(supply)(article => {\n        this._post = article.slug\n            ? { favorited: article.favorited, favoritesCount: article.favoritesCount }\n            : undefined;\n      });\n    });\n  }\n\n  @Render()\n  render(): ElementRenderer {\n\n    const { contentRoot }: { contentRoot: HTMLElement } = this._context;\n    const { document } = this._context.get(BootstrapWindow);\n    const icon = document.createElement('i');\n\n    contentRoot.insertBefore(icon, contentRoot.childNodes[0]);\n\n    const counter = contentRoot.appendChild(document.createElement('span'));\n\n    counter.className = 'counter';\n\n    return () => {\n      icon.className = this._post && this._post.favorited ? 'ion-heart' : 'ion-ios-heart-outline';\n      counter.innerText = this._post && this._post.favoritesCount ? String(this._post.favoritesCount) : '';\n      contentRoot.className = this._post && this._post.favorited ? 'btn-outline-primary' : 'btn-outline-secondary';\n    };\n  }\n\n}\n","import { Feature } from '@wesib/wesib';\nimport { ArticleAuthorComponent } from './article-author.component';\nimport { FavoritePostComponent } from './favorite-post.component';\n\n@Feature({\n  needs: [\n    ArticleAuthorComponent,\n    FavoritePostComponent,\n  ],\n})\nexport class ArticleMetaSupport {\n}\n"],"names":["CurrentArticle","SingleContextUpKey","byDefault","ArticleAuthorComponent","[object Object]","_context","this","hierarchy","get","HierarchyContext","whenOn","supply","tillOff","article","document","BootstrapWindow","contentRoot","fragment","createDocumentFragment","authorImgLink","appendChild","createElement","info","className","authorLink","time","profileURL","profileImage","username","timestamp","postDate","slug","author","encodeURIComponent","image","encodeURI","createdAt","date","Date","getFullYear","thisYearDateFormat","otherYearFateFormat","format","href","innerHTML","innerText","setAttribute","removeAttribute","__decorate","StateProperty","Render","Component","Conduit__NS","HandleNavLinks","Intl","DateTimeFormat","month","day","year","FavoritePostComponent","_post","favorited","favoritesCount","undefined","icon","insertBefore","childNodes","counter","String","ArticleMetaSupport","Feature","needs"],"mappings":"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"}