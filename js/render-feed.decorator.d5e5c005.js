import{n as e}from"./lib/call-thru.00f7427a.js";import{d as t,a as s,S as r}from"./lib/context-values.956fc686.js";import{e as a,t as n,k as i}from"./lib/fun-events.a21352be.js";import{r as o,C as c,k as l,i as f,p,R as u,B as d,l as h,o as g,d as m}from"./wesib/wesib.b48306cb.js";import{_ as b}from"./helpers.920c7f83.js";import{P as v,c as w,a as _,b as y,N as C}from"./wesib/generic.e7ebea81.js";import{C as j}from"./core.f6946162.js";import{R as P,b as q,a as O}from"./core/loader.4f7c7fa2.js";import{e as R}from"./core/util.4298e8ae.js";import{A as D,a as k,C as x}from"./article-meta-components-support.feature.1c44b9de.js";import{f as E,F as A,a as S,b as $}from"./core/feed.b95193f2.js";const M=new class extends v{create(e,t){const s=this.byDefault(e);return s.put(t),s}byDefault(e){return{get(){const{searchParams:t,pathname:s}=e.get(w);return{feed:"/personal-feed"===s?s:void 0,tag:t.get("tag")||void 0,limit:parseInt(t.get("limit")||"",10)||void 0,offset:parseInt(t.get("offset")||"",10)||void 0}},put(t){const{feed:s}=t,r=new URL(e.get(w).href);r.pathname="/personal-feed"===s?s:"";const a=E(t).toString();r.search=a?"?"+a:"",e.put(w,r)}}}};let N=class{constructor(e){this._article=new k;const t=e.get(y);e.whenOn(e=>{const s=t.provide({a:x,is:this._article});e.whenOff(s)})}get article(){return this._article.it}set article(e){this._article.set(e)}get postMeta(){if(!this.article.slug)return;return`\n<div class="post-meta">\n<conduit-article-author></conduit-article-author>\n<conduit-favorite-post></conduit-favorite-post>\n</div>\n<a href="${`article/#/${encodeURIComponent(this.article.slug)}`}" class="preview-link">\n<h1>${R(this.article.title)}</h1>\n<p class="post-content">${R(this.article.description)}</p>\n<span>Read more...</span>\n</a>\n`}};b([o({propertyKey:"feedArticle"})],N.prototype,"article",null),b([P({path:l("article")})],N.prototype,"postMeta",null),N=b([c(["article-preview",j],{feature:{needs:[D]}},_({href(e){let t=e.target;for(;;){const e=t.getAttribute("href");if(null!=e)return e;const{parentNode:s}=t;if(!s||!f(s))return;t=s}}}))],N);const F=new t("feed-article-list",{byDefault:()=>({articles:[],articlesCount:0})});let I=class{constructor(e){this._context=e,this.articles={articles:[],articlesCount:0};const t=e.get(y);e.whenOn(e=>{t.get(F).tillOff(e)(e=>this.articles=e)})}render(){const e=this._context.get(d).document,t=e.createRange();return t.selectNodeContents(this._context.contentRoot),()=>{if(t.deleteContents(),!this.articles.articlesCount)return;const s=e.createDocumentFragment();this.articles.articles.forEach(t=>{s.appendChild(e.createElement("conduit-article-preview")).feedArticle=t}),t.insertNode(s)}}};b([p()],I.prototype,"articles",void 0),b([u()],I.prototype,"render",null),I=b([c(["article-list",j],{feature:{needs:N}})],I);const B=new t("feed-request-page-param",{byDefault:()=>M});let U=class{constructor(e){this._feedPaging={};const t=e.get(y),s=e.get(C);e.whenOn(e=>{a({param:t.get(B),page:s,list:t.get(F)}).tillOff(e)(({param:[e],page:[t],list:[{articlesCount:r}]})=>{const a=t.get(e),{limit:n=20,offset:i=0}=a;this.feedPaging={totalPages:Math.ceil(r/n),currentPage:Math.floor(i/n),pageHref(t){var r;return(null===(r=s.with(e,Object.assign(Object.assign({},a),{offset:n*t})).pretend())||void 0===r?void 0:r.url.href)||""}}})})}get feedPaging(){return this._feedPaging}set feedPaging(e){this._feedPaging=e}};b([q()],U.prototype,"feedPaging",null),U=b([c(["feed-pager",j])],U);const H=new r("render-feed-state"),K=Symbol("render-feed-state");class L{constructor(e,t){this.response=n(),this._request=n({});const s=e.get(S);this.response.on((s,r)=>e.updateState(t,s,r)),e.get(y).provide({a:F,is:this.response.read.keep.thru_(e=>(null==e?void 0:e.ok)?e.body:{articles:[],articlesCount:0})}),e.whenOn(e=>{this._request.read.tillOff(e).thru_(e=>(this.response.it=void 0,i(s.articles(e))))(e=>this.response.it=e)})}static get[s](){return H}get request(){return this._request.it}set request(e){const t=this.request;$(e,t)||(this._request.it=e)}}function z({requestParam:t}={}){return h(({get:s,set:r,key:a})=>{const n=[K,a];return{componentDef:g.all({feature:{needs:[I,U,A]},define(e){e.perComponent({a:L,by:e=>new L(e,n)}),t&&e.whenComponent(e=>{e.get(y).provide({a:B,is:t})})}},O({path:n,offline:!0,comment:`FEED(${String(a)})`}).By((function(e){return m.of(e).get(L).response.it}),a),u({path:n,offline:!0}).As((function(){const t=m.of(this),{contentRoot:s}=t,r=t.get(d).document;return s.appendChild(r.createElement("conduit-article-list")),s.appendChild(r.createElement("conduit-feed-pager")),e}),a)),get:s,set(e,t){r(e,t),m.of(e).get(L).request=t}}})}export{M as P,z as R};//# sourceMappingURL=render-feed.decorator.d5e5c005.js.map
