{"version":3,"file":"main.6aa4ef5e.js","sources":["../../src/pages/login/login-email.component.ts","../../src/pages/login/login-password.component.ts","../../src/pages/login/login.component.ts","../../src/pages/login/index.ts"],"sourcesContent":["import { SetInputName, UseInputElement } from '@wesib/generic/input';\nimport { Component } from '@wesib/wesib';\nimport { InCssClasses, inCssInfo, inText, InValidation, requirePresent } from 'input-aspects';\nimport { bootstrapCssError, Conduit__NS } from '../../common';\n\n@Component(\n    ['login-email', Conduit__NS],\n    UseInputElement({\n      makeControl({ node, aspects }) {\n        return inText(node.element)\n            .convert(aspects)\n            .setup(InValidation, validation => validation.by(requirePresent()))\n            .setup(InCssClasses, classes => {\n              classes.add(inCssInfo());\n              classes.add(bootstrapCssError());\n            });\n      },\n    }),\n    SetInputName('email'),\n)\nexport class LoginEmailComponent {\n}\n","import { SetInputName, UseInputElement } from '@wesib/generic/input';\nimport { Component } from '@wesib/wesib';\nimport { InCssClasses, inCssInfo, inText, InValidation, requirePresent } from 'input-aspects';\nimport { bootstrapCssError, Conduit__NS } from '../../common';\n\n@Component(\n    ['login-password', Conduit__NS],\n    UseInputElement({\n      makeControl({ node, aspects }) {\n        return inText(node.element)\n            .convert(aspects)\n            .setup(InValidation, validation => validation.by(requirePresent()))\n            .setup(InCssClasses, classes => {\n              classes.add(inCssInfo());\n              classes.add(bootstrapCssError());\n            });\n      },\n    }),\n    SetInputName('password'),\n)\nexport class LoginPasswordComponent {\n}\n","import { ComponentNode, HandleNavLinks } from '@wesib/generic';\nimport { DefaultInAspects, inputFromControl } from '@wesib/generic/input';\nimport { Component, ComponentContext } from '@wesib/wesib';\nimport { afterAll, eventSupply } from 'fun-events';\nimport { DomEventDispatcher } from 'fun-events/dom';\nimport {\n  InCssClasses,\n  inCssInfo,\n  InGroup,\n  inGroup,\n  InMode,\n  InStyledElement,\n  InSubmit, InSubmitError,\n  InSupply,\n  inText,\n  InValidation,\n} from 'input-aspects';\nimport { apiSubmit, AuthService, Conduit__NS, LoginRequest } from '../../common';\nimport { LoginEmailComponent } from './login-email.component';\nimport { LoginPasswordComponent } from './login-password.component';\n\n@Component(\n    ['login', Conduit__NS],\n    HandleNavLinks(),\n    {\n      feature: {\n        needs: [\n          LoginEmailComponent,\n          LoginPasswordComponent,\n        ],\n      },\n    },\n)\nexport class LoginComponent {\n\n  constructor(context: ComponentContext) {\n\n    const componentNode = context.get(ComponentNode);\n    const authService = context.get(AuthService);\n\n    context.whenOn(connectSupply => {\n\n      afterAll({\n        form: componentNode.select('form', { all: true, deep: true }).first,\n        button: componentNode.select('button', { all: true, deep: true }).first,\n        aspects: context.get(DefaultInAspects),\n      }).consume(\n          ({\n            form: [form],\n            button: [button],\n            aspects: [aspects],\n          }) => {\n            if (!form) {\n              return;\n            }\n\n            const formSupply = eventSupply();\n            const group: InGroup<LoginRequest> = inGroup<LoginRequest>({\n              email: '',\n              password: '',\n            }).setup(InSupply, s => s.needs(formSupply));\n            group.aspect(InValidation);\n\n            const formControl = group.convert(InStyledElement.to(form.element), aspects);\n            const submit = formControl.aspect(InSubmit);\n\n            formControl.setup(InCssClasses, classes => classes.add(inCssInfo()));\n\n            if (button) {\n              inText(button.element).convert(aspects)\n                  .setup(InMode, mode => mode.derive(formControl.aspect(InMode)));\n            }\n\n            new DomEventDispatcher(form.element).on('submit').instead(() => {\n              submit.submit(request => apiSubmit(authService.login(request)))\n                  .catch(e => {\n                    if (e instanceof InSubmitError) {\n                      console.log('Failed to login', ...e.errors);\n                    } else {\n                      console.log('Failed to login', e);\n                    }\n                  });\n            });\n\n            inputFromControl(context, group);\n\n            return formSupply;\n          },\n      ).needs(connectSupply);\n    });\n  }\n\n}\n","import { conduitContext } from '../../common';\nimport { LoginComponent } from './login.component';\n\nexport * from './login-email.component';\nexport * from './login-password.component';\n\nconduitContext.load(LoginComponent);\n"],"names":["LoginEmailComponent","Component","Conduit__NS","UseInputElement","makeControl","node","aspects","inText","element","convert","setup","InValidation","validation","by","requirePresent","InCssClasses","classes","add","inCssInfo","bootstrapCssError","SetInputName","LoginPasswordComponent","LoginComponent","[object Object]","context","componentNode","get","ComponentNode","authService","AuthService","whenOn","connectSupply","afterAll","form","select","all","deep","first","button","DefaultInAspects","consume","formSupply","eventSupply","group","inGroup","email","password","InSupply","s","needs","aspect","formControl","InStyledElement","to","submit","InSubmit","InMode","mode","derive","DomEventDispatcher","on","instead","request","apiSubmit","login","catch","e","InSubmitError","console","log","errors","inputFromControl","HandleNavLinks","feature","conduitContext","load"],"mappings":"0TAoBaA,EAAb,QAAaA,KAfZC,EACG,CAAC,cAAeC,GAChBC,EAAgB,CACdC,YAAW,EAACC,KAAEA,EAAIC,QAAEA,KACXC,EAAOF,EAAKG,SACdC,QAAQH,GACRI,MAAMC,EAAcC,GAAcA,EAAWC,GAAGC,MAChDJ,MAAMK,EAAcC,IACnBA,EAAQC,IAAIC,KACZF,EAAQC,IAAIE,SAItBC,EAAa,WAEJpB,OCAAqB,EAAb,QAAaA,KAfZpB,EACG,CAAC,iBAAkBC,GACnBC,EAAgB,CACdC,YAAW,EAACC,KAAEA,EAAIC,QAAEA,KACXC,EAAOF,EAAKG,SACdC,QAAQH,GACRI,MAAMC,EAAcC,GAAcA,EAAWC,GAAGC,MAChDJ,MAAMK,EAAcC,IACnBA,EAAQC,IAAIC,KACZF,EAAQC,IAAIE,SAItBC,EAAa,cAEJC,GCab,IAAaC,EAAb,MAEEC,YAAYC,GAEV,MAAMC,EAAgBD,EAAQE,IAAIC,GAC5BC,EAAcJ,EAAQE,IAAIG,GAEhCL,EAAQM,OAAOC,IAEbC,EAAS,CACPC,KAAMR,EAAcS,OAAO,OAAQ,CAAEC,KAAK,EAAMC,MAAM,IAAQC,MAC9DC,OAAQb,EAAcS,OAAO,SAAU,CAAEC,KAAK,EAAMC,MAAM,IAAQC,MAClE/B,QAASkB,EAAQE,IAAIa,KACpBC,QACC,EACEP,MAAOA,GACPK,QAASA,GACThC,SAAUA,OAEV,IAAK2B,EACH,OAGF,MAAMQ,EAAaC,IACbC,EAA+BC,EAAsB,CACzDC,MAAO,GACPC,SAAU,KACTpC,MAAMqC,EAAUC,GAAKA,EAAEC,MAAMR,IAChCE,EAAMO,OAAOvC,GAEb,MAAMwC,EAAcR,EAAMlC,QAAQ2C,EAAgBC,GAAGpB,EAAKzB,SAAUF,GAC9DgD,EAASH,EAAYD,OAAOK,GAsBlC,OApBAJ,EAAYzC,MAAMK,EAAcC,GAAWA,EAAQC,IAAIC,MAEnDoB,GACF/B,EAAO+B,EAAO9B,SAASC,QAAQH,GAC1BI,MAAM8C,EAAQC,GAAQA,EAAKC,OAAOP,EAAYD,OAAOM,KAG5D,IAAIG,EAAmB1B,EAAKzB,SAASoD,GAAG,UAAUC,QAAQ,KACxDP,EAAOA,OAAOQ,GAAWC,EAAUnC,EAAYoC,MAAMF,KAChDG,MAAMC,IACDA,aAAaC,EACfC,QAAQC,IAAI,qBAAsBH,EAAEI,QAEpCF,QAAQC,IAAI,kBAAmBH,OAKzCK,EAAiB/C,EAASmB,GAEnBF,IAEXQ,MAAMlB,OAvDDT,KAZZrB,EACG,CAAC,QAASC,GACVsE,IACA,CACEC,QAAS,CACPxB,MAAO,CACLjD,EACAqB,OAKGC,GC3BboD,EAAeC,KAAKrD"}