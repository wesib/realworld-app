import{n as t}from"../js/_lib_/call-thru.7c5feeee.js";import{d as e}from"../js/_lib_/context-values.49ce4d52.js";import{e as s,t as n,k as r}from"../js/_lib_/fun-events.d1b80992.js";import{R as o,C as a,B as i,p as c}from"../js/_wesib/wesib.6bf655a7.js";import{_ as l}from"../js/helpers.920c7f83.js";import{a as d}from"../js/_common/auth.e5cbd92f.js";import{P as f,b as h,a as p,N as u,A as g,c as m,d as _}from"../js/_wesib/generic.69e1c9fe.js";import{C as b}from"../js/_common/index.e13c2fd6.js";import{L as j}from"../js/_generic/loader.b1731faf.js";import{c as v}from"../js/_common/main.cc9f0a0d.js";import{f as x,F as C,a as R,b as w,c as y}from"../js/_common/articles.d75dce24.js";import{A as O}from"../js/_common/input.8e7d6929.js";import{e as $}from"../js/_common/util.47eebbd0.js";import{R as P}from"../js/_generic/pager.483b9b5d.js";const S=new class extends f{create(t,e){const s=this.byDefault(t);return s.put(e),s}byDefault(t){return{get(){const{searchParams:e,pathname:s}=t.get(h);return{feed:"/personal-feed"===s?s:void 0,tag:e.get("tag")||void 0,author:e.get("author")||void 0,favorited:e.get("favorited")||void 0,limit:parseInt(e.get("limit")||"",10)||void 0,offset:parseInt(e.get("offset")||"",10)||void 0}},put(e){const{feed:s}=e,n=new URL(t.get(h).href);n.pathname="/personal-feed"===s?s:"";const r=x(e).toString();n.search=r?"?"+r:"",t.put(h,n)}}}};let E=class{constructor(t){this._context=t,this._tags=[];const e=this._context.get(C);t.whenOn(t=>{e.tags().tillOff(t)((...t)=>this.tags=t)})}get tags(){return this._tags}set tags(t){const e=this._tags;this._tags=t,this._context.updateState("tags",t,e)}render(){const{document:t}=this._context.get(i),e=t.createRange(),{contentRoot:s}=this._context;e.selectNodeContents(s),e.setStartAfter(s.childNodes[s.childNodes.length-1]);const n=this._context.get(u);let r;return n.read(t=>{const e=r;r=t,this._context.updateState("page",r,e)}),()=>{e.deleteContents();const s=t.createDocumentFragment(),o=r.get(S);this.tags.forEach(e=>{const r=n.with(S,Object.assign(Object.assign({},o),{tag:e,offset:0})).pretend();if(r){const n=s.appendChild(t.createElement("a"));n.href=r.url.href,n.innerText=e}}),e.insertNode(s)}}};l([o()],E.prototype,"render",null),E=l([a(["feed-tags",b],p())],E);let N=class{constructor(e){const{document:n}=e.get(i),r=e.get(u),o=e.get(d);e.whenOn(e=>{s({auth:o.authentication,page:r}).tillOff(e)(({auth:[{token:e}],page:[s]})=>{const{url:o}=s,a=new URL(n.baseURI);if(o.pathname!==a.pathname)return;const{feed:i}=s.get(S);"/personal-feed"===i&&(e||r.with(S,{}).replace().catch(t))})})}};N=l([a(["feed-toggle",b],g({active:"active"}),p())],N);let A=class{constructor(t){this._context=t}render(){if(!this.article)return;const{article:t}=this,e=this._context.contentRoot,{author:s}=this.article,n=`profile/#${encodeURIComponent(s.username)}`,r=s.image?`<img src="${encodeURI(s.image)}"/>`:"",o=$(s.username),a=new Date(this.article.createdAt).toDateString(),i=`article/#${encodeURIComponent(this.article.slug)}`,c=this.article.favorited?"ion-heart":"ion-ios-heart-outline";e.innerHTML=`\n<div class="post-meta">\n<a href="${n}">${r}</a>\n<div class="info">\n    <a href="${n}" class="author">${o}</a>\n    <span class="date">${a}</span>\n</div>\n<button class="btn btn-outline-primary btn-sm float-right">\n  <i class="${c}"></i> ${this.article.favoritesCount}\n</button>\n</div>\n<a href="${i}" class="preview-link">\n<h1>${$(this.article.title)}</h1>\n<p class="post-content"></p>\n<span>Read more...</span>\n</a>\n`;let l="";const d=t=>{const e=l;l=t,this._context.updateState("postContent",l,e)};return R(t).then(d).catch(e=>{console.log(`Failed to display article ${t.slug}`),d(`ERROR ${String(e)}`)}),()=>{e.querySelector(".post-content").innerHTML=l}}};l([c({propertyKey:"feedArticle"})],A.prototype,"article",void 0),l([o()],A.prototype,"render",null),A=l([a(["article-preview",b],p({href(t){let e=t.target;for(;;){const t=e.getAttribute("href");if(null!=t)return t;const{parentNode:s}=e;if(!s)return;e=s}}}))],A);const k=new e("feed-article-list",{byDefault:()=>({articles:[],articlesCount:0})});let D=class{constructor(t){this._context=t}render(){const t=this._context.get(i).document,e=this._context.get(m),s=t.createRange();let n;return s.selectNodeContents(this._context.contentRoot),e.get(k)(t=>{const e=n;n=t,this._context.updateState("articles",t,e)}),()=>{if(s.deleteContents(),!n.articlesCount)return;const e=t.createDocumentFragment();n.articles.forEach(s=>{e.appendChild(t.createElement("conduit-article-preview")).feedArticle=s}),s.insertNode(e)}}};l([o()],D.prototype,"render",null),D=l([a(["article-list",b],{feature:{needs:A}})],D);let I=class{constructor(t){this._feedPaging={};const e=t.get(m),n=t.get(u);t.whenOn(t=>{s({param:n.read.keep.thru_(t=>t.get(S)),list:e.get(k)}).tillOff(t)(({param:[t],list:[{articlesCount:e}]})=>{const{limit:s=20,offset:r=0}=t;this.feedPaging={totalPages:Math.ceil(e/s),currentPage:Math.floor(r/s),pageHref(e){var r;return(null===(r=n.with(S,Object.assign(Object.assign({},t),{offset:s*e})).pretend())||void 0===r?void 0:r.url.href)||""}}})})}get feedPaging(){return this._feedPaging}set feedPaging(t){this._feedPaging=t}};l([P()],I.prototype,"feedPaging",null),I=l([a(["feed-pager",b])],I);let U=class{constructor(t){this._context=t,this._request=n({}),this._response=n();const e=t.get(u),s=t.get(C);this._response.on((e,s)=>t.updateState("response",e,s)),this._context.get(m).provide({a:k,is:this._response.read.keep.thru_(t=>(null==t?void 0:t.ok)?t.body:{articles:[],articlesCount:0})}),t.whenOn(t=>{e.read.tillOff(t)(t=>{const e=t.get(S),s=this._request.it;w(e,s)||(this._request.it=e)}),this._request.read.tillOff(t).thru_(t=>(this._response.it=void 0,r(s.articles(t))))(t=>this._response.it=t)})}render(){const{contentRoot:t}=this._context,e=this._context.get(i).document,s=this._context.get(O),n=t.appendChild(e.createElement("conduit-article-list")),r=t.appendChild(e.createElement("conduit-feed-pager")),o=e.createRange();return o.setStartAfter(n),o.setEndBefore(r),()=>{o.deleteContents();const t=this._response.it;t?t.ok||o.insertNode(function(t){const n=s(t);if(n)return n;const r=e.createElement("conduit-loader");return r.setAttribute("load-error","Failed to load articles"),r}(t.errors)):o.insertNode(e.createElement("conduit-loader"))}}};l([o()],U.prototype,"render",null),U=l([a(["feed",b],{feature:{needs:[D,I]}})],U);let q=class{};q=l([a(["home",b],{feature:{needs:[y,U,E,N,j,_]}})],q),v.load(q);//# sourceMappingURL=main.ec3b8400.js.map
