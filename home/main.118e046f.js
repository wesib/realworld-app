import{ac as t,f as e,s,a1 as n,t as o,a8 as a,D as r}from"../js/lib.722ff502.js";import{P as i,m as c,R as l,C as d,j as h,B as u,N as p,i as g,n as f,a as m,o as _}from"../js/wesib.828181c2.js";import{f as b,C as v,F as x,A as C,e as R,a as w,b as y,d as $,c as S}from"../js/common.d13eb97a.js";const j=new class extends i{create(t,e){const s=this.byDefault(t);return s.put(e),s}byDefault(t){return{get(){const{searchParams:e,pathname:s}=t.get(c);return{feed:"/personal-feed"===s?s:void 0,tag:e.get("tag")||void 0,author:e.get("author")||void 0,favorited:e.get("favorited")||void 0,limit:parseInt(e.get("limit")||"",10)||void 0,offset:parseInt(e.get("offset")||"",10)||void 0}},put(e){const{feed:s}=e,n=new URL(t.get(c).href);n.pathname="/personal-feed"===s?s:"";const o=b(e).toString();n.search=o?"?"+o:"",t.put(c,n)}}}};let N=class{constructor(t){this._context=t,this._tags=[];const e=this._context.get(x);t.whenOn(t=>{e.tags().tillOff(t)((...t)=>this.tags=t)})}get tags(){return this._tags}set tags(t){const e=this._tags;this._tags=t,this._context.updateState("tags",t,e)}render(){const{document:t}=this._context.get(u),e=t.createRange(),{contentRoot:s}=this._context;e.selectNodeContents(s),e.setStartAfter(s.childNodes[s.childNodes.length-1]);const n=this._context.get(p);let o;return n.read(t=>{const e=o;o=t,this._context.updateState("page",o,e)}),()=>{e.deleteContents();const s=t.createDocumentFragment(),a=o.get(j);this.tags.forEach(e=>{const o=n.with(j,Object.assign(Object.assign({},a),{tag:e,offset:0})).pretend();if(o){const n=s.appendChild(t.createElement("a"));n.href=o.url.href,n.innerText=e}}),e.insertNode(s)}}};t([l()],N.prototype,"render",null),N=t([d(["feed-tags",v],h())],N);let O=class{constructor(t){const{document:n}=t.get(u),o=t.get(p),a=t.get(C);t.whenOn(t=>{e({auth:a.authentication,page:o}).tillOff(t)(({auth:[{token:t}],page:[e]})=>{const{url:a}=e,r=new URL(n.baseURI);if(a.pathname!==r.pathname)return;const{feed:i}=e.get(j);"/personal-feed"===i&&(t||o.with(j,{}).replace().catch(s))})})}};O=t([d(["feed-toggle",v],g({active:"active"}),h())],O);let A=class{constructor(t){this._context=t}render(){if(!this.article)return;const{article:t}=this,e=this._context.contentRoot,{author:s}=this.article,n=`profile/#${encodeURIComponent(s.username)}`,o=s.image?`<img src="${encodeURI(s.image)}"/>`:"",a=R(s.username),r=new Date(this.article.createdAt).toDateString(),i=`article/#${encodeURIComponent(this.article.slug)}`,c=this.article.favorited?"ion-heart":"ion-ios-heart-outline";e.innerHTML=`\n<div class="post-meta">\n<a href="${n}">${o}</a>\n<div class="info">\n    <a href="${n}" class="author">${a}</a>\n    <span class="date">${r}</span>\n</div>\n<button class="btn btn-outline-primary btn-sm float-right">\n  <i class="${c}"></i> ${this.article.favoritesCount}\n</button>\n</div>\n<a href="${i}" class="preview-link">\n<h1>${R(this.article.title)}</h1>\n<p class="post-content"></p>\n<span>Read more...</span>\n</a>\n`;let l="";const d=t=>{const e=l;l=t,this._context.updateState("postContent",l,e)};return w(t).then(d).catch(e=>{console.log(`Failed to display article ${t.slug}`),d(`ERROR ${String(e)}`)}),()=>{e.querySelector(".post-content").innerHTML=l}}};t([f({propertyKey:"feedArticle"})],A.prototype,"article",void 0),t([l()],A.prototype,"render",null),A=t([d(["article-preview",v],h({href(t){let e=t.target;for(;;){const t=e.getAttribute("href");if(null!=t)return t;const{parentNode:s}=e;if(!s)return;e=s}}}))],A);const E=new n("feed-article-list",{byDefault:()=>({articles:[],articlesCount:0})});let D=class{constructor(t){this._context=t}render(){const t=this._context.get(u).document,e=this._context.get(m),s=t.createRange();let n;return s.selectNodeContents(this._context.contentRoot),e.get(E)(t=>{const e=n;n=t,this._context.updateState("articles",t,e)}),()=>{if(s.deleteContents(),!n.articlesCount)return;const e=t.createDocumentFragment();n.articles.forEach(s=>{e.appendChild(t.createElement("conduit-article-preview")).feedArticle=s}),s.insertNode(e)}}};t([l()],D.prototype,"render",null),D=t([d(["article-list",v],{feature:{needs:A}})],D);let q=class{constructor(t){this._context=t,this._request=o({}),this._response=o();const e=t.get(p),s=t.get(x);this._response.on((e,s)=>t.updateState("response",e,s)),this._context.get(m).provide({a:E,is:this._response.read.keep.thru_(t=>(null==t?void 0:t.ok)?t.body:{articles:[],articlesCount:0})}),t.whenOn(t=>{e.read.tillOff(t)(t=>{const e=t.get(j),s=this._request.it;y(e,s)||(this._request.it=e)}),this._request.read.tillOff(t).thru_(t=>(this._response.it=void 0,a(s.articles(t))))(t=>this._response.it=t)})}render(){const t=this,{contentRoot:e}=this._context,s=this._context.get(p),n=this._context.get(u).document,o=this._context.get($),a=e.appendChild(n.createElement("conduit-article-list")),i=n.createRange();return i.selectNodeContents(e),i.setStartAfter(a),()=>{i.deleteContents();const e=this._response.it;e?e.ok?i.insertNode(function({articlesCount:e}){const{limit:o=20,offset:a=0}=t._request.it,i=Math.ceil(e/o),c=Math.floor(a/o),l=n.createElement("conduit-pager");return l.setAttribute("total-pages",i.toString(10)),l.setAttribute("current-page",c.toString(10)),new r(l).on("conduit:pager").just(({detail:t})=>{const e=s.page.get(j);s.with(j,Object.assign(Object.assign({},e),{offset:t*o})).open()}),l}(e.body)):i.insertNode(function(t){const e=o(t);if(e)return e;const s=n.createElement("conduit-loader");return s.setAttribute("load-error","Failed to load articles"),s}(e.errors)):i.insertNode(n.createElement("conduit-loader"))}}};t([l()],q.prototype,"render",null),q=t([d(["feed",v],{feature:{needs:D}})],q);let I=class{};I=t([d(["home",v],{feature:{needs:[q,N,O,_]}})],I),S.load(I);//# sourceMappingURL=main.118e046f.js.map
