import{n as t}from"../js/lib/call-thru.00f7427a.js";import{d as e}from"../js/lib/context-values.d686e0c8.js";import{e as s,t as r,k as n}from"../js/lib/fun-events.a21352be.js";import{o,R as a,C as i,B as c,r as l}from"../js/wesib/wesib.84ff8eb8.js";import{_ as d}from"../js/helpers.920c7f83.js";import{a as f}from"../js/common/auth.7af1dac4.js";import{f as h,P as p,a as u,N as g,A as m,b as _,g as j}from"../js/wesib/generic.643f46dc.js";import{C as v}from"../js/common.74dd5bad.js";import{L as b}from"../js/generic/loader.74a72c40.js";import{c as w}from"../js/common/main.cbd1afd7.js";import{f as x,a as C,b as O,F as y}from"../js/common/articles.3436168e.js";import{A as R}from"../js/common/input.9985e50b.js";import{A as P,C as N}from"../js/article-meta-support.feature.bcf3ee96.js";import{e as A}from"../js/common/util.36d20bba.js";import{R as E}from"../js/generic/pager.c27e7351.js";const k=new class extends h{create(t,e){const s=this.byDefault(t);return s.put(e),s}byDefault(t){return{get(){const{searchParams:e,pathname:s}=t.get(p);return{feed:"/personal-feed"===s?s:void 0,tag:e.get("tag")||void 0,author:e.get("author")||void 0,favorited:e.get("favorited")||void 0,limit:parseInt(e.get("limit")||"",10)||void 0,offset:parseInt(e.get("offset")||"",10)||void 0}},put(e){const{feed:s}=e,r=new URL(t.get(p).href);r.pathname="/personal-feed"===s?s:"";const n=x(e).toString();r.search=n?"?"+n:"",t.put(p,r)}}}};let D=class{constructor(t){this._context=t,this.tags=[];const e=this._context.get(C),s=this._context.get(g);t.whenOn(t=>{s.read.tillOff(t)(t=>this.page=t),e.tags().tillOff(t)((...t)=>this.tags=t)})}render(){const{document:t}=this._context.get(c),e=t.createRange(),{contentRoot:s}=this._context;return e.selectNodeContents(s),e.setStartAfter(s.childNodes[s.childNodes.length-1]),()=>{if(e.deleteContents(),!this.page)return;const s=this._context.get(g),r=t.createDocumentFragment(),n=this.page.get(k);this.tags.forEach(e=>{const o=s.with(k,Object.assign(Object.assign({},n),{tag:e,offset:0})).pretend();if(o){const s=r.appendChild(t.createElement("a"));s.href=o.url.href,s.innerText=e}}),e.insertNode(r)}}};d([o()],D.prototype,"tags",void 0),d([o()],D.prototype,"page",void 0),d([a()],D.prototype,"render",null),D=d([i(["feed-tags",v],u())],D);let q=class{constructor(e){const{document:r}=e.get(c),n=e.get(g),o=e.get(f);e.whenOn(e=>{s({auth:o.authentication,page:n}).tillOff(e)(({auth:[{token:e}],page:[s]})=>{const{url:o}=s,a=new URL(r.baseURI);if(o.pathname!==a.pathname)return;const{feed:i}=s.get(k);"/personal-feed"===i&&(e||n.with(k,{}).replace().catch(t))})})}};q=d([i(["feed-toggle",v],m({active:"active"}),u())],q);let F=class{constructor(t){this._context=t,this._article=r({});const e=t.get(_);t.whenOn(t=>{const s=e.provide({a:N,is:this._article.read});t.whenOff(s)})}get article(){return this._article.it}set article(t){this._article.it=t}render(){if(!this.article.slug)return;const t=this._context.contentRoot,e=`article/#/${encodeURIComponent(this.article.slug)}`;t.innerHTML=`\n<div class="post-meta">\n<conduit-article-author></conduit-article-author>\n<conduit-favorite-post></conduit-favorite-post>\n</div>\n<a href="${e}" class="preview-link">\n<h1>${A(this.article.title)}</h1>\n<p class="post-content">${A(this.article.description)}</p>\n<span>Read more...</span>\n</a>\n`}};d([l({propertyKey:"feedArticle"})],F.prototype,"article",null),d([a({offline:!0})],F.prototype,"render",null),F=d([i(["article-preview",v],{feature:{needs:[P]}},u({href(t){let e=t.target;for(;;){const t=e.getAttribute("href");if(null!=t)return t;const{parentNode:s}=e;if(!s)return;e=s}}}))],F);const I=new e("feed-article-list",{byDefault:()=>({articles:[],articlesCount:0})});let L=class{constructor(t){this._context=t,this.articles={articles:[],articlesCount:0};const e=t.get(_);t.whenOn(t=>{e.get(I).tillOff(t)(t=>this.articles=t)})}render(){const t=this._context.get(c).document,e=t.createRange();return e.selectNodeContents(this._context.contentRoot),()=>{if(e.deleteContents(),!this.articles.articlesCount)return;const s=t.createDocumentFragment();this.articles.articles.forEach(e=>{s.appendChild(t.createElement("conduit-article-preview")).feedArticle=e}),e.insertNode(s)}}};d([o()],L.prototype,"articles",void 0),d([a()],L.prototype,"render",null),L=d([i(["article-list",v],{feature:{needs:F}})],L);let S=class{constructor(t){this._feedPaging={};const e=t.get(_),r=t.get(g);t.whenOn(t=>{s({param:r.read.keep.thru_(t=>t.get(k)),list:e.get(I)}).tillOff(t)(({param:[t],list:[{articlesCount:e}]})=>{const{limit:s=20,offset:n=0}=t;this.feedPaging={totalPages:Math.ceil(e/s),currentPage:Math.floor(n/s),pageHref(e){var n;return(null===(n=r.with(k,Object.assign(Object.assign({},t),{offset:s*e})).pretend())||void 0===n?void 0:n.url.href)||""}}})})}get feedPaging(){return this._feedPaging}set feedPaging(t){this._feedPaging=t}};d([E()],S.prototype,"feedPaging",null),S=d([i(["feed-pager",v])],S);let U=class{constructor(t){this._context=t,this._request=r({}),this._response=r();const e=t.get(g),s=t.get(C);this._response.on((e,s)=>t.updateState("response",e,s)),this._context.get(_).provide({a:I,is:this._response.read.keep.thru_(t=>(null==t?void 0:t.ok)?t.body:{articles:[],articlesCount:0})}),t.whenOn(t=>{e.read.tillOff(t)(t=>{const e=t.get(k),s=this._request.it;O(e,s)||(this._request.it=e)}),this._request.read.tillOff(t).thru_(t=>(this._response.it=void 0,n(s.articles(t))))(t=>this._response.it=t)})}render(){const{contentRoot:t}=this._context,e=this._context.get(c).document,s=this._context.get(R),r=t.appendChild(e.createElement("conduit-article-list")),n=t.appendChild(e.createElement("conduit-feed-pager")),o=e.createRange();return o.setStartAfter(r),o.setEndBefore(n),()=>{o.deleteContents();const t=this._response.it;t?t.ok||o.insertNode(function(t){const r=s(t);if(r)return r;const n=e.createElement("conduit-loader");return n.setAttribute("load-error","Failed to load articles"),n}(t.errors)):o.insertNode(e.createElement("conduit-loader"))}}};d([a()],U.prototype,"render",null),U=d([i(["feed",v],{feature:{needs:[L,S]}})],U);let $=class{};$=d([i(["home",v],{feature:{needs:[y,U,D,q,b,j]}})],$),w.load($);//# sourceMappingURL=main.e1ecc8f2.js.map
