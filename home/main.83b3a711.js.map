{"version":3,"file":"main.83b3a711.js","sources":["../../src/pages/home/feed-tags.component.ts","../../src/pages/home/feed-toggle.component.ts","../../src/pages/home/feed.component.ts","../../src/pages/home/home.component.ts","../../src/pages/home/main.ts"],"sourcesContent":["import { HandleNavLinks, Navigation, Page } from '@wesib/generic';\nimport { BootstrapWindow, Component, ComponentContext, ElementRenderer, Render, StateProperty } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { FeedService } from '../../core/feed';\nimport { PageFeedParam } from './page-feed-param';\n\n@Component(\n    ['feed-tags', Conduit__NS],\n    HandleNavLinks(),\n)\nexport class FeedTagsComponent {\n\n  @StateProperty()\n  private tags: string[] = [];\n\n  @StateProperty()\n  private page?: Page;\n\n  constructor(private readonly _context: ComponentContext) {\n\n    const feedService = this._context.get(FeedService);\n    const navigation = this._context.get(Navigation);\n\n    _context.whenOn(supply => {\n      navigation.read().tillOff(supply).to(page => this.page = page);\n      feedService.tags().tillOff(supply).to((...tags) => this.tags = tags);\n    });\n  }\n\n  @Render()\n  render(): ElementRenderer {\n\n    const { document } = this._context.get(BootstrapWindow);\n    const range = document.createRange();\n    const { contentRoot }: { contentRoot: Element } = this._context;\n\n    range.selectNodeContents(contentRoot);\n    range.setStartAfter(contentRoot.childNodes[contentRoot.childNodes.length - 1]);\n\n    return () => {\n      range.deleteContents();\n      if (!this.page) {\n        return;\n      }\n\n      const navigation = this._context.get(Navigation);\n      const fragment = document.createDocumentFragment();\n      const request = this.page.get(PageFeedParam);\n\n      this.tags.forEach(tag => {\n\n        const target = navigation.with(PageFeedParam, { ...request, tag, feed: undefined, offset: 0 }).pretend();\n\n        if (target) {\n\n          const a = fragment.appendChild(document.createElement('a'));\n\n          a.href = target.url.href;\n          a.innerText = tag;\n        }\n      });\n\n      range.insertNode(fragment);\n    };\n  }\n\n}\n","import { ActivateNavLink, HandleNavLinks, Navigation } from '@wesib/generic';\nimport { BootstrapWindow, Component, ComponentContext, ElementRenderer, Render, StateProperty } from '@wesib/wesib';\nimport { noop } from 'call-thru';\nimport { afterAll } from 'fun-events';\nimport { Conduit__NS } from '../../core';\nimport { AuthService } from '../../core/auth';\nimport { FeedRequest } from '../../core/feed';\nimport { PageFeedParam } from './page-feed-param';\n\n@Component(\n    ['feed-toggle', Conduit__NS],\n    ActivateNavLink({ active: 'active' }),\n    HandleNavLinks(),\n)\nexport class FeedToggleComponent {\n\n  @StateProperty()\n  request: FeedRequest = {};\n\n  constructor(private readonly _context: ComponentContext) {\n\n    const { document } = _context.get(BootstrapWindow);\n    const navigation = _context.get(Navigation);\n    const authService = _context.get(AuthService);\n\n    _context.whenOn(supply => {\n      afterAll({\n        auth: authService.authentication(),\n        page: navigation,\n      }).tillOff(supply).to(\n          ({\n            auth: [{ token }],\n            page: [page],\n          }) => {\n\n            const { url } = page;\n            const baseURL = new URL(document.baseURI);\n\n            if (url.pathname !== baseURL.pathname) {\n              return; // Not a home page\n            }\n\n            const request = this.request = page.get(PageFeedParam);\n            const { feed } = request;\n\n            if (feed !== '/personal-feed') {\n              return; // Global feed\n            }\n            if (!token /* not authenticated */) {\n              // Redirect to global feed\n              navigation.with(PageFeedParam, {}).replace().catch(noop);\n            }\n          },\n      );\n    });\n  }\n\n  @Render()\n  render(): ElementRenderer {\n\n    const navigation = this._context.get(Navigation);\n    const { document } = this._context.get(BootstrapWindow);\n    const { element }: { element: Element } = this._context;\n    const ul = element.querySelector('ul')!;\n    const range = document.createRange();\n\n    range.setStartAfter(ul.appendChild(document.createComment('[TAG[')));\n    range.setEndBefore(ul.appendChild(document.createComment(']TAG]')));\n\n    return () => {\n      range.deleteContents();\n\n      const { tag } = this.request;\n\n      if (!tag) {\n        return;\n      }\n\n      const target = navigation.with(PageFeedParam, { tag }).pretend();\n\n      if (!target) {\n        return;\n      }\n\n      const li = document.createElement('li');\n\n      li.className = 'nav-item';\n\n      const a = li.appendChild(document.createElement('a'));\n\n      a.className = 'nav-link';\n      a.innerText = `#${tag}`;\n      a.setAttribute('href', target.url.hash);\n\n      range.insertNode(li);\n    };\n  }\n\n}\n","import { Navigation } from '@wesib/generic';\nimport { Component, ComponentContext } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { FeedRequest } from '../../core/feed';\nimport { PageFeedParam } from './page-feed-param';\nimport { RenderFeed } from './render-feed.decorator';\n\n@Component(['feed', Conduit__NS])\nexport class FeedComponent {\n\n  @RenderFeed()\n  request: FeedRequest = {};\n\n  constructor(context: ComponentContext) {\n\n    const navigation = context.get(Navigation);\n\n    context.whenOn(supply => {\n      navigation.read().tillOff(supply).to(page => {\n        this.request = page.get(PageFeedParam);\n      });\n    });\n  }\n\n}\n","import { PageHashURLSupport } from '@wesib/generic';\nimport { Component } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { FeedSupport } from '../../core/feed';\nimport { LoaderComponent } from '../../core/loader';\nimport { FeedTagsComponent } from './feed-tags.component';\nimport { FeedToggleComponent } from './feed-toggle.component';\nimport { FeedComponent } from './feed.component';\n\n@Component(\n    ['home', Conduit__NS],\n    {\n      feature: {\n        needs: [\n          FeedSupport,\n          FeedComponent,\n          FeedTagsComponent,\n          FeedToggleComponent,\n          LoaderComponent,\n          PageHashURLSupport,\n        ],\n      },\n    },\n)\nexport class HomeComponent {\n}\n","import { conduitContext } from '../../core/main';\nimport { HomeComponent } from './home.component';\n\nconduitContext.load(HomeComponent);\n"],"names":["FeedTagsComponent","[object Object]","_context","this","feedService","get","FeedService","navigation","Navigation","whenOn","supply","read","tillOff","to","page","tags","document","BootstrapWindow","range","createRange","contentRoot","selectNodeContents","setStartAfter","childNodes","length","deleteContents","fragment","createDocumentFragment","request","PageFeedParam","forEach","tag","target","with","feed","undefined","offset","pretend","a","appendChild","createElement","href","url","innerText","insertNode","__decorate","StateProperty","Render","Component","Conduit__NS","HandleNavLinks","FeedToggleComponent","authService","AuthService","afterAll","auth","authentication","token","baseURL","URL","baseURI","pathname","replace","catch","noop","element","ul","querySelector","createComment","setEndBefore","li","className","setAttribute","hash","ActivateNavLink","active","FeedComponent","context","RenderFeed","HomeComponent","feature","needs","FeedSupport","LoaderComponent","PageHashURLSupport","conduitContext","load"],"mappings":"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"}