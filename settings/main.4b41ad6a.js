import"../js/proc7ts/primitives.90941b78.js";import"../js/proc7ts/push-iterator.e3c0f3f1.js";import"../js/proc7ts/context-values.de0fa082.js";import"../js/proc7ts/call-thru.104a1934.js";import"../js/proc7ts/fun-events.751f4123.js";import{c as s}from"../js/frontmeans/namespace-aliaser.54a2e6c0.js";import"../js/frontmeans/render-scheduler.c6ad5452.js";import{C as e,S as t,R as o,l as a}from"../js/wesib/wesib.fd49a6cd.js";import{_ as r}from"../js/helpers.e1623395.js";import{b as i}from"../js/core/auth.2372f198.js";import{a as m}from"../js/core/api.850f8641.js";import{S as c,O as n,a as p,c as l}from"../js/wesib/generic.1df87fc1.js";import"../js/proc7ts/delta-set.9ee1ffba.js";import{r as d,d as j,h as u,b as f,q as h,I as b}from"../js/frontmeans/input-aspects.8b5674f5.js";import{C as g}from"../js/core.bba16f1a.js";import{a as v}from"../js/core/loader.46a2a88b.js";import"../js/core/layout.2906fa88.js";import{c as S}from"../js/core/main.e6d61b54.js";import{U as _,F as y,C as U}from"../js/core/input.28057277.js";import{U as x}from"../js/user-email.component.8585abf5.js";import{U as C}from"../js/user-name.component.bb1383b8.js";let k=class{};k=r([e(["change-password",g],_({makeControl({node:s,aspects:e}){const t=d(s.element,{aspects:e}),o=t.convert({get:s=>s||"",set:s=>s||void 0},e,j.to(s.element));return t.aspect(u).derive(o.aspect(u)),o}}),c("password"))],k);let w=class{};w=r([e(["user-bio",g],_({select:"textarea",makeControl:({node:s,aspects:e})=>d(s.element,{aspects:e})}),c("bio"))],w);let F=class{};F=r([e(["user-image",g],_({makeControl:({node:s,aspects:e})=>d(s.element,{aspects:e})}),c("image"))],F);const L=["updated",g];let O=class{constructor(s){this._context=s,this.updated=!1,this._authService=s.get(i),this._authService.loadUser().tillOff(s).to((s=>{this.loadStatus=s,s&&s.ok&&this.setUser(s.body)}))}submit({control:s}){this.updated=!1,s.aspect(f).markEdited(),s.aspect(h).submit((s=>m(this._authService.updateSettings(s)))).then((s=>{this.setUser(s),this.updated=!0})).catch((s=>{s instanceof b?console.error("Failed to update user settings",...s.errors):console.error("Failed to update user settings",s)}))}render(){const{element:e}=this._context,t=s.name(L,this._context.get(a));return()=>{this.updated?e.classList.add(t):e.classList.remove(t)}}setUser({username:s,email:e,bio:t,image:o}){this._context.get(p).get(l).once((a=>{a.control&&(a.control.it={username:s,email:e,bio:t,image:o})}))}};r([t()],O.prototype,"updated",void 0),r([v({comment:"settings"})],O.prototype,"loadStatus",void 0),r([n()],O.prototype,"submit",null),r([o()],O.prototype,"render",null),O=r([e(["settings",g],{feature:{needs:[k,U,w,x,F,C]}},y({emptyModel:{email:"",username:""}}))],O),S.load(O);//# sourceMappingURL=main.4b41ad6a.js.map
