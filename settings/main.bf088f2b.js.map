{"version":3,"file":"main.bf088f2b.js","sources":["../../src/pages/settings/change-password.component.ts","../../src/pages/settings/user-bio.component.ts","../../src/pages/settings/user-image.component.ts","../../src/pages/settings/settings.component.ts","../../src/pages/settings/main.ts"],"sourcesContent":["import { InMode, InStyledElement, inText } from '@frontmeans/input-aspects';\nimport { SetInputName } from '@wesib/generic/input';\nimport { Component } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { UseConduitInput } from '../../core/input';\n\n@Component(\n    ['change-password', Conduit__NS],\n    UseConduitInput({\n      makeControl({ node, aspects }) {\n\n        const text = inText(node.element, { aspects });\n        const control = text.convert<string | undefined>(\n            {\n              get(value) {\n                return value || '';\n              },\n              set(value) {\n                return value || undefined;\n              },\n            },\n            aspects,\n            InStyledElement.to(node.element),\n        );\n\n        text.aspect(InMode).derive(control.aspect(InMode));\n\n        return control;\n      },\n    }),\n    SetInputName('password'),\n)\nexport class ChangePasswordComponent {\n}\n","import { inText } from '@frontmeans/input-aspects';\nimport { SetInputName } from '@wesib/generic/input';\nimport { Component } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { UseConduitInput } from '../../core/input';\n\n@Component(\n    ['user-bio', Conduit__NS],\n    UseConduitInput({\n      select: 'textarea',\n      makeControl({ node, aspects }) {\n        return inText(node.element, { aspects });\n      },\n    }),\n    SetInputName('bio'),\n)\nexport class UserBioComponent {\n}\n","import { inText } from '@frontmeans/input-aspects';\nimport { SetInputName } from '@wesib/generic/input';\nimport { Component } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { UseConduitInput } from '../../core/input';\n\n@Component(\n    ['user-image', Conduit__NS],\n    UseConduitInput({\n      makeControl({ node, aspects }) {\n        return inText(node.element, { aspects });\n      },\n    }),\n    SetInputName('image'),\n)\nexport class UserImageComponent {\n}\n","import { InStatus, InSubmit, InSubmitError } from '@frontmeans/input-aspects';\nimport { css__naming, QualifiedName } from '@frontmeans/namespace-aliaser';\nimport { AfterEvent, onceAfter, supplyOn } from '@proc7ts/fun-events';\nimport { HierarchyContext } from '@wesib/generic';\nimport { InputToForm, NoInputToForm, OnSubmit } from '@wesib/generic/input';\nimport {\n  Component,\n  ComponentContext,\n  DefaultNamespaceAliaser,\n  ElementRenderer,\n  Render,\n  StateProperty,\n} from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { apiSubmit } from '../../core/api';\nimport { AuthService, AuthUser, UpdateSettingsRequest } from '../../core/auth';\nimport { ConduitInputSupport, FillConduitForm } from '../../core/input';\nimport { LoadStatus, RenderLoader } from '../../core/loader';\nimport { ChangePasswordComponent } from './change-password.component';\nimport { UserBioComponent } from './user-bio.component';\nimport { UserEmailComponent } from './user-email.component';\nimport { UserImageComponent } from './user-image.component';\nimport { UserNameComponent } from './user-name.component';\n\nconst updatedClassName: QualifiedName = ['updated', Conduit__NS];\n\n@Component(\n    ['settings', Conduit__NS],\n    {\n      feature: {\n        needs: [\n          ChangePasswordComponent,\n          ConduitInputSupport,\n          UserBioComponent,\n          UserEmailComponent,\n          UserImageComponent,\n          UserNameComponent,\n        ],\n      },\n    },\n    FillConduitForm<UpdateSettingsRequest>({\n      emptyModel: {\n        email: '',\n        username: '',\n      },\n    }),\n)\nexport class SettingsComponent {\n\n  private readonly _authService: AuthService;\n\n  @StateProperty()\n  updated = false;\n\n  @RenderLoader({ comment: 'settings' })\n  loadStatus?: LoadStatus;\n\n  constructor(private readonly _context: ComponentContext) {\n    this._authService = _context.get(AuthService);\n\n    this._authService.loadUser().do(supplyOn(_context))(\n        response => {\n          this.loadStatus = response;\n          if (response && response.ok) {\n            this.setUser(response.body);\n          }\n        },\n    );\n  }\n\n  @OnSubmit()\n  submit({ control }: InputToForm<UpdateSettingsRequest>): void {\n    this.updated = false;\n    control.aspect(InStatus).markEdited();\n    control.aspect(InSubmit)\n        .submit(request => apiSubmit(this._authService.updateSettings(request)))\n        .then(user => {\n          this.setUser(user);\n          this.updated = true;\n        })\n        .catch(e => {\n          if (e instanceof InSubmitError) {\n            console.error('Failed to update user settings', ...e.errors);\n          } else {\n            console.error('Failed to update user settings', e);\n          }\n        });\n  }\n\n  @Render()\n  render(): ElementRenderer {\n\n    const { element }: { element: Element } = this._context;\n    const updatedClass = css__naming.name(updatedClassName, this._context.get(DefaultNamespaceAliaser));\n\n    return () => {\n      if (this.updated) {\n        element.classList.add(updatedClass);\n      } else {\n        element.classList.remove(updatedClass);\n      }\n    };\n  }\n\n  private setUser(\n      {\n        username,\n        email,\n        bio,\n        image,\n      }: AuthUser,\n  ): void {\n\n    const hierarchy = this._context.get(HierarchyContext);\n    const form: AfterEvent<[InputToForm<UpdateSettingsRequest> | NoInputToForm]> = hierarchy.get(InputToForm);\n\n    form.do(onceAfter)(f => {\n      if (f.control) {\n        f.control.it = {\n          username,\n          email,\n          bio,\n          image,\n        };\n      }\n    });\n  }\n\n}\n","import { conduitContext } from '../../core/main';\nimport { SettingsComponent } from './settings.component';\n\nconduitContext.load(SettingsComponent);\n"],"names":["ChangePasswordComponent","Component","Conduit__NS","UseConduitInput","[object Object]","node","aspects","text","inText","element","control","convert","get","value","set","undefined","InStyledElement","to","aspect","InMode","derive","SetInputName","UserBioComponent","select","makeControl","UserImageComponent","updatedClassName","SettingsComponent","_context","this","_authService","AuthService","loadUser","do","supplyOn","response","loadStatus","ok","setUser","body","updated","InStatus","markEdited","InSubmit","submit","request","apiSubmit","updateSettings","then","user","catch","e","InSubmitError","console","error","errors","updatedClass","css__naming","name","DefaultNamespaceAliaser","classList","add","remove","username","email","bio","image","HierarchyContext","InputToForm","onceAfter","form","f","it","__decorate","StateProperty","RenderLoader","comment","OnSubmit","Render","feature","needs","ConduitInputSupport","UserEmailComponent","UserNameComponent","FillConduitForm","emptyModel","conduitContext","load"],"mappings":"4zCAgCA,IAAaA,EAAb,QAAaA,KA1BZC,EACG,CAAC,kBAAmBC,GACpBC,EAAgB,CACdC,aAAYC,KAAEA,EAAIC,QAAEA,IAElB,MAAMC,EAAOC,EAAOH,EAAKI,QAAS,CAAEH,QAAAA,IAC9BI,EAAUH,EAAKI,QACjB,CACEC,IAAIC,GACKA,GAAS,GAElBC,IAAID,GACKA,QAASE,GAGpBT,EACAU,EAAgBC,GAAGZ,EAAKI,UAK5B,OAFAF,EAAKW,OAAOC,GAAQC,OAAOV,EAAQQ,OAAOC,IAEnCT,KAGXW,EAAa,cAEJrB,GChBb,IAAasB,EAAb,QAAaA,KAVZrB,EACG,CAAC,WAAYC,GACbC,EAAgB,CACdoB,OAAQ,WACRC,YAAW,EAACnB,KAAEA,EAAIC,QAAEA,KACXE,EAAOH,EAAKI,QAAS,CAAEH,QAAAA,MAGlCe,EAAa,SAEJC,GCDb,IAAaG,EAAb,QAAaA,KATZxB,EACG,CAAC,aAAcC,GACfC,EAAgB,CACdqB,YAAW,EAACnB,KAAEA,EAAIC,QAAEA,KACXE,EAAOH,EAAKI,QAAS,CAAEH,QAAAA,MAGlCe,EAAa,WAEJI,GCSb,MAAMC,EAAkC,CAAC,UAAWxB,GAuBpD,IAAayB,EAAb,MAUEvB,YAA6BwB,GAAAC,cAAAD,EAL7BC,cAAU,EAMRA,KAAKC,aAAeF,EAAShB,IAAImB,GAEjCF,KAAKC,aAAaE,WAAWC,GAAGC,EAASN,GAAzCC,EACIM,IACEN,KAAKO,WAAaD,EACdA,GAAYA,EAASE,IACvBR,KAAKS,QAAQH,EAASI,SAOhCnC,QAAOM,QAAEA,IACPmB,KAAKW,SAAU,EACf9B,EAAQQ,OAAOuB,GAAUC,aACzBhC,EAAQQ,OAAOyB,GACVC,QAAOC,GAAWC,EAAUjB,KAAKC,aAAaiB,eAAeF,MAC7DG,MAAKC,IACJpB,KAAKS,QAAQW,GACbpB,KAAKW,SAAU,KAEhBU,OAAMC,IACDA,aAAaC,EACfC,QAAQC,MAAM,oCAAqCH,EAAEI,QAErDF,QAAQC,MAAM,iCAAkCH,MAM1D/C,SAEE,MAAMK,QAAEA,GAAkCoB,KAAKD,SACzC4B,EAAeC,EAAYC,KAAKhC,EAAkBG,KAAKD,SAAShB,IAAI+C,IAE1E,MAAO,KACD9B,KAAKW,QACP/B,EAAQmD,UAAUC,IAAIL,GAEtB/C,EAAQmD,UAAUE,OAAON,IAKvBpD,SACJ2D,SACEA,EAAQC,MACRA,EAAKC,IACLA,EAAGC,MACHA,IAIcrC,KAAKD,SAAShB,IAAIuD,GACqDvD,IAAIwD,GAExFnC,GAAGoC,EAARC,EAAmBC,IACbA,EAAE7D,UACJ6D,EAAE7D,QAAQ8D,GAAK,CACbT,SAAAA,EACAC,MAAAA,EACAC,IAAAA,EACAC,MAAAA,SAtERO,GADCC,mCAIDD,GADCE,EAAa,CAAEC,QAAS,+CAiBzBH,GADCI,gCAoBDJ,GADCK,gCA1CUnD,KArBZ1B,EACG,CAAC,WAAYC,GACb,CACE6E,QAAS,CACPC,MAAO,CACLhF,EACAiF,EACA3D,EACA4D,EACAzD,EACA0D,KAINC,EAAuC,CACrCC,WAAY,CACVrB,MAAO,GACPD,SAAU,QAILpC,GC5Cb2D,EAAeC,KAAK5D"}