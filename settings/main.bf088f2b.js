import{c as s}from"../js/core/main.65d7bafb.js";import{_ as e}from"../js/helpers.e1623395.js";import{r as t,d as o,h as a,b as r,q as i,I as m}from"../js/frontmeans/input-aspects.453491d0.js";import{c}from"../js/frontmeans/namespace-aliaser.9467f14d.js";import{F as n,x as p}from"../js/proc7ts/fun-events.2a5b87d8.js";import{S as d,O as j,a as l,c as u}from"../js/wesib/generic.2dcf3479.js";import{C as f,S as h,R as b,l as g}from"../js/wesib/wesib.8c9ee002.js";import{C as v}from"../js/core.10059585.js";import{a as y}from"../js/core/api.e1bac610.js";import{b as S}from"../js/core/auth.97776b50.js";import{U as _,F as x,C as U}from"../js/core/input.475c0ace.js";import{a as k}from"../js/core/loader.9029aa45.js";import{U as w}from"../js/user-email.component.e78d7a83.js";import{U as C}from"../js/user-name.component.5f778977.js";import"../js/core/layout.52c96865.js";import"../js/frontmeans/dom-events.fbc8d9ac.js";import"../js/proc7ts/primitives.d6f0dd1c.js";import"../js/frontmeans/render-scheduler.6f331202.js";import"../js/proc7ts/push-iterator.8feb4ef8.js";import"../js/proc7ts/call-thru.f4f68410.js";import"../js/proc7ts/delta-set.d5d9e832.js";import"../js/proc7ts/context-values.20584faa.js";import"../js/hatsy/http-header-value.851567fb.js";import"../js/proc7ts/workbench.03f3f31a.js";import"../js/frontmeans/httongue.6b868a5b.js";let F=class{};F=e([f(["change-password",v],_({makeControl({node:s,aspects:e}){const r=t(s.element,{aspects:e}),i=r.convert({get:s=>s||"",set:s=>s||void 0},e,o.to(s.element));return r.aspect(a).derive(i.aspect(a)),i}}),d("password"))],F);let L=class{};L=e([f(["user-bio",v],_({select:"textarea",makeControl:({node:s,aspects:e})=>t(s.element,{aspects:e})}),d("bio"))],L);let q=class{};q=e([f(["user-image",v],_({makeControl:({node:s,aspects:e})=>t(s.element,{aspects:e})}),d("image"))],q);const E=["updated",v];let I=class{constructor(s){this._context=s,this.updated=!1,this._authService=s.get(S),this._authService.loadUser().do(n(s))((s=>{this.loadStatus=s,s&&s.ok&&this.setUser(s.body)}))}submit({control:s}){this.updated=!1,s.aspect(r).markEdited(),s.aspect(i).submit((s=>y(this._authService.updateSettings(s)))).then((s=>{this.setUser(s),this.updated=!0})).catch((s=>{s instanceof m?console.error("Failed to update user settings",...s.errors):console.error("Failed to update user settings",s)}))}render(){const{element:s}=this._context,e=c.name(E,this._context.get(g));return()=>{this.updated?s.classList.add(e):s.classList.remove(e)}}setUser({username:s,email:e,bio:t,image:o}){this._context.get(l).get(u).do(p)((a=>{a.control&&(a.control.it={username:s,email:e,bio:t,image:o})}))}};e([h()],I.prototype,"updated",void 0),e([k({comment:"settings"})],I.prototype,"loadStatus",void 0),e([j()],I.prototype,"submit",null),e([b()],I.prototype,"render",null),I=e([f(["settings",v],{feature:{needs:[F,U,L,w,q,C]}},x({emptyModel:{email:"",username:""}}))],I),s.load(I);//# sourceMappingURL=main.bf088f2b.js.map
