import"../js/proc7ts/fun-events.52028069.js";import{c as e}from"../js/proc7ts/namespace-aliaser.1d67b636.js";import{C as s,S as t,R as a,k as o}from"../js/wesib/wesib.5a50f1b5.js";import{_ as r}from"../js/helpers.e1623395.js";import{b as i}from"../js/core/auth.33eb0dd2.js";import{a as n}from"../js/core/api.e062ba10.js";import{S as c,O as m,a as p,c as d}from"../js/wesib/generic.e2a57dd1.js";import{r as l,d as u,h as j,b,q as f,I as h}from"../js/proc7ts/input-aspects.50499af4.js";import{C as g}from"../js/core.c852ba8c.js";import{a as v}from"../js/core/loader.b563ebf9.js";import{U as S,F as _,C as U}from"../js/core/input.dd6f29b8.js";import{c as k}from"../js/core/main.16ec9d81.js";import{U as y}from"../js/user-email.component.7f2b99be.js";import{U as C}from"../js/user-name.component.8c85d852.js";let w=(()=>{let e=class{};return e=r([s(["change-password",g],S({makeControl({node:e,aspects:s}){const t=l(e.element,{aspects:s}),a=t.convert({get:e=>e||"",set:e=>e||void 0},s,u.to(e.element));return t.aspect(j).derive(a.aspect(j)),a}}),c("password"))],e),e})(),x=(()=>{let e=class{};return e=r([s(["user-bio",g],S({select:"textarea",makeControl:({node:e,aspects:s})=>l(e.element,{aspects:s})}),c("bio"))],e),e})(),F=(()=>{let e=class{};return e=r([s(["user-image",g],S({makeControl:({node:e,aspects:s})=>l(e.element,{aspects:s})}),c("image"))],e),e})();const L=["updated",g];let O=(()=>{let c=class{constructor(e){this._context=e,this.updated=!1,this._authService=e.get(i),this._authService.loadUser().tillOff(e).to(e=>{this.loadStatus=e,e&&e.ok&&this.setUser(e.body)})}submit({control:e}){this.updated=!1,e.aspect(b).markEdited(),e.aspect(f).submit(e=>n(this._authService.updateSettings(e))).then(e=>{this.setUser(e),this.updated=!0}).catch(e=>{e instanceof h?console.error("Failed to update user settings",...e.errors):console.error("Failed to update user settings",e)})}render(){const{element:s}=this._context,t=e.name(L,this._context.get(o));return()=>{this.updated?s.classList.add(t):s.classList.remove(t)}}setUser({username:e,email:s,bio:t,image:a}){this._context.get(p).get(d).once(o=>{o.control&&(o.control.it={username:e,email:s,bio:t,image:a})})}};return r([t()],c.prototype,"updated",void 0),r([v({comment:"settings"})],c.prototype,"loadStatus",void 0),r([m()],c.prototype,"submit",null),r([a()],c.prototype,"render",null),c=r([s(["settings",g],{feature:{needs:[w,U,x,y,F,C]}},_({emptyModel:{email:"",username:""}}))],c),c})();k.load(O);//# sourceMappingURL=main.09d04822.js.map
