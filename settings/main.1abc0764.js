import"../js/proc7ts/fun-events.751f4123.js";import{c as e}from"../js/proc7ts/namespace-aliaser.16afa07c.js";import{C as s,S as t,R as a,l as o}from"../js/wesib/wesib.7b25387e.js";import{_ as r}from"../js/helpers.e1623395.js";import{b as i}from"../js/core/auth.94824694.js";import{a as c}from"../js/core/api.2eceae9c.js";import{S as m,O as n,a as p,c as l}from"../js/wesib/generic.69a57111.js";import{r as d,d as u,h as j,b as f,q as h,I as b}from"../js/proc7ts/input-aspects.9c95a66e.js";import{C as g}from"../js/core.21bb0d86.js";import{a as v}from"../js/core/loader.cc6fc823.js";import{c as S}from"../js/core/main.18a67af6.js";import{U as _,F as U,C as y}from"../js/core/input.3bfe5363.js";import{U as C}from"../js/user-email.component.4dfaaaff.js";import{U as k}from"../js/user-name.component.f3ccbde7.js";let w=class{};w=r([s(["change-password",g],_({makeControl({node:e,aspects:s}){const t=d(e.element,{aspects:s}),a=t.convert({get:e=>e||"",set:e=>e||void 0},s,u.to(e.element));return t.aspect(j).derive(a.aspect(j)),a}}),m("password"))],w);let x=class{};x=r([s(["user-bio",g],_({select:"textarea",makeControl:({node:e,aspects:s})=>d(e.element,{aspects:s})}),m("bio"))],x);let F=class{};F=r([s(["user-image",g],_({makeControl:({node:e,aspects:s})=>d(e.element,{aspects:s})}),m("image"))],F);const L=["updated",g];let O=class{constructor(e){this._context=e,this.updated=!1,this._authService=e.get(i),this._authService.loadUser().tillOff(e).to((e=>{this.loadStatus=e,e&&e.ok&&this.setUser(e.body)}))}submit({control:e}){this.updated=!1,e.aspect(f).markEdited(),e.aspect(h).submit((e=>c(this._authService.updateSettings(e)))).then((e=>{this.setUser(e),this.updated=!0})).catch((e=>{e instanceof b?console.error("Failed to update user settings",...e.errors):console.error("Failed to update user settings",e)}))}render(){const{element:s}=this._context,t=e.name(L,this._context.get(o));return()=>{this.updated?s.classList.add(t):s.classList.remove(t)}}setUser({username:e,email:s,bio:t,image:a}){this._context.get(p).get(l).once((o=>{o.control&&(o.control.it={username:e,email:s,bio:t,image:a})}))}};r([t()],O.prototype,"updated",void 0),r([v({comment:"settings"})],O.prototype,"loadStatus",void 0),r([n()],O.prototype,"submit",null),r([a()],O.prototype,"render",null),O=r([s(["settings",g],{feature:{needs:[w,y,x,C,F,k]}},U({emptyModel:{email:"",username:""}}))],O),S.load(O);//# sourceMappingURL=main.1abc0764.js.map
