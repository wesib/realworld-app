import{c as s}from"../js/core/main.9847b445.js";import{_ as t}from"../js/helpers.e1623395.js";import{w as e,d as o,h as r,v as a,m as i,b as m,u as p,I as n}from"../js/frontmeans/input-aspects.552a677b.js";import{c}from"../js/frontmeans/namespace-aliaser.9467f14d.js";import{y as d}from"../js/proc7ts/fun-events.0c993baf.js";import{S as u,k as l,i as j,O as h,j as f,d as b}from"../js/wesib/generic.36801613.js";import{C as v,S as y,R as S,k as g}from"../js/wesib/wesib.1ebc214d.js";import{C as w}from"../js/core.10059585.js";import{a as _}from"../js/core/api.e687a690.js";import{b as U}from"../js/core/auth.d58e7713.js";import{s as k,C as q}from"../js/core/forms.c0daa8d3.js";import{a as x}from"../js/core/loader.430f4736.js";import{c as C}from"../js/proc7ts/primitives.7b24aae7.js";import{U as B}from"../js/user-email.component.923fb1b8.js";import{U as F}from"../js/user-name.component.20a5f8a0.js";import"../js/core/layout.f26065db.js";import"../js/frontmeans/dom-events.ba8d072f.js";import"../js/proc7ts/supply.9762ee6d.js";import"../js/frontmeans/render-scheduler.6f331202.js";import"../js/proc7ts/push-iterator.ccd51d52.js";import"../js/proc7ts/call-thru.f4f68410.js";import"../js/proc7ts/delta-set.d5d9e832.js";import"../js/proc7ts/context-values.5140e67e.js";import"../js/hatsy/http-header-value.851567fb.js";import"../js/proc7ts/workbench.dbc8e30b.js";import"../js/frontmeans/httongue.6b868a5b.js";let L=class{constructor(s){s.whenSettled((({element:s})=>{this.password=l.by((({aspects:t})=>{const a=s.querySelector("input"),i=e(a,{aspects:t}),m=i.convert({get:s=>s||"",set:s=>s||void 0},o.to(a),...C(t));return i.aspect(r).derive(m.aspect(r)),m}))}))}};t([u()],L.prototype,"password",void 0),L=t([v(["change-password",w])],L);let E=class{constructor(s){s.whenSettled((({element:s})=>{this.bio=l.by((t=>e(s.querySelector("textarea"),t)))}))}};t([u()],E.prototype,"bio",void 0),E=t([v(["user-bio",w])],E);let I=class{constructor(s){s.whenSettled((({element:s})=>{this.image=l.by((t=>e(s.querySelector("input"),t)))}))}};t([u()],I.prototype,"image",void 0),I=t([v(["user-image",w])],I);const O=["updated",w];let R=class{constructor(s){this._context=s,this.updated=!1,this._authService=s.get(U),this._authService.loadUser().do(d(s))((s=>{this.loadStatus=s,s&&s.ok&&this.setUser(s.body)})),s.whenSettled((({element:s})=>{this.form=f.by((s=>a({email:"",username:""},s)),(t=>i(s.querySelector("form"),t))),this.submitButton=k(s.querySelector("button"))}))}submit({control:s}){this.updated=!1,s.aspect(m).markEdited(),s.aspect(p).submit((s=>_(this._authService.updateSettings(s)))).then((s=>{this.setUser(s),this.updated=!0})).catch((s=>{s instanceof n?console.error("Failed to update user settings",...s.errors):console.error("Failed to update user settings",s)}))}render(){const{element:s}=this._context,t=c.name(O,this._context.get(g));return()=>{this.updated?s.classList.add(t):s.classList.remove(t)}}setUser({username:s,email:t,bio:e,image:o}){var r;const a=null===(r=null==this?void 0:this.form)||void 0===r?void 0:r.control;a&&(a.it={username:s,email:t,bio:e,image:o})}};t([y()],R.prototype,"updated",void 0),t([x({comment:"settings"})],R.prototype,"loadStatus",void 0),t([j()],R.prototype,"form",void 0),t([u({form:{share:b,local:!0},name:""})],R.prototype,"submitButton",void 0),t([h()],R.prototype,"submit",null),t([S()],R.prototype,"render",null),R=t([v(["settings",w],{feature:{needs:[L,q,E,B,I,F]}})],R),s.load(R);//# sourceMappingURL=main.e8a8abcc.js.map
