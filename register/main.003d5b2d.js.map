{"version":3,"file":"main.003d5b2d.js","sources":["../../src/pages/register/register.component.ts","../../src/pages/register/main.ts"],"sourcesContent":["import { inFormElement, inGroup, InStatus, InSubmit, InSubmitError } from '@frontmeans/input-aspects';\nimport { HandleNavLinks, Navigation } from '@wesib/generic';\nimport { Field, Form, FormShare, OnSubmit, SharedField, SharedForm } from '@wesib/generic/forms';\nimport { Component, ComponentContext } from '@wesib/wesib';\nimport { Conduit__NS } from '../../core';\nimport { apiSubmit } from '../../core/api';\nimport { AuthService, RegisterRequest } from '../../core/auth';\nimport { ConduitFormsSupport, submitButton } from '../../core/forms';\nimport { UserEmailComponent } from '../settings/user-email.component';\nimport { UserNameComponent } from '../settings/user-name.component';\nimport { UserPasswordComponent } from '../settings/user-password.component';\n\n@Component(\n    ['register', Conduit__NS],\n    {\n      feature: {\n        needs: [\n          ConduitFormsSupport,\n          UserEmailComponent,\n          UserNameComponent,\n          UserPasswordComponent,\n        ],\n      },\n    },\n    HandleNavLinks(),\n)\nexport class RegisterComponent {\n\n  private readonly _authService: AuthService;\n  private readonly _navigation: Navigation;\n\n  @SharedForm()\n  form?: Form<RegisterRequest>;\n\n  @SharedField({\n    form: {\n      share: FormShare,\n      local: true,\n    },\n    name: '',\n  })\n  submitButton?: Field<void>;\n\n  constructor(context: ComponentContext) {\n    this._authService = context.get(AuthService);\n    this._navigation = context.get(Navigation);\n\n    context.whenSettled(({ element }: { element: Element }) => {\n      this.form = Form.by(\n          opts => inGroup(\n              {\n                username: '',\n                email: '',\n                password: '',\n              },\n              opts,\n          ),\n          opts => inFormElement(element.querySelector('form')!, opts),\n      );\n      this.submitButton = submitButton(element.querySelector('button')!);\n    });\n  }\n\n  @OnSubmit()\n  submit({ control }: Form.Controls<RegisterRequest>): void {\n    control.aspect(InStatus).markEdited();\n    control.aspect(InSubmit)\n        .submit(request => apiSubmit(this._authService.register(request)))\n        .then(() => this._navigation.open('.'))\n        .catch(e => {\n          if (e instanceof InSubmitError) {\n            console.error('Failed to register', ...e.errors);\n          } else {\n            console.error('Failed to register', e);\n          }\n        });\n  }\n\n}\n","import { conduitContext } from '../../core/main';\nimport { RegisterComponent } from './register.component';\n\nconduitContext.load(RegisterComponent);\n"],"names":["RegisterComponent","[object Object]","context","this","_authService","get","AuthService","_navigation","Navigation","whenSettled","element","form","Form","by","opts","inGroup","username","email","password","inFormElement","querySelector","submitButton","control","aspect","InStatus","markEdited","InSubmit","submit","request","apiSubmit","register","then","open","catch","e","InSubmitError","console","error","errors","__decorate","SharedForm","SharedField","share","FormShare","local","name","OnSubmit","Component","Conduit__NS","feature","needs","ConduitFormsSupport","UserEmailComponent","UserNameComponent","UserPasswordComponent","HandleNavLinks","conduitContext","load"],"mappings":"+2CA0BA,IAAaA,EAAb,MAiBEC,YAAYC,GACVC,KAAKC,aAAeF,EAAQG,IAAIC,GAChCH,KAAKI,YAAcL,EAAQG,IAAIG,GAE/BN,EAAQO,aAAY,EAAGC,QAAAA,MACrBP,KAAKQ,KAAOC,EAAKC,IACbC,GAAQC,EACJ,CACEC,SAAU,GACVC,MAAO,GACPC,SAAU,IAEZJ,KAEJA,GAAQK,EAAcT,EAAQU,cAAc,QAAUN,KAE1DX,KAAKkB,aAAeA,EAAaX,EAAQU,cAAc,cAK3DnB,QAAOqB,QAAEA,IACPA,EAAQC,OAAOC,GAAUC,aACzBH,EAAQC,OAAOG,GACVC,QAAOC,GAAWC,EAAU1B,KAAKC,aAAa0B,SAASF,MACvDG,MAAK,IAAM5B,KAAKI,YAAYyB,KAAK,OACjCC,OAAMC,IACDA,aAAaC,EACfC,QAAQC,MAAM,wBAAyBH,EAAEI,QAEzCF,QAAQC,MAAM,qBAAsBH,QAzC9CK,GADCC,gCAUDD,GAPCE,EAAY,CACX9B,KAAM,CACJ+B,MAAOC,EACPC,OAAO,GAETC,KAAM,yCAyBRN,GADCO,gCArCU9C,KAdZ+C,EACG,CAAC,WAAYC,GACb,CACEC,QAAS,CACPC,MAAO,CACLC,EACAC,EACAC,EACAC,KAINC,MAESvD,GCvBbwD,EAAeC,KAAKzD"}